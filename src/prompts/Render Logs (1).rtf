üì® GHL DM reply response: {



  status: 201,



  contactId: 'gC2s1kUJKLTY6YCVLlTF',



  conversationId: '6HPBVvpLDlkJq3ydqsux'



}



üì§ Sent AI bubbles to GHL conversation.



üß† Updating contact system fields from AI meta: {



  ai_phase: 'intake',



  lead_temperature: 'warm',



  consult_explained: undefined



}



‚ÑπÔ∏è No field_updates from AI to apply this turn.



‚ÑπÔ∏è No deposit link created (either not requested, already sent, or already paid). { wantsDepositLink: false, alreadyPaid: false, alreadySent: false }



POST /ghl/message-webhook



üí¨ GHL MESSAGE WEBHOOK HIT



Raw Body: {



  "consult_explained": "",



  "AI Creative Response": "",



  "Tattoo Style": "",



  "Promotional Link": "",



  "Appt 2: Start Time": "",



  "deposit_confirmation_sent": "",



  "Deposit Made On": "",



  "pending_slot_artist": "",



  "utm medium": "",



  "pending_slot_calendar": "",



  " Appt 2: Cancellation Link": "",



  "total_tattoos_completed": "",



  "Appt 1: Reschedule Link": "",



  "Tattoo Concerns": "",



  "Appt 1: Service": "",



  "reschedule_pending": "",



  "Appt 3: Reschedule Link": "",



  "utm campaign": "",



  "TikTok": "",



  "Tattoo Title": "",



  "reschedule_target_translator_appointment_id": "",



  "Follow Up Reason": "",



  "Technician's Address": "",



  "Square Payment ID": "",



  "Technician's Photo ID": "",



  "pending_slot_end": "",



  "I have been fully informed of the risks of body art including but not limited to infection, scarring, and allergic reactions to items associated with body art procedures. Technician will not perform the body art procedure if you fail to complete or sign this form. Further, technician may decline to perform a body art procedure if the client has any identified health conditions. Having been informed of the potential risks associated with this body art procedure, I still wish to proceed with the body art application and I assume any/all risks that may arise from body art.": "",



  "Appt 2: Start Date": "",



  "Appt 1: End Time": "",



  "Customer Lifetime Value": "",



  "times_sent": "",



  "Language Preference": "English",



  "First Tattoo": "",



  "pending_slot_mode": "",



  "Appt 2: Google Calendar": "",



  "Artist Inquired (Deseado)": "",



  "hold_last_activity_at": "",



  "last_released_slot_start": "",



  "AI Email Subject": "",



  "Instagram": "",



  "Appt 1: IOS/Outlook Calendar": "",



  "First Assigned Barber": "",



  "Appt 1: Start Date": "",



  "Deposit Paid": "",



  "Artist": "",



  "last_released_slot_display": "",



  "Appt 3: Cancellation Link": "",



  "Preferred Artist": "",



  "pending_slot_start": "",



  "Lead Temperature": "warm",



  "Square Payment Status": "",



  "Deposit": "",



  "Appt 3: Google Calendar": "",



  "Appt 3: IOS/Outlook Calendar": "",



  "Emergency Contact": "",



  "Appt 3: Start Date": "",



  "Whatsapp User?": "",



  "Other Social Media": "",



  "Technician's Phone Number": "",



  "Tattoo Color Preference": "",



  "Appt 1: Cancellation Link": "",



  "Last SMS": "",



  "Valid Body Art License": "",



  "Flash Tattoo": "",



  "Appt 1: Assigned User": "",



  "square_payment_link_id": "",



  "last_released_slot_calendar": "",



  "Rent vs Commission": "",



  "Appt 1: Start Time": "",



  "pending_slot_display": "",



  "Location of Tattoo": "",



  "I {{contact.full_name}}, the client, confirm that I have read the above statements, and by checking \"Yes\" below, you give your consent to receive BODY ART.": "",



  "Appt 3: Assigned User": "",



  "Referral: Current Referral Points": "",



  "How would you like us to contact you?": "",



  "returning_client": "",



  "hold_warning_sent": "",



  "Appt 3: End Time": "",



  "consultation_type": "",



  "Final Price": "",



  "Upload a Picture of a Valid ID (Driver's License, Gov ID, etc)": "",



  "Best time to contact you": "",



  "Notes to the Artist? (Optional)": "",



  "language_barrier_explained": "",



  "Application Notes": "",



  "Deposit Link Sent": "",



  "Tattoo Placement": "",



  "Appt 2: Reschedule Link": "",



  "client_lifetime_value": "",



  "Dwelling Type": "",



  "Appt 3: Start Time": "",



  "utm source": "",



  "Appt 1: Google Calendar": "",



  "Date of Procedure:": "",



  "Technician's DOB": "",



  "Referral Link Shortened": "",



  "reschedule_target_appointment_id": "",



  "hold_appointment_id": "",



  "Appt 2: IOS/Outlook Calendar": "",



  "Medical History": "",



  "Medical History (Description)": "",



  "Square Order ID": "",



  "Date Picker 3k8r": "",



  "Last Phase Update At": "2025-12-10T15:46:08.941Z",



  "Photo Reference (Referencia)": "",



  "Assigned Technician License #": "",



  "translator_needed": "",



  "Google Meet Link": "",



  "How Soon Is Client Deciding?": "",



  "Work Experience": "",



  "Appt 3: Service": "",



  "Appt 2: Service": "",



  "Project Complexity": "",



  "Appt 2: End Time": "",



  "Appt 2: Assigned User": "",



  "Square Reference ID": "",



  "translator_appointment_id": "",



  "Tattoo Photo Description": "",



  "Body Art License Number": "",



  "last_released_slot_end": "",



  "Tattoo Size": "",



  "Appt 3: End Date": "",



  "Tattoo Summary": "",



  "AI Phase": "intake",



  "Next Follow Up At": "",



  "Assigned Technician": "",



  "contact_id": "gC2s1kUJKLTY6YCVLlTF",



  "first_name": "Maria",



  "last_name": "Claflin",



  "full_name": "Maria Claflin",



  "tags": "dm consultation request",



  "country": "US",



  "date_created": "2025-12-10T15:45:48.808Z",



  "full_address": "",



  "contact_type": "lead",



  "location": {



    "name": "Studio AZ Tattoo",



    "address": "333 Washington Ave N STE 100",



    "city": "Minneapolis",



    "state": "Minnesota",



    "country": "US",



    "postalCode": "55401",



    "fullAddress": "333 Washington Ave N STE 100, Minneapolis Minnesota 55401",



    "id": "mUemx2jG4wly4kJWBkI4"



  },



  "message": {



    "type": 11,



    "body": "On my back towards my shoulder !"



  },



  "workflow": {



    "id": "8cf237bb-6cb1-4240-8ca5-b797bba8b769",



    "name": "Testing Ai Bot"



  },



  "triggerData": {},



  "contact": {



    "attributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    },



    "lastAttributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    }



  },



  "attributionSource": {},



  "customData": {



    "contactId": "gC2s1kUJKLTY6YCVLlTF",



    "messageBody": "On my back towards my shoulder !"



  }



}



üì° Channel context: { isDm: true, hasPhone: false, conversationId: null, phone: null }



Parsed contactId from message webhook: gC2s1kUJKLTY6YCVLlTF



‚úÖ Loaded Contact from GHL (message webhook): {



  id: 'gC2s1kUJKLTY6YCVLlTF',



  firstName: 'Maria',



  lastName: 'Claflin',



  tags: [ 'dm consultation request' ]



}



‚úÖ Found 0 appointments for contact gC2s1kUJKLTY6YCVLlTF



‚ùå Returning client detection failed: boolField is not a function



üì© Incoming message text (for language detection): On my back towards my shoulder !



üåê Updating language_preference based on DM/SMS detection: { previous: null, next: 'English' }



‚úÖ language_preference updated to English for contact: gC2s1kUJKLTY6YCVLlTF



üß† Derived system state (message): { currentPhase: 'intake', newPhase: 'intake', leadTemperature: 'warm' }



‚úÖ System fields updated for message webhook



üîÑ [PIPELINE] Syncing opportunity stage for contact gC2s1kUJKLTY6YCVLlTF: {



  currentStage: '(none)',



  targetStage: 'INTAKE',



  context: {



    aiPhase: 'intake',



    depositLinkSent: false,



    depositPaid: false,



    consultType: null,



    hasUpcomingTattoo: false,



    tattooCompleted: false,



    lost: false



  }



}



‚ùå Error syncing opportunity stage from message webhook: Request failed with status code 422



üîÑ Refetched contact after system field update for AI call.



ü§ñ Processing message with payload summary: {



  contactId: 'gC2s1kUJKLTY6YCVLlTF',



  leadTemperature: 'warm',



  aiPhase: 'intake',



  language: 'English',



  returning: false,



  hasTattooPlacement: false,



  hasTattooSize: false,



  depositPaid: false,



  depositLinkSent: false



}



üîÑ New generation 2 for contact gC2s1kUJKLTY6YCVLlTF



üì± Channel emoji support: yes



ü§ñ Raw OpenAI opener response: {



  "language": "en",



  "bubbles": [



    "Got it ‚Äî that back shoulder spot is a great canvas.",



    "What kind of design were you thinking for that area?"



  ],



  "internal_notes": "Acknowledged placement from user message, started intake by asking about design idea.",



  "meta": {



    "aiPhase": "intake",



    "leadTemperature": "warm",



    "wantsDepositLink": false,



    "depositPushedThisTurn": false,



    "mentionDecoyOffered": false,



    "consultMode": "online"



  },



  "field_updates": {



    "tattoo_placement": "back shoulder"



  }



}



üß† AI DECISION SUMMARY {



  aiPhaseFromAI: 'intake',



  leadTemperatureFromAI: 'warm',



  wantsDepositLink: false,



  wantsAppointmentOffer: undefined,



  consultMode: 'online',



  depositPushedThisTurn: false,



  mentionDecoyOffered: false,



  field_updates: { tattoo_placement: 'back shoulder' },



  bubblesPreview: [



    'Got it ‚Äî that back shoulder spot is a great canvas.',



    'What kind of design were you thinking for that area?'



  ]



}



ü§ñ AI DM suggestion: {



  "language": "en",



  "bubbles": [



    "Got it ‚Äî that back shoulder spot is a great canvas.",



    "What kind of design were you thinking for that area?"



  ],



  "internal_notes": "Acknowledged placement from user message, started intake by asking about design idea.",



  "meta": {



    "aiPhase": "intake",



    "leadTemperature": "warm",



    "wantsDepositLink": false,



    "depositPushedThisTurn": false,



    "mentionDecoyOffered": false,



    "consultMode": "online"



  },



  "field_updates": {



    "tattoo_placement": "back shoulder"



  }



}



‚úâÔ∏è sendConversationMessage context: { contactId: 'gC2s1kUJKLTY6YCVLlTF', isDm: true, hasPhone: false }



üîç No conversationId provided for DM, searching for existing conversation...



‚úÖ Found existing conversation 6HPBVvpLDlkJq3ydqsux with type FB



‚úÖ Using conversation type FB from GHL conversation - skipping ID validation



üì® Sending DM reply via GHL: {



  conversationId: '6HPBVvpLDlkJq3ydqsux',



  contactId: 'gC2s1kUJKLTY6YCVLlTF',



  message: 'Got it ‚Äî that back shoulder spot is a great canvas.',



  type: 'FB'



}



üì® GHL DM reply response: {



  status: 201,



  contactId: 'gC2s1kUJKLTY6YCVLlTF',



  conversationId: '6HPBVvpLDlkJq3ydqsux'



}



‚è± Waiting 8000ms before sending bubble 2...



‚úâÔ∏è sendConversationMessage context: { contactId: 'gC2s1kUJKLTY6YCVLlTF', isDm: true, hasPhone: false }



üîç No conversationId provided for DM, searching for existing conversation...



‚úÖ Found existing conversation 6HPBVvpLDlkJq3ydqsux with type FB



‚úÖ Using conversation type FB from GHL conversation - skipping ID validation



üì® Sending DM reply via GHL: {



  conversationId: '6HPBVvpLDlkJq3ydqsux',



  contactId: 'gC2s1kUJKLTY6YCVLlTF',



  message: 'What kind of design were you thinking for that area?',



  type: 'FB'



}



üì® GHL DM reply response: {



  status: 201,



  contactId: 'gC2s1kUJKLTY6YCVLlTF',



  conversationId: '6HPBVvpLDlkJq3ydqsux'



}



üì§ Sent AI bubbles to GHL conversation.



üß† Updating contact system fields from AI meta: {



  ai_phase: 'intake',



  lead_temperature: 'warm',



  consult_explained: undefined



}



üßæ Applying AI field_updates to GHL: { tattoo_placement: 'back shoulder' }



‚úÖ Updated tattoo fields for contact gC2s1kUJKLTY6YCVLlTF with { tattoo_placement: 'back shoulder' }



‚ÑπÔ∏è No deposit link created (either not requested, already sent, or already paid). { wantsDepositLink: false, alreadyPaid: false, alreadySent: false }



POST /ghl/message-webhook



üí¨ GHL MESSAGE WEBHOOK HIT



Raw Body: {



  "consult_explained": "",



  "AI Creative Response": "",



  "Tattoo Style": "",



  "Promotional Link": "",



  "Appt 2: Start Time": "",



  "deposit_confirmation_sent": "",



  "Deposit Made On": "",



  "pending_slot_artist": "",



  "utm medium": "",



  "pending_slot_calendar": "",



  " Appt 2: Cancellation Link": "",



  "total_tattoos_completed": "",



  "Appt 1: Reschedule Link": "",



  "Tattoo Concerns": "",



  "Appt 1: Service": "",



  "reschedule_pending": "",



  "Appt 3: Reschedule Link": "",



  "utm campaign": "",



  "TikTok": "",



  "Tattoo Title": "",



  "reschedule_target_translator_appointment_id": "",



  "Follow Up Reason": "",



  "Technician's Address": "",



  "Square Payment ID": "",



  "Technician's Photo ID": "",



  "pending_slot_end": "",



  "I have been fully informed of the risks of body art including but not limited to infection, scarring, and allergic reactions to items associated with body art procedures. Technician will not perform the body art procedure if you fail to complete or sign this form. Further, technician may decline to perform a body art procedure if the client has any identified health conditions. Having been informed of the potential risks associated with this body art procedure, I still wish to proceed with the body art application and I assume any/all risks that may arise from body art.": "",



  "Appt 2: Start Date": "",



  "Appt 1: End Time": "",



  "Customer Lifetime Value": "",



  "times_sent": "",



  "Language Preference": "English",



  "First Tattoo": "",



  "pending_slot_mode": "",



  "Appt 2: Google Calendar": "",



  "Artist Inquired (Deseado)": "",



  "hold_last_activity_at": "",



  "last_released_slot_start": "",



  "AI Email Subject": "",



  "Instagram": "",



  "Appt 1: IOS/Outlook Calendar": "",



  "First Assigned Barber": "",



  "Appt 1: Start Date": "",



  "Deposit Paid": "",



  "Artist": "",



  "last_released_slot_display": "",



  "Appt 3: Cancellation Link": "",



  "Preferred Artist": "",



  "pending_slot_start": "",



  "Lead Temperature": "warm",



  "Square Payment Status": "",



  "Deposit": "",



  "Appt 3: Google Calendar": "",



  "Appt 3: IOS/Outlook Calendar": "",



  "Emergency Contact": "",



  "Appt 3: Start Date": "",



  "Whatsapp User?": "",



  "Other Social Media": "",



  "Technician's Phone Number": "",



  "Tattoo Color Preference": "",



  "Appt 1: Cancellation Link": "",



  "Last SMS": "",



  "Valid Body Art License": "",



  "Flash Tattoo": "",



  "Appt 1: Assigned User": "",



  "square_payment_link_id": "",



  "last_released_slot_calendar": "",



  "Rent vs Commission": "",



  "Appt 1: Start Time": "",



  "pending_slot_display": "",



  "Location of Tattoo": "",



  "I {{contact.full_name}}, the client, confirm that I have read the above statements, and by checking \"Yes\" below, you give your consent to receive BODY ART.": "",



  "Appt 3: Assigned User": "",



  "Referral: Current Referral Points": "",



  "How would you like us to contact you?": "",



  "returning_client": "",



  "hold_warning_sent": "",



  "Appt 3: End Time": "",



  "consultation_type": "",



  "Final Price": "",



  "Upload a Picture of a Valid ID (Driver's License, Gov ID, etc)": "",



  "Best time to contact you": "",



  "Notes to the Artist? (Optional)": "",



  "language_barrier_explained": "",



  "Application Notes": "",



  "Deposit Link Sent": "",



  "Tattoo Placement": "back shoulder",



  "Appt 2: Reschedule Link": "",



  "client_lifetime_value": "",



  "Dwelling Type": "",



  "Appt 3: Start Time": "",



  "utm source": "",



  "Appt 1: Google Calendar": "",



  "Date of Procedure:": "",



  "Technician's DOB": "",



  "Referral Link Shortened": "",



  "reschedule_target_appointment_id": "",



  "hold_appointment_id": "",



  "Appt 2: IOS/Outlook Calendar": "",



  "Medical History": "",



  "Medical History (Description)": "",



  "Square Order ID": "",



  "Date Picker 3k8r": "",



  "Last Phase Update At": "2025-12-10T15:47:51.695Z",



  "Photo Reference (Referencia)": "",



  "Assigned Technician License #": "",



  "translator_needed": "",



  "Google Meet Link": "",



  "How Soon Is Client Deciding?": "",



  "Work Experience": "",



  "Appt 3: Service": "",



  "Appt 2: Service": "",



  "Project Complexity": "",



  "Appt 2: End Time": "",



  "Appt 2: Assigned User": "",



  "Square Reference ID": "",



  "translator_appointment_id": "",



  "Tattoo Photo Description": "",



  "Body Art License Number": "",



  "last_released_slot_end": "",



  "Tattoo Size": "",



  "Appt 3: End Date": "",



  "Tattoo Summary": "",



  "AI Phase": "intake",



  "Next Follow Up At": "",



  "Assigned Technician": "",



  "contact_id": "gC2s1kUJKLTY6YCVLlTF",



  "first_name": "Maria",



  "last_name": "Claflin",



  "full_name": "Maria Claflin",



  "tags": "dm consultation request",



  "country": "US",



  "date_created": "2025-12-10T15:45:48.808Z",



  "full_address": "",



  "contact_type": "lead",



  "location": {



    "name": "Studio AZ Tattoo",



    "address": "333 Washington Ave N STE 100",



    "city": "Minneapolis",



    "state": "Minnesota",



    "country": "US",



    "postalCode": "55401",



    "fullAddress": "333 Washington Ave N STE 100, Minneapolis Minnesota 55401",



    "id": "mUemx2jG4wly4kJWBkI4"



  },



  "message": {



    "type": 11,



    "body": "I was thinking a bouquet of flowers!"



  },



  "workflow": {



    "id": "8cf237bb-6cb1-4240-8ca5-b797bba8b769",



    "name": "Testing Ai Bot"



  },



  "triggerData": {},



  "contact": {



    "attributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    },



    "lastAttributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    }



  },



  "attributionSource": {},



  "customData": {



    "contactId": "gC2s1kUJKLTY6YCVLlTF",



    "messageBody": "I was thinking a bouquet of flowers!"



  }



}



üì° Channel context: { isDm: true, hasPhone: false, conversationId: null, phone: null }



Parsed contactId from message webhook: gC2s1kUJKLTY6YCVLlTF



‚úÖ Loaded Contact from GHL (message webhook): {



  id: 'gC2s1kUJKLTY6YCVLlTF',



  firstName: 'Maria',



  lastName: 'Claflin',



  tags: [ 'dm consultation request' ]



}



‚úÖ Found 0 appointments for contact gC2s1kUJKLTY6YCVLlTF



üì© Incoming message text (for language detection): I was thinking a bouquet of flowers!



‚ùå Returning client detection failed: boolField is not a function



üåê Updating language_preference based on DM/SMS detection: { previous: null, next: 'English' }



‚úÖ language_preference updated to English for contact: gC2s1kUJKLTY6YCVLlTF



üß† Derived system state (message): { currentPhase: 'intake', newPhase: 'intake', leadTemperature: 'warm' }



‚úÖ System fields updated for message webhook



üîÑ [PIPELINE] Syncing opportunity stage for contact gC2s1kUJKLTY6YCVLlTF: {



  currentStage: '(none)',



  targetStage: 'INTAKE',



  context: {



    aiPhase: 'intake',



    depositLinkSent: false,



    depositPaid: false,



    consultType: null,



    hasUpcomingTattoo: false,



    tattooCompleted: false,



    lost: false



  }



}



‚ùå Error syncing opportunity stage from message webhook: Request failed with status code 422



üîÑ Refetched contact after system field update for AI call.



ü§ñ Processing message with payload summary: {



  contactId: 'gC2s1kUJKLTY6YCVLlTF',



  leadTemperature: 'warm',



  aiPhase: 'intake',



  language: 'English',



  returning: false,



  hasTattooPlacement: true,



  hasTattooSize: false,



  depositPaid: false,



  depositLinkSent: false



}



üîÑ New generation 3 for contact gC2s1kUJKLTY6YCVLlTF



üì± Channel emoji support: yes



ü§ñ Raw OpenAI opener response: {



  "language": "en",



  "bubbles": [



    "Nice, a bouquet on your back shoulder will look really clean.",



    "Roughly how big were you thinking for this piece?"



  ],



  "internal_notes": "Acknowledged tattoo idea and placement, asking for size to continue intake phase.",



  "meta": {



    "aiPhase": "intake",



    "leadTemperature": "warm",



    "wantsDepositLink": false,



    "depositPushedThisTurn": false,



    "mentionDecoyOffered": false,



    "consultMode": "online"



  },



  "field_updates": {



    "tattoo_placement": "back shoulder",



    "tattoo_summary": "bouquet of flowers"



  }



}



üß† AI DECISION SUMMARY {



  aiPhaseFromAI: 'intake',



  leadTemperatureFromAI: 'warm',



  wantsDepositLink: false,



  wantsAppointmentOffer: undefined,



  consultMode: 'online',



  depositPushedThisTurn: false,



  mentionDecoyOffered: false,



  field_updates: {



    tattoo_placement: 'back shoulder',



    tattoo_summary: 'bouquet of flowers'



  },



  bubblesPreview: [



    'Nice, a bouquet on your back shoulder will look really clean.',



    'Roughly how big were you thinking for this piece?'



  ]



}



ü§ñ AI DM suggestion: {



  "language": "en",



  "bubbles": [



    "Nice, a bouquet on your back shoulder will look really clean.",



    "Roughly how big were you thinking for this piece?"



  ],



  "internal_notes": "Acknowledged tattoo idea and placement, asking for size to continue intake phase.",



  "meta": {



    "aiPhase": "intake",



    "leadTemperature": "warm",



    "wantsDepositLink": false,



    "depositPushedThisTurn": false,



    "mentionDecoyOffered": false,



    "consultMode": "online"



  },



  "field_updates": {



    "tattoo_placement": "back shoulder",



    "tattoo_summary": "bouquet of flowers"



  }



}



‚úâÔ∏è sendConversationMessage context: { contactId: 'gC2s1kUJKLTY6YCVLlTF', isDm: true, hasPhone: false }



üîç No conversationId provided for DM, searching for existing conversation...



‚úÖ Found existing conversation 6HPBVvpLDlkJq3ydqsux with type FB



‚úÖ Using conversation type FB from GHL conversation - skipping ID validation



üì® Sending DM reply via GHL: {



  conversationId: '6HPBVvpLDlkJq3ydqsux',



  contactId: 'gC2s1kUJKLTY6YCVLlTF',



  message: 'Nice, a bouquet on your back shoulder will look really clean.',



  type: 'FB'



}



üì® GHL DM reply response: {



  status: 201,



  contactId: 'gC2s1kUJKLTY6YCVLlTF',



  conversationId: '6HPBVvpLDlkJq3ydqsux'



}



‚è± Waiting 8000ms before sending bubble 2...



‚úâÔ∏è sendConversationMessage context: { contactId: 'gC2s1kUJKLTY6YCVLlTF', isDm: true, hasPhone: false }



üîç No conversationId provided for DM, searching for existing conversation...



‚úÖ Found existing conversation 6HPBVvpLDlkJq3ydqsux with type FB



‚úÖ Using conversation type FB from GHL conversation - skipping ID validation



üì® Sending DM reply via GHL: {



  conversationId: '6HPBVvpLDlkJq3ydqsux',



  contactId: 'gC2s1kUJKLTY6YCVLlTF',



  message: 'Roughly how big were you thinking for this piece?',



  type: 'FB'



}



üì® GHL DM reply response: {



  status: 201,



  contactId: 'gC2s1kUJKLTY6YCVLlTF',



  conversationId: '6HPBVvpLDlkJq3ydqsux'



}



üì§ Sent AI bubbles to GHL conversation.



üß† Updating contact system fields from AI meta: {



  ai_phase: 'intake',



  lead_temperature: 'warm',



  consult_explained: undefined



}



üßæ Applying AI field_updates to GHL: {



  tattoo_placement: 'back shoulder',



  tattoo_summary: 'bouquet of flowers'



}



‚úÖ Updated tattoo fields for contact gC2s1kUJKLTY6YCVLlTF with {



  tattoo_placement: 'back shoulder',



  tattoo_summary: 'bouquet of flowers'



}



‚ÑπÔ∏è No deposit link created (either not requested, already sent, or already paid). { wantsDepositLink: false, alreadyPaid: false, alreadySent: false }



POST /ghl/message-webhook



üí¨ GHL MESSAGE WEBHOOK HIT



Raw Body: {



  "consult_explained": "",



  "AI Creative Response": "",



  "Tattoo Style": "",



  "Promotional Link": "",



  "Appt 2: Start Time": "",



  "deposit_confirmation_sent": "",



  "Deposit Made On": "",



  "pending_slot_artist": "",



  "utm medium": "",



  "pending_slot_calendar": "",



  " Appt 2: Cancellation Link": "",



  "total_tattoos_completed": "",



  "Appt 1: Reschedule Link": "",



  "Tattoo Concerns": "",



  "Appt 1: Service": "",



  "reschedule_pending": "",



  "Appt 3: Reschedule Link": "",



  "utm campaign": "",



  "TikTok": "",



  "Tattoo Title": "",



  "reschedule_target_translator_appointment_id": "",



  "Follow Up Reason": "",



  "Technician's Address": "",



  "Square Payment ID": "",



  "Technician's Photo ID": "",



  "pending_slot_end": "",



  "I have been fully informed of the risks of body art including but not limited to infection, scarring, and allergic reactions to items associated with body art procedures. Technician will not perform the body art procedure if you fail to complete or sign this form. Further, technician may decline to perform a body art procedure if the client has any identified health conditions. Having been informed of the potential risks associated with this body art procedure, I still wish to proceed with the body art application and I assume any/all risks that may arise from body art.": "",



  "Appt 2: Start Date": "",



  "Appt 1: End Time": "",



  "Customer Lifetime Value": "",



  "times_sent": "",



  "Language Preference": "English",



  "First Tattoo": "",



  "pending_slot_mode": "",



  "Appt 2: Google Calendar": "",



  "Artist Inquired (Deseado)": "",



  "hold_last_activity_at": "",



  "last_released_slot_start": "",



  "AI Email Subject": "",



  "Instagram": "",



  "Appt 1: IOS/Outlook Calendar": "",



  "First Assigned Barber": "",



  "Appt 1: Start Date": "",



  "Deposit Paid": "",



  "Artist": "",



  "last_released_slot_display": "",



  "Appt 3: Cancellation Link": "",



  "Preferred Artist": "",



  "pending_slot_start": "",



  "Lead Temperature": "warm",



  "Square Payment Status": "",



  "Deposit": "",



  "Appt 3: Google Calendar": "",



  "Appt 3: IOS/Outlook Calendar": "",



  "Emergency Contact": "",



  "Appt 3: Start Date": "",



  "Whatsapp User?": "",



  "Other Social Media": "",



  "Technician's Phone Number": "",



  "Tattoo Color Preference": "",



  "Appt 1: Cancellation Link": "",



  "Last SMS": "",



  "Valid Body Art License": "",



  "Flash Tattoo": "",



  "Appt 1: Assigned User": "",



  "square_payment_link_id": "",



  "last_released_slot_calendar": "",



  "Rent vs Commission": "",



  "Appt 1: Start Time": "",



  "pending_slot_display": "",



  "Location of Tattoo": "",



  "I {{contact.full_name}}, the client, confirm that I have read the above statements, and by checking \"Yes\" below, you give your consent to receive BODY ART.": "",



  "Appt 3: Assigned User": "",



  "Referral: Current Referral Points": "",



  "How would you like us to contact you?": "",



  "returning_client": "",



  "hold_warning_sent": "",



  "Appt 3: End Time": "",



  "consultation_type": "",



  "Final Price": "",



  "Upload a Picture of a Valid ID (Driver's License, Gov ID, etc)": "",



  "Best time to contact you": "",



  "Notes to the Artist? (Optional)": "",



  "language_barrier_explained": "",



  "Application Notes": "",



  "Deposit Link Sent": "",



  "Tattoo Placement": "back shoulder",



  "Appt 2: Reschedule Link": "",



  "client_lifetime_value": "",



  "Dwelling Type": "",



  "Appt 3: Start Time": "",



  "utm source": "",



  "Appt 1: Google Calendar": "",



  "Date of Procedure:": "",



  "Technician's DOB": "",



  "Referral Link Shortened": "",



  "reschedule_target_appointment_id": "",



  "hold_appointment_id": "",



  "Appt 2: IOS/Outlook Calendar": "",



  "Medical History": "",



  "Medical History (Description)": "",



  "Square Order ID": "",



  "Date Picker 3k8r": "",



  "Last Phase Update At": "2025-12-10T15:48:52.998Z",



  "Photo Reference (Referencia)": "",



  "Assigned Technician License #": "",



  "translator_needed": "",



  "Google Meet Link": "",



  "How Soon Is Client Deciding?": "",



  "Work Experience": "",



  "Appt 3: Service": "",



  "Appt 2: Service": "",



  "Project Complexity": "",



  "Appt 2: End Time": "",



  "Appt 2: Assigned User": "",



  "Square Reference ID": "",



  "translator_appointment_id": "",



  "Tattoo Photo Description": "",



  "Body Art License Number": "",



  "last_released_slot_end": "",



  "Tattoo Size": "",



  "Appt 3: End Date": "",



  "Tattoo Summary": "bouquet of flowers",



  "AI Phase": "intake",



  "Next Follow Up At": "",



  "Assigned Technician": "",



  "contact_id": "gC2s1kUJKLTY6YCVLlTF",



  "first_name": "Maria",



  "last_name": "Claflin",



  "full_name": "Maria Claflin",



  "tags": "dm consultation request",



  "country": "US",



  "date_created": "2025-12-10T15:45:48.808Z",



  "full_address": "",



  "contact_type": "lead",



  "location": {



    "name": "Studio AZ Tattoo",



    "address": "333 Washington Ave N STE 100",



    "city": "Minneapolis",



    "state": "Minnesota",



    "country": "US",



    "postalCode": "55401",



    "fullAddress": "333 Washington Ave N STE 100, Minneapolis Minnesota 55401",



    "id": "mUemx2jG4wly4kJWBkI4"



  },



  "message": {



    "type": 11,



    "body": "Not sure, I want a second opinion on the size. Not too small not too big"



  },



  "workflow": {



    "id": "8cf237bb-6cb1-4240-8ca5-b797bba8b769",



    "name": "Testing Ai Bot"



  },



  "triggerData": {},



  "contact": {



    "attributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    },



    "lastAttributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    }



  },



  "attributionSource": {},



  "customData": {



    "contactId": "gC2s1kUJKLTY6YCVLlTF",



    "messageBody": "Not sure, I want a second opinion on the size. Not too small not too big"



  }



}



üì° Channel context: { isDm: true, hasPhone: false, conversationId: null, phone: null }



Parsed contactId from message webhook: gC2s1kUJKLTY6YCVLlTF



‚úÖ Loaded Contact from GHL (message webhook): {



  id: 'gC2s1kUJKLTY6YCVLlTF',



  firstName: 'Maria',



  lastName: 'Claflin',



  tags: [ 'dm consultation request' ]



}



‚úÖ Found 0 appointments for contact gC2s1kUJKLTY6YCVLlTF



‚ùå Returning client detection failed: boolField is not a function



üì© Incoming message text (for language detection): Not sure, I want a second opinion on the size. Not too small not too big



üåê Updating language_preference based on DM/SMS detection: { previous: null, next: 'English' }



‚úÖ language_preference updated to English for contact: gC2s1kUJKLTY6YCVLlTF



üß† Derived system state (message): { currentPhase: 'intake', newPhase: 'intake', leadTemperature: 'warm' }



‚úÖ System fields updated for message webhook



üîÑ [PIPELINE] Syncing opportunity stage for contact gC2s1kUJKLTY6YCVLlTF: {



  currentStage: '(none)',



  targetStage: 'INTAKE',



  context: {



    aiPhase: 'intake',



    depositLinkSent: false,



    depositPaid: false,



    consultType: null,



    hasUpcomingTattoo: false,



    tattooCompleted: false,



    lost: false



  }



}



‚ùå Error syncing opportunity stage from message webhook: Request failed with status code 422



üîÑ Refetched contact after system field update for AI call.



ü§ñ Processing message with payload summary: {



  contactId: 'gC2s1kUJKLTY6YCVLlTF',



  leadTemperature: 'warm',



  aiPhase: 'intake',



  language: 'English',



  returning: false,



  hasTattooPlacement: true,



  hasTattooSize: false,



  depositPaid: false,



  depositLinkSent: false



}



üîÑ New generation 4 for contact gC2s1kUJKLTY6YCVLlTF



üì± Channel emoji support: yes



ü§ñ Raw OpenAI opener response: {



  "language": "en",



  "bubbles": [



    "Got it ‚Äî that bouquet on your back shoulder needs to be just right size-wise.",



    "Do you have a rough size range in mind or should the artist help figure that out with you?"



  ],



  "internal_notes": "Acknowledged tattoo idea and placement; probing for size details to clarify before consult.",



  "meta": {



    "aiPhase": "intake",



    "leadTemperature": "warm",



    "wantsDepositLink": false,



    "depositPushedThisTurn": false,



    "mentionDecoyOffered": false,



    "consultMode": "online"



  },



  "field_updates": {



    "tattoo_placement": "back shoulder",



    "tattoo_summary": "bouquet of flowers"



  }



}



üß† AI DECISION SUMMARY {



  aiPhaseFromAI: 'intake',



  leadTemperatureFromAI: 'warm',



  wantsDepositLink: false,



  wantsAppointmentOffer: undefined,



  consultMode: 'online',



  depositPushedThisTurn: false,



  mentionDecoyOffered: false,



  field_updates: {



    tattoo_placement: 'back shoulder',



    tattoo_summary: 'bouquet of flowers'



  },



  bubblesPreview: [



    'Got it ‚Äî that bouquet on your back shoulder needs to be just right size-wise.',



    'Do you have a rough size range in mind or should the artist help figure that out'



  ]



}



ü§ñ AI DM suggestion: {



  "language": "en",



  "bubbles": [



    "Got it ‚Äî that bouquet on your back shoulder needs to be just right size-wise.",



    "Do you have a rough size range in mind or should the artist help figure that out with you?"



  ],



  "internal_notes": "Acknowledged tattoo idea and placement; probing for size details to clarify before consult.",



  "meta": {



    "aiPhase": "intake",



    "leadTemperature": "warm",



    "wantsDepositLink": false,



    "depositPushedThisTurn": false,



    "mentionDecoyOffered": false,



    "consultMode": "online"



  },



  "field_updates": {



    "tattoo_placement": "back shoulder",



    "tattoo_summary": "bouquet of flowers"



  }



}



‚úâÔ∏è sendConversationMessage context: { contactId: 'gC2s1kUJKLTY6YCVLlTF', isDm: true, hasPhone: false }



üîç No conversationId provided for DM, searching for existing conversation...



‚úÖ Found existing conversation 6HPBVvpLDlkJq3ydqsux with type FB



‚úÖ Using conversation type FB from GHL conversation - skipping ID validation



üì® Sending DM reply via GHL: {



  conversationId: '6HPBVvpLDlkJq3ydqsux',



  contactId: 'gC2s1kUJKLTY6YCVLlTF',



  message: 'Got it ‚Äî that bouquet on your back shoulder needs to be just right size-wise.',



  type: 'FB'



}



üì® GHL DM reply response: {



  status: 201,



  contactId: 'gC2s1kUJKLTY6YCVLlTF',



  conversationId: '6HPBVvpLDlkJq3ydqsux'



}



‚è± Waiting 12000ms before sending bubble 2...



‚úâÔ∏è sendConversationMessage context: { contactId: 'gC2s1kUJKLTY6YCVLlTF', isDm: true, hasPhone: false }



üîç No conversationId provided for DM, searching for existing conversation...



‚úÖ Found existing conversation 6HPBVvpLDlkJq3ydqsux with type FB



‚úÖ Using conversation type FB from GHL conversation - skipping ID validation



üì® Sending DM reply via GHL: {



  conversationId: '6HPBVvpLDlkJq3ydqsux',



  contactId: 'gC2s1kUJKLTY6YCVLlTF',



  message: 'Do you have a rough size range in mind or should the artist help figure that out with you?',



  type: 'FB'



}



üì® GHL DM reply response: {



  status: 201,



  contactId: 'gC2s1kUJKLTY6YCVLlTF',



  conversationId: '6HPBVvpLDlkJq3ydqsux'



}



üì§ Sent AI bubbles to GHL conversation.



üß† Updating contact system fields from AI meta: {



  ai_phase: 'intake',



  lead_temperature: 'warm',



  consult_explained: undefined



}



üßæ Applying AI field_updates to GHL: {



  tattoo_placement: 'back shoulder',



  tattoo_summary: 'bouquet of flowers'



}



‚úÖ Updated tattoo fields for contact gC2s1kUJKLTY6YCVLlTF with {



  tattoo_placement: 'back shoulder',



  tattoo_summary: 'bouquet of flowers'



}



‚ÑπÔ∏è No deposit link created (either not requested, already sent, or already paid). { wantsDepositLink: false, alreadyPaid: false, alreadySent: false }



POST /ghl/message-webhook



üí¨ GHL MESSAGE WEBHOOK HIT



Raw Body: {



  "consult_explained": "",



  "AI Creative Response": "",



  "Tattoo Style": "",



  "Promotional Link": "",



  "Appt 2: Start Time": "",



  "deposit_confirmation_sent": "",



  "Deposit Made On": "",



  "pending_slot_artist": "",



  "utm medium": "",



  "pending_slot_calendar": "",



  " Appt 2: Cancellation Link": "",



  "total_tattoos_completed": "",



  "Appt 1: Reschedule Link": "",



  "Tattoo Concerns": "",



  "Appt 1: Service": "",



  "reschedule_pending": "",



  "Appt 3: Reschedule Link": "",



  "utm campaign": "",



  "TikTok": "",



  "Tattoo Title": "",



  "reschedule_target_translator_appointment_id": "",



  "Follow Up Reason": "",



  "Technician's Address": "",



  "Square Payment ID": "",



  "Technician's Photo ID": "",



  "pending_slot_end": "",



  "I have been fully informed of the risks of body art including but not limited to infection, scarring, and allergic reactions to items associated with body art procedures. Technician will not perform the body art procedure if you fail to complete or sign this form. Further, technician may decline to perform a body art procedure if the client has any identified health conditions. Having been informed of the potential risks associated with this body art procedure, I still wish to proceed with the body art application and I assume any/all risks that may arise from body art.": "",



  "Appt 2: Start Date": "",



  "Appt 1: End Time": "",



  "Customer Lifetime Value": "",



  "times_sent": "",



  "Language Preference": "English",



  "First Tattoo": "",



  "pending_slot_mode": "",



  "Appt 2: Google Calendar": "",



  "Artist Inquired (Deseado)": "",



  "hold_last_activity_at": "",



  "last_released_slot_start": "",



  "AI Email Subject": "",



  "Instagram": "",



  "Appt 1: IOS/Outlook Calendar": "",



  "First Assigned Barber": "",



  "Appt 1: Start Date": "",



  "Deposit Paid": "",



  "Artist": "",



  "last_released_slot_display": "",



  "Appt 3: Cancellation Link": "",



  "Preferred Artist": "",



  "pending_slot_start": "",



  "Lead Temperature": "warm",



  "Square Payment Status": "",



  "Deposit": "",



  "Appt 3: Google Calendar": "",



  "Appt 3: IOS/Outlook Calendar": "",



  "Emergency Contact": "",



  "Appt 3: Start Date": "",



  "Whatsapp User?": "",



  "Other Social Media": "",



  "Technician's Phone Number": "",



  "Tattoo Color Preference": "",



  "Appt 1: Cancellation Link": "",



  "Last SMS": "",



  "Valid Body Art License": "",



  "Flash Tattoo": "",



  "Appt 1: Assigned User": "",



  "square_payment_link_id": "",



  "last_released_slot_calendar": "",



  "Rent vs Commission": "",



  "Appt 1: Start Time": "",



  "pending_slot_display": "",



  "Location of Tattoo": "",



  "I {{contact.full_name}}, the client, confirm that I have read the above statements, and by checking \"Yes\" below, you give your consent to receive BODY ART.": "",



  "Appt 3: Assigned User": "",



  "Referral: Current Referral Points": "",



  "How would you like us to contact you?": "",



  "returning_client": "",



  "hold_warning_sent": "",



  "Appt 3: End Time": "",



  "consultation_type": "",



  "Final Price": "",



  "Upload a Picture of a Valid ID (Driver's License, Gov ID, etc)": "",



  "Best time to contact you": "",



  "Notes to the Artist? (Optional)": "",



  "language_barrier_explained": "",



  "Application Notes": "",



  "Deposit Link Sent": "",



  "Tattoo Placement": "back shoulder",



  "Appt 2: Reschedule Link": "",



  "client_lifetime_value": "",



  "Dwelling Type": "",



  "Appt 3: Start Time": "",



  "utm source": "",



  "Appt 1: Google Calendar": "",



  "Date of Procedure:": "",



  "Technician's DOB": "",



  "Referral Link Shortened": "",



  "reschedule_target_appointment_id": "",



  "hold_appointment_id": "",



  "Appt 2: IOS/Outlook Calendar": "",



  "Medical History": "",



  "Medical History (Description)": "",



  "Square Order ID": "",



  "Date Picker 3k8r": "",



  "Last Phase Update At": "2025-12-10T15:51:24.240Z",



  "Photo Reference (Referencia)": "",



  "Assigned Technician License #": "",



  "translator_needed": "",



  "Google Meet Link": "",



  "How Soon Is Client Deciding?": "",



  "Work Experience": "",



  "Appt 3: Service": "",



  "Appt 2: Service": "",



  "Project Complexity": "",



  "Appt 2: End Time": "",



  "Appt 2: Assigned User": "",



  "Square Reference ID": "",



  "translator_appointment_id": "",



  "Tattoo Photo Description": "",



  "Body Art License Number": "",



  "last_released_slot_end": "",



  "Tattoo Size": "",



  "Appt 3: End Date": "",



  "Tattoo Summary": "bouquet of flowers",



  "AI Phase": "intake",



  "Next Follow Up At": "",



  "Assigned Technician": "",



  "contact_id": "gC2s1kUJKLTY6YCVLlTF",



  "first_name": "Maria",



  "last_name": "Claflin",



  "full_name": "Maria Claflin",



  "tags": "dm consultation request",



  "country": "US",



  "date_created": "2025-12-10T15:45:48.808Z",



  "full_address": "",



  "contact_type": "lead",



  "location": {



    "name": "Studio AZ Tattoo",



    "address": "333 Washington Ave N STE 100",



    "city": "Minneapolis",



    "state": "Minnesota",



    "country": "US",



    "postalCode": "55401",



    "fullAddress": "333 Washington Ave N STE 100, Minneapolis Minnesota 55401",



    "id": "mUemx2jG4wly4kJWBkI4"



  },



  "message": {



    "type": 11,



    "body": "The artist should help me figure it out!"



  },



  "workflow": {



    "id": "8cf237bb-6cb1-4240-8ca5-b797bba8b769",



    "name": "Testing Ai Bot"



  },



  "triggerData": {},



  "contact": {



    "attributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    },



    "lastAttributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    }



  },



  "attributionSource": {},



  "customData": {



    "contactId": "gC2s1kUJKLTY6YCVLlTF",



    "messageBody": "The artist should help me figure it out!"



  }



}



üì° Channel context: { isDm: true, hasPhone: false, conversationId: null, phone: null }



Parsed contactId from message webhook: gC2s1kUJKLTY6YCVLlTF



‚úÖ Loaded Contact from GHL (message webhook): {



  id: 'gC2s1kUJKLTY6YCVLlTF',



  firstName: 'Maria',



  lastName: 'Claflin',



  tags: [ 'dm consultation request' ]



}



‚úÖ Found 0 appointments for contact gC2s1kUJKLTY6YCVLlTF



‚ùå Returning client detection failed: boolField is not a function



üì© Incoming message text (for language detection): The artist should help me figure it out!



üåê Updating language_preference based on DM/SMS detection: { previous: null, next: 'English' }



‚úÖ language_preference updated to English for contact: gC2s1kUJKLTY6YCVLlTF



üß† Derived system state (message): { currentPhase: 'intake', newPhase: 'intake', leadTemperature: 'warm' }



‚úÖ System fields updated for message webhook



üîÑ [PIPELINE] Syncing opportunity stage for contact gC2s1kUJKLTY6YCVLlTF: {



  currentStage: '(none)',



  targetStage: 'INTAKE',



  context: {



    aiPhase: 'intake',



    depositLinkSent: false,



    depositPaid: false,



    consultType: null,



    hasUpcomingTattoo: false,



    tattooCompleted: false,



    lost: false



  }



}



‚ùå Error syncing opportunity stage from message webhook: Request failed with status code 422



üîÑ Refetched contact after system field update for AI call.



ü§ñ Processing message with payload summary: {



  contactId: 'gC2s1kUJKLTY6YCVLlTF',



  leadTemperature: 'warm',



  aiPhase: 'intake',



  language: 'English',



  returning: false,



  hasTattooPlacement: true,



  hasTattooSize: false,



  depositPaid: false,



  depositLinkSent: false



}



üîÑ New generation 5 for contact gC2s1kUJKLTY6YCVLlTF



üì± Channel emoji support: yes



ü§ñ Raw OpenAI opener response: {



  "language": "en",



  "bubbles": [



    "Got it ‚Äî that bouquet on your back shoulder is a great spot.",



    "When were you hoping to get it done?"



  ],



  "internal_notes": "Acknowledged tattoo placement and idea; asked for timing to move forward in intake phase.",



  "meta": {



    "aiPhase": "intake",



    "leadTemperature": "warm",



    "wantsDepositLink": false,



    "depositPushedThisTurn": false,



    "mentionDecoyOffered": false,



    "consultMode": "online"



  },



  "field_updates": {



    "tattoo_placement": "back shoulder",



    "tattoo_summary": "bouquet of flowers"



  }



}



üß† AI DECISION SUMMARY {



  aiPhaseFromAI: 'intake',



  leadTemperatureFromAI: 'warm',



  wantsDepositLink: false,



  wantsAppointmentOffer: undefined,



  consultMode: 'online',



  depositPushedThisTurn: false,



  mentionDecoyOffered: false,



  field_updates: {



    tattoo_placement: 'back shoulder',



    tattoo_summary: 'bouquet of flowers'



  },



  bubblesPreview: [



    'Got it ‚Äî that bouquet on your back shoulder is a great spot.',



    'When were you hoping to get it done?'



  ]



}



ü§ñ AI DM suggestion: {



  "language": "en",



  "bubbles": [



    "Got it ‚Äî that bouquet on your back shoulder is a great spot.",



    "When were you hoping to get it done?"



  ],



  "internal_notes": "Acknowledged tattoo placement and idea; asked for timing to move forward in intake phase.",



  "meta": {



    "aiPhase": "intake",



    "leadTemperature": "warm",



    "wantsDepositLink": false,



    "depositPushedThisTurn": false,



    "mentionDecoyOffered": false,



    "consultMode": "online"



  },



  "field_updates": {



    "tattoo_placement": "back shoulder",



    "tattoo_summary": "bouquet of flowers"



  }



}



‚úâÔ∏è sendConversationMessage context: { contactId: 'gC2s1kUJKLTY6YCVLlTF', isDm: true, hasPhone: false }



üîç No conversationId provided for DM, searching for existing conversation...



‚úÖ Found existing conversation 6HPBVvpLDlkJq3ydqsux with type FB



‚úÖ Using conversation type FB from GHL conversation - skipping ID validation



üì® Sending DM reply via GHL: {



  conversationId: '6HPBVvpLDlkJq3ydqsux',



  contactId: 'gC2s1kUJKLTY6YCVLlTF',



  message: 'Got it ‚Äî that bouquet on your back shoulder is a great spot.',



  type: 'FB'



}



üì® GHL DM reply response: {



  status: 201,



  contactId: 'gC2s1kUJKLTY6YCVLlTF',



  conversationId: '6HPBVvpLDlkJq3ydqsux'



}



‚è± Waiting 8000ms before sending bubble 2...



‚úâÔ∏è sendConversationMessage context: { contactId: 'gC2s1kUJKLTY6YCVLlTF', isDm: true, hasPhone: false }



üîç No conversationId provided for DM, searching for existing conversation...



‚úÖ Found existing conversation 6HPBVvpLDlkJq3ydqsux with type FB



‚úÖ Using conversation type FB from GHL conversation - skipping ID validation



üì® Sending DM reply via GHL: {



  conversationId: '6HPBVvpLDlkJq3ydqsux',



  contactId: 'gC2s1kUJKLTY6YCVLlTF',



  message: 'When were you hoping to get it done?',



  type: 'FB'



}



üì® GHL DM reply response: {



  status: 201,



  contactId: 'gC2s1kUJKLTY6YCVLlTF',



  conversationId: '6HPBVvpLDlkJq3ydqsux'



}



üì§ Sent AI bubbles to GHL conversation.



üß† Updating contact system fields from AI meta: {



  ai_phase: 'intake',



  lead_temperature: 'warm',



  consult_explained: undefined



}



üßæ Applying AI field_updates to GHL: {



  tattoo_placement: 'back shoulder',



  tattoo_summary: 'bouquet of flowers'



}



‚úÖ Updated tattoo fields for contact gC2s1kUJKLTY6YCVLlTF with {



  tattoo_placement: 'back shoulder',



  tattoo_summary: 'bouquet of flowers'



}



‚ÑπÔ∏è No deposit link created (either not requested, already sent, or already paid). { wantsDepositLink: false, alreadyPaid: false, alreadySent: false }



    "Got it ‚Äî that bouquet on your back shoulder is a great spot.",



    "When were you hoping to get it done?"



  ],



  "internal_notes": "Acknowledged tattoo placement and idea; asked for timing to move forward in intake phase.",



  "meta": {



    "aiPhase": "intake",



    "leadTemperature": "warm",



    "wantsDepositLink": false,



    "depositPushedThisTurn": false,



    "mentionDecoyOffered": false,



    "consultMode": "online"



  },



  "field_updates": {



    "tattoo_placement": "back shoulder",



    "tattoo_summary": "bouquet of flowers"



  }



}



üß† AI DECISION SUMMARY {



  aiPhaseFromAI: 'intake',



  leadTemperatureFromAI: 'warm',



  wantsDepositLink: false,



  wantsAppointmentOffer: undefined,



  consultMode: 'online',



  depositPushedThisTurn: false,



  mentionDecoyOffered: false,



  field_updates: {



    tattoo_placement: 'back shoulder',



    tattoo_summary: 'bouquet of flowers'



  },



  bubblesPreview: [



    'Got it ‚Äî that bouquet on your back shoulder is a great spot.',



    'When were you hoping to get it done?'



  ]



}



ü§ñ AI DM suggestion: {



  "language": "en",



  "bubbles": [



    "Got it ‚Äî that bouquet on your back shoulder is a great spot.",



    "When were you hoping to get it done?"



  ],



  "internal_notes": "Acknowledged tattoo placement and idea; asked for timing to move forward in intake phase.",



  "meta": {



    "aiPhase": "intake",



    "leadTemperature": "warm",



    "wantsDepositLink": false,



    "depositPushedThisTurn": false,



    "mentionDecoyOffered": false,



    "consultMode": "online"



  },



  "field_updates": {



    "tattoo_placement": "back shoulder",



    "tattoo_summary": "bouquet of flowers"



  }



}



‚úâÔ∏è sendConversationMessage context: { contactId: 'gC2s1kUJKLTY6YCVLlTF', isDm: true, hasPhone: false }



üîç No conversationId provided for DM, searching for existing conversation...



‚úÖ Found existing conversation 6HPBVvpLDlkJq3ydqsux with type FB



‚úÖ Using conversation type FB from GHL conversation - skipping ID validation



üì® Sending DM reply via GHL: {



  conversationId: '6HPBVvpLDlkJq3ydqsux',



  contactId: 'gC2s1kUJKLTY6YCVLlTF',



  message: 'Got it ‚Äî that bouquet on your back shoulder is a great spot.',



  type: 'FB'



}



üì® GHL DM reply response: {



  status: 201,



  contactId: 'gC2s1kUJKLTY6YCVLlTF',



  conversationId: '6HPBVvpLDlkJq3ydqsux'



}



‚è± Waiting 8000ms before sending bubble 2...



‚úâÔ∏è sendConversationMessage context: { contactId: 'gC2s1kUJKLTY6YCVLlTF', isDm: true, hasPhone: false }



üîç No conversationId provided for DM, searching for existing conversation...



‚úÖ Found existing conversation 6HPBVvpLDlkJq3ydqsux with type FB



‚úÖ Using conversation type FB from GHL conversation - skipping ID validation



üì® Sending DM reply via GHL: {



  conversationId: '6HPBVvpLDlkJq3ydqsux',



  contactId: 'gC2s1kUJKLTY6YCVLlTF',



  message: 'When were you hoping to get it done?',



  type: 'FB'



}



üì® GHL DM reply response: {



  status: 201,



  contactId: 'gC2s1kUJKLTY6YCVLlTF',



  conversationId: '6HPBVvpLDlkJq3ydqsux'



}



üì§ Sent AI bubbles to GHL conversation.



üß† Updating contact system fields from AI meta: {



  ai_phase: 'intake',



  lead_temperature: 'warm',



  consult_explained: undefined



}



üßæ Applying AI field_updates to GHL: {



  tattoo_placement: 'back shoulder',



  tattoo_summary: 'bouquet of flowers'



}



‚úÖ Updated tattoo fields for contact gC2s1kUJKLTY6YCVLlTF with {



  tattoo_placement: 'back shoulder',



  tattoo_summary: 'bouquet of flowers'



}



‚ÑπÔ∏è No deposit link created (either not requested, already sent, or already paid). { wantsDepositLink: false, alreadyPaid: false, alreadySent: false }



POST /ghl/message-webhook



üí¨ GHL MESSAGE WEBHOOK HIT



Raw Body: {



  "consult_explained": "",



  "AI Creative Response": "",



  "Tattoo Style": "",



  "Promotional Link": "",



  "Appt 2: Start Time": "",



  "deposit_confirmation_sent": "",



  "Deposit Made On": "",



  "pending_slot_artist": "",



  "utm medium": "",



  "pending_slot_calendar": "",



  " Appt 2: Cancellation Link": "",



  "total_tattoos_completed": "",



  "Appt 1: Reschedule Link": "",



  "Tattoo Concerns": "",



  "Appt 1: Service": "",



  "reschedule_pending": "",



  "Appt 3: Reschedule Link": "",



  "utm campaign": "",



  "TikTok": "",



  "Tattoo Title": "",



  "reschedule_target_translator_appointment_id": "",



  "Follow Up Reason": "",



  "Technician's Address": "",



  "Square Payment ID": "",



  "Technician's Photo ID": "",



  "pending_slot_end": "",



  "I have been fully informed of the risks of body art including but not limited to infection, scarring, and allergic reactions to items associated with body art procedures. Technician will not perform the body art procedure if you fail to complete or sign this form. Further, technician may decline to perform a body art procedure if the client has any identified health conditions. Having been informed of the potential risks associated with this body art procedure, I still wish to proceed with the body art application and I assume any/all risks that may arise from body art.": "",



  "Appt 2: Start Date": "",



  "Appt 1: End Time": "",



  "Customer Lifetime Value": "",



  "times_sent": "",



  "Language Preference": "English",



  "First Tattoo": "",



  "pending_slot_mode": "",



  "Appt 2: Google Calendar": "",



  "Artist Inquired (Deseado)": "",



  "hold_last_activity_at": "",



  "last_released_slot_start": "",



  "AI Email Subject": "",



  "Instagram": "",



  "Appt 1: IOS/Outlook Calendar": "",



  "First Assigned Barber": "",



  "Appt 1: Start Date": "",



  "Deposit Paid": "",



  "Artist": "",



  "last_released_slot_display": "",



  "Appt 3: Cancellation Link": "",



  "Preferred Artist": "",



  "pending_slot_start": "",



  "Lead Temperature": "warm",



  "Square Payment Status": "",



  "Deposit": "",



  "Appt 3: Google Calendar": "",



  "Appt 3: IOS/Outlook Calendar": "",



  "Emergency Contact": "",



  "Appt 3: Start Date": "",



  "Whatsapp User?": "",



  "Other Social Media": "",



  "Technician's Phone Number": "",



  "Tattoo Color Preference": "",



  "Appt 1: Cancellation Link": "",



  "Last SMS": "",



  "Valid Body Art License": "",



  "Flash Tattoo": "",



  "Appt 1: Assigned User": "",



  "square_payment_link_id": "",



  "last_released_slot_calendar": "",



  "Rent vs Commission": "",



  "Appt 1: Start Time": "",



  "pending_slot_display": "",



  "Location of Tattoo": "",



  "I {{contact.full_name}}, the client, confirm that I have read the above statements, and by checking \"Yes\" below, you give your consent to receive BODY ART.": "",



  "Appt 3: Assigned User": "",



  "Referral: Current Referral Points": "",



  "How would you like us to contact you?": "",



  "returning_client": "",



  "hold_warning_sent": "",



  "Appt 3: End Time": "",



  "consultation_type": "",



  "Final Price": "",



  "Upload a Picture of a Valid ID (Driver's License, Gov ID, etc)": "",



  "Best time to contact you": "",



  "Notes to the Artist? (Optional)": "",



  "language_barrier_explained": "",



  "Application Notes": "",



  "Deposit Link Sent": "",



  "Tattoo Placement": "back shoulder",



  "Appt 2: Reschedule Link": "",



  "client_lifetime_value": "",



  "Dwelling Type": "",



  "Appt 3: Start Time": "",



  "utm source": "",



  "Appt 1: Google Calendar": "",



  "Date of Procedure:": "",



  "Technician's DOB": "",



  "Referral Link Shortened": "",



  "reschedule_target_appointment_id": "",



  "hold_appointment_id": "",



  "Appt 2: IOS/Outlook Calendar": "",



  "Medical History": "",



  "Medical History (Description)": "",



  "Square Order ID": "",



  "Date Picker 3k8r": "",



  "Last Phase Update At": "2025-12-10T15:52:17.618Z",



  "Photo Reference (Referencia)": "",



  "Assigned Technician License #": "",



  "translator_needed": "",



  "Google Meet Link": "",



  "How Soon Is Client Deciding?": "",



  "Work Experience": "",



  "Appt 3: Service": "",



  "Appt 2: Service": "",



  "Project Complexity": "",



  "Appt 2: End Time": "",



  "Appt 2: Assigned User": "",



  "Square Reference ID": "",



  "translator_appointment_id": "",



  "Tattoo Photo Description": "",



  "Body Art License Number": "",



  "last_released_slot_end": "",



  "Tattoo Size": "",



  "Appt 3: End Date": "",



  "Tattoo Summary": "bouquet of flowers",



  "AI Phase": "intake",



  "Next Follow Up At": "",



  "Assigned Technician": "",



  "contact_id": "gC2s1kUJKLTY6YCVLlTF",



  "first_name": "Maria",



  "last_name": "Claflin",



  "full_name": "Maria Claflin",



  "tags": "dm consultation request",



  "country": "US",



  "date_created": "2025-12-10T15:45:48.808Z",



  "full_address": "",



  "contact_type": "lead",



  "location": {



    "name": "Studio AZ Tattoo",



    "address": "333 Washington Ave N STE 100",



    "city": "Minneapolis",



    "state": "Minnesota",



    "country": "US",



    "postalCode": "55401",



    "fullAddress": "333 Washington Ave N STE 100, Minneapolis Minnesota 55401",



    "id": "mUemx2jG4wly4kJWBkI4"



  },



  "message": {



    "type": 11,



    "body": "December!"



  },



  "workflow": {



    "id": "8cf237bb-6cb1-4240-8ca5-b797bba8b769",



    "name": "Testing Ai Bot"



  },



  "triggerData": {},



  "contact": {



    "attributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    },



    "lastAttributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    }



  },



  "attributionSource": {},



  "customData": {



    "contactId": "gC2s1kUJKLTY6YCVLlTF",



    "messageBody": "December!"



  }



}



üì° Channel context: { isDm: true, hasPhone: false, conversationId: null, phone: null }



Parsed contactId from message webhook: gC2s1kUJKLTY6YCVLlTF



‚úÖ Loaded Contact from GHL (message webhook): {



  id: 'gC2s1kUJKLTY6YCVLlTF',



  firstName: 'Maria',



  lastName: 'Claflin',



  tags: [ 'dm consultation request' ]



}



‚úÖ Found 0 appointments for contact gC2s1kUJKLTY6YCVLlTF



‚ùå Returning client detection failed: boolField is not a function



üì© Incoming message text (for language detection): December!



üåê Updating language_preference based on DM/SMS detection: { previous: null, next: 'English' }



‚úÖ language_preference updated to English for contact: gC2s1kUJKLTY6YCVLlTF



üß† Derived system state (message): { currentPhase: 'intake', newPhase: 'intake', leadTemperature: 'warm' }



‚úÖ System fields updated for message webhook



üîÑ [PIPELINE] Syncing opportunity stage for contact gC2s1kUJKLTY6YCVLlTF: {



  currentStage: '(none)',



  targetStage: 'INTAKE',



  context: {



    aiPhase: 'intake',



    depositLinkSent: false,



    depositPaid: false,



    consultType: null,



    hasUpcomingTattoo: false,



    tattooCompleted: false,



    lost: false



  }



}



‚ùå Error syncing opportunity stage from message webhook: Request failed with status code 422



üîÑ Refetched contact after system field update for AI call.



ü§ñ Processing message with payload summary: {



  contactId: 'gC2s1kUJKLTY6YCVLlTF',



  leadTemperature: 'warm',



  aiPhase: 'intake',



  language: 'English',



  returning: false,



  hasTattooPlacement: true,



  hasTattooSize: false,



  depositPaid: false,



  depositLinkSent: false



}



üîÑ New generation 6 for contact gC2s1kUJKLTY6YCVLlTF



üì± Channel emoji support: yes



ü§ñ Raw OpenAI opener response: {



  "language": "en",



  "bubbles": [



    "Got it ‚Äî that bouquet of flowers on your back shoulder is gonna look clean.",



    "December works. The next step is a quick 15‚Äì20 minute consultation with the artist to fully understand your design.",



    "Would you prefer a video call or to go back and forth in messages?"



  ],



  "internal_notes": "Acknowledged tattoo idea and placement, confirmed timing month, introduced consult and asked for preferred consult mode.",



  "meta": {



    "aiPhase": "intake",



    "leadTemperature": "warm",



    "wantsDepositLink": false,



    "depositPushedThisTurn": false,



    "mentionDecoyOffered": false,



    "consultMode": "online"



  },



  "field_updates": {



    "tattoo_placement": "back shoulder",



    "tattoo_summary": "bouquet of flowers",



    "how_soon_is_client_deciding": "December"



  }



}



üß† AI DECISION SUMMARY {



  aiPhaseFromAI: 'intake',



  leadTemperatureFromAI: 'warm',



  wantsDepositLink: false,



  wantsAppointmentOffer: undefined,



  consultMode: 'online',



  depositPushedThisTurn: false,



  mentionDecoyOffered: false,



  field_updates: {



    tattoo_placement: 'back shoulder',



    tattoo_summary: 'bouquet of flowers',



    how_soon_is_client_deciding: 'December'



  },



  bubblesPreview: [



    'Got it ‚Äî that bouquet of flowers on your back shoulder is gonna look clean.',



    'December works. The next step is a quick 15‚Äì20 minute consultation with the arti',



    'Would you prefer a video call or to go back and forth in messages?'



  ]



}



ü§ñ AI DM suggestion: {



  "language": "en",



  "bubbles": [



    "Got it ‚Äî that bouquet of flowers on your back shoulder is gonna look clean.",



    "December works. The next step is a quick 15‚Äì20 minute consultation with the artist to fully understand your design.",



    "Would you prefer a video call or to go back and forth in messages?"



  ],



  "internal_notes": "Acknowledged tattoo idea and placement, confirmed timing month, introduced consult and asked for preferred consult mode.",



  "meta": {



    "aiPhase": "intake",



    "leadTemperature": "warm",



    "wantsDepositLink": false,



    "depositPushedThisTurn": false,



    "mentionDecoyOffered": false,



    "consultMode": "online"



  },



  "field_updates": {



    "tattoo_placement": "back shoulder",



    "tattoo_summary": "bouquet of flowers",



    "how_soon_is_client_deciding": "December"



  }



}



‚úâÔ∏è sendConversationMessage context: { contactId: 'gC2s1kUJKLTY6YCVLlTF', isDm: true, hasPhone: false }



üîç No conversationId provided for DM, searching for existing conversation...



‚úÖ Found existing conversation 6HPBVvpLDlkJq3ydqsux with type FB



‚úÖ Using conversation type FB from GHL conversation - skipping ID validation



üì® Sending DM reply via GHL: {



  conversationId: '6HPBVvpLDlkJq3ydqsux',



  contactId: 'gC2s1kUJKLTY6YCVLlTF',



  message: 'December works. The next step is a quick 15‚Äì20 minute consultation with the artist to fully understand your design.',



  type: 'FB'



}



üì® GHL DM reply response: {



  status: 201,



  contactId: 'gC2s1kUJKLTY6YCVLlTF',



  conversationId: '6HPBVvpLDlkJq3ydqsux'



}



‚è± Waiting 8000ms before sending bubble 2...



‚úâÔ∏è sendConversationMessage context: { contactId: 'gC2s1kUJKLTY6YCVLlTF', isDm: true, hasPhone: false }



üîç No conversationId provided for DM, searching for existing conversation...



‚úÖ Found existing conversation 6HPBVvpLDlkJq3ydqsux with type FB



‚úÖ Using conversation type FB from GHL conversation - skipping ID validation



üì® Sending DM reply via GHL: {



  conversationId: '6HPBVvpLDlkJq3ydqsux',



  contactId: 'gC2s1kUJKLTY6YCVLlTF',



  message: 'Would you prefer a video call or to go back and forth in messages?',



  type: 'FB'



}



üì® GHL DM reply response: {



  status: 201,



  contactId: 'gC2s1kUJKLTY6YCVLlTF',



  conversationId: '6HPBVvpLDlkJq3ydqsux'



}



üì§ Sent AI bubbles to GHL conversation.



üß† Updating contact system fields from AI meta: {



  ai_phase: 'intake',



  lead_temperature: 'warm',



  consult_explained: undefined



}



üßæ Applying AI field_updates to GHL: {



  tattoo_placement: 'back shoulder',



  tattoo_summary: 'bouquet of flowers',



  how_soon_is_client_deciding: 'December'



}



‚úÖ Updated tattoo fields for contact gC2s1kUJKLTY6YCVLlTF with {



  tattoo_placement: 'back shoulder',



  tattoo_summary: 'bouquet of flowers',



  how_soon_is_client_deciding: 'December'



}



‚ÑπÔ∏è No deposit link created (either not requested, already sent, or already paid). { wantsDepositLink: false, alreadyPaid: false, alreadySent: false }



POST /ghl/message-webhook



üí¨ GHL MESSAGE WEBHOOK HIT



Raw Body: {



  "consult_explained": "",



  "AI Creative Response": "",



  "Tattoo Style": "",



  "Promotional Link": "",



  "Appt 2: Start Time": "",



  "deposit_confirmation_sent": "",



  "Deposit Made On": "",



  "pending_slot_artist": "",



  "utm medium": "",



  "pending_slot_calendar": "",



  " Appt 2: Cancellation Link": "",



  "total_tattoos_completed": "",



  "Appt 1: Reschedule Link": "",



  "Tattoo Concerns": "",



  "Appt 1: Service": "",



  "reschedule_pending": "",



  "Appt 3: Reschedule Link": "",



  "utm campaign": "",



  "TikTok": "",



  "Tattoo Title": "",



  "reschedule_target_translator_appointment_id": "",



  "Follow Up Reason": "",



  "Technician's Address": "",



  "Square Payment ID": "",



  "Technician's Photo ID": "",



  "pending_slot_end": "",



  "I have been fully informed of the risks of body art including but not limited to infection, scarring, and allergic reactions to items associated with body art procedures. Technician will not perform the body art procedure if you fail to complete or sign this form. Further, technician may decline to perform a body art procedure if the client has any identified health conditions. Having been informed of the potential risks associated with this body art procedure, I still wish to proceed with the body art application and I assume any/all risks that may arise from body art.": "",



  "Appt 2: Start Date": "",



  "Appt 1: End Time": "",



  "Customer Lifetime Value": "",



  "times_sent": "",



  "Language Preference": "English",



  "First Tattoo": "",



  "pending_slot_mode": "",



  "Appt 2: Google Calendar": "",



  "Artist Inquired (Deseado)": "",



  "hold_last_activity_at": "",



  "last_released_slot_start": "",



  "AI Email Subject": "",



  "Instagram": "",



  "Appt 1: IOS/Outlook Calendar": "",



  "First Assigned Barber": "",



  "Appt 1: Start Date": "",



  "Deposit Paid": "",



  "Artist": "",



  "last_released_slot_display": "",



  "Appt 3: Cancellation Link": "",



  "Preferred Artist": "",



  "pending_slot_start": "",



  "Lead Temperature": "warm",



  "Square Payment Status": "",



  "Deposit": "",



  "Appt 3: Google Calendar": "",



  "Appt 3: IOS/Outlook Calendar": "",



  "Emergency Contact": "",



  "Appt 3: Start Date": "",



  "Whatsapp User?": "",



  "Other Social Media": "",



  "Technician's Phone Number": "",



  "Tattoo Color Preference": "",



  "Appt 1: Cancellation Link": "",



  "Last SMS": "",



  "Valid Body Art License": "",



  "Flash Tattoo": "",



  "Appt 1: Assigned User": "",



  "square_payment_link_id": "",



  "last_released_slot_calendar": "",



  "Rent vs Commission": "",



  "Appt 1: Start Time": "",



  "pending_slot_display": "",



  "Location of Tattoo": "",



  "I {{contact.full_name}}, the client, confirm that I have read the above statements, and by checking \"Yes\" below, you give your consent to receive BODY ART.": "",



  "Appt 3: Assigned User": "",



  "Referral: Current Referral Points": "",



  "How would you like us to contact you?": "",



  "returning_client": "",



  "hold_warning_sent": "",



  "Appt 3: End Time": "",



  "consultation_type": "",



  "Final Price": "",



  "Upload a Picture of a Valid ID (Driver's License, Gov ID, etc)": "",



  "Best time to contact you": "",



  "Notes to the Artist? (Optional)": "",



  "language_barrier_explained": "",



  "Application Notes": "",



  "Deposit Link Sent": "",



  "Tattoo Placement": "back shoulder",



  "Appt 2: Reschedule Link": "",



  "client_lifetime_value": "",



  "Dwelling Type": "",



  "Appt 3: Start Time": "",



  "utm source": "",



  "Appt 1: Google Calendar": "",



  "Date of Procedure:": "",



  "Technician's DOB": "",



  "Referral Link Shortened": "",



  "reschedule_target_appointment_id": "",



  "hold_appointment_id": "",



  "Appt 2: IOS/Outlook Calendar": "",



  "Medical History": "",



  "Medical History (Description)": "",



  "Square Order ID": "",



  "Date Picker 3k8r": "",



  "Last Phase Update At": "2025-12-10T15:53:03.706Z",



  "Photo Reference (Referencia)": "",



  "Assigned Technician License #": "",



  "translator_needed": "",



  "Google Meet Link": "",



  "How Soon Is Client Deciding?": "December",



  "Work Experience": "",



  "Appt 3: Service": "",



  "Appt 2: Service": "",



  "Project Complexity": "",



  "Appt 2: End Time": "",



  "Appt 2: Assigned User": "",



  "Square Reference ID": "",



  "translator_appointment_id": "",



  "Tattoo Photo Description": "",



  "Body Art License Number": "",



  "last_released_slot_end": "",



  "Tattoo Size": "",



  "Appt 3: End Date": "",



  "Tattoo Summary": "bouquet of flowers",



  "AI Phase": "intake",



  "Next Follow Up At": "",



  "Assigned Technician": "",



  "contact_id": "gC2s1kUJKLTY6YCVLlTF",



  "first_name": "Maria",



  "last_name": "Claflin",



  "full_name": "Maria Claflin",



  "tags": "dm consultation request",



  "country": "US",



  "date_created": "2025-12-10T15:45:48.808Z",



  "full_address": "",



  "contact_type": "lead",



  "location": {



    "name": "Studio AZ Tattoo",



    "address": "333 Washington Ave N STE 100",



    "city": "Minneapolis",



    "state": "Minnesota",



    "country": "US",



    "postalCode": "55401",



    "fullAddress": "333 Washington Ave N STE 100, Minneapolis Minnesota 55401",



    "id": "mUemx2jG4wly4kJWBkI4"



  },



  "message": {



    "type": 11,



    "body": "Video call!"



  },



  "workflow": {



    "id": "8cf237bb-6cb1-4240-8ca5-b797bba8b769",



    "name": "Testing Ai Bot"



  },



  "triggerData": {},



  "contact": {



    "attributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    },



    "lastAttributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    }



  },



  "attributionSource": {},



  "customData": {



    "contactId": "gC2s1kUJKLTY6YCVLlTF",



    "messageBody": "Video call!"



  }



}



üì° Channel context: { isDm: true, hasPhone: false, conversationId: null, phone: null }



Parsed contactId from message webhook: gC2s1kUJKLTY6YCVLlTF



‚úÖ Loaded Contact from GHL (message webhook): {



  id: 'gC2s1kUJKLTY6YCVLlTF',



  firstName: 'Maria',



  lastName: 'Claflin',



  tags: [ 'dm consultation request' ]



}



‚úÖ Found 0 appointments for contact gC2s1kUJKLTY6YCVLlTF



üì© Incoming message text (for language detection): Video call!



‚ùå Returning client detection failed: boolField is not a function



üåê Updating language_preference based on DM/SMS detection: { previous: null, next: 'English' }



‚úÖ language_preference updated to English for contact: gC2s1kUJKLTY6YCVLlTF



üß† Derived system state (message): { currentPhase: 'intake', newPhase: 'intake', leadTemperature: 'warm' }



‚úÖ System fields updated for message webhook



üîÑ [PIPELINE] Syncing opportunity stage for contact gC2s1kUJKLTY6YCVLlTF: {



  currentStage: '(none)',



  targetStage: 'INTAKE',



  context: {



    aiPhase: 'intake',



    depositLinkSent: false,



    depositPaid: false,



    consultType: null,



    hasUpcomingTattoo: false,



    tattooCompleted: false,



    lost: false



  }



}



‚ùå Error syncing opportunity stage from message webhook: Request failed with status code 422



üîÑ Refetched contact after system field update for AI call.



ü§ñ Processing message with payload summary: {



  contactId: 'gC2s1kUJKLTY6YCVLlTF',



  leadTemperature: 'warm',



  aiPhase: 'intake',



  language: 'English',



  returning: false,



  hasTattooPlacement: true,



  hasTattooSize: false,



  depositPaid: false,



  depositLinkSent: false



}



üîÑ New generation 7 for contact gC2s1kUJKLTY6YCVLlTF



üì± Channel emoji support: yes



üìù [CONSULTATION_TYPE] Setting consultation_type="appointment" (translator needed) for contact gC2s1kUJKLTY6YCVLlTF (detected from: "Video call!")



‚úâÔ∏è sendConversationMessage context: { contactId: 'gC2s1kUJKLTY6YCVLlTF', isDm: true, hasPhone: false }



üîç No conversationId provided for DM, searching for existing conversation...



‚úÖ Found existing conversation 6HPBVvpLDlkJq3ydqsux with type FB



‚úÖ Using conversation type FB from GHL conversation - skipping ID validation



üì® Sending DM reply via GHL: {



  conversationId: '6HPBVvpLDlkJq3ydqsux',



  contactId: 'gC2s1kUJKLTY6YCVLlTF',



  message: "Our artist's native language is Spanish, so for video consults we include a translator on the call to keep every detail clear. Does that work for you?",



  type: 'FB'



}



üì® GHL DM reply response: {



  status: 201,



  contactId: 'gC2s1kUJKLTY6YCVLlTF',



  conversationId: '6HPBVvpLDlkJq3ydqsux'



}



üîÑ [PIPELINE] Syncing opportunity stage for contact gC2s1kUJKLTY6YCVLlTF: {



  currentStage: '(none)',



  targetStage: 'INTAKE',



  context: {



    aiPhase: 'consult_support',



    depositLinkSent: false,



    depositPaid: false,



    consultType: null,



    hasUpcomingTattoo: false,



    tattooCompleted: false,



    lost: false



  }



}



‚ùå Error syncing opportunity stage after consult mode = appointment: Request failed with status code 422



POST /ghl/message-webhook



üí¨ GHL MESSAGE WEBHOOK HIT



Raw Body: {



  "consult_explained": "",



  "AI Creative Response": "",



  "Tattoo Style": "",



  "Promotional Link": "",



  "Appt 2: Start Time": "",



  "deposit_confirmation_sent": "",



  "Deposit Made On": "",



  "pending_slot_artist": "",



  "utm medium": "",



  "pending_slot_calendar": "",



  " Appt 2: Cancellation Link": "",



  "total_tattoos_completed": "",



  "Appt 1: Reschedule Link": "",



  "Tattoo Concerns": "",



  "Appt 1: Service": "",



  "reschedule_pending": "",



  "Appt 3: Reschedule Link": "",



  "utm campaign": "",



  "TikTok": "",



  "Tattoo Title": "",



  "reschedule_target_translator_appointment_id": "",



  "Follow Up Reason": "",



  "Technician's Address": "",



  "Square Payment ID": "",



  "Technician's Photo ID": "",



  "pending_slot_end": "",



  "I have been fully informed of the risks of body art including but not limited to infection, scarring, and allergic reactions to items associated with body art procedures. Technician will not perform the body art procedure if you fail to complete or sign this form. Further, technician may decline to perform a body art procedure if the client has any identified health conditions. Having been informed of the potential risks associated with this body art procedure, I still wish to proceed with the body art application and I assume any/all risks that may arise from body art.": "",



  "Appt 2: Start Date": "",



  "Appt 1: End Time": "",



  "Customer Lifetime Value": "",



  "times_sent": "",



  "Language Preference": "English",



  "First Tattoo": "",



  "pending_slot_mode": "",



  "Appt 2: Google Calendar": "",



  "Artist Inquired (Deseado)": "",



  "hold_last_activity_at": "",



  "last_released_slot_start": "",



  "AI Email Subject": "",



  "Instagram": "",



  "Appt 1: IOS/Outlook Calendar": "",



  "First Assigned Barber": "",



  "Appt 1: Start Date": "",



  "Deposit Paid": "",



  "Artist": "",



  "last_released_slot_display": "",



  "Appt 3: Cancellation Link": "",



  "Preferred Artist": "",



  "pending_slot_start": "",



  "Lead Temperature": "warm",



  "Square Payment Status": "",



  "Deposit": "",



  "Appt 3: Google Calendar": "",



  "Appt 3: IOS/Outlook Calendar": "",



  "Emergency Contact": "",



  "Appt 3: Start Date": "",



  "Whatsapp User?": "",



  "Other Social Media": "",



  "Technician's Phone Number": "",



  "Tattoo Color Preference": "",



  "Appt 1: Cancellation Link": "",



  "Last SMS": "",



  "Valid Body Art License": "",



  "Flash Tattoo": "",



  "Appt 1: Assigned User": "",



  "square_payment_link_id": "",



  "last_released_slot_calendar": "",



  "Rent vs Commission": "",



  "Appt 1: Start Time": "",



  "pending_slot_display": "",



  "Location of Tattoo": "",



  "I {{contact.full_name}}, the client, confirm that I have read the above statements, and by checking \"Yes\" below, you give your consent to receive BODY ART.": "",



  "Appt 3: Assigned User": "",



  "Referral: Current Referral Points": "",



  "How would you like us to contact you?": "",



  "returning_client": "",



  "hold_warning_sent": "",



  "Appt 3: End Time": "",



  "consultation_type": "appointment",



  "Final Price": "",



  "Upload a Picture of a Valid ID (Driver's License, Gov ID, etc)": "",



  "Best time to contact you": "",



  "Notes to the Artist? (Optional)": "",



  "language_barrier_explained": "Yes",



  "Application Notes": "",



  "Deposit Link Sent": "",



  "Tattoo Placement": "back shoulder",



  "Appt 2: Reschedule Link": "",



  "client_lifetime_value": "",



  "Dwelling Type": "",



  "Appt 3: Start Time": "",



  "utm source": "",



  "Appt 1: Google Calendar": "",



  "Date of Procedure:": "",



  "Technician's DOB": "",



  "Referral Link Shortened": "",



  "reschedule_target_appointment_id": "",



  "hold_appointment_id": "",



  "Appt 2: IOS/Outlook Calendar": "",



  "Medical History": "",



  "Medical History (Description)": "",



  "Square Order ID": "",



  "Date Picker 3k8r": "",



  "Last Phase Update At": "2025-12-10T15:53:20.898Z",



  "Photo Reference (Referencia)": "",



  "Assigned Technician License #": "",



  "translator_needed": "Yes",



  "Google Meet Link": "",



  "How Soon Is Client Deciding?": "December",



  "Work Experience": "",



  "Appt 3: Service": "",



  "Appt 2: Service": "",



  "Project Complexity": "",



  "Appt 2: End Time": "",



  "Appt 2: Assigned User": "",



  "Square Reference ID": "",



  "translator_appointment_id": "",



  "Tattoo Photo Description": "",



  "Body Art License Number": "",



  "last_released_slot_end": "",



  "Tattoo Size": "",



  "Appt 3: End Date": "",



  "Tattoo Summary": "bouquet of flowers",



  "AI Phase": "intake",



  "Next Follow Up At": "",



  "Assigned Technician": "",



  "contact_id": "gC2s1kUJKLTY6YCVLlTF",



  "first_name": "Maria",



  "last_name": "Claflin",



  "full_name": "Maria Claflin",



  "tags": "dm consultation request",



  "country": "US",



  "date_created": "2025-12-10T15:45:48.808Z",



  "full_address": "",



  "contact_type": "lead",



  "location": {



    "name": "Studio AZ Tattoo",



    "address": "333 Washington Ave N STE 100",



    "city": "Minneapolis",



    "state": "Minnesota",



    "country": "US",



    "postalCode": "55401",



    "fullAddress": "333 Washington Ave N STE 100, Minneapolis Minnesota 55401",



    "id": "mUemx2jG4wly4kJWBkI4"



  },



  "message": {



    "type": 11,



    "body": "Yes that works!"



  },



  "workflow": {



    "id": "8cf237bb-6cb1-4240-8ca5-b797bba8b769",



    "name": "Testing Ai Bot"



  },



  "triggerData": {},



  "contact": {



    "attributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    },



    "lastAttributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    }



  },



  "attributionSource": {},



  "customData": {



    "contactId": "gC2s1kUJKLTY6YCVLlTF",



    "messageBody": "Yes that works!"



  }



}



üì° Channel context: { isDm: true, hasPhone: false, conversationId: null, phone: null }



Parsed contactId from message webhook: gC2s1kUJKLTY6YCVLlTF



‚úÖ Loaded Contact from GHL (message webhook): {



  id: 'gC2s1kUJKLTY6YCVLlTF',



  firstName: 'Maria',



  lastName: 'Claflin',



  tags: [ 'dm consultation request' ]



}



‚úÖ Found 0 appointments for contact gC2s1kUJKLTY6YCVLlTF



‚ùå Returning client detection failed: boolField is not a function



üì© Incoming message text (for language detection): Yes that works!



üåê Updating language_preference based on DM/SMS detection: { previous: null, next: 'English' }



‚úÖ language_preference updated to English for contact: gC2s1kUJKLTY6YCVLlTF



üß† Derived system state (message): { currentPhase: 'intake', newPhase: 'intake', leadTemperature: 'warm' }



‚úÖ System fields updated for message webhook



üîÑ [PIPELINE] Syncing opportunity stage for contact gC2s1kUJKLTY6YCVLlTF: {



  currentStage: '(none)',



  targetStage: 'INTAKE',



  context: {



    aiPhase: 'intake',



    depositLinkSent: false,



    depositPaid: false,



    consultType: null,



    hasUpcomingTattoo: false,



    tattooCompleted: false,



    lost: false



  }



}



‚ùå Error syncing opportunity stage from message webhook: Request failed with status code 422



üîÑ Refetched contact after system field update for AI call.



ü§ñ Processing message with payload summary: {



  contactId: 'gC2s1kUJKLTY6YCVLlTF',



  leadTemperature: 'warm',



  aiPhase: 'intake',



  language: 'English',



  returning: false,



  hasTattooPlacement: true,



  hasTattooSize: false,



  depositPaid: false,



  depositLinkSent: false



}



üîÑ New generation 8 for contact gC2s1kUJKLTY6YCVLlTF



üì± Channel emoji support: yes



‚è≥ Weak booking intent but consult mode not chosen yet ‚Äî gating times



ü§ñ Raw OpenAI opener response: {



  "language": "en",



  "bubbles": [



    "Perfect, that bouquet on your back shoulder is gonna look fire.",



    "The next step is a quick 15‚Äì20 minute consultation with the artist to fully understand your design.",



    "Would you prefer a video call or to go back and forth in messages?"



  ],



  "internal_notes": "Acknowledged tattoo placement and summary, introduced consult and asked for preferred consult mode.",



  "meta": {



    "aiPhase": "qualification",



    "leadTemperature": "warm",



    "wantsDepositLink": false,



    "depositPushedThisTurn": false,



    "mentionDecoyOffered": false,



    "consultMode": "online"



  },



  "field_updates": {



    "tattoo_placement": "back shoulder",



    "tattoo_summary": "bouquet of flowers"



  }



}



üß† AI DECISION SUMMARY {



  aiPhaseFromAI: 'qualification',



  leadTemperatureFromAI: 'warm',



  wantsDepositLink: false,



  wantsAppointmentOffer: undefined,



  consultMode: 'online',



  depositPushedThisTurn: false,



  mentionDecoyOffered: false,



  field_updates: {



    tattoo_placement: 'back shoulder',



    tattoo_summary: 'bouquet of flowers'



  },



  bubblesPreview: [



    'Perfect, that bouquet on your back shoulder is gonna look fire.',



    'The next step is a quick 15‚Äì20 minute consultation with the artist to fully unde',



    'Would you prefer a video call or to go back and forth in messages?'



  ]



}



ü§ñ AI DM suggestion: {



  "language": "en",



  "bubbles": [



    "Perfect, that bouquet on your back shoulder is gonna look fire.",



    "The next step is a quick 15‚Äì20 minute consultation with the artist to fully understand your design.",



    "Would you prefer a video call or to go back and forth in messages?"



  ],



  "internal_notes": "Acknowledged tattoo placement and summary, introduced consult and asked for preferred consult mode.",



  "meta": {



    "aiPhase": "qualification",



    "leadTemperature": "warm",



    "wantsDepositLink": false,



    "depositPushedThisTurn": false,



    "mentionDecoyOffered": false,



    "consultMode": "online"



  },



  "field_updates": {



    "tattoo_placement": "back shoulder",



    "tattoo_summary": "bouquet of flowers"



  }



}



‚úâÔ∏è sendConversationMessage context: { contactId: 'gC2s1kUJKLTY6YCVLlTF', isDm: true, hasPhone: false }



üîç No conversationId provided for DM, searching for existing conversation...



‚úÖ Found existing conversation 6HPBVvpLDlkJq3ydqsux with type FB



‚úÖ Using conversation type FB from GHL conversation - skipping ID validation



üì® Sending DM reply via GHL: {



  conversationId: '6HPBVvpLDlkJq3ydqsux',



  contactId: 'gC2s1kUJKLTY6YCVLlTF',



  message: 'Perfect, that bouquet on your back shoulder is gonna look fire.',



  type: 'FB'



}



üì® GHL DM reply response: {



  status: 201,



  contactId: 'gC2s1kUJKLTY6YCVLlTF',



  conversationId: '6HPBVvpLDlkJq3ydqsux'



}



‚è± Waiting 12000ms before sending bubble 2...



‚úâÔ∏è sendConversationMessage context: { contactId: 'gC2s1kUJKLTY6YCVLlTF', isDm: true, hasPhone: false }



üîç No conversationId provided for DM, searching for existing conversation...



‚úÖ Found existing conversation 6HPBVvpLDlkJq3ydqsux with type FB



‚úÖ Using conversation type FB from GHL conversation - skipping ID validation



üì® Sending DM reply via GHL: {



  conversationId: '6HPBVvpLDlkJq3ydqsux',



  contactId: 'gC2s1kUJKLTY6YCVLlTF',



  message: 'The next step is a quick 15‚Äì20 minute consultation with the artist to fully understand your design.',



  type: 'FB'



}



üì® GHL DM reply response: {



  status: 201,



  contactId: 'gC2s1kUJKLTY6YCVLlTF',



  conversationId: '6HPBVvpLDlkJq3ydqsux'



}



‚è± Waiting 8000ms before sending bubble 3...



‚úâÔ∏è sendConversationMessage context: { contactId: 'gC2s1kUJKLTY6YCVLlTF', isDm: true, hasPhone: false }



üîç No conversationId provided for DM, searching for existing conversation...



‚úÖ Found existing conversation 6HPBVvpLDlkJq3ydqsux with type FB



‚úÖ Using conversation type FB from GHL conversation - skipping ID validation



üì® Sending DM reply via GHL: {



  conversationId: '6HPBVvpLDlkJq3ydqsux',



  contactId: 'gC2s1kUJKLTY6YCVLlTF',



  message: 'Would you prefer a video call or to go back and forth in messages?',



  type: 'FB'



}



üì® GHL DM reply response: {



  status: 201,



  contactId: 'gC2s1kUJKLTY6YCVLlTF',



  conversationId: '6HPBVvpLDlkJq3ydqsux'



}



üì§ Sent AI bubbles to GHL conversation.



üß† Updating contact system fields from AI meta: {



  ai_phase: 'qualification',



  lead_temperature: 'warm',



  consult_explained: undefined



}



üßæ Applying AI field_updates to GHL: {



  tattoo_placement: 'back shoulder',



  tattoo_summary: 'bouquet of flowers'



}



‚úÖ Updated tattoo fields for contact gC2s1kUJKLTY6YCVLlTF with {



  tattoo_placement: 'back shoulder',



  tattoo_summary: 'bouquet of flowers'



}



‚ÑπÔ∏è No deposit link created (either not requested, already sent, or already paid). { wantsDepositLink: false, alreadyPaid: false, alreadySent: false }



POST /ghl/message-webhook



üí¨ GHL MESSAGE WEBHOOK HIT



Raw Body: {



  "consult_explained": "",



  "AI Creative Response": "",



  "Tattoo Style": "",



  "Promotional Link": "",



  "Appt 2: Start Time": "",



  "deposit_confirmation_sent": "",



  "Deposit Made On": "",



  "pending_slot_artist": "",



  "utm medium": "",



  "pending_slot_calendar": "",



  " Appt 2: Cancellation Link": "",



  "total_tattoos_completed": "",



  "Appt 1: Reschedule Link": "",



  "Tattoo Concerns": "",



  "Appt 1: Service": "",



  "reschedule_pending": "",



  "Appt 3: Reschedule Link": "",



  "utm campaign": "",



  "TikTok": "",



  "Tattoo Title": "",



  "reschedule_target_translator_appointment_id": "",



  "Follow Up Reason": "",



  "Technician's Address": "",



  "Square Payment ID": "",



  "Technician's Photo ID": "",



  "pending_slot_end": "",



  "I have been fully informed of the risks of body art including but not limited to infection, scarring, and allergic reactions to items associated with body art procedures. Technician will not perform the body art procedure if you fail to complete or sign this form. Further, technician may decline to perform a body art procedure if the client has any identified health conditions. Having been informed of the potential risks associated with this body art procedure, I still wish to proceed with the body art application and I assume any/all risks that may arise from body art.": "",



  "Appt 2: Start Date": "",



  "Appt 1: End Time": "",



  "Customer Lifetime Value": "",



  "times_sent": "",



  "Language Preference": "English",



  "First Tattoo": "",



  "pending_slot_mode": "",



  "Appt 2: Google Calendar": "",



  "Artist Inquired (Deseado)": "",



  "hold_last_activity_at": "",



  "last_released_slot_start": "",



  "AI Email Subject": "",



  "Instagram": "",



  "Appt 1: IOS/Outlook Calendar": "",



  "First Assigned Barber": "",



  "Appt 1: Start Date": "",



  "Deposit Paid": "",



  "Artist": "",



  "last_released_slot_display": "",



  "Appt 3: Cancellation Link": "",



  "Preferred Artist": "",



  "pending_slot_start": "",



  "Lead Temperature": "warm",



  "Square Payment Status": "",



  "Deposit": "",



  "Appt 3: Google Calendar": "",



  "Appt 3: IOS/Outlook Calendar": "",



  "Emergency Contact": "",



  "Appt 3: Start Date": "",



  "Whatsapp User?": "",



  "Other Social Media": "",



  "Technician's Phone Number": "",



  "Tattoo Color Preference": "",



  "Appt 1: Cancellation Link": "",



  "Last SMS": "",



  "Valid Body Art License": "",



  "Flash Tattoo": "",



  "Appt 1: Assigned User": "",



  "square_payment_link_id": "",



  "last_released_slot_calendar": "",



  "Rent vs Commission": "",



  "Appt 1: Start Time": "",



  "pending_slot_display": "",



  "Location of Tattoo": "",



  "I {{contact.full_name}}, the client, confirm that I have read the above statements, and by checking \"Yes\" below, you give your consent to receive BODY ART.": "",



  "Appt 3: Assigned User": "",



  "Referral: Current Referral Points": "",



  "How would you like us to contact you?": "",



  "returning_client": "",



  "hold_warning_sent": "",



  "Appt 3: End Time": "",



  "consultation_type": "appointment",



  "Final Price": "",



  "Upload a Picture of a Valid ID (Driver's License, Gov ID, etc)": "",



  "Best time to contact you": "",



  "Notes to the Artist? (Optional)": "",



  "language_barrier_explained": "Yes",



  "Application Notes": "",



  "Deposit Link Sent": "",



  "Tattoo Placement": "back shoulder",



  "Appt 2: Reschedule Link": "",



  "client_lifetime_value": "",



  "Dwelling Type": "",



  "Appt 3: Start Time": "",



  "utm source": "",



  "Appt 1: Google Calendar": "",



  "Date of Procedure:": "",



  "Technician's DOB": "",



  "Referral Link Shortened": "",



  "reschedule_target_appointment_id": "",



  "hold_appointment_id": "",



  "Appt 2: IOS/Outlook Calendar": "",



  "Medical History": "",



  "Medical History (Description)": "",



  "Square Order ID": "",



  "Date Picker 3k8r": "",



  "Last Phase Update At": "2025-12-10T15:54:13.330Z",



  "Photo Reference (Referencia)": "",



  "Assigned Technician License #": "",



  "translator_needed": "Yes",



  "Google Meet Link": "",



  "How Soon Is Client Deciding?": "December",



  "Work Experience": "",



  "Appt 3: Service": "",



  "Appt 2: Service": "",



  "Project Complexity": "",



  "Appt 2: End Time": "",



  "Appt 2: Assigned User": "",



  "Square Reference ID": "",



  "translator_appointment_id": "",



  "Tattoo Photo Description": "",



  "Body Art License Number": "",



  "last_released_slot_end": "",



  "Tattoo Size": "",



  "Appt 3: End Date": "",



  "Tattoo Summary": "bouquet of flowers",



  "AI Phase": "qualification",



  "Next Follow Up At": "",



  "Assigned Technician": "",



  "contact_id": "gC2s1kUJKLTY6YCVLlTF",



  "first_name": "Maria",



  "last_name": "Claflin",



  "full_name": "Maria Claflin",



  "tags": "dm consultation request",



  "country": "US",



  "date_created": "2025-12-10T15:45:48.808Z",



  "full_address": "",



  "contact_type": "lead",



  "location": {



    "name": "Studio AZ Tattoo",



    "address": "333 Washington Ave N STE 100",



    "city": "Minneapolis",



    "state": "Minnesota",



    "country": "US",



    "postalCode": "55401",



    "fullAddress": "333 Washington Ave N STE 100, Minneapolis Minnesota 55401",



    "id": "mUemx2jG4wly4kJWBkI4"



  },



  "message": {



    "type": 11,



    "body": "Video call this week! What times are you available?"



  },



  "workflow": {



    "id": "8cf237bb-6cb1-4240-8ca5-b797bba8b769",



    "name": "Testing Ai Bot"



  },



  "triggerData": {},



  "contact": {



    "attributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    },



    "lastAttributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    }



  },



  "attributionSource": {},



  "customData": {



    "contactId": "gC2s1kUJKLTY6YCVLlTF",



    "messageBody": "Video call this week! What times are you available?"



  }



}



üì° Channel context: { isDm: true, hasPhone: false, conversationId: null, phone: null }



Parsed contactId from message webhook: gC2s1kUJKLTY6YCVLlTF



‚úÖ Loaded Contact from GHL (message webhook): {



  id: 'gC2s1kUJKLTY6YCVLlTF',



  firstName: 'Maria',



  lastName: 'Claflin',



  tags: [ 'dm consultation request' ]



}



‚úÖ Found 0 appointments for contact gC2s1kUJKLTY6YCVLlTF



üì© Incoming message text (for language detection): Video call this week! What times are you available?



‚ùå Returning client detection failed: boolField is not a function



üåê Updating language_preference based on DM/SMS detection: { previous: null, next: 'English' }



‚úÖ language_preference updated to English for contact: gC2s1kUJKLTY6YCVLlTF



üß† Derived system state (message): {



  currentPhase: 'qualification',



  newPhase: 'qualification',



  leadTemperature: 'warm'



}



‚úÖ System fields updated for message webhook



üîÑ [PIPELINE] Syncing opportunity stage for contact gC2s1kUJKLTY6YCVLlTF: {



  currentStage: '(none)',



  targetStage: 'INTAKE',



  context: {



    aiPhase: 'qualification',



    depositLinkSent: false,



    depositPaid: false,



    consultType: null,



    hasUpcomingTattoo: false,



    tattooCompleted: false,



    lost: false



  }



}



‚ùå Error syncing opportunity stage from message webhook: Request failed with status code 422



üîÑ Refetched contact after system field update for AI call.



ü§ñ Processing message with payload summary: {



  contactId: 'gC2s1kUJKLTY6YCVLlTF',



  leadTemperature: 'warm',



  aiPhase: 'qualification',



  language: 'English',



  returning: false,



  hasTattooPlacement: true,



  hasTattooSize: false,



  depositPaid: false,



  depositLinkSent: false



}



üîÑ New generation 9 for contact gC2s1kUJKLTY6YCVLlTF



üì± Channel emoji support: yes



üìù [CONSULTATION_TYPE] Setting consultation_type="appointment" (translator needed) for contact gC2s1kUJKLTY6YCVLlTF (detected from: "Video call this week! What times are you available?")



‚úâÔ∏è sendConversationMessage context: { contactId: 'gC2s1kUJKLTY6YCVLlTF', isDm: true, hasPhone: false }



üîç No conversationId provided for DM, searching for existing conversation...



‚úÖ Found existing conversation 6HPBVvpLDlkJq3ydqsux with type FB



‚úÖ Using conversation type FB from GHL conversation - skipping ID validation



üì® Sending DM reply via GHL: {



  conversationId: '6HPBVvpLDlkJq3ydqsux',



  contactId: 'gC2s1kUJKLTY6YCVLlTF',



  message: "Our artist's native language is Spanish, so for video consults we include a translator on the call to keep every detail clear. Does that work for you?",



  type: 'FB'



}



üì® GHL DM reply response: {



  status: 201,



  contactId: 'gC2s1kUJKLTY6YCVLlTF',



  conversationId: '6HPBVvpLDlkJq3ydqsux'



}



üîÑ [PIPELINE] Syncing opportunity stage for contact gC2s1kUJKLTY6YCVLlTF: {



  currentStage: '(none)',



  targetStage: 'INTAKE',



  context: {



    aiPhase: 'consult_support',



    depositLinkSent: false,



    depositPaid: false,



    consultType: null,



    hasUpcomingTattoo: false,



    tattooCompleted: false,



    lost: false



  }



}



‚ùå Error syncing opportunity stage after consult mode = appointment: Request failed with status code 422



POST /ghl/message-webhook



üí¨ GHL MESSAGE WEBHOOK HIT



Raw Body: {



  "consult_explained": "",



  "AI Creative Response": "",



  "Tattoo Style": "",



  "Promotional Link": "",



  "Appt 2: Start Time": "",



  "deposit_confirmation_sent": "",



  "Deposit Made On": "",



  "pending_slot_artist": "",



  "utm medium": "",



  "pending_slot_calendar": "",



  " Appt 2: Cancellation Link": "",



  "total_tattoos_completed": "",



  "Appt 1: Reschedule Link": "",



  "Tattoo Concerns": "",



  "Appt 1: Service": "",



  "reschedule_pending": "",



  "Appt 3: Reschedule Link": "",



  "utm campaign": "",



  "TikTok": "",



  "Tattoo Title": "",



  "reschedule_target_translator_appointment_id": "",



  "Follow Up Reason": "",



  "Technician's Address": "",



  "Square Payment ID": "",



  "Technician's Photo ID": "",



  "pending_slot_end": "",



  "I have been fully informed of the risks of body art including but not limited to infection, scarring, and allergic reactions to items associated with body art procedures. Technician will not perform the body art procedure if you fail to complete or sign this form. Further, technician may decline to perform a body art procedure if the client has any identified health conditions. Having been informed of the potential risks associated with this body art procedure, I still wish to proceed with the body art application and I assume any/all risks that may arise from body art.": "",



  "Appt 2: Start Date": "",



  "Appt 1: End Time": "",



  "Customer Lifetime Value": "",



  "times_sent": "",



  "Language Preference": "English",



  "First Tattoo": "",



  "pending_slot_mode": "",



  "Appt 2: Google Calendar": "",



  "Artist Inquired (Deseado)": "",



  "hold_last_activity_at": "",



  "last_released_slot_start": "",



  "AI Email Subject": "",



  "Instagram": "",



  "Appt 1: IOS/Outlook Calendar": "",



  "First Assigned Barber": "",



  "Appt 1: Start Date": "",



  "Deposit Paid": "",



  "Artist": "",



  "last_released_slot_display": "",



  "Appt 3: Cancellation Link": "",



  "Preferred Artist": "",



  "pending_slot_start": "",



  "Lead Temperature": "warm",



  "Square Payment Status": "",



  "Deposit": "",



  "Appt 3: Google Calendar": "",



  "Appt 3: IOS/Outlook Calendar": "",



  "Emergency Contact": "",



  "Appt 3: Start Date": "",



  "Whatsapp User?": "",



  "Other Social Media": "",



  "Technician's Phone Number": "",



  "Tattoo Color Preference": "",



  "Appt 1: Cancellation Link": "",



  "Last SMS": "",



  "Valid Body Art License": "",



  "Flash Tattoo": "",



  "Appt 1: Assigned User": "",



  "square_payment_link_id": "",



  "last_released_slot_calendar": "",



  "Rent vs Commission": "",



  "Appt 1: Start Time": "",



  "pending_slot_display": "",



  "Location of Tattoo": "",



  "I {{contact.full_name}}, the client, confirm that I have read the above statements, and by checking \"Yes\" below, you give your consent to receive BODY ART.": "",



  "Appt 3: Assigned User": "",



  "Referral: Current Referral Points": "",



  "How would you like us to contact you?": "",



  "returning_client": "",



  "hold_warning_sent": "",



  "Appt 3: End Time": "",



  "consultation_type": "appointment",



  "Final Price": "",



  "Upload a Picture of a Valid ID (Driver's License, Gov ID, etc)": "",



  "Best time to contact you": "",



  "Notes to the Artist? (Optional)": "",



  "language_barrier_explained": "Yes",



  "Application Notes": "",



  "Deposit Link Sent": "",



  "Tattoo Placement": "back shoulder",



  "Appt 2: Reschedule Link": "",



  "client_lifetime_value": "",



  "Dwelling Type": "",



  "Appt 3: Start Time": "",



  "utm source": "",



  "Appt 1: Google Calendar": "",



  "Date of Procedure:": "",



  "Technician's DOB": "",



  "Referral Link Shortened": "",



  "reschedule_target_appointment_id": "",



  "hold_appointment_id": "",



  "Appt 2: IOS/Outlook Calendar": "",



  "Medical History": "",



  "Medical History (Description)": "",



  "Square Order ID": "",



  "Date Picker 3k8r": "",



  "Last Phase Update At": "2025-12-10T15:55:04.358Z",



  "Photo Reference (Referencia)": "",



  "Assigned Technician License #": "",



  "translator_needed": "Yes",



  "Google Meet Link": "",



  "How Soon Is Client Deciding?": "December",



  "Work Experience": "",



  "Appt 3: Service": "",



  "Appt 2: Service": "",



  "Project Complexity": "",



  "Appt 2: End Time": "",



  "Appt 2: Assigned User": "",



  "Square Reference ID": "",



  "translator_appointment_id": "",



  "Tattoo Photo Description": "",



  "Body Art License Number": "",



  "last_released_slot_end": "",



  "Tattoo Size": "",



  "Appt 3: End Date": "",



  "Tattoo Summary": "bouquet of flowers",



  "AI Phase": "qualification",



  "Next Follow Up At": "",



  "Assigned Technician": "",



  "contact_id": "gC2s1kUJKLTY6YCVLlTF",



  "first_name": "Maria",



  "last_name": "Claflin",



  "full_name": "Maria Claflin",



  "tags": "dm consultation request",



  "country": "US",



  "date_created": "2025-12-10T15:45:48.808Z",



  "full_address": "",



  "contact_type": "lead",



  "location": {



    "name": "Studio AZ Tattoo",



    "address": "333 Washington Ave N STE 100",



    "city": "Minneapolis",



    "state": "Minnesota",



    "country": "US",



    "postalCode": "55401",



    "fullAddress": "333 Washington Ave N STE 100, Minneapolis Minnesota 55401",



    "id": "mUemx2jG4wly4kJWBkI4"



  },



  "message": {



    "type": 11,



    "body": "Yes!"



  },



  "workflow": {



    "id": "8cf237bb-6cb1-4240-8ca5-b797bba8b769",



    "name": "Testing Ai Bot"



  },



  "triggerData": {},



  "contact": {



    "attributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    },



    "lastAttributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    }



  },



  "attributionSource": {},



  "customData": {



    "contactId": "gC2s1kUJKLTY6YCVLlTF",



    "messageBody": "Yes!"



  }



}



üì° Channel context: { isDm: true, hasPhone: false, conversationId: null, phone: null }



Parsed contactId from message webhook: gC2s1kUJKLTY6YCVLlTF



‚úÖ Loaded Contact from GHL (message webhook): {



  id: 'gC2s1kUJKLTY6YCVLlTF',



  firstName: 'Maria',



  lastName: 'Claflin',



  tags: [ 'dm consultation request' ]



}



‚úÖ Found 0 appointments for contact gC2s1kUJKLTY6YCVLlTF



üì© Incoming message text (for language detection): Yes!



‚ùå Returning client detection failed: boolField is not a function



üåê Updating language_preference based on DM/SMS detection: { previous: null, next: 'English' }



‚úÖ language_preference updated to English for contact: gC2s1kUJKLTY6YCVLlTF



üß† Derived system state (message): {



  currentPhase: 'qualification',



  newPhase: 'qualification',



  leadTemperature: 'warm'



}



‚úÖ System fields updated for message webhook



üîÑ [PIPELINE] Syncing opportunity stage for contact gC2s1kUJKLTY6YCVLlTF: {



  currentStage: '(none)',



  targetStage: 'INTAKE',



  context: {



    aiPhase: 'qualification',



    depositLinkSent: false,



    depositPaid: false,



    consultType: null,



    hasUpcomingTattoo: false,



    tattooCompleted: false,



    lost: false



  }



}



‚ùå Error syncing opportunity stage from message webhook: Request failed with status code 422



üîÑ Refetched contact after system field update for AI call.



ü§ñ Processing message with payload summary: {



  contactId: 'gC2s1kUJKLTY6YCVLlTF',



  leadTemperature: 'warm',



  aiPhase: 'qualification',



  language: 'English',



  returning: false,



  hasTattooPlacement: true,



  hasTattooSize: false,



  depositPaid: false,



  depositLinkSent: false



}



üîÑ New generation 10 for contact gC2s1kUJKLTY6YCVLlTF



üì± Channel emoji support: yes



‚è≥ Weak booking intent but consult mode not chosen yet ‚Äî gating times



ü§ñ Raw OpenAI opener response: {



  "language": "en",



  "bubbles": [



    "Got it ‚Äî that bouquet of flowers on your back shoulder will look great.",



    "When are you trying to get it done?"



  ],



  "internal_notes": "Acknowledged tattoo idea and placement, moving to timing qualification.",



  "meta": {



    "aiPhase": "qualification",



    "leadTemperature": "warm",



    "wantsDepositLink": false,



    "depositPushedThisTurn": false,



    "mentionDecoyOffered": false,



    "consultMode": "online"



  },



  "field_updates": {



    "tattoo_placement": "back shoulder",



    "tattoo_summary": "bouquet of flowers"



  }



}



üß† AI DECISION SUMMARY {



  aiPhaseFromAI: 'qualification',



  leadTemperatureFromAI: 'warm',



  wantsDepositLink: false,



  wantsAppointmentOffer: undefined,



  consultMode: 'online',



  depositPushedThisTurn: false,



  mentionDecoyOffered: false,



  field_updates: {



    tattoo_placement: 'back shoulder',



    tattoo_summary: 'bouquet of flowers'



  },



  bubblesPreview: [



    'Got it ‚Äî that bouquet of flowers on your back shoulder will look great.',



    'When are you trying to get it done?'



  ]



}



ü§ñ AI DM suggestion: {



  "language": "en",



  "bubbles": [



    "Got it ‚Äî that bouquet of flowers on your back shoulder will look great.",



    "When are you trying to get it done?"



  ],



  "internal_notes": "Acknowledged tattoo idea and placement, moving to timing qualification.",



  "meta": {



    "aiPhase": "qualification",



    "leadTemperature": "warm",



    "wantsDepositLink": false,



    "depositPushedThisTurn": false,



    "mentionDecoyOffered": false,



    "consultMode": "online"



  },



  "field_updates": {



    "tattoo_placement": "back shoulder",



    "tattoo_summary": "bouquet of flowers"



  }



}



‚úâÔ∏è sendConversationMessage context: { contactId: 'gC2s1kUJKLTY6YCVLlTF', isDm: true, hasPhone: false }



üîç No conversationId provided for DM, searching for existing conversation...



‚úÖ Found existing conversation 6HPBVvpLDlkJq3ydqsux with type FB



‚úÖ Using conversation type FB from GHL conversation - skipping ID validation



üì® Sending DM reply via GHL: {



  conversationId: '6HPBVvpLDlkJq3ydqsux',



  contactId: 'gC2s1kUJKLTY6YCVLlTF',



  message: 'When are you trying to get it done?',



  type: 'FB'



}



üì® GHL DM reply response: {



  status: 201,



  contactId: 'gC2s1kUJKLTY6YCVLlTF',



  conversationId: '6HPBVvpLDlkJq3ydqsux'



}



üì§ Sent AI bubbles to GHL conversation.



üß† Updating contact system fields from AI meta: {



  ai_phase: 'qualification',



  lead_temperature: 'warm',



  consult_explained: undefined



}



üßæ Applying AI field_updates to GHL: {



  tattoo_placement: 'back shoulder',



  tattoo_summary: 'bouquet of flowers'



}



‚úÖ Updated tattoo fields for contact gC2s1kUJKLTY6YCVLlTF with {



  tattoo_placement: 'back shoulder',



  tattoo_summary: 'bouquet of flowers'



}



‚ÑπÔ∏è No deposit link created (either not requested, already sent, or already paid). { wantsDepositLink: false, alreadyPaid: false, alreadySent: false }



POST /ghl/message-webhook



üí¨ GHL MESSAGE WEBHOOK HIT



Raw Body: {



  "consult_explained": "",



  "AI Creative Response": "",



  "Tattoo Style": "",



  "Promotional Link": "",



  "Appt 2: Start Time": "",



  "deposit_confirmation_sent": "",



  "Deposit Made On": "",



  "pending_slot_artist": "",



  "utm medium": "",



  "pending_slot_calendar": "",



  " Appt 2: Cancellation Link": "",



  "total_tattoos_completed": "",



  "Appt 1: Reschedule Link": "",



  "Tattoo Concerns": "",



  "Appt 1: Service": "",



  "reschedule_pending": "",



  "Appt 3: Reschedule Link": "",



  "utm campaign": "",



  "TikTok": "",



  "Tattoo Title": "",



  "reschedule_target_translator_appointment_id": "",



  "Follow Up Reason": "",



  "Technician's Address": "",



  "Square Payment ID": "",



  "Technician's Photo ID": "",



  "pending_slot_end": "",



  "I have been fully informed of the risks of body art including but not limited to infection, scarring, and allergic reactions to items associated with body art procedures. Technician will not perform the body art procedure if you fail to complete or sign this form. Further, technician may decline to perform a body art procedure if the client has any identified health conditions. Having been informed of the potential risks associated with this body art procedure, I still wish to proceed with the body art application and I assume any/all risks that may arise from body art.": "",



  "Appt 2: Start Date": "",



  "Appt 1: End Time": "",



  "Customer Lifetime Value": "",



  "times_sent": "",



  "Language Preference": "English",



  "First Tattoo": "",



  "pending_slot_mode": "",



  "Appt 2: Google Calendar": "",



  "Artist Inquired (Deseado)": "",



  "hold_last_activity_at": "",



  "last_released_slot_start": "",



  "AI Email Subject": "",



  "Instagram": "",



  "Appt 1: IOS/Outlook Calendar": "",



  "First Assigned Barber": "",



  "Appt 1: Start Date": "",



  "Deposit Paid": "",



  "Artist": "",



  "last_released_slot_display": "",



  "Appt 3: Cancellation Link": "",



  "Preferred Artist": "",



  "pending_slot_start": "",



  "Lead Temperature": "warm",



  "Square Payment Status": "",



  "Deposit": "",



  "Appt 3: Google Calendar": "",



  "Appt 3: IOS/Outlook Calendar": "",



  "Emergency Contact": "",



  "Appt 3: Start Date": "",



  "Whatsapp User?": "",



  "Other Social Media": "",



  "Technician's Phone Number": "",



  "Tattoo Color Preference": "",



  "Appt 1: Cancellation Link": "",



  "Last SMS": "",



  "Valid Body Art License": "",



  "Flash Tattoo": "",



  "Appt 1: Assigned User": "",



  "square_payment_link_id": "",



  "last_released_slot_calendar": "",



  "Rent vs Commission": "",



  "Appt 1: Start Time": "",



  "pending_slot_display": "",



  "Location of Tattoo": "",



  "I {{contact.full_name}}, the client, confirm that I have read the above statements, and by checking \"Yes\" below, you give your consent to receive BODY ART.": "",



  "Appt 3: Assigned User": "",



  "Referral: Current Referral Points": "",



  "How would you like us to contact you?": "",



  "returning_client": "",



  "hold_warning_sent": "",



  "Appt 3: End Time": "",



  "consultation_type": "appointment",



  "Final Price": "",



  "Upload a Picture of a Valid ID (Driver's License, Gov ID, etc)": "",



  "Best time to contact you": "",



  "Notes to the Artist? (Optional)": "",



  "language_barrier_explained": "Yes",



  "Application Notes": "",



  "Deposit Link Sent": "",



  "Tattoo Placement": "back shoulder",



  "Appt 2: Reschedule Link": "",



  "client_lifetime_value": "",



  "Dwelling Type": "",



  "Appt 3: Start Time": "",



  "utm source": "",



  "Appt 1: Google Calendar": "",



  "Date of Procedure:": "",



  "Technician's DOB": "",



  "Referral Link Shortened": "",



  "reschedule_target_appointment_id": "",



  "hold_appointment_id": "",



  "Appt 2: IOS/Outlook Calendar": "",



  "Medical History": "",



  "Medical History (Description)": "",



  "Square Order ID": "",



  "Date Picker 3k8r": "",



  "Last Phase Update At": "2025-12-10T15:55:24.458Z",



  "Photo Reference (Referencia)": "",



  "Assigned Technician License #": "",



  "translator_needed": "Yes",



  "Google Meet Link": "",



  "How Soon Is Client Deciding?": "December",



  "Work Experience": "",



  "Appt 3: Service": "",



  "Appt 2: Service": "",



  "Project Complexity": "",



  "Appt 2: End Time": "",



  "Appt 2: Assigned User": "",



  "Square Reference ID": "",



  "translator_appointment_id": "",



  "Tattoo Photo Description": "",



  "Body Art License Number": "",



  "last_released_slot_end": "",



  "Tattoo Size": "",



  "Appt 3: End Date": "",



  "Tattoo Summary": "bouquet of flowers",



  "AI Phase": "qualification",



  "Next Follow Up At": "",



  "Assigned Technician": "",



  "contact_id": "gC2s1kUJKLTY6YCVLlTF",



  "first_name": "Maria",



  "last_name": "Claflin",



  "full_name": "Maria Claflin",



  "tags": "dm consultation request",



  "country": "US",



  "date_created": "2025-12-10T15:45:48.808Z",



  "full_address": "",



  "contact_type": "lead",



  "location": {



    "name": "Studio AZ Tattoo",



    "address": "333 Washington Ave N STE 100",



    "city": "Minneapolis",



    "state": "Minnesota",



    "country": "US",



    "postalCode": "55401",



    "fullAddress": "333 Washington Ave N STE 100, Minneapolis Minnesota 55401",



    "id": "mUemx2jG4wly4kJWBkI4"



  },



  "message": {



    "type": 11,



    "body": "December"



  },



  "workflow": {



    "id": "8cf237bb-6cb1-4240-8ca5-b797bba8b769",



    "name": "Testing Ai Bot"



  },



  "triggerData": {},



  "contact": {



    "attributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    },



    "lastAttributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    }



  },



  "attributionSource": {},



  "customData": {



    "contactId": "gC2s1kUJKLTY6YCVLlTF",



    "messageBody": "December"



  }



}



üì° Channel context: { isDm: true, hasPhone: false, conversationId: null, phone: null }



Parsed contactId from message webhook: gC2s1kUJKLTY6YCVLlTF



‚úÖ Loaded Contact from GHL (message webhook): {



  id: 'gC2s1kUJKLTY6YCVLlTF',



  firstName: 'Maria',



  lastName: 'Claflin',



  tags: [ 'dm consultation request' ]



}



‚úÖ Found 0 appointments for contact gC2s1kUJKLTY6YCVLlTF



‚ùå Returning client detection failed: boolField is not a function



üì© Incoming message text (for language detection): December



üåê Updating language_preference based on DM/SMS detection: { previous: null, next: 'English' }



‚úÖ language_preference updated to English for contact: gC2s1kUJKLTY6YCVLlTF



üß† Derived system state (message): {



  currentPhase: 'qualification',



  newPhase: 'qualification',



  leadTemperature: 'warm'



}



‚úÖ System fields updated for message webhook



üîÑ [PIPELINE] Syncing opportunity stage for contact gC2s1kUJKLTY6YCVLlTF: {



  currentStage: '(none)',



  targetStage: 'INTAKE',



  context: {



    aiPhase: 'qualification',



    depositLinkSent: false,



    depositPaid: false,



    consultType: null,



    hasUpcomingTattoo: false,



    tattooCompleted: false,



    lost: false



  }



}



‚ùå Error syncing opportunity stage from message webhook: Request failed with status code 422



üîÑ Refetched contact after system field update for AI call.



ü§ñ Processing message with payload summary: {



  contactId: 'gC2s1kUJKLTY6YCVLlTF',



  leadTemperature: 'warm',



  aiPhase: 'qualification',



  language: 'English',



  returning: false,



  hasTattooPlacement: true,



  hasTattooSize: false,



  depositPaid: false,



  depositLinkSent: false



}



üîÑ New generation 11 for contact gC2s1kUJKLTY6YCVLlTF



üì± Channel emoji support: yes



ü§ñ Raw OpenAI opener response: {



  "language": "en",



  "bubbles": [



    "Got it ‚Äî that bouquet of flowers on your back shoulder will look clean.",



    "December works. Perfect, we can make that happen.",



    "The next step is a quick 15‚Äì20 minute consultation with the artist to fully understand your design. Would you prefer a video call or to go back and forth in messages?"



  ],



  "internal_notes": "Acknowledged tattoo idea and timing, introduced consult and asked for preferred consult mode.",



  "meta": {



    "aiPhase": "qualification",



    "leadTemperature": "warm",



    "wantsDepositLink": false,



    "wantsAppointmentOffer": false,



    "depositPushedThisTurn": false,



    "mentionDecoyOffered": false,



    "consultMode": "online"



  },



  "field_updates": {



    "tattoo_placement": "back shoulder",



    "tattoo_summary": "bouquet of flowers",



    "how_soon_is_client_deciding": "December"



  }



}



üß† AI DECISION SUMMARY {



  aiPhaseFromAI: 'qualification',



  leadTemperatureFromAI: 'warm',



  wantsDepositLink: false,



  wantsAppointmentOffer: false,



  consultMode: 'online',



  depositPushedThisTurn: false,



  mentionDecoyOffered: false,



  field_updates: {



    tattoo_placement: 'back shoulder',



    tattoo_summary: 'bouquet of flowers',



    how_soon_is_client_deciding: 'December'



  },



  bubblesPreview: [



    'Got it ‚Äî that bouquet of flowers on your back shoulder will look clean.',



    'December works. Perfect, we can make that happen.',



    'The next step is a quick 15‚Äì20 minute consultation with the artist to fully unde'



  ]



}



ü§ñ AI DM suggestion: {



  "language": "en",



  "bubbles": [



    "Got it ‚Äî that bouquet of flowers on your back shoulder will look clean.",



    "December works. Perfect, we can make that happen.",



    "The next step is a quick 15‚Äì20 minute consultation with the artist to fully understand your design. Would you prefer a video call or to go back and forth in messages?"



  ],



  "internal_notes": "Acknowledged tattoo idea and timing, introduced consult and asked for preferred consult mode.",



  "meta": {



    "aiPhase": "qualification",



    "leadTemperature": "warm",



    "wantsDepositLink": false,



    "wantsAppointmentOffer": false,



    "depositPushedThisTurn": false,



    "mentionDecoyOffered": false,



    "consultMode": "online"



  },



  "field_updates": {



    "tattoo_placement": "back shoulder",



    "tattoo_summary": "bouquet of flowers",



    "how_soon_is_client_deciding": "December"



  }



}



üìù Limiting bubbles from 3 to 2



‚úâÔ∏è sendConversationMessage context: { contactId: 'gC2s1kUJKLTY6YCVLlTF', isDm: true, hasPhone: false }



üîç No conversationId provided for DM, searching for existing conversation...



‚úÖ Found existing conversation 6HPBVvpLDlkJq3ydqsux with type FB



‚úÖ Using conversation type FB from GHL conversation - skipping ID validation



üì® Sending DM reply via GHL: {



  conversationId: '6HPBVvpLDlkJq3ydqsux',



  contactId: 'gC2s1kUJKLTY6YCVLlTF',



  message: 'December works. Perfect, we can make that happen.',



  type: 'FB'



}



üì® GHL DM reply response: {



  status: 201,



  contactId: 'gC2s1kUJKLTY6YCVLlTF',



  conversationId: '6HPBVvpLDlkJq3ydqsux'



}



üì§ Sent AI bubbles to GHL conversation.



üß† Updating contact system fields from AI meta: {



  ai_phase: 'qualification',



  lead_temperature: 'warm',



  consult_explained: undefined



}



üßæ Applying AI field_updates to GHL: {



  tattoo_placement: 'back shoulder',



  tattoo_summary: 'bouquet of flowers',



  how_soon_is_client_deciding: 'December'



}



‚úÖ Updated tattoo fields for contact gC2s1kUJKLTY6YCVLlTF with {



  tattoo_placement: 'back shoulder',



  tattoo_summary: 'bouquet of flowers',



  how_soon_is_client_deciding: 'December'



}



‚ÑπÔ∏è No deposit link created (either not requested, already sent, or already paid). { wantsDepositLink: false, alreadyPaid: false, alreadySent: false }



POST /ghl/message-webhook



üí¨ GHL MESSAGE WEBHOOK HIT



Raw Body: {



  "consult_explained": "",



  "AI Creative Response": "",



  "Tattoo Style": "",



  "Promotional Link": "",



  "Appt 2: Start Time": "",



  "deposit_confirmation_sent": "",



  "Deposit Made On": "",



  "pending_slot_artist": "",



  "utm medium": "",



  "pending_slot_calendar": "",



  " Appt 2: Cancellation Link": "",



  "total_tattoos_completed": "",



  "Appt 1: Reschedule Link": "",



  "Tattoo Concerns": "",



  "Appt 1: Service": "",



  "reschedule_pending": "",



  "Appt 3: Reschedule Link": "",



  "utm campaign": "",



  "TikTok": "",



  "Tattoo Title": "",



  "reschedule_target_translator_appointment_id": "",



  "Follow Up Reason": "",



  "Technician's Address": "",



  "Square Payment ID": "",



  "Technician's Photo ID": "",



  "pending_slot_end": "",



  "I have been fully informed of the risks of body art including but not limited to infection, scarring, and allergic reactions to items associated with body art procedures. Technician will not perform the body art procedure if you fail to complete or sign this form. Further, technician may decline to perform a body art procedure if the client has any identified health conditions. Having been informed of the potential risks associated with this body art procedure, I still wish to proceed with the body art application and I assume any/all risks that may arise from body art.": "",



  "Appt 2: Start Date": "",



  "Appt 1: End Time": "",



  "Customer Lifetime Value": "",



  "times_sent": "",



  "Language Preference": "English",



  "First Tattoo": "",



  "pending_slot_mode": "",



  "Appt 2: Google Calendar": "",



  "Artist Inquired (Deseado)": "",



  "hold_last_activity_at": "",



  "last_released_slot_start": "",



  "AI Email Subject": "",



  "Instagram": "",



  "Appt 1: IOS/Outlook Calendar": "",



  "First Assigned Barber": "",



  "Appt 1: Start Date": "",



  "Deposit Paid": "",



  "Artist": "",



  "last_released_slot_display": "",



  "Appt 3: Cancellation Link": "",



  "Preferred Artist": "",



  "pending_slot_start": "",



  "Lead Temperature": "warm",



  "Square Payment Status": "",



  "Deposit": "",



  "Appt 3: Google Calendar": "",



  "Appt 3: IOS/Outlook Calendar": "",



  "Emergency Contact": "",



  "Appt 3: Start Date": "",



  "Whatsapp User?": "",



  "Other Social Media": "",



  "Technician's Phone Number": "",



  "Tattoo Color Preference": "",



  "Appt 1: Cancellation Link": "",



  "Last SMS": "",



  "Valid Body Art License": "",



  "Flash Tattoo": "",



  "Appt 1: Assigned User": "",



  "square_payment_link_id": "",



  "last_released_slot_calendar": "",



  "Rent vs Commission": "",



  "Appt 1: Start Time": "",



  "pending_slot_display": "",



  "Location of Tattoo": "",



  "I {{contact.full_name}}, the client, confirm that I have read the above statements, and by checking \"Yes\" below, you give your consent to receive BODY ART.": "",



  "Appt 3: Assigned User": "",



  "Referral: Current Referral Points": "",



  "How would you like us to contact you?": "",



  "returning_client": "",



  "hold_warning_sent": "",



  "Appt 3: End Time": "",



  "consultation_type": "appointment",



  "Final Price": "",



  "Upload a Picture of a Valid ID (Driver's License, Gov ID, etc)": "",



  "Best time to contact you": "",



  "Notes to the Artist? (Optional)": "",



  "language_barrier_explained": "Yes",



  "Application Notes": "",



  "Deposit Link Sent": "",



  "Tattoo Placement": "back shoulder",



  "Appt 2: Reschedule Link": "",



  "client_lifetime_value": "",



  "Dwelling Type": "",



  "Appt 3: Start Time": "",



  "utm source": "",



  "Appt 1: Google Calendar": "",



  "Date of Procedure:": "",



  "Technician's DOB": "",



  "Referral Link Shortened": "",



  "reschedule_target_appointment_id": "",



  "hold_appointment_id": "",



  "Appt 2: IOS/Outlook Calendar": "",



  "Medical History": "",



  "Medical History (Description)": "",



  "Square Order ID": "",



  "Date Picker 3k8r": "",



  "Last Phase Update At": "2025-12-10T15:55:44.797Z",



  "Photo Reference (Referencia)": "",



  "Assigned Technician License #": "",



  "translator_needed": "Yes",



  "Google Meet Link": "",



  "How Soon Is Client Deciding?": "December",



  "Work Experience": "",



  "Appt 3: Service": "",



  "Appt 2: Service": "",



  "Project Complexity": "",



  "Appt 2: End Time": "",



  "Appt 2: Assigned User": "",



  "Square Reference ID": "",



  "translator_appointment_id": "",



  "Tattoo Photo Description": "",



  "Body Art License Number": "",



  "last_released_slot_end": "",



  "Tattoo Size": "",



  "Appt 3: End Date": "",



  "Tattoo Summary": "bouquet of flowers",



  "AI Phase": "qualification",



  "Next Follow Up At": "",



  "Assigned Technician": "",



  "contact_id": "gC2s1kUJKLTY6YCVLlTF",



  "first_name": "Maria",



  "last_name": "Claflin",



  "full_name": "Maria Claflin",



  "tags": "dm consultation request",



  "country": "US",



  "date_created": "2025-12-10T15:45:48.808Z",



  "full_address": "",



  "contact_type": "lead",



  "location": {



    "name": "Studio AZ Tattoo",



    "address": "333 Washington Ave N STE 100",



    "city": "Minneapolis",



    "state": "Minnesota",



    "country": "US",



    "postalCode": "55401",



    "fullAddress": "333 Washington Ave N STE 100, Minneapolis Minnesota 55401",



    "id": "mUemx2jG4wly4kJWBkI4"



  },



  "message": {



    "type": 11,



    "body": "What days do you have consultation openings for this week?"



  },



  "workflow": {



    "id": "8cf237bb-6cb1-4240-8ca5-b797bba8b769",



    "name": "Testing Ai Bot"



  },



  "triggerData": {},



  "contact": {



    "attributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    },



    "lastAttributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    }



  },



  "attributionSource": {},



  "customData": {



    "contactId": "gC2s1kUJKLTY6YCVLlTF",



    "messageBody": "What days do you have consultation openings for this week?"



  }



}



üì° Channel context: { isDm: true, hasPhone: false, conversationId: null, phone: null }



Parsed contactId from message webhook: gC2s1kUJKLTY6YCVLlTF



‚úÖ Loaded Contact from GHL (message webhook): {



  id: 'gC2s1kUJKLTY6YCVLlTF',



  firstName: 'Maria',



  lastName: 'Claflin',



  tags: [ 'dm consultation request' ]



}



‚úÖ Found 0 appointments for contact gC2s1kUJKLTY6YCVLlTF



üì© Incoming message text (for language detection): What days do you have consultation openings for this week?



üåê Updating language_preference based on DM/SMS detection: { previous: null, next: 'English' }



‚ùå Returning client detection failed: boolField is not a function



‚úÖ language_preference updated to English for contact: gC2s1kUJKLTY6YCVLlTF



üß† Derived system state (message): {



  currentPhase: 'qualification',



  newPhase: 'qualification',



  leadTemperature: 'warm'



}



‚úÖ System fields updated for message webhook



üîÑ [PIPELINE] Syncing opportunity stage for contact gC2s1kUJKLTY6YCVLlTF: {



  currentStage: '(none)',



  targetStage: 'INTAKE',



  context: {



    aiPhase: 'qualification',



    depositLinkSent: false,



    depositPaid: false,



    consultType: null,



    hasUpcomingTattoo: false,



    tattooCompleted: false,



    lost: false



  }



}



‚ùå Error syncing opportunity stage from message webhook: Request failed with status code 422



üîÑ Refetched contact after system field update for AI call.



ü§ñ Processing message with payload summary: {



  contactId: 'gC2s1kUJKLTY6YCVLlTF',



  leadTemperature: 'warm',



  aiPhase: 'qualification',



  language: 'English',



  returning: false,



  hasTattooPlacement: true,



  hasTattooSize: false,



  depositPaid: false,



  depositLinkSent: false



}



üîÑ New generation 12 for contact gC2s1kUJKLTY6YCVLlTF



üì± Channel emoji support: yes



‚úâÔ∏è sendConversationMessage context: { contactId: 'gC2s1kUJKLTY6YCVLlTF', isDm: true, hasPhone: false }



üîç No conversationId provided for DM, searching for existing conversation...



‚úÖ Found existing conversation 6HPBVvpLDlkJq3ydqsux with type FB



‚úÖ Using conversation type FB from GHL conversation - skipping ID validation



üì® Sending DM reply via GHL: {



  conversationId: '6HPBVvpLDlkJq3ydqsux',



  contactId: 'gC2s1kUJKLTY6YCVLlTF',



  message: 'Got it ‚Äî let me clarify anything you‚Äôre unsure about. What part should I explain?',



  type: 'FB'



}



üì® GHL DM reply response: {



  status: 201,



  contactId: 'gC2s1kUJKLTY6YCVLlTF',



  conversationId: '6HPBVvpLDlkJq3ydqsux'



}



    "id": "8cf237bb-6cb1-4240-8ca5-b797bba8b769",



    "name": "Testing Ai Bot"



  },



  "triggerData": {},



  "contact": {



    "attributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    },



    "lastAttributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    }



  },



  "attributionSource": {},



  "customData": {



    "contactId": "gC2s1kUJKLTY6YCVLlTF",



    "messageBody": "What days do you have consultation openings for this week?"



  }



}



üì° Channel context: { isDm: true, hasPhone: false, conversationId: null, phone: null }



Parsed contactId from message webhook: gC2s1kUJKLTY6YCVLlTF



‚úÖ Loaded Contact from GHL (message webhook): {



  id: 'gC2s1kUJKLTY6YCVLlTF',



  firstName: 'Maria',



  lastName: 'Claflin',



  tags: [ 'dm consultation request' ]



}



‚úÖ Found 0 appointments for contact gC2s1kUJKLTY6YCVLlTF



üì© Incoming message text (for language detection): What days do you have consultation openings for this week?



üåê Updating language_preference based on DM/SMS detection: { previous: null, next: 'English' }



‚ùå Returning client detection failed: boolField is not a function



‚úÖ language_preference updated to English for contact: gC2s1kUJKLTY6YCVLlTF



üß† Derived system state (message): {



  currentPhase: 'qualification',



  newPhase: 'qualification',



  leadTemperature: 'warm'



}



‚úÖ System fields updated for message webhook



üîÑ [PIPELINE] Syncing opportunity stage for contact gC2s1kUJKLTY6YCVLlTF: {



  currentStage: '(none)',



  targetStage: 'INTAKE',



  context: {



    aiPhase: 'qualification',



    depositLinkSent: false,



    depositPaid: false,



    consultType: null,



    hasUpcomingTattoo: false,



    tattooCompleted: false,



    lost: false



  }



}



‚ùå Error syncing opportunity stage from message webhook: Request failed with status code 422



üîÑ Refetched contact after system field update for AI call.



ü§ñ Processing message with payload summary: {



  contactId: 'gC2s1kUJKLTY6YCVLlTF',



  leadTemperature: 'warm',



  aiPhase: 'qualification',



  language: 'English',



  returning: false,



  hasTattooPlacement: true,



  hasTattooSize: false,



  depositPaid: false,



  depositLinkSent: false



}



üîÑ New generation 12 for contact gC2s1kUJKLTY6YCVLlTF



üì± Channel emoji support: yes



‚úâÔ∏è sendConversationMessage context: { contactId: 'gC2s1kUJKLTY6YCVLlTF', isDm: true, hasPhone: false }



üîç No conversationId provided for DM, searching for existing conversation...



‚úÖ Found existing conversation 6HPBVvpLDlkJq3ydqsux with type FB



‚úÖ Using conversation type FB from GHL conversation - skipping ID validation



üì® Sending DM reply via GHL: {



  conversationId: '6HPBVvpLDlkJq3ydqsux',



  contactId: 'gC2s1kUJKLTY6YCVLlTF',



  message: 'Got it ‚Äî let me clarify anything you‚Äôre unsure about. What part should I explain?',



  type: 'FB'



}



üì® GHL DM reply response: {



  status: 201,



  contactId: 'gC2s1kUJKLTY6YCVLlTF',



  conversationId: '6HPBVvpLDlkJq3ydqsux'



}
