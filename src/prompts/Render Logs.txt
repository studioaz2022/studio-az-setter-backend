
ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’¬ GHL MESSAGE WEBHOOK HIT
ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“¦ Webhook Payload (non-empty fields): {
  "contact_id": "xp6aekYUptIbjtDZSQqo",
  "first_name": "Maria",
  "last_name": "Claflin",
  "full_name": "Maria Claflin",
  "tags": "dm consultation request",
  "date_created": "2025-12-23T05:18:59.226Z",
  "contact_type": "lead",
  "location": {
    "name": "Studio AZ Tattoo",
    "address": "333 Washington Ave N STE 100",
    "city": "Minneapolis",
    "state": "Minnesota",
    "country": "US",
    "postalCode": "55401",
    "fullAddress": "333 Washington Ave N STE 100, Minneapolis Minnesota 55401",
    "id": "mUemx2jG4wly4kJWBkI4"
  },
  "message": {
    "type": 11,
    "body": "Hi Iâ€™d like to book a tattoo. How much do you charge ?"
  },
  "workflow": {
    "id": "8cf237bb-6cb1-4240-8ca5-b797bba8b769",
    "name": "Testing Ai Bot"
  },
  "contact": {
    "attributionSource": {
      "photoUrl": null,
      "sessionSource": "Social media",
      "adId": null,
      "productId": null,
      "videoUrl": null,
      "mediumId": "24364584283244494",
      "utmContent": null,
      "pSid": "24364584283244494",
      "medium": "facebook",
      "postId": null,
      "flowId": null
    },
    "lastAttributionSource": {
      "photoUrl": null,
      "sessionSource": "Social media",
      "adId": null,
      "productId": null,
      "videoUrl": null,
      "mediumId": "24364584283244494",
      "utmContent": null,
      "pSid": "24364584283244494",
      "medium": "facebook",
      "postId": null,
      "flowId": null
    }
  },
  "customData": {
    "contactId": "xp6aekYUptIbjtDZSQqo",
    "messageBody": "Hi Iâ€™d like to book a tattoo. How much do you charge ?"
  }
}
ğŸ“© Incoming message text: Hi Iâ€™d like to book a tattoo. How much do you charge ?
ğŸ‘¤ Contact ID: xp6aekYUptIbjtDZSQqo
â³ [DEBOUNCE] Started new batch for xp6aekYUptIbjtDZSQqo. Waiting 15s for more messages...
==> Detected service running on port 10000
==> Docs on specifying a port: https://render.com/docs/web-services#port-binding
âœ… [DEBOUNCE] Processing batch for xp6aekYUptIbjtDZSQqo: 1 message(s) after 15.0s
ğŸ“¦ [DEBOUNCE] Processing 1 batched message(s):
   1. Hi Iâ€™d like to book a tattoo. How much do you charge ?
ğŸ“‹ Webhook custom fields extracted: {}
ğŸ‘¤ Contact: Maria Claflin
ğŸ“‹ Contact custom fields (merged): {}
ğŸ“¡ Channel context: {
  isDm: true,
  hasPhone: false,
  isWhatsApp: false,
  isSms: false,
  channelType: 'facebook',
  conversationId: null,
  phone: null
}
ğŸ“Š [PIPELINE] New lead from facebook - syncing entry stage...
ğŸ“Š [PIPELINE] Direct channel (facebook) â†’ starting at DISCOVERY
âœ… [PIPELINE] Entry stage set: DISCOVERY (contact: xp6aekYUptIbjtDZSQqo)
ğŸ“œ Fetching conversation history...
ğŸ“œ Fetched 1 messages for contact xp6aekYUptIbjtDZSQqo
ğŸ“œ Thread context: {
  totalMessages: 1,
  recentCount: 1,
  hasSummary: false,
  hasImageContext: false,
  wasHumanHandling: false,
  isReturningClient: false
}
ğŸ§  [AI CONTEXT] Processing message: {
  messageText: 'Hi Iâ€™d like to book a tattoo. How much do you charge ?',
  contactId: 'xp6aekYUptIbjtDZSQqo',
  contactName: 'Maria Claflin',
  consultExplained: undefined,
  threadStats: {
    totalMessages: 1,
    recentMessages: 1,
    hasSummary: false,
    hasImageContext: false,
    wasHumanHandling: false
  }
}
ğŸ“Š [CANONICAL] State before routing: {
  tattooSummary: null,
  tattooPlacement: null,
  tattooSize: null,
  timeline: null,
  consultationType: null,
  depositPaid: false,
  derivedPhase: 'intake'
}
ğŸ¯ [INTENTS] Detected intents: [ 'process_or_price_question_intent' ] from message: Hi Iâ€™d like to book a tattoo. How much do you charge ?
ğŸ“œ [AI] Thread context included: {
  totalMessages: 1,
  recentCount: 1,
  hasSummary: false,
  hasImageContext: false,
  wasHumanHandling: false
}
ğŸ¤– Raw OpenAI opener response: {
  "language": "en",
  "bubbles": [
    "Hey Maria â€” prices really depend on the size and detail of your tattoo.",
    "What kind of piece are you thinking, and where were you thinking of placing it?"
  ],
  "internal_notes": "Opening message to start intake, no price quotes, asking for tattoo idea and placement.",
  "meta": {
    "aiPhase": "intake",
    "leadTemperature": "warm",
    "wantsDepositLink": false,
    "depositPushedThisTurn": false,
    "mentionDecoyOffered": false,
    "wantsAppointmentOffer": false,
    "consultMode": "online"
  },
  "field_updates": {}
}
â±ï¸ [TIMING] AI call took 5379ms
ğŸ§­ [PHASE] derived_phase snapshot {
  derived_phase: 'intake',
  canonical: {
    tattooSummary: null,
    tattooPlacement: null,
    tattooSize: null,
    timeline: null,
    consultationType: null,
    consultationTypeLocked: false,
    depositLinkSent: false,
    depositPaid: false,
    holdAppointmentId: null
  },
  intents: {
    reschedule_intent: false,
    cancel_intent: false,
    scheduling_intent: false,
    slot_selection_intent: false,
    deposit_intent: false,
    consult_path_choice_intent: false,
    artist_guided_size_intent: false,
    process_or_price_question_intent: true,
    objection_intent: false,
    objection_type: null,
    objection_data: null
  },
  selected_handler: 'ai',
  routing_reason: 'ai_fallback',
  intent_flags: [ 'process_or_price_question_intent' ]
}
â±ï¸ [TIMING] Total handleInboundMessage took 5387ms
ğŸ¤– AI Response Summary: {
  bubblesCount: 2,
  phase: 'intake',
  handler: 'ai',
  reason: 'ai_fallback',
  fieldUpdatesKeys: []
}
âœ‰ï¸ sendConversationMessage context: { contactId: 'xp6aekYUptIbjtDZSQqo', isDm: true, hasPhone: false }
ğŸ” No conversationId provided for DM, searching for DM conversation...
ğŸ” No DM conversation found for contact
ğŸ” No existing DM conversation found, will try to infer type from contact...
ğŸ” No DM conversation found for contact
inferConversationMessageType: no DM conversation found, checking contact tags...
ğŸ“¨ Sending DM via GHL (creating new conversation): {
  contactId: 'xp6aekYUptIbjtDZSQqo',
  locationId: 'mUemx2jG4wly4kJWBkI4',
  message: 'Hey Maria â€” prices really depend on the size and detail of your tattoo.',
  type: 'FB'
}
ğŸ“¨ GHL DM message response (new conversation): { status: 201, contactId: 'xp6aekYUptIbjtDZSQqo', type: 'FB' }
âœ‰ï¸ sendConversationMessage context: { contactId: 'xp6aekYUptIbjtDZSQqo', isDm: true, hasPhone: false }
ğŸ” No conversationId provided for DM, searching for DM conversation...
ğŸ” No DM conversation found for contact
ğŸ” No existing DM conversation found, will try to infer type from contact...
ğŸ” No DM conversation found for contact
inferConversationMessageType: no DM conversation found, checking contact tags...
ğŸ“¨ Sending DM via GHL (creating new conversation): {
  contactId: 'xp6aekYUptIbjtDZSQqo',
  locationId: 'mUemx2jG4wly4kJWBkI4',
  message: 'What kind of piece are you thinking, and where were you thinking of placing it?',
  type: 'FB'
}
ğŸ“¨ GHL DM message response (new conversation): { status: 201, contactId: 'xp6aekYUptIbjtDZSQqo', type: 'FB' }
ğŸ“¤ Sent 2/2 bubbles to GHL conversation
â„¹ï¸ No field_updates from AI to persist this turn
ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’¬ GHL MESSAGE WEBHOOK HIT
ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“¦ Webhook Payload (non-empty fields): {
  "contact_id": "xp6aekYUptIbjtDZSQqo",
  "first_name": "Maria",
  "last_name": "Claflin",
  "full_name": "Maria Claflin",
  "tags": "dm consultation request",
  "country": "US",
  "date_created": "2025-12-23T05:18:59.226Z",
  "contact_type": "lead",
  "location": {
    "name": "Studio AZ Tattoo",
    "address": "333 Washington Ave N STE 100",
    "city": "Minneapolis",
    "state": "Minnesota",
    "country": "US",
    "postalCode": "55401",
    "fullAddress": "333 Washington Ave N STE 100, Minneapolis Minnesota 55401",
    "id": "mUemx2jG4wly4kJWBkI4"
  },
  "message": {
    "type": 11,
    "body": "This is the idea I had"
  },
  "workflow": {
    "id": "8cf237bb-6cb1-4240-8ca5-b797bba8b769",
    "name": "Testing Ai Bot"
  },
  "contact": {
    "attributionSource": {
      "photoUrl": null,
      "sessionSource": "Social media",
      "adId": null,
      "productId": null,
      "videoUrl": null,
      "mediumId": "24364584283244494",
      "utmContent": null,
      "pSid": "24364584283244494",
      "medium": "facebook",
      "postId": null,
      "flowId": null
    },
    "lastAttributionSource": {
      "photoUrl": null,
      "sessionSource": "Social media",
      "adId": null,
      "productId": null,
      "videoUrl": null,
      "mediumId": "24364584283244494",
      "utmContent": null,
      "pSid": "24364584283244494",
      "medium": "facebook",
      "postId": null,
      "flowId": null
    }
  },
  "customData": {
    "contactId": "xp6aekYUptIbjtDZSQqo",
    "messageBody": "This is the idea I had"
  }
}
ğŸ“© Incoming message text: This is the idea I had
ğŸ‘¤ Contact ID: xp6aekYUptIbjtDZSQqo
â³ [DEBOUNCE] Started new batch for xp6aekYUptIbjtDZSQqo. Waiting 15s for more messages...
âœ… [DEBOUNCE] Processing batch for xp6aekYUptIbjtDZSQqo: 1 message(s) after 15.0s
ğŸ“¦ [DEBOUNCE] Processing 1 batched message(s):
   1. This is the idea I had
ğŸ“‹ Webhook custom fields extracted: {}
ğŸ‘¤ Contact: Maria Claflin
ğŸ“‹ Contact custom fields (merged): {}
ğŸ“¡ Channel context: {
  isDm: true,
  hasPhone: false,
  isWhatsApp: false,
  isSms: false,
  channelType: 'facebook',
  conversationId: null,
  phone: null
}
ğŸ“Š [PIPELINE] New lead from facebook - syncing entry stage...
ğŸ“Š [PIPELINE] Direct channel (facebook) â†’ starting at DISCOVERY
âœ… [PIPELINE] Entry stage set: DISCOVERY (contact: xp6aekYUptIbjtDZSQqo)
ğŸ“œ Fetching conversation history...
ğŸ“œ Fetched 5 messages for contact xp6aekYUptIbjtDZSQqo
ğŸ“œ Thread context: {
  totalMessages: 5,
  recentCount: 5,
  hasSummary: false,
  hasImageContext: true,
  wasHumanHandling: true,
  isReturningClient: false
}
ğŸ§  [AI CONTEXT] Processing message: {
  messageText: 'This is the idea I had',
  contactId: 'xp6aekYUptIbjtDZSQqo',
  contactName: 'Maria Claflin',
  consultExplained: undefined,
  threadStats: {
    totalMessages: 5,
    recentMessages: 5,
    hasSummary: false,
    hasImageContext: true,
    wasHumanHandling: true
  }
}
ğŸ“Š [CANONICAL] State before routing: {
  tattooSummary: null,
  tattooPlacement: null,
  tattooSize: null,
  timeline: null,
  consultationType: null,
  depositPaid: false,
  derivedPhase: 'intake'
}
ğŸ¯ [INTENTS] No specific intents detected for: This is the idea I had
ğŸ“œ [AI] Thread context included: {
  totalMessages: 5,
  recentCount: 5,
  hasSummary: false,
  hasImageContext: true,
  wasHumanHandling: true
}
ğŸ¤– Raw OpenAI opener response: {
  "language": "en",
  "bubbles": [
    "Hey Maria â€” that looks like a cool idea youâ€™ve got there.",
    "Where were you thinking of placing it, and about what size?"
  ],
  "internal_notes": "Acknowledging the tattoo idea image and asking for placement and size to gather basics.",
  "meta": {
    "aiPhase": "intake",
    "leadTemperature": "warm",
    "wantsDepositLink": false,
    "depositPushedThisTurn": false,
    "mentionDecoyOffered": false,
    "consultMode": "online"
  },
  "field_updates": {}
}
â±ï¸ [TIMING] AI call took 3611ms
ğŸ§­ [PHASE] derived_phase snapshot {
  derived_phase: 'intake',
  canonical: {
    tattooSummary: null,
    tattooPlacement: null,
    tattooSize: null,
    timeline: null,
    consultationType: null,
    consultationTypeLocked: false,
    depositLinkSent: false,
    depositPaid: false,
    holdAppointmentId: null
  },
  intents: {
    reschedule_intent: false,
    cancel_intent: false,
    scheduling_intent: false,
    slot_selection_intent: false,
    deposit_intent: false,
    consult_path_choice_intent: false,
    artist_guided_size_intent: false,
    process_or_price_question_intent: false,
    objection_intent: false,
    objection_type: null,
    objection_data: null
  },
  selected_handler: 'ai',
  routing_reason: 'ai_fallback',
  intent_flags: []
}
â±ï¸ [TIMING] Total handleInboundMessage took 3614ms
ğŸ¤– AI Response Summary: {
  bubblesCount: 2,
  phase: 'intake',
  handler: 'ai',
  reason: 'ai_fallback',
  fieldUpdatesKeys: []
}
âœ‰ï¸ sendConversationMessage context: { contactId: 'xp6aekYUptIbjtDZSQqo', isDm: true, hasPhone: false }
ğŸ” No conversationId provided for DM, searching for DM conversation...
ğŸ” No DM conversation found for contact
ğŸ” No existing DM conversation found, will try to infer type from contact...
ğŸ” No DM conversation found for contact
inferConversationMessageType: no DM conversation found, checking contact tags...
ğŸ“¨ Sending DM via GHL (creating new conversation): {
  contactId: 'xp6aekYUptIbjtDZSQqo',
  locationId: 'mUemx2jG4wly4kJWBkI4',
  message: 'Hey Maria â€” that looks like a cool idea youâ€™ve got there.',
  type: 'FB'
}
ğŸ“¨ GHL DM message response (new conversation): { status: 201, contactId: 'xp6aekYUptIbjtDZSQqo', type: 'FB' }
âœ‰ï¸ sendConversationMessage context: { contactId: 'xp6aekYUptIbjtDZSQqo', isDm: true, hasPhone: false }
ğŸ” No conversationId provided for DM, searching for DM conversation...
ğŸ” No DM conversation found for contact
ğŸ” No existing DM conversation found, will try to infer type from contact...
ğŸ” No DM conversation found for contact
inferConversationMessageType: no DM conversation found, checking contact tags...
ğŸ“¨ Sending DM via GHL (creating new conversation): {
  contactId: 'xp6aekYUptIbjtDZSQqo',
  locationId: 'mUemx2jG4wly4kJWBkI4',
  message: 'Where were you thinking of placing it, and about what size?',
  type: 'FB'
}
ğŸ“¨ GHL DM message response (new conversation): { status: 201, contactId: 'xp6aekYUptIbjtDZSQqo', type: 'FB' }
ğŸ“¤ Sent 2/2 bubbles to GHL conversation
â„¹ï¸ No field_updates from AI to persist this turn
ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’¬ GHL MESSAGE WEBHOOK HIT
ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“¦ Webhook Payload (non-empty fields): {
  "contact_id": "xp6aekYUptIbjtDZSQqo",
  "first_name": "Maria",
  "last_name": "Claflin",
  "full_name": "Maria Claflin",
  "tags": "dm consultation request",
  "country": "US",
  "date_created": "2025-12-23T05:18:59.226Z",
  "contact_type": "lead",
  "location": {
    "name": "Studio AZ Tattoo",
    "address": "333 Washington Ave N STE 100",
    "city": "Minneapolis",
    "state": "Minnesota",
    "country": "US",
    "postalCode": "55401",
    "fullAddress": "333 Washington Ave N STE 100, Minneapolis Minnesota 55401",
    "id": "mUemx2jG4wly4kJWBkI4"
  },
  "message": {
    "type": 11,
    "body": "I like the look of it on my calf and about the same size as the image, 6-7 inches long and a few inches wide"
  },
  "workflow": {
    "id": "8cf237bb-6cb1-4240-8ca5-b797bba8b769",
    "name": "Testing Ai Bot"
  },
  "contact": {
    "attributionSource": {
      "photoUrl": null,
      "sessionSource": "Social media",
      "adId": null,
      "productId": null,
      "videoUrl": null,
      "mediumId": "24364584283244494",
      "utmContent": null,
      "pSid": "24364584283244494",
      "medium": "facebook",
      "postId": null,
      "flowId": null
    },
    "lastAttributionSource": {
      "photoUrl": null,
      "sessionSource": "Social media",
      "adId": null,
      "productId": null,
      "videoUrl": null,
      "mediumId": "24364584283244494",
      "utmContent": null,
      "pSid": "24364584283244494",
      "medium": "facebook",
      "postId": null,
      "flowId": null
    }
  },
  "customData": {
    "contactId": "xp6aekYUptIbjtDZSQqo",
    "messageBody": "I like the look of it on my calf and about the same size as the image, 6-7 inches long and a few inches wide"
  }
}
ğŸ“© Incoming message text: I like the look of it on my calf and about the same size as the image, 6-7 inches long and a few inches wide
ğŸ‘¤ Contact ID: xp6aekYUptIbjtDZSQqo
â³ [DEBOUNCE] Started new batch for xp6aekYUptIbjtDZSQqo. Waiting 15s for more messages...
âœ… [DEBOUNCE] Processing batch for xp6aekYUptIbjtDZSQqo: 1 message(s) after 15.0s
ğŸ“¦ [DEBOUNCE] Processing 1 batched message(s):
   1. I like the look of it on my calf and about the same size as the image, 6-7 inches long and a few inches wide
ğŸ“‹ Webhook custom fields extracted: {}
ğŸ‘¤ Contact: Maria Claflin
ğŸ“‹ Contact custom fields (merged): {}
ğŸ“¡ Channel context: {
  isDm: true,
  hasPhone: false,
  isWhatsApp: false,
  isSms: false,
  channelType: 'facebook',
  conversationId: null,
  phone: null
}
ğŸ“Š [PIPELINE] New lead from facebook - syncing entry stage...
ğŸ“Š [PIPELINE] Direct channel (facebook) â†’ starting at DISCOVERY
âœ… [PIPELINE] Entry stage set: DISCOVERY (contact: xp6aekYUptIbjtDZSQqo)
ğŸ“œ Fetching conversation history...
ğŸ“œ Fetched 8 messages for contact xp6aekYUptIbjtDZSQqo
ğŸ“œ Thread context: {
  totalMessages: 8,
  recentCount: 8,
  hasSummary: false,
  hasImageContext: true,
  wasHumanHandling: true,
  isReturningClient: false
}
ğŸ§  [AI CONTEXT] Processing message: {
  messageText: 'I like the look of it on my calf and about the same size as the image, 6-7 inches long and a few inches wide',
  contactId: 'xp6aekYUptIbjtDZSQqo',
  contactName: 'Maria Claflin',
  consultExplained: undefined,
  threadStats: {
    totalMessages: 8,
    recentMessages: 8,
    hasSummary: false,
    hasImageContext: true,
    wasHumanHandling: true
  }
}
ğŸ“Š [CANONICAL] State before routing: {
  tattooSummary: null,
  tattooPlacement: null,
  tattooSize: null,
  timeline: null,
  consultationType: null,
  depositPaid: false,
  derivedPhase: 'intake'
}
ğŸ¯ [INTENTS] No specific intents detected for: I like the look of it on my calf and about the same size as the image, 6-7 inches long and a few inches wide
ğŸ“œ [AI] Thread context included: {
  totalMessages: 8,
  recentCount: 8,
  hasSummary: false,
  hasImageContext: true,
  wasHumanHandling: true
}
ğŸ¤– Raw OpenAI opener response: {
  "language": "en",
  "bubbles": [
    "Got it â€” that calf piece around 6-7 inches sounds solid.",
    "When were you thinking of getting it done?"
  ],
  "internal_notes": "Acknowledged placement and size; moved to timing question to qualify lead.",
  "meta": {
    "aiPhase": "qualification",
    "leadTemperature": "warm",
    "wantsDepositLink": false,
    "depositPushedThisTurn": false,
    "mentionDecoyOffered": false,
    "consultMode": "online"
  },
  "field_updates": {
    "tattoo_placement": "calf",
    "tattoo_size": "6-7 inches"
  }
}
â±ï¸ [TIMING] AI call took 2685ms
ğŸ§­ [PHASE] derived_phase snapshot {
  derived_phase: 'intake',
  canonical: {
    tattooSummary: null,
    tattooPlacement: 'calf',
    tattooSize: '6-7 inches',
    timeline: null,
    consultationType: null,
    consultationTypeLocked: false,
    depositLinkSent: false,
    depositPaid: false,
    holdAppointmentId: null
  },
  intents: {
    reschedule_intent: false,
    cancel_intent: false,
    scheduling_intent: false,
    slot_selection_intent: false,
    deposit_intent: false,
    consult_path_choice_intent: false,
    artist_guided_size_intent: false,
    process_or_price_question_intent: false,
    objection_intent: false,
    objection_type: null,
    objection_data: null
  },
  selected_handler: 'ai',
  routing_reason: 'ai_fallback',
  intent_flags: []
}
â±ï¸ [TIMING] Total handleInboundMessage took 2876ms
ğŸ¤– AI Response Summary: {
  bubblesCount: 2,
  phase: 'intake',
  handler: 'ai',
  reason: 'ai_fallback',
  fieldUpdatesKeys: [ 'tattoo_placement', 'tattoo_size' ]
}
âœ‰ï¸ sendConversationMessage context: { contactId: 'xp6aekYUptIbjtDZSQqo', isDm: true, hasPhone: false }
ğŸ” No conversationId provided for DM, searching for DM conversation...
ğŸ” No DM conversation found for contact
ğŸ” No existing DM conversation found, will try to infer type from contact...
inferConversationMessageType: no DM conversation found, checking contact tags...
ğŸ” No DM conversation found for contact
ğŸ“¨ Sending DM via GHL (creating new conversation): {
  contactId: 'xp6aekYUptIbjtDZSQqo',
  locationId: 'mUemx2jG4wly4kJWBkI4',
  message: 'Got it â€” that calf piece around 6-7 inches sounds solid.',
  type: 'FB'
}
ğŸ“¨ GHL DM message response (new conversation): { status: 201, contactId: 'xp6aekYUptIbjtDZSQqo', type: 'FB' }
âœ‰ï¸ sendConversationMessage context: { contactId: 'xp6aekYUptIbjtDZSQqo', isDm: true, hasPhone: false }
ğŸ” No conversationId provided for DM, searching for DM conversation...
ğŸ” No DM conversation found for contact
ğŸ” No existing DM conversation found, will try to infer type from contact...
ğŸ” No DM conversation found for contact
inferConversationMessageType: no DM conversation found, checking contact tags...
ğŸ“¨ Sending DM via GHL (creating new conversation): {
  contactId: 'xp6aekYUptIbjtDZSQqo',
  locationId: 'mUemx2jG4wly4kJWBkI4',
  message: 'When were you thinking of getting it done?',
  type: 'FB'
}
ğŸ“¨ GHL DM message response (new conversation): { status: 201, contactId: 'xp6aekYUptIbjtDZSQqo', type: 'FB' }
ğŸ“¤ Sent 2/2 bubbles to GHL conversation
âœ… Updated tattoo fields for contact xp6aekYUptIbjtDZSQqo with { tattoo_placement: 'calf', tattoo_size: '6-7 inches' }
âœ… Persisted field_updates: [ 'tattoo_placement', 'tattoo_size' ]
ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’¬ GHL MESSAGE WEBHOOK HIT
ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“¦ Webhook Payload (non-empty fields): {
  "Tattoo Placement": "calf",
  "contact_id": "xp6aekYUptIbjtDZSQqo",
  "first_name": "Maria",
  "last_name": "Claflin",
  "full_name": "Maria Claflin",
  "tags": "dm consultation request",
  "country": "US",
  "date_created": "2025-12-23T05:18:59.226Z",
  "contact_type": "lead",
  "location": {
    "name": "Studio AZ Tattoo",
    "address": "333 Washington Ave N STE 100",
    "city": "Minneapolis",
    "state": "Minnesota",
    "country": "US",
    "postalCode": "55401",
    "fullAddress": "333 Washington Ave N STE 100, Minneapolis Minnesota 55401",
    "id": "mUemx2jG4wly4kJWBkI4"
  },
  "message": {
    "type": 11,
    "body": "In January"
  },
  "workflow": {
    "id": "8cf237bb-6cb1-4240-8ca5-b797bba8b769",
    "name": "Testing Ai Bot"
  },
  "contact": {
    "attributionSource": {
      "photoUrl": null,
      "sessionSource": "Social media",
      "adId": null,
      "productId": null,
      "videoUrl": null,
      "mediumId": "24364584283244494",
      "utmContent": null,
      "pSid": "24364584283244494",
      "medium": "facebook",
      "postId": null,
      "flowId": null
    },
    "lastAttributionSource": {
      "photoUrl": null,
      "sessionSource": "Social media",
      "adId": null,
      "productId": null,
      "videoUrl": null,
      "mediumId": "24364584283244494",
      "utmContent": null,
      "pSid": "24364584283244494",
      "medium": "facebook",
      "postId": null,
      "flowId": null
    }
  },
  "customData": {
    "contactId": "xp6aekYUptIbjtDZSQqo",
    "messageBody": "In January"
  }
}
ğŸ“© Incoming message text: In January
ğŸ‘¤ Contact ID: xp6aekYUptIbjtDZSQqo
â³ [DEBOUNCE] Started new batch for xp6aekYUptIbjtDZSQqo. Waiting 15s for more messages...
âœ… [DEBOUNCE] Processing batch for xp6aekYUptIbjtDZSQqo: 1 message(s) after 15.0s
ğŸ“¦ [DEBOUNCE] Processing 1 batched message(s):
   1. In January
ğŸ“‹ Webhook custom fields extracted: {
  "tattoo_placement": "calf"
}
ğŸ‘¤ Contact: Maria Claflin
ğŸ“‹ Contact custom fields (merged): {
  "kxtfzydeskuys5lltksr": "6-7 inches",
  "jd8yhvksbi4agqjqoeov": "calf",
  "tattoo_placement": "calf"
}
ğŸ“¡ Channel context: {
  isDm: true,
  hasPhone: false,
  isWhatsApp: false,
  isSms: false,
  channelType: 'facebook',
  conversationId: null,
  phone: null
}
ğŸ“Š [PIPELINE] New lead from facebook - syncing entry stage...
ğŸ“Š [PIPELINE] Direct channel (facebook) â†’ starting at DISCOVERY
âœ… [PIPELINE] Entry stage set: DISCOVERY (contact: xp6aekYUptIbjtDZSQqo)
ğŸ“œ Fetching conversation history...
ğŸ“œ Fetched 11 messages for contact xp6aekYUptIbjtDZSQqo
ğŸ“œ Thread context: {
  totalMessages: 11,
  recentCount: 11,
  hasSummary: false,
  hasImageContext: true,
  wasHumanHandling: true,
  isReturningClient: false
}
ğŸ§  [AI CONTEXT] Processing message: {
  messageText: 'In January',
  contactId: 'xp6aekYUptIbjtDZSQqo',
  contactName: 'Maria Claflin',
  consultExplained: undefined,
  threadStats: {
    totalMessages: 11,
    recentMessages: 11,
    hasSummary: false,
    hasImageContext: true,
    wasHumanHandling: true
  }
}
ğŸ“Š [CANONICAL] State before routing: {
  tattooSummary: null,
  tattooPlacement: 'calf',
  tattooSize: null,
  timeline: null,
  consultationType: null,
  depositPaid: false,
  derivedPhase: 'intake'
}
ğŸ¯ [INTENTS] No specific intents detected for: In January
ğŸ“œ [AI] Thread context included: {
  totalMessages: 11,
  recentCount: 11,
  hasSummary: false,
  hasImageContext: true,
  wasHumanHandling: true
}
ğŸ¤– Raw OpenAI opener response: {
  "language": "en",
  "bubbles": [
    "Perfect, January works. We can make that happen.",
    "The next step is a quick 15â€“20 minute consultation with the artist to fully understand your design.",
    "Since our artist's native language is Spanish, our clients either do a video call with a translator or message the artist directly about their idea. Both options have worked great â€” which do you prefer?"
  ],
  "internal_notes": "Acknowledged timing and introduced the consultation step with explanation of consult modes.",
  "meta": {
    "aiPhase": "qualification",
    "leadTemperature": "warm",
    "wantsDepositLink": false,
    "depositPushedThisTurn": false,
    "mentionDecoyOffered": false,
    "wantsAppointmentOffer": false,
    "consultMode": "online"
  },
  "field_updates": {
    "how_soon_is_client_deciding": "January"
  }
}
â±ï¸ [TIMING] AI call took 4372ms
ğŸ§­ [PHASE] derived_phase snapshot {
  derived_phase: 'consult_path',
  canonical: {
    tattooSummary: null,
    tattooPlacement: 'calf',
    tattooSize: null,
    timeline: 'January',
    consultationType: null,
    consultationTypeLocked: false,
    depositLinkSent: false,
    depositPaid: false,
    holdAppointmentId: null
  },
  intents: {
    reschedule_intent: false,
    cancel_intent: false,
    scheduling_intent: false,
    slot_selection_intent: false,
    deposit_intent: false,
    consult_path_choice_intent: false,
    artist_guided_size_intent: false,
    process_or_price_question_intent: false,
    objection_intent: false,
    objection_type: null,
    objection_data: null
  },
  selected_handler: 'ai',
  routing_reason: 'ai_fallback',
  intent_flags: []
}
â±ï¸ [TIMING] Total handleInboundMessage took 4572ms
ğŸ¤– AI Response Summary: {
  bubblesCount: 3,
  phase: 'consult_path',
  handler: 'ai',
  reason: 'ai_fallback',
  fieldUpdatesKeys: [ 'how_soon_is_client_deciding' ]
}
âœ‰ï¸ sendConversationMessage context: { contactId: 'xp6aekYUptIbjtDZSQqo', isDm: true, hasPhone: false }
ğŸ” No conversationId provided for DM, searching for DM conversation...
ğŸ” No DM conversation found for contact
ğŸ” No existing DM conversation found, will try to infer type from contact...
ğŸ” No DM conversation found for contact
inferConversationMessageType: no DM conversation found, checking contact tags...
ğŸ“¨ Sending DM via GHL (creating new conversation): {
  contactId: 'xp6aekYUptIbjtDZSQqo',
  locationId: 'mUemx2jG4wly4kJWBkI4',
  message: 'Perfect, January works. We can make that happen.',
  type: 'FB'
}
ğŸ“¨ GHL DM message response (new conversation): { status: 201, contactId: 'xp6aekYUptIbjtDZSQqo', type: 'FB' }
âœ‰ï¸ sendConversationMessage context: { contactId: 'xp6aekYUptIbjtDZSQqo', isDm: true, hasPhone: false }
ğŸ” No conversationId provided for DM, searching for DM conversation...
ğŸ” No DM conversation found for contact
ğŸ” No existing DM conversation found, will try to infer type from contact...
ğŸ” No DM conversation found for contact
inferConversationMessageType: no DM conversation found, checking contact tags...
ğŸ“¨ Sending DM via GHL (creating new conversation): {
  contactId: 'xp6aekYUptIbjtDZSQqo',
  locationId: 'mUemx2jG4wly4kJWBkI4',
  message: 'The next step is a quick 15â€“20 minute consultation with the artist to fully understand your design.',
  type: 'FB'
}
ğŸ“¨ GHL DM message response (new conversation): { status: 201, contactId: 'xp6aekYUptIbjtDZSQqo', type: 'FB' }
âœ‰ï¸ sendConversationMessage context: { contactId: 'xp6aekYUptIbjtDZSQqo', isDm: true, hasPhone: false }
ğŸ” No conversationId provided for DM, searching for DM conversation...
ğŸ” No DM conversation found for contact
ğŸ” No existing DM conversation found, will try to infer type from contact...
inferConversationMessageType: no DM conversation found, checking contact tags...
ğŸ” No DM conversation found for contact
ğŸ“¨ Sending DM via GHL (creating new conversation): {
  contactId: 'xp6aekYUptIbjtDZSQqo',
  locationId: 'mUemx2jG4wly4kJWBkI4',
  message: "Since our artist's native language is Spanish, our clients either do a video call with a translator or message the artist directly about their idea. Both options have worked great â€” which do you prefer?",
  type: 'FB'
}
ğŸ“¨ GHL DM message response (new conversation): { status: 201, contactId: 'xp6aekYUptIbjtDZSQqo', type: 'FB' }
ğŸ“¤ Sent 3/3 bubbles to GHL conversation
âœ… Updated tattoo fields for contact xp6aekYUptIbjtDZSQqo with { how_soon_is_client_deciding: 'January' }
âœ… Persisted field_updates: [ 'how_soon_is_client_deciding' ]
ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’¬ GHL MESSAGE WEBHOOK HIT
ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“¦ Webhook Payload (non-empty fields): {
  "Tattoo Placement": "calf",
  "How Soon Is Client Deciding?": "January",
  "contact_id": "xp6aekYUptIbjtDZSQqo",
  "first_name": "Maria",
  "last_name": "Claflin",
  "full_name": "Maria Claflin",
  "tags": "dm consultation request",
  "country": "US",
  "date_created": "2025-12-23T05:18:59.226Z",
  "contact_type": "lead",
  "location": {
    "name": "Studio AZ Tattoo",
    "address": "333 Washington Ave N STE 100",
    "city": "Minneapolis",
    "state": "Minnesota",
    "country": "US",
    "postalCode": "55401",
    "fullAddress": "333 Washington Ave N STE 100, Minneapolis Minnesota 55401",
    "id": "mUemx2jG4wly4kJWBkI4"
  },
  "message": {
    "type": 11,
    "body": "Video call works"
  },
  "workflow": {
    "id": "8cf237bb-6cb1-4240-8ca5-b797bba8b769",
    "name": "Testing Ai Bot"
  },
  "contact": {
    "attributionSource": {
      "photoUrl": null,
      "sessionSource": "Social media",
      "adId": null,
      "productId": null,
      "videoUrl": null,
      "mediumId": "24364584283244494",
      "utmContent": null,
      "pSid": "24364584283244494",
      "medium": "facebook",
      "postId": null,
      "flowId": null
    },
    "lastAttributionSource": {
      "photoUrl": null,
      "sessionSource": "Social media",
      "adId": null,
      "productId": null,
      "videoUrl": null,
      "mediumId": "24364584283244494",
      "utmContent": null,
      "pSid": "24364584283244494",
      "medium": "facebook",
      "postId": null,
      "flowId": null
    }
  },
  "customData": {
    "contactId": "xp6aekYUptIbjtDZSQqo",
    "messageBody": "Video call works"
  }
}
ğŸ“© Incoming message text: Video call works
ğŸ‘¤ Contact ID: xp6aekYUptIbjtDZSQqo
â³ [DEBOUNCE] Started new batch for xp6aekYUptIbjtDZSQqo. Waiting 15s for more messages...
âœ… [DEBOUNCE] Processing batch for xp6aekYUptIbjtDZSQqo: 1 message(s) after 15.0s
ğŸ“¦ [DEBOUNCE] Processing 1 batched message(s):
   1. Video call works
ğŸ“‹ Webhook custom fields extracted: {
  "tattoo_placement": "calf",
  "how_soon_is_client_deciding": "January"
}
ğŸ‘¤ Contact: Maria Claflin
ğŸ“‹ Contact custom fields (merged): {
  "kxtfzydeskuys5lltksr": "6-7 inches",
  "jd8yhvksbi4agqjqoeov": "calf",
  "ra4nk80wma8eqklcfxst": "January",
  "tattoo_placement": "calf",
  "how_soon_is_client_deciding": "January"
}
ğŸ“¡ Channel context: {
  isDm: true,
  hasPhone: false,
  isWhatsApp: false,
  isSms: false,
  channelType: 'facebook',
  conversationId: null,
  phone: null
}
ğŸ“Š [PIPELINE] New lead from facebook - syncing entry stage...
ğŸ“Š [PIPELINE] Direct channel (facebook) â†’ starting at DISCOVERY
âœ… [PIPELINE] Entry stage set: DISCOVERY (contact: xp6aekYUptIbjtDZSQqo)
ğŸ“œ Fetching conversation history...
ğŸ“œ Fetched 15 messages for contact xp6aekYUptIbjtDZSQqo
ğŸ“œ Thread context: {
  totalMessages: 15,
  recentCount: 15,
  hasSummary: false,
  hasImageContext: true,
  wasHumanHandling: true,
  isReturningClient: false
}
ğŸ§  [AI CONTEXT] Processing message: {
  messageText: 'Video call works',
  contactId: 'xp6aekYUptIbjtDZSQqo',
  contactName: 'Maria Claflin',
  consultExplained: undefined,
  threadStats: {
    totalMessages: 15,
    recentMessages: 15,
    hasSummary: false,
    hasImageContext: true,
    wasHumanHandling: true
  }
}
ğŸ“Š [CANONICAL] State before routing: {
  tattooSummary: null,
  tattooPlacement: 'calf',
  tattooSize: null,
  timeline: 'January',
  consultationType: null,
  depositPaid: false,
  derivedPhase: 'consult_path'
}
ğŸ¯ [INTENTS] Detected intents: [ 'consult_path_choice_intent' ] from message: Video call works
ğŸ“ [CONSULTATION_TYPE] Setting consultation_type="appointment" (translator needed) for contact xp6aekYUptIbjtDZSQqo (detected from: "Video call works")
ğŸŒ Adding translator as follower for contact xp6aekYUptIbjtDZSQqo
ğŸŒ [TRANSLATOR] Added translator as follower for video consultation contact xp6aekYUptIbjtDZSQqo
âŒ Error adding followers to contact: 400 {
  message: 'Invalid Followers',
  error: 'Bad Request',
  statusCode: 400,
  traceId: '67e3bd6d-42cb-478b-b26e-345037d6fdba'
}
ğŸ”„ [PIPELINE] Syncing opportunity stage for contact xp6aekYUptIbjtDZSQqo: {
  currentStage: '(none)',
  targetStage: 'CONSULT_APPOINTMENT',
  context: {
    aiPhase: 'consult_support',
    depositLinkSent: false,
    depositPaid: false,
    consultType: 'appointment',
    hasUpcomingTattoo: false,
    tattooCompleted: false,
    lost: false
  }
}
ğŸ“Š [PIPELINE] Transitioning opportunity ERUkbcdnzf4F2k7IzbDb: DISCOVERY â†’ CONSULT_APPOINTMENT
âœ… [PIPELINE] Stage transition: (none) â†’ CONSULT_APPOINTMENT (contact: xp6aekYUptIbjtDZSQqo)
ğŸ—ï¸ Pipeline stage synced after consult mode = appointment/translator
ğŸ“… [ROUTING] Video call selected â†’ offering slots immediately (translator auto-confirmed)
âœ‰ï¸ sendConversationMessage context: { contactId: 'xp6aekYUptIbjtDZSQqo', isDm: false, hasPhone: false }
ğŸ“¨ GHL conversations API response (fallback): { status: 201, contactId: 'xp6aekYUptIbjtDZSQqo', type: 'FB' }
ğŸ“… [SLOT OFFER] Time preferences extracted: {
  preferredWeek: null,
  preferredDay: null,
  preferredTimeWindow: null,
  preferredMonth: 0,
  preferredYear: null,
  preferredWeekStartDate: null
}
ğŸ“… [SLOTS] Inputs {
  preferredWeek: null,
  preferredDay: null,
  preferredTimeWindow: null,
  preferredMonth: 0,
  preferredYear: null,
  preferredWeekStartDate: null,
  nowIso: '2025-12-23T05:27:18.548Z',
  tzOffsetMinutes: 0
}
ğŸ“… [SLOTS] Month preference "Jan" 2026 - fetching full month
ğŸ“… [SLOTS] Fetching real GHL slots from 2026-01-01T00:00:00.000Z to 2026-01-31T23:59:59.999Z
âœ… [GHL CALENDAR] Found 18 free slots for calendar 2EJcAtrllnYOtuSx4Dua between 2026-01-01T00:00:00.000Z and 2026-01-31T23:59:59.999Z
ğŸ“… [SLOTS] Varied selection: 3 day(s) available, selected 4 slots
ğŸ“… [SLOTS] Returning 4 real GHL slots (varied across days)
ğŸ§¾ [SLOT PERSIST] Writing last_sent_slots {
  contactId: 'xp6aekYUptIbjtDZSQqo',
  slotsCount: 4,
  bytes: 614,
  sha1: 'c084e746a7ed',
  preview: [
    {
      startTime: '2026-01-06T20:00:00.000Z',
      endTime: '2026-01-06T20:30:00.000Z',
      calendarId: '2EJcAtrllnYOtuSx4Dua',
      displayText: 'Tuesday, Jan 6 at 8pm'
    },
    {
      startTime: '2026-01-06T20:40:00.000Z',
      endTime: '2026-01-06T21:10:00.000Z',
      calendarId: '2EJcAtrllnYOtuSx4Dua',
      displayText: 'Tuesday, Jan 6 at 8:40pm'
    },
    {
      startTime: '2026-01-13T20:00:00.000Z',
      endTime: '2026-01-13T20:30:00.000Z',
      calendarId: '2EJcAtrllnYOtuSx4Dua',
      displayText: 'Tuesday, Jan 13 at 8pm'
    },
    {
      startTime: '2026-01-20T20:00:00.000Z',
      endTime: '2026-01-20T20:30:00.000Z',
      calendarId: '2EJcAtrllnYOtuSx4Dua',
      displayText: 'Tuesday, Jan 20 at 8pm'
    }
  ]
}
ğŸ§¾ [SLOT PERSIST] updateSystemFields result { contactId: 'xp6aekYUptIbjtDZSQqo', ok: true }
âœ… [SLOT PERSIST] Saved 4 slots to GHL for contact xp6aekYUptIbjtDZSQqo
ğŸ§­ [PHASE] derived_phase snapshot {
  derived_phase: 'consult_path',
  canonical: {
    tattooSummary: null,
    tattooPlacement: 'calf',
    tattooSize: null,
    timeline: 'January',
    consultationType: null,
    consultationTypeLocked: false,
    depositLinkSent: false,
    depositPaid: false,
    holdAppointmentId: null
  },
  intents: {
    reschedule_intent: false,
    cancel_intent: false,
    scheduling_intent: false,
    slot_selection_intent: false,
    deposit_intent: false,
    consult_path_choice_intent: true,
    artist_guided_size_intent: false,
    process_or_price_question_intent: false,
    objection_intent: false,
    objection_type: null,
    objection_data: null
  },
  selected_handler: 'consult_path_scheduling',
  routing_reason: 'video_consult_with_slots',
  intent_flags: [ 'consult_path_choice_intent' ]
}
â±ï¸ [TIMING] Total handleInboundMessage took 3927ms
ğŸ¤– AI Response Summary: {
  bubblesCount: 1,
  phase: 'consult_path',
  handler: 'consult_path_scheduling',
  reason: 'video_consult_with_slots',
  fieldUpdatesKeys: [ 'consult_explained' ]
}
âœ‰ï¸ sendConversationMessage context: { contactId: 'xp6aekYUptIbjtDZSQqo', isDm: true, hasPhone: false }
ğŸ” No conversationId provided for DM, searching for DM conversation...
ğŸ” No DM conversation found for contact
ğŸ” No existing DM conversation found, will try to infer type from contact...
inferConversationMessageType: no DM conversation found, checking contact tags...
ğŸ” No DM conversation found for contact
ğŸ“¨ Sending DM via GHL (creating new conversation): {
  contactId: 'xp6aekYUptIbjtDZSQqo',
  locationId: 'mUemx2jG4wly4kJWBkI4',
  message: 'I pulled a few openings for a consult with an artist:\n' +
    '1) Tuesday, Jan 6 at 8pm\n' +
    '2) Tuesday, Jan 6 at 8:40pm\n' +
    '3) Tuesday, Jan 13 at 8pm\n' +
    '4) Tuesday, Jan 20 at 8pm\n' +
    '\n' +
    'Which works best?',
  type: 'FB'
}
ğŸ“¨ GHL DM message response (new conversation): { status: 201, contactId: 'xp6aekYUptIbjtDZSQqo', type: 'FB' }
ğŸ“¤ Sent 1/1 bubbles to GHL conversation
updateTattooFields: no mapped fields to update for contact xp6aekYUptIbjtDZSQqo
âœ… Persisted field_updates: [ 'consult_explained' ]
ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’¬ GHL MESSAGE WEBHOOK HIT
ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“¦ Webhook Payload (non-empty fields): {
  "last_sent_slots": "[{\"startTime\":\"2026-01-06T20:00:00.000Z\",\"endTime\":\"2026-01-06T20:30:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 6 at 8pm\"},{\"startTime\":\"2026-01-06T20:40:00.000Z\",\"endTime\":\"2026-01-06T21:10:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 6 at 8:40pm\"},{\"startTime\":\"2026-01-13T20:00:00.000Z\",\"endTime\":\"2026-01-13T20:30:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 13 at 8pm\"},{\"startTime\":\"2026-01-20T20:00:00.000Z\",\"endTime\":\"2026-01-20T20:30:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 20 at 8pm\"}]",
  "times_sent": "Yes",
  "translator_explained": "Yes",
  "translator_confirmed": "Yes",
  "consultation_type": "appointment",
  "language_barrier_explained": "Yes",
  "Tattoo Placement": "calf",
  "translator_needed": "Yes",
  "How Soon Is Client Deciding?": "January",
  "contact_id": "xp6aekYUptIbjtDZSQqo",
  "first_name": "Maria",
  "last_name": "Claflin",
  "full_name": "Maria Claflin",
  "tags": "dm consultation request",
  "country": "US",
  "date_created": "2025-12-23T05:18:59.226Z",
  "contact_type": "lead",
  "location": {
    "name": "Studio AZ Tattoo",
    "address": "333 Washington Ave N STE 100",
    "city": "Minneapolis",
    "state": "Minnesota",
    "country": "US",
    "postalCode": "55401",
    "fullAddress": "333 Washington Ave N STE 100, Minneapolis Minnesota 55401",
    "id": "mUemx2jG4wly4kJWBkI4"
  },
  "message": {
    "type": 11,
    "body": "The first time"
  },
  "workflow": {
    "id": "8cf237bb-6cb1-4240-8ca5-b797bba8b769",
    "name": "Testing Ai Bot"
  },
  "contact": {
    "attributionSource": {
      "photoUrl": null,
      "sessionSource": "Social media",
      "adId": null,
      "productId": null,
      "videoUrl": null,
      "mediumId": "24364584283244494",
      "utmContent": null,
      "pSid": "24364584283244494",
      "medium": "facebook",
      "postId": null,
      "flowId": null
    },
    "lastAttributionSource": {
      "photoUrl": null,
      "sessionSource": "Social media",
      "adId": null,
      "productId": null,
      "videoUrl": null,
      "mediumId": "24364584283244494",
      "utmContent": null,
      "pSid": "24364584283244494",
      "medium": "facebook",
      "postId": null,
      "flowId": null
    }
  },
  "customData": {
    "contactId": "xp6aekYUptIbjtDZSQqo",
    "messageBody": "The first time"
  }
}
ğŸ“© Incoming message text: The first time
ğŸ‘¤ Contact ID: xp6aekYUptIbjtDZSQqo
â³ [DEBOUNCE] Started new batch for xp6aekYUptIbjtDZSQqo. Waiting 15s for more messages...
âœ… [DEBOUNCE] Processing batch for xp6aekYUptIbjtDZSQqo: 1 message(s) after 15.0s
ğŸ“¦ [DEBOUNCE] Processing 1 batched message(s):
   1. The first time
ğŸ“‹ Webhook custom fields extracted: {
  "last_sent_slots": "[{\"startTime\":\"2026-01-06T20:00:00.000Z\",\"endTime\":\"2026-01-06T20:30:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 6 at 8pm\"},{\"startTime\":\"2026-01-06T20:40:00.000Z\",\"endTime\":\"2026-01-06T21:10:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 6 at 8:40pm\"},{\"startTime\":\"2026-01-13T20:00:00.000Z\",\"endTime\":\"2026-01-13T20:30:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 13 at 8pm\"},{\"startTime\":\"2026-01-20T20:00:00.000Z\",\"endTime\":\"2026-01-20T20:30:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 20 at 8pm\"}]",
  "times_sent": "Yes",
  "translator_explained": "Yes",
  "translator_confirmed": "Yes",
  "consultation_type": "appointment",
  "tattoo_placement": "calf",
  "translator_needed": "Yes",
  "how_soon_is_client_deciding": "January"
}
ğŸ‘¤ Contact: Maria Claflin
ğŸ“‹ Contact custom fields (merged): {
  "kxtfzydeskuys5lltksr": "6-7 inches",
  "jd8yhvksbi4agqjqoeov": "calf",
  "ra4nk80wma8eqklcfxst": "January",
  "myuihlqvwgjnrnmy1hzu": "Yes",
  "whwh3aco0mzavhb0vizw": "Yes",
  "gm2pvo90ynbdhekv5g64": "appointment",
  "ikiju6c8apzchvhsyfwr": "Yes",
  "qvuq2wdv3drhbkhts6td": "Yes",
  "a832mlwirz5cv6xaktna": "[{\"startTime\":\"2026-01-06T20:00:00.000Z\",\"endTime\":\"2026-01-06T20:30:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 6 at 8pm\"},{\"startTime\":\"2026-01-06T20:40:00.000Z\",\"endTime\":\"2026-01-06T21:10:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 6 at 8:40pm\"},{\"startTime\":\"2026-01-13T20:00:00.000Z\",\"endTime\":\"2026-01-13T20:30:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 13 at 8pm\"},{\"startTime\":\"2026-01-20T20:00:00.000Z\",\"endTime\":\"2026-01-20T20:30:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 20 at 8pm\"}]",
  "eah8fdi5pwfxsqqfd45a": "Yes",
  "last_sent_slots": "[{\"startTime\":\"2026-01-06T20:00:00.000Z\",\"endTime\":\"2026-01-06T20:30:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 6 at 8pm\"},{\"startTime\":\"2026-01-06T20:40:00.000Z\",\"endTime\":\"2026-01-06T21:10:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 6 at 8:40pm\"},{\"startTime\":\"2026-01-13T20:00:00.000Z\",\"endTime\":\"2026-01-13T20:30:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 13 at 8pm\"},{\"startTime\":\"2026-01-20T20:00:00.000Z\",\"endTime\":\"2026-01-20T20:30:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 20 at 8pm\"}]",
  "times_sent": "Yes",
  "translator_explained": "Yes",
  "translator_confirmed": "Yes",
  "consultation_type": "appointment",
  "tattoo_placement": "calf",
  "translator_needed": "Yes",
  "how_soon_is_client_deciding": "January"
}
ğŸ“¡ Channel context: {
  isDm: true,
  hasPhone: false,
  isWhatsApp: false,
  isSms: false,
  channelType: 'facebook',
  conversationId: null,
  phone: null
}
ğŸ“Š [PIPELINE] New lead from facebook - syncing entry stage...
ğŸ“Š [PIPELINE] Direct channel (facebook) â†’ starting at DISCOVERY
ğŸ“œ Fetching conversation history...
ğŸ“œ Fetched 18 messages for contact xp6aekYUptIbjtDZSQqo
ğŸ“œ Thread context: {
  totalMessages: 18,
  recentCount: 18,
  hasSummary: false,
  hasImageContext: true,
  wasHumanHandling: true,
  isReturningClient: false
}
ğŸ§  [AI CONTEXT] Processing message: {
  messageText: 'The first time',
  contactId: 'xp6aekYUptIbjtDZSQqo',
  contactName: 'Maria Claflin',
  consultExplained: undefined,
  threadStats: {
    totalMessages: 18,
    recentMessages: 18,
    hasSummary: false,
    hasImageContext: true,
    wasHumanHandling: true
  }
}
ğŸ“Š [CANONICAL] State before routing: {
  tattooSummary: null,
  tattooPlacement: 'calf',
  tattooSize: null,
  timeline: 'January',
  consultationType: 'appointment',
  depositPaid: false,
  derivedPhase: 'scheduling'
}
ğŸ¯ [INTENTS] No specific intents detected for: The first time
ğŸ“œ [AI] Thread context included: {
  totalMessages: 18,
  recentCount: 18,
  hasSummary: false,
  hasImageContext: true,
  wasHumanHandling: true
}
ğŸ¤– Raw OpenAI opener response: {
  "language": "en",
  "bubbles": [
    "Got you for Tuesday, Jan 6 at 8pm.",
    "To lock in your spot, the $100 deposit is fully refundable if you donâ€™t love the design and goes toward your tattoo total. Ready to lock it in?"
  ],
  "internal_notes": "Confirming the chosen consult time and pushing for the refundable deposit to secure the spot.",
  "meta": {
    "aiPhase": "closing",
    "leadTemperature": "hot",
    "wantsDepositLink": true,
    "depositPushedThisTurn": true,
    "mentionDecoyOffered": false,
    "consultMode": "in_person"
  },
  "field_updates": {}
}
â±ï¸ [TIMING] AI call took 3535ms
ğŸ§­ [PHASE] derived_phase snapshot {
  derived_phase: 'scheduling',
  canonical: {
    tattooSummary: null,
    tattooPlacement: 'calf',
    tattooSize: null,
    timeline: 'January',
    consultationType: 'appointment',
    consultationTypeLocked: false,
    depositLinkSent: false,
    depositPaid: false,
    holdAppointmentId: null
  },
  intents: {
    reschedule_intent: false,
    cancel_intent: false,
    scheduling_intent: false,
    slot_selection_intent: false,
    deposit_intent: false,
    consult_path_choice_intent: false,
    artist_guided_size_intent: false,
    process_or_price_question_intent: false,
    objection_intent: false,
    objection_type: null,
    objection_data: null
  },
  selected_handler: 'ai',
  routing_reason: 'ai_fallback',
  intent_flags: []
}
â±ï¸ [TIMING] Total handleInboundMessage took 3737ms
ğŸ¤– AI Response Summary: {
  bubblesCount: 2,
  phase: 'scheduling',
  handler: 'ai',
  reason: 'ai_fallback',
  fieldUpdatesKeys: []
}
âœ‰ï¸ sendConversationMessage context: { contactId: 'xp6aekYUptIbjtDZSQqo', isDm: true, hasPhone: false }
ğŸ” No conversationId provided for DM, searching for DM conversation...
ğŸ” No DM conversation found for contact
ğŸ” No existing DM conversation found, will try to infer type from contact...
ğŸ” No DM conversation found for contact
inferConversationMessageType: no DM conversation found, checking contact tags...
ğŸ“¨ Sending DM via GHL (creating new conversation): {
  contactId: 'xp6aekYUptIbjtDZSQqo',
  locationId: 'mUemx2jG4wly4kJWBkI4',
  message: 'Got you for Tuesday, Jan 6 at 8pm.',
  type: 'FB'
}
ğŸ“¨ GHL DM message response (new conversation): { status: 201, contactId: 'xp6aekYUptIbjtDZSQqo', type: 'FB' }
âœ‰ï¸ sendConversationMessage context: { contactId: 'xp6aekYUptIbjtDZSQqo', isDm: true, hasPhone: false }
ğŸ” No conversationId provided for DM, searching for DM conversation...
ğŸ” No DM conversation found for contact
ğŸ” No existing DM conversation found, will try to infer type from contact...
inferConversationMessageType: no DM conversation found, checking contact tags...
ğŸ” No DM conversation found for contact
ğŸ“¨ Sending DM via GHL (creating new conversation): {
  contactId: 'xp6aekYUptIbjtDZSQqo',
  locationId: 'mUemx2jG4wly4kJWBkI4',
  message: 'To lock in your spot, the $100 deposit is fully refundable if you donâ€™t love the design and goes toward your tattoo total. Ready to lock it in?',
  type: 'FB'
}
ğŸ“¨ GHL DM message response (new conversation): { status: 201, contactId: 'xp6aekYUptIbjtDZSQqo', type: 'FB' }
ğŸ“¤ Sent 2/2 bubbles to GHL conversation
â„¹ï¸ No field_updates from AI to persist this turn
ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’¬ GHL MESSAGE WEBHOOK HIT
ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“¦ Webhook Payload (non-empty fields): {
  "last_sent_slots": "[{\"startTime\":\"2026-01-06T20:00:00.000Z\",\"endTime\":\"2026-01-06T20:30:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 6 at 8pm\"},{\"startTime\":\"2026-01-06T20:40:00.000Z\",\"endTime\":\"2026-01-06T21:10:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 6 at 8:40pm\"},{\"startTime\":\"2026-01-13T20:00:00.000Z\",\"endTime\":\"2026-01-13T20:30:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 13 at 8pm\"},{\"startTime\":\"2026-01-20T20:00:00.000Z\",\"endTime\":\"2026-01-20T20:30:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 20 at 8pm\"}]",
  "times_sent": "Yes",
  "translator_explained": "Yes",
  "translator_confirmed": "Yes",
  "consultation_type": "appointment",
  "language_barrier_explained": "Yes",
  "Tattoo Placement": "calf",
  "translator_needed": "Yes",
  "How Soon Is Client Deciding?": "January",
  "contact_id": "xp6aekYUptIbjtDZSQqo",
  "first_name": "Maria",
  "last_name": "Claflin",
  "full_name": "Maria Claflin",
  "tags": "dm consultation request",
  "country": "US",
  "date_created": "2025-12-23T05:18:59.226Z",
  "contact_type": "lead",
  "location": {
    "name": "Studio AZ Tattoo",
    "address": "333 Washington Ave N STE 100",
    "city": "Minneapolis",
    "state": "Minnesota",
    "country": "US",
    "postalCode": "55401",
    "fullAddress": "333 Washington Ave N STE 100, Minneapolis Minnesota 55401",
    "id": "mUemx2jG4wly4kJWBkI4"
  },
  "message": {
    "type": 11,
    "body": "Do I have to pay a deposit?"
  },
  "workflow": {
    "id": "8cf237bb-6cb1-4240-8ca5-b797bba8b769",
    "name": "Testing Ai Bot"
  },
  "contact": {
    "attributionSource": {
      "photoUrl": null,
      "sessionSource": "Social media",
      "adId": null,
      "productId": null,
      "videoUrl": null,
      "mediumId": "24364584283244494",
      "utmContent": null,
      "pSid": "24364584283244494",
      "medium": "facebook",
      "postId": null,
      "flowId": null
    },
    "lastAttributionSource": {
      "photoUrl": null,
      "sessionSource": "Social media",
      "adId": null,
      "productId": null,
      "videoUrl": null,
      "mediumId": "24364584283244494",
      "utmContent": null,
      "pSid": "24364584283244494",
      "medium": "facebook",
      "postId": null,
      "flowId": null
    }
  },
  "customData": {
    "contactId": "xp6aekYUptIbjtDZSQqo",
    "messageBody": "Do I have to pay a deposit?"
  }
}
ğŸ“© Incoming message text: Do I have to pay a deposit?
ğŸ‘¤ Contact ID: xp6aekYUptIbjtDZSQqo
â³ [DEBOUNCE] Started new batch for xp6aekYUptIbjtDZSQqo. Waiting 15s for more messages...
âœ… [DEBOUNCE] Processing batch for xp6aekYUptIbjtDZSQqo: 1 message(s) after 15.0s
ğŸ“¦ [DEBOUNCE] Processing 1 batched message(s):
   1. Do I have to pay a deposit?
ğŸ“‹ Webhook custom fields extracted: {
  "last_sent_slots": "[{\"startTime\":\"2026-01-06T20:00:00.000Z\",\"endTime\":\"2026-01-06T20:30:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 6 at 8pm\"},{\"startTime\":\"2026-01-06T20:40:00.000Z\",\"endTime\":\"2026-01-06T21:10:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 6 at 8:40pm\"},{\"startTime\":\"2026-01-13T20:00:00.000Z\",\"endTime\":\"2026-01-13T20:30:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 13 at 8pm\"},{\"startTime\":\"2026-01-20T20:00:00.000Z\",\"endTime\":\"2026-01-20T20:30:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 20 at 8pm\"}]",
  "times_sent": "Yes",
  "translator_explained": "Yes",
  "translator_confirmed": "Yes",
  "consultation_type": "appointment",
  "tattoo_placement": "calf",
  "translator_needed": "Yes",
  "how_soon_is_client_deciding": "January"
}
ğŸ‘¤ Contact: Maria Claflin
ğŸ“‹ Contact custom fields (merged): {
  "kxtfzydeskuys5lltksr": "6-7 inches",
  "jd8yhvksbi4agqjqoeov": "calf",
  "ra4nk80wma8eqklcfxst": "January",
  "myuihlqvwgjnrnmy1hzu": "Yes",
  "whwh3aco0mzavhb0vizw": "Yes",
  "gm2pvo90ynbdhekv5g64": "appointment",
  "ikiju6c8apzchvhsyfwr": "Yes",
  "qvuq2wdv3drhbkhts6td": "Yes",
  "a832mlwirz5cv6xaktna": "[{\"startTime\":\"2026-01-06T20:00:00.000Z\",\"endTime\":\"2026-01-06T20:30:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 6 at 8pm\"},{\"startTime\":\"2026-01-06T20:40:00.000Z\",\"endTime\":\"2026-01-06T21:10:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 6 at 8:40pm\"},{\"startTime\":\"2026-01-13T20:00:00.000Z\",\"endTime\":\"2026-01-13T20:30:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 13 at 8pm\"},{\"startTime\":\"2026-01-20T20:00:00.000Z\",\"endTime\":\"2026-01-20T20:30:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 20 at 8pm\"}]",
  "eah8fdi5pwfxsqqfd45a": "Yes",
  "last_sent_slots": "[{\"startTime\":\"2026-01-06T20:00:00.000Z\",\"endTime\":\"2026-01-06T20:30:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 6 at 8pm\"},{\"startTime\":\"2026-01-06T20:40:00.000Z\",\"endTime\":\"2026-01-06T21:10:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 6 at 8:40pm\"},{\"startTime\":\"2026-01-13T20:00:00.000Z\",\"endTime\":\"2026-01-13T20:30:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 13 at 8pm\"},{\"startTime\":\"2026-01-20T20:00:00.000Z\",\"endTime\":\"2026-01-20T20:30:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 20 at 8pm\"}]",
  "times_sent": "Yes",
  "translator_explained": "Yes",
  "translator_confirmed": "Yes",
  "consultation_type": "appointment",
  "tattoo_placement": "calf",
  "translator_needed": "Yes",
  "how_soon_is_client_deciding": "January"
}
ğŸ“¡ Channel context: {
  isDm: true,
  hasPhone: false,
  isWhatsApp: false,
  isSms: false,
  channelType: 'facebook',
  conversationId: null,
  phone: null
}
ğŸ“Š [PIPELINE] New lead from facebook - syncing entry stage...
ğŸ“Š [PIPELINE] Direct channel (facebook) â†’ starting at DISCOVERY
ğŸ“œ Fetching conversation history...
ğŸ“œ Fetched 22 messages for contact xp6aekYUptIbjtDZSQqo
ğŸ“œ Thread context: {
  totalMessages: 22,
  recentCount: 20,
  hasSummary: true,
  hasImageContext: true,
  wasHumanHandling: true,
  isReturningClient: false
}
ğŸ§  [AI CONTEXT] Processing message: {
  messageText: 'Do I have to pay a deposit?',
  contactId: 'xp6aekYUptIbjtDZSQqo',
  contactName: 'Maria Claflin',
  consultExplained: undefined,
  threadStats: {
    totalMessages: 22,
    recentMessages: 20,
    hasSummary: true,
    hasImageContext: true,
    wasHumanHandling: true
  }
}
ğŸ“Š [CANONICAL] State before routing: {
  tattooSummary: null,
  tattooPlacement: 'calf',
  tattooSize: null,
  timeline: 'January',
  consultationType: 'appointment',
  depositPaid: false,
  derivedPhase: 'scheduling'
}
ğŸ¯ [INTENTS] Detected intents: [ 'deposit_intent' ] from message: Do I have to pay a deposit?
[Square] Creating payment link (HTTP) with body: {
  contactId: 'xp6aekYUptIbjtDZSQqo',
  amountCents: 10000,
  currency: 'USD',
  env: 'sandbox'
}
ğŸ’³ Square payment link created (HTTP): {
  contactId: 'xp6aekYUptIbjtDZSQqo',
  paymentLinkId: 'OVAS5YU3HZ4YN7FP',
  url: 'https://sandbox.square.link/u/hlIBoNTa'
}
ğŸ“Š [PIPELINE] Deposit link sent â†’ DEPOSIT_PENDING
ğŸ§­ [PHASE] derived_phase snapshot {
  derived_phase: 'scheduling',
  canonical: {
    tattooSummary: null,
    tattooPlacement: 'calf',
    tattooSize: null,
    timeline: 'January',
    consultationType: 'appointment',
    consultationTypeLocked: false,
    depositLinkSent: false,
    depositPaid: false,
    holdAppointmentId: null
  },
  intents: {
    reschedule_intent: false,
    cancel_intent: false,
    scheduling_intent: false,
    slot_selection_intent: false,
    deposit_intent: true,
    consult_path_choice_intent: false,
    artist_guided_size_intent: false,
    process_or_price_question_intent: false,
    objection_intent: false,
    objection_type: null,
    objection_data: null
  },
  selected_handler: 'deterministic',
  routing_reason: 'deposit_intent',
  intent_flags: [ 'deposit_intent' ]
}
â±ï¸ [TIMING] Total handleInboundMessage took 1415ms
ğŸ¤– AI Response Summary: {
  bubblesCount: 1,
  phase: 'scheduling',
  handler: 'deterministic',
  reason: 'deposit_intent',
  fieldUpdatesKeys: [ 'consult_explained' ]
}
âœ‰ï¸ sendConversationMessage context: { contactId: 'xp6aekYUptIbjtDZSQqo', isDm: true, hasPhone: false }
ğŸ” No conversationId provided for DM, searching for DM conversation...
ğŸ” No DM conversation found for contact
ğŸ” No existing DM conversation found, will try to infer type from contact...
ğŸ” No DM conversation found for contact
inferConversationMessageType: no DM conversation found, checking contact tags...
ğŸ“¨ Sending DM via GHL (creating new conversation): {
  contactId: 'xp6aekYUptIbjtDZSQqo',
  locationId: 'mUemx2jG4wly4kJWBkI4',
  message: "Here's your $100 refundable deposit to lock your consult: https://sandbox.square.link/u/hlIBoNTa",
  type: 'FB'
}
âš ï¸ /square/webhook could not resolve contactId from payment
ğŸ’³ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’³ SQUARE PAYMENT WEBHOOK HIT
ğŸ’³ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’³ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“¨ GHL DM message response (new conversation): { status: 201, contactId: 'xp6aekYUptIbjtDZSQqo', type: 'FB' }
ğŸ“¤ Sent 1/1 bubbles to GHL conversation
updateTattooFields: no mapped fields to update for contact xp6aekYUptIbjtDZSQqo
âœ… Persisted field_updates: [ 'consult_explained' ]
ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’³ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’³ SQUARE PAYMENT WEBHOOK HIT
âš ï¸ /square/webhook could not resolve contactId from payment
ğŸ’³ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’³ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’³ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âš ï¸ /square/webhook could not resolve contactId from payment
ğŸ’³ SQUARE PAYMENT WEBHOOK HIT
ğŸ’³ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’³ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âš ï¸ /square/webhook could not resolve contactId from payment
ğŸ’³ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’³ SQUARE PAYMENT WEBHOOK HIT
ğŸ’³ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’³ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’³ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âš ï¸ /square/webhook could not resolve contactId from payment
ğŸ’³ SQUARE PAYMENT WEBHOOK HIT
ğŸ’³ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’³ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’³ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’³ SQUARE PAYMENT WEBHOOK HIT
âš ï¸ /square/webhook could not resolve contactId from payment
ğŸ’³ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’³ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âš ï¸ /square/webhook could not resolve contactId from payment
ğŸ’³ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’³ SQUARE PAYMENT WEBHOOK HIT
ğŸ’³ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’³ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’³ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’³ SQUARE PAYMENT WEBHOOK HIT
ğŸ’³ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âš ï¸ /square/webhook could not resolve contactId from payment
ğŸ’³ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’³ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’³ SQUARE PAYMENT WEBHOOK HIT
ğŸ’³ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’³ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’³ SQUARE PAYMENT WEBHOOK HIT
ğŸ’³ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
[Square] Raw order from getContactIdFromOrder: {
  "id": "fBBrS3XIrye2J7CjQEd9rkgYrCSZY",
  "location_id": "LYB91RMNFSKFH",
  "line_items": [
    {
      "uid": "lnVUOF8R9gz0VizLf1l1eC",
      "quantity": "1",
      "name": "Studio AZ Tattoo Deposit",
      "base_price_money": {
        "amount": 10000,
        "currency": "USD"
      },
      "gross_sales_money": {
        "amount": 10000,
        "currency": "USD"
      },
      "total_tax_money": {
        "amount": 0,
        "currency": "USD"
      },
      "total_discount_money": {
        "amount": 0,
        "currency": "USD"
      },
      "total_money": {
        "amount": 10000,
        "currency": "USD"
      },
      "variation_total_price_money": {
        "amount": 10000,
        "currency": "USD"
      },
      "item_type": "ITEM",
      "total_service_charge_money": {
        "amount": 0,
        "currency": "USD"
      },
      "total_card_surcharge_money": {
        "amount": 0,
        "currency": "USD"
      }
    }
  ],
  "fulfillments": [
    {
      "uid": "031xSdGcKOWtN1FAMFqZfI",
      "type": "DIGITAL",
      "state": "PROPOSED"
    }
  ],
  "created_at": "2025-12-23T05:29:21.258Z",
  "updated_at": "2025-12-23T05:30:54.098Z",
  "state": "OPEN",
  "version": 6,
  "reference_id": "xp6aekYUptIbjtDZSQqo",
  "total_tax_money": {
    "amount": 0,
    "currency": "USD"
  },
  "total_discount_money": {
    "amount": 0,
    "currency": "USD"
  },
  "total_tip_money": {
    "amount": 0,
    "currency": "USD"
  },
  "total_money": {
    "amount": 10000,
    "currency": "USD"
  },
  "tenders": [
    {
      "id": "pkKrdo2SW7WDOVssVzZshd0JeCeZY",
      "location_id": "LYB91RMNFSKFH",
      "transaction_id": "fBBrS3XIrye2J7CjQEd9rkgYrCSZY",
      "created_at": "2025-12-23T05:30:53.944Z",
      "amount_money": {
        "amount": 10000,
        "currency": "USD"
      },
      "type": "THIRD_PARTY_CARD",
      "payment_id": "pkKrdo2SW7WDOVssVzZshd0JeCeZY"
    }
  ],
  "total_service_charge_money": {
    "amount": 0,
    "currency": "USD"
  },
  "net_amounts": {
    "total_money": {
      "amount": 10000,
      "currency": "USD"
    },
    "tax_money": {
      "amount": 0,
      "currency": "USD"
    },
    "discount_money": {
      "amount": 0,
      "currency": "USD"
    },
    "tip_money": {
      "amount": 0,
      "currency": "USD"
    },
    "service_charge_money": {
      "amount": 0,
      "currency": "USD"
    },
    "card_surcharge_money": {
      "amount": 0,
      "currency": "USD"
    }
  },
  "source": {
    "name": "Sandbox for sq0idp-7Bn6HAd2TKtXcbkoDSPu5g"
  },
  "net_amount_due_money": {
    "amount": 0,
    "currency": "USD"
  },
  "total_card_surcharge_money": {
    "amount": 0,
    "currency": "USD"
  }
}
[Square] Resolved order â†’ contact mapping: {
  orderId: 'fBBrS3XIrye2J7CjQEd9rkgYrCSZY',
  contactId: 'xp6aekYUptIbjtDZSQqo'
}
ğŸ’³ Deposit paid for contact: xp6aekYUptIbjtDZSQqo
[Square] Raw order from getContactIdFromOrder: {
  "id": "fBBrS3XIrye2J7CjQEd9rkgYrCSZY",
  "location_id": "LYB91RMNFSKFH",
  "line_items": [
    {
      "uid": "lnVUOF8R9gz0VizLf1l1eC",
      "quantity": "1",
      "name": "Studio AZ Tattoo Deposit",
      "base_price_money": {
        "amount": 10000,
        "currency": "USD"
      },
      "gross_sales_money": {
        "amount": 10000,
        "currency": "USD"
      },
      "total_tax_money": {
        "amount": 0,
        "currency": "USD"
      },
      "total_discount_money": {
        "amount": 0,
        "currency": "USD"
      },
      "total_money": {
        "amount": 10000,
        "currency": "USD"
      },
      "variation_total_price_money": {
        "amount": 10000,
        "currency": "USD"
      },
      "item_type": "ITEM",
      "total_service_charge_money": {
        "amount": 0,
        "currency": "USD"
      },
      "total_card_surcharge_money": {
        "amount": 0,
        "currency": "USD"
      }
    }
  ],
  "fulfillments": [
    {
      "uid": "031xSdGcKOWtN1FAMFqZfI",
      "type": "DIGITAL",
      "state": "PROPOSED"
    }
  ],
  "created_at": "2025-12-23T05:29:21.258Z",
  "updated_at": "2025-12-23T05:30:54.098Z",
  "state": "OPEN",
  "version": 6,
  "reference_id": "xp6aekYUptIbjtDZSQqo",
  "total_tax_money": {
    "amount": 0,
    "currency": "USD"
  },
  "total_discount_money": {
    "amount": 0,
    "currency": "USD"
  },
  "total_tip_money": {
    "amount": 0,
    "currency": "USD"
  },
  "total_money": {
    "amount": 10000,
    "currency": "USD"
  },
  "tenders": [
    {
      "id": "pkKrdo2SW7WDOVssVzZshd0JeCeZY",
      "location_id": "LYB91RMNFSKFH",
      "transaction_id": "fBBrS3XIrye2J7CjQEd9rkgYrCSZY",
      "created_at": "2025-12-23T05:30:53.944Z",
      "amount_money": {
        "amount": 10000,
        "currency": "USD"
      },
      "type": "THIRD_PARTY_CARD",
      "payment_id": "pkKrdo2SW7WDOVssVzZshd0JeCeZY"
    }
  ],
  "total_service_charge_money": {
    "amount": 0,
    "currency": "USD"
  },
  "net_amounts": {
    "total_money": {
      "amount": 10000,
      "currency": "USD"
    },
    "tax_money": {
      "amount": 0,
      "currency": "USD"
    },
    "discount_money": {
      "amount": 0,
      "currency": "USD"
    },
    "tip_money": {
      "amount": 0,
      "currency": "USD"
    },
    "service_charge_money": {
      "amount": 0,
      "currency": "USD"
    },
    "card_surcharge_money": {
      "amount": 0,
      "currency": "USD"
    }
  },
  "source": {
    "name": "Sandbox for sq0idp-7Bn6HAd2TKtXcbkoDSPu5g"
  },
  "net_amount_due_money": {
    "amount": 0,
    "currency": "USD"
  },
  "total_card_surcharge_money": {
    "amount": 0,
    "currency": "USD"
  }
}
[Square] Resolved order â†’ contact mapping: {
  orderId: 'fBBrS3XIrye2J7CjQEd9rkgYrCSZY',
  contactId: 'xp6aekYUptIbjtDZSQqo'
}
ğŸ’³ Deposit paid for contact: xp6aekYUptIbjtDZSQqo
ğŸ“Š [PIPELINE] Deposit paid - transitioning to QUALIFIED...
ğŸ“Š [PIPELINE] Deposit paid - transitioning to QUALIFIED...
âœ… [PIPELINE] Contact xp6aekYUptIbjtDZSQqo moved to QUALIFIED stage
âœ‰ï¸ sendConversationMessage context: { contactId: 'xp6aekYUptIbjtDZSQqo', isDm: false, hasPhone: false }
ğŸ’³ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âš ï¸ /square/webhook could not resolve contactId from payment
ğŸ’³ SQUARE PAYMENT WEBHOOK HIT
ğŸ’³ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’³ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ… [PIPELINE] Contact xp6aekYUptIbjtDZSQqo moved to QUALIFIED stage
âœ‰ï¸ sendConversationMessage context: { contactId: 'xp6aekYUptIbjtDZSQqo', isDm: false, hasPhone: false }
ğŸ“¨ GHL conversations API response (fallback): { status: 201, contactId: 'xp6aekYUptIbjtDZSQqo', type: 'FB' }
âœ… [DEPOSIT] Sent confirmation message to contact xp6aekYUptIbjtDZSQqo
ğŸ’³ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“¨ GHL conversations API response (fallback): { status: 201, contactId: 'xp6aekYUptIbjtDZSQqo', type: 'FB' }
âœ… [DEPOSIT] Sent confirmation message to contact xp6aekYUptIbjtDZSQqo
ğŸ’³ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’³ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’³ SQUARE PAYMENT WEBHOOK HIT
ğŸ’³ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
[Square] Raw order from getContactIdFromOrder: {
  "id": "fBBrS3XIrye2J7CjQEd9rkgYrCSZY",
  "location_id": "LYB91RMNFSKFH",
  "line_items": [
    {
      "uid": "lnVUOF8R9gz0VizLf1l1eC",
      "quantity": "1",
      "name": "Studio AZ Tattoo Deposit",
      "base_price_money": {
        "amount": 10000,
        "currency": "USD"
      },
      "gross_sales_money": {
        "amount": 10000,
        "currency": "USD"
      },
      "total_tax_money": {
        "amount": 0,
        "currency": "USD"
      },
      "total_discount_money": {
        "amount": 0,
        "currency": "USD"
      },
      "total_money": {
        "amount": 10000,
        "currency": "USD"
         },
      "variation_total_price_money": {
        "amount": 10000,
        "currency": "USD"
      },
      "item_type": "ITEM",
      "total_service_charge_money": {
        "amount": 0,
        "currency": "USD"
      },
      "total_card_surcharge_money": {
        "amount": 0,
        "currency": "USD"
      }
    }
  ],
  "fulfillments": [
    {
      "uid": "031xSdGcKOWtN1FAMFqZfI",
      "type": "DIGITAL",
      "state": "PROPOSED"
    }
  ],
  "created_at": "2025-12-23T05:29:21.258Z",
  "updated_at": "2025-12-23T05:30:56.000Z",
  "state": "OPEN",
  "version": 7,
  "reference_id": "xp6aekYUptIbjtDZSQqo",
  "total_tax_money": {
    "amount": 0,
    "currency": "USD"
  },
  "total_discount_money": {
    "amount": 0,
    "currency": "USD"
  },
  "total_tip_money": {
    "amount": 0,
    "currency": "USD"
  },
  "total_money": {
    "amount": 10000,
    "currency": "USD"
  },
  "tenders": [
    {
      "id": "pkKrdo2SW7WDOVssVzZshd0JeCeZY",
      "location_id": "LYB91RMNFSKFH",
      "transaction_id": "fBBrS3XIrye2J7CjQEd9rkgYrCSZY",
      "created_at": "2025-12-23T05:30:53Z",
      "amount_money": {
        "amount": 10000,
        "currency": "USD"
      },
      "type": "OTHER",
      "payment_id": "pkKrdo2SW7WDOVssVzZshd0JeCeZY",
      "other_details": {
        "source": "Developer Control Panel"
      }
    }
  ],
  "total_service_charge_money": {
    "amount": 0,
    "currency": "USD"
  },
  "net_amounts": {
    "total_money": {
      "amount": 10000,
      "currency": "USD"
    },
    "tax_money": {
      "amount": 0,
      "currency": "USD"
    },
    "discount_money": {
      "amount": 0,
      "currency": "USD"
    },
    "tip_money": {
      "amount": 0,
      "currency": "USD"
    },
    "service_charge_money": {
      "amount": 0,
      "currency": "USD"
    },
    "card_surcharge_money": {
      "amount": 0,
      "currency": "USD"
    }
  },
  "source": {
    "name": "Sandbox for sq0idp-7Bn6HAd2TKtXcbkoDSPu5g"
  },
  "net_amount_due_money": {
    "amount": 0,
    "currency": "USD"
  },
  "total_card_surcharge_money": {
    "amount": 0,
    "currency": "USD"
  }
}
[Square] Resolved order â†’ contact mapping: {
  orderId: 'fBBrS3XIrye2J7CjQEd9rkgYrCSZY',
  contactId: 'xp6aekYUptIbjtDZSQqo'
}
ğŸ’³ Deposit paid for contact: xp6aekYUptIbjtDZSQqo
ğŸ“Š [PIPELINE] Deposit paid - transitioning to QUALIFIED...
âœ… [PIPELINE] Contact xp6aekYUptIbjtDZSQqo moved to QUALIFIED stage
âœ‰ï¸ sendConversationMessage context: { contactId: 'xp6aekYUptIbjtDZSQqo', isDm: false, hasPhone: false }
ğŸ“¨ GHL conversations API response (fallback): { status: 201, contactId: 'xp6aekYUptIbjtDZSQqo', type: 'FB' }
âœ… [DEPOSIT] Sent confirmation message to contact xp6aekYUptIbjtDZSQqo
ğŸ’³ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•