ğŸ’¬ GHL MESSAGE WEBHOOK HIT



ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•



ğŸ“¦ Webhook Payload (non-empty fields): {



  "contact_id": "e4li32CBaL6hsTy4uXDj",



  "first_name": "Maria",



  "last_name": "Claflin",



  "full_name": "Maria Claflin",



  "tags": "dm consultation request",



  "date_created": "2025-12-16T05:00:04.640Z",



  "contact_type": "lead",



  "location": {



    "name": "Studio AZ Tattoo",



    "address": "333 Washington Ave N STE 100",



    "city": "Minneapolis",



    "state": "Minnesota",



    "country": "US",



    "postalCode": "55401",



    "fullAddress": "333 Washington Ave N STE 100, Minneapolis Minnesota 55401",



    "id": "mUemx2jG4wly4kJWBkI4"



  },



  "message": {



    "type": 11,



    "body": "How do I book a tattoo?"



  },



  "workflow": {



    "id": "8cf237bb-6cb1-4240-8ca5-b797bba8b769",



    "name": "Testing Ai Bot"



  },



  "contact": {



    "attributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    },



    "lastAttributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    }



  },



  "customData": {



    "contactId": "e4li32CBaL6hsTy4uXDj",



    "messageBody": "How do I book a tattoo?"



  }



}



ğŸ“© Incoming message text: How do I book a tattoo?



ğŸ‘¤ Contact ID: e4li32CBaL6hsTy4uXDj



ğŸ“‹ Webhook custom fields extracted: {}



ğŸ‘¤ Contact: Maria Claflin



ğŸ“‹ Contact custom fields (merged): {}



ğŸ§  [AI CONTEXT] Processing message: {



  messageText: 'How do I book a tattoo?',



  contactId: 'e4li32CBaL6hsTy4uXDj',



  contactName: 'Maria Claflin',



  consultExplained: undefined



}



ğŸ“Š [CANONICAL] State before routing: {



  tattooSummary: null,



  tattooPlacement: null,



  tattooSize: null,



  timeline: null,



  consultationType: null,



  depositPaid: false,



  derivedPhase: 'intake'



}



ğŸ¯ [INTENTS] No specific intents detected for: How do I book a tattoo?



ğŸ¤– Raw OpenAI opener response: {



  "language": "en",



  "bubbles": [



    "Hey Maria! To get started, what kind of tattoo are you thinking?",



    "Where on your body were you thinking to place it?"



  ],



  "internal_notes": "Opening message to start intake phase, gathering tattoo idea and placement.",



  "meta": {



    "aiPhase": "intake",



    "leadTemperature": "warm",



    "wantsDepositLink": false,



    "depositPushedThisTurn": false,



    "mentionDecoyOffered": false,



    "consultMode": "online"



  },



  "field_updates": {}



}



â±ï¸ [TIMING] AI call took 3448ms



ğŸ§­ [PHASE] derived_phase snapshot {



  derived_phase: 'intake',



  canonical: {



    tattooSummary: null,



    tattooPlacement: null,



    tattooSize: null,



    timeline: null,



    consultationType: null,



    consultationTypeLocked: false,



    depositLinkSent: false,



    depositPaid: false,



    holdAppointmentId: null



  },



  intents: {



    reschedule_intent: false,



    cancel_intent: false,



    scheduling_intent: false,



    slot_selection_intent: false,



    deposit_intent: false,



    consult_path_choice_intent: false,



    artist_guided_size_intent: false,



    process_or_price_question_intent: false,



    translator_affirm_intent: false



  },



  selected_handler: 'ai',



  routing_reason: 'ai_fallback',



  intent_flags: []



}



â±ï¸ [TIMING] Total handleInboundMessage took 3451ms



ğŸ¤– AI Response Summary: {



  bubblesCount: 2,



  phase: 'intake',



  handler: 'ai',



  reason: 'ai_fallback',



  fieldUpdatesKeys: []



}



ğŸ“¡ Channel context: { isDm: true, hasPhone: false, conversationId: null, phone: null }



âœ‰ï¸ sendConversationMessage context: { contactId: 'e4li32CBaL6hsTy4uXDj', isDm: true, hasPhone: false }



ğŸ” No conversationId provided for DM, searching for existing conversation...



âœ… Found existing conversation 7y7T7be9lJESYKNgUvZY with type FB



âœ… Using conversation type FB from GHL conversation - skipping ID validation



ğŸ“¨ Sending DM reply via GHL: {



  conversationId: '7y7T7be9lJESYKNgUvZY',



  contactId: 'e4li32CBaL6hsTy4uXDj',



  message: 'Hey Maria! To get started, what kind of tattoo are you thinking?',



  type: 'FB'



}



ğŸ“¨ GHL DM reply response: {



  status: 201,



  contactId: 'e4li32CBaL6hsTy4uXDj',



  conversationId: '7y7T7be9lJESYKNgUvZY'



}



âœ‰ï¸ sendConversationMessage context: { contactId: 'e4li32CBaL6hsTy4uXDj', isDm: true, hasPhone: false }



ğŸ” No conversationId provided for DM, searching for existing conversation...



âœ… Found existing conversation 7y7T7be9lJESYKNgUvZY with type FB



âœ… Using conversation type FB from GHL conversation - skipping ID validation



ğŸ“¨ Sending DM reply via GHL: {



  conversationId: '7y7T7be9lJESYKNgUvZY',



  contactId: 'e4li32CBaL6hsTy4uXDj',



  message: 'Where on your body were you thinking to place it?',



  type: 'FB'



}



ğŸ“¨ GHL DM reply response: {



  status: 201,



  contactId: 'e4li32CBaL6hsTy4uXDj',



  conversationId: '7y7T7be9lJESYKNgUvZY'



}



ğŸ“¤ Sent 2/2 bubbles to GHL conversation



â„¹ï¸ No field_updates from AI to persist this turn



ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•





     ==> Detected service running on port 10000


     ==> Docs on specifying a port: https://render.com/docs/web-services#port-binding






ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•



ğŸ’¬ GHL MESSAGE WEBHOOK HIT



ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•



ğŸ“¦ Webhook Payload (non-empty fields): {



  "contact_id": "e4li32CBaL6hsTy4uXDj",



  "first_name": "Maria",



  "last_name": "Claflin",



  "full_name": "Maria Claflin",



  "tags": "dm consultation request",



  "date_created": "2025-12-16T05:00:04.640Z",



  "contact_type": "lead",



  "location": {



    "name": "Studio AZ Tattoo",



    "address": "333 Washington Ave N STE 100",



    "city": "Minneapolis",



    "state": "Minnesota",



    "country": "US",



    "postalCode": "55401",



    "fullAddress": "333 Washington Ave N STE 100, Minneapolis Minnesota 55401",



    "id": "mUemx2jG4wly4kJWBkI4"



  },



  "message": {



    "type": 11,



    "body": "I was thinking a forest scene with pine trees on my back shoulder"



  },



  "workflow": {



    "id": "8cf237bb-6cb1-4240-8ca5-b797bba8b769",



    "name": "Testing Ai Bot"



  },



  "contact": {



    "attributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    },



    "lastAttributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    }



  },



  "customData": {



    "contactId": "e4li32CBaL6hsTy4uXDj",



    "messageBody": "I was thinking a forest scene with pine trees on my back shoulder"



  }



}



ğŸ“© Incoming message text: I was thinking a forest scene with pine trees on my back shoulder



ğŸ‘¤ Contact ID: e4li32CBaL6hsTy4uXDj



ğŸ“‹ Webhook custom fields extracted: {}



ğŸ‘¤ Contact: Maria Claflin



ğŸ“‹ Contact custom fields (merged): {}



ğŸ§  [AI CONTEXT] Processing message: {



  messageText: 'I was thinking a forest scene with pine trees on my back shoulder',



  contactId: 'e4li32CBaL6hsTy4uXDj',



  contactName: 'Maria Claflin',



  consultExplained: undefined



}



ğŸ“Š [CANONICAL] State before routing: {



  tattooSummary: null,



  tattooPlacement: null,



  tattooSize: null,



  timeline: null,



  consultationType: null,



  depositPaid: false,



  derivedPhase: 'intake'



}



ğŸ¯ [INTENTS] No specific intents detected for: I was thinking a forest scene with pine trees on my back shoulder



ğŸ¤– Raw OpenAI opener response: {



  "language": "en",



  "bubbles": [



    "Sick â€” that back shoulder forest scene with pine trees is gonna look fire.",



    "When were you thinking about getting it done?"



  ],



  "internal_notes": "Acknowledged tattoo idea and placement, asked for timing to move forward in intake phase.",



  "meta": {



    "aiPhase": "intake",



    "leadTemperature": "warm",



    "wantsDepositLink": false,



    "depositPushedThisTurn": false,



    "mentionDecoyOffered": false,



    "consultMode": "online"



  },



  "field_updates": {



    "tattoo_placement": "back shoulder",



    "tattoo_summary": "forest scene with pine trees"



  }



}



â±ï¸ [TIMING] AI call took 4892ms



ğŸ§­ [PHASE] derived_phase snapshot {



  derived_phase: 'discovery',



  canonical: {



    tattooSummary: 'forest scene with pine trees',



    tattooPlacement: 'back shoulder',



    tattooSize: null,



    timeline: null,



    consultationType: null,



    consultationTypeLocked: false,



    depositLinkSent: false,



    depositPaid: false,



    holdAppointmentId: null



  },



  intents: {



    reschedule_intent: false,



    cancel_intent: false,



    scheduling_intent: false,



    slot_selection_intent: false,



    deposit_intent: false,



    consult_path_choice_intent: false,



    artist_guided_size_intent: false,



    process_or_price_question_intent: false,



    translator_affirm_intent: false



  },



  selected_handler: 'ai',



  routing_reason: 'ai_fallback',



  intent_flags: []



}



â±ï¸ [TIMING] Total handleInboundMessage took 5273ms



ğŸ¤– AI Response Summary: {



  bubblesCount: 2,



  phase: 'discovery',



  handler: 'ai',



  reason: 'ai_fallback',



  fieldUpdatesKeys: [ 'tattoo_placement', 'tattoo_summary' ]



}



ğŸ“¡ Channel context: { isDm: true, hasPhone: false, conversationId: null, phone: null }



âœ‰ï¸ sendConversationMessage context: { contactId: 'e4li32CBaL6hsTy4uXDj', isDm: true, hasPhone: false }



ğŸ” No conversationId provided for DM, searching for existing conversation...



âœ… Found existing conversation 7y7T7be9lJESYKNgUvZY with type FB



âœ… Using conversation type FB from GHL conversation - skipping ID validation



ğŸ“¨ Sending DM reply via GHL: {



  conversationId: '7y7T7be9lJESYKNgUvZY',



  contactId: 'e4li32CBaL6hsTy4uXDj',



  message: 'Sick â€” that back shoulder forest scene with pine trees is gonna look fire.',



  type: 'FB'



}



ğŸ“¨ GHL DM reply response: {



  status: 201,



  contactId: 'e4li32CBaL6hsTy4uXDj',



  conversationId: '7y7T7be9lJESYKNgUvZY'



}



âœ‰ï¸ sendConversationMessage context: { contactId: 'e4li32CBaL6hsTy4uXDj', isDm: true, hasPhone: false }



ğŸ” No conversationId provided for DM, searching for existing conversation...



âœ… Found existing conversation 7y7T7be9lJESYKNgUvZY with type FB



âœ… Using conversation type FB from GHL conversation - skipping ID validation



ğŸ“¨ Sending DM reply via GHL: {



  conversationId: '7y7T7be9lJESYKNgUvZY',



  contactId: 'e4li32CBaL6hsTy4uXDj',



  message: 'When were you thinking about getting it done?',



  type: 'FB'



}



ğŸ“¨ GHL DM reply response: {



  status: 201,



  contactId: 'e4li32CBaL6hsTy4uXDj',



  conversationId: '7y7T7be9lJESYKNgUvZY'



}



ğŸ“¤ Sent 2/2 bubbles to GHL conversation



âœ… Updated tattoo fields for contact e4li32CBaL6hsTy4uXDj with {



  tattoo_placement: 'back shoulder',



  tattoo_summary: 'forest scene with pine trees'



}



âœ… Persisted field_updates: [ 'tattoo_placement', 'tattoo_summary' ]



ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•









ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•



ğŸ’¬ GHL MESSAGE WEBHOOK HIT



ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•



ğŸ“¦ Webhook Payload (non-empty fields): {



  "Tattoo Placement": "back shoulder",



  "Tattoo Summary": "forest scene with pine trees",



  "contact_id": "e4li32CBaL6hsTy4uXDj",



  "first_name": "Maria",



  "last_name": "Claflin",



  "full_name": "Maria Claflin",



  "tags": "dm consultation request",



  "country": "US",



  "date_created": "2025-12-16T05:00:04.640Z",



  "contact_type": "lead",



  "location": {



    "name": "Studio AZ Tattoo",



    "address": "333 Washington Ave N STE 100",



    "city": "Minneapolis",



    "state": "Minnesota",



    "country": "US",



    "postalCode": "55401",



    "fullAddress": "333 Washington Ave N STE 100, Minneapolis Minnesota 55401",



    "id": "mUemx2jG4wly4kJWBkI4"



  },



  "message": {



    "type": 11,



    "body": "January"



  },



  "workflow": {



    "id": "8cf237bb-6cb1-4240-8ca5-b797bba8b769",



    "name": "Testing Ai Bot"



  },



  "contact": {



    "attributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    },



    "lastAttributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    }



  },



  "customData": {



    "contactId": "e4li32CBaL6hsTy4uXDj",



    "messageBody": "January"



  }



}



ğŸ“© Incoming message text: January



ğŸ‘¤ Contact ID: e4li32CBaL6hsTy4uXDj



ğŸ“‹ Webhook custom fields extracted: {



  "tattoo_placement": "back shoulder",



  "tattoo_summary": "forest scene with pine trees"



}



ğŸ‘¤ Contact: Maria Claflin



ğŸ“‹ Contact custom fields (merged): {



  "jd8yhvksbi4agqjqoeov": "back shoulder",



  "xagtmfmbxtfchdo2oyf7": "forest scene with pine trees",



  "tattoo_placement": "back shoulder",



  "tattoo_summary": "forest scene with pine trees"



}



ğŸ§  [AI CONTEXT] Processing message: {



  messageText: 'January',



  contactId: 'e4li32CBaL6hsTy4uXDj',



  contactName: 'Maria Claflin',



  consultExplained: undefined



}



ğŸ“Š [CANONICAL] State before routing: {



  tattooSummary: 'forest scene with pine trees',



  tattooPlacement: 'back shoulder',



  tattooSize: null,



  timeline: null,



  consultationType: null,



  depositPaid: false,



  derivedPhase: 'discovery'



}



ğŸ¯ [INTENTS] No specific intents detected for: January



ğŸ¤– Raw OpenAI opener response: {



  "language": "en",



  "bubbles": [



    "That forest scene on your back shoulder is gonna look fire.",



    "January works. Any specific week youâ€™re aiming for?",



    "The next step is a quick 15â€“20 minute consultation with the artist to fully understand your design."



  ],



  "internal_notes": "Acknowledged tattoo idea and placement, confirmed timeline month, introduced consult step to move forward.",



  "meta": {



    "aiPhase": "qualification",



    "leadTemperature": "warm",



    "wantsDepositLink": false,



    "depositPushedThisTurn": false,



    "mentionDecoyOffered": false,



    "wantsAppointmentOffer": false,



    "consultMode": "online"



  },



  "field_updates": {



    "tattoo_summary": "forest scene with pine trees",



    "tattoo_placement": "back shoulder",



    "how_soon_is_client_deciding": "January",



    "first_tattoo": false



  }



}



â±ï¸ [TIMING] AI call took 6338ms



ğŸ§­ [PHASE] derived_phase snapshot {



  derived_phase: 'consult_path',



  canonical: {



    tattooSummary: 'forest scene with pine trees',



    tattooPlacement: 'back shoulder',



    tattooSize: null,



    timeline: 'January',



    consultationType: null,



    consultationTypeLocked: false,



    depositLinkSent: false,



    depositPaid: false,



    holdAppointmentId: null



  },



  intents: {



    reschedule_intent: false,



    cancel_intent: false,



    scheduling_intent: false,



    slot_selection_intent: false,



    deposit_intent: false,



    consult_path_choice_intent: false,



    artist_guided_size_intent: false,



    process_or_price_question_intent: false,



    translator_affirm_intent: false



  },



  selected_handler: 'ai',



  routing_reason: 'ai_fallback',



  intent_flags: []



}



â±ï¸ [TIMING] Total handleInboundMessage took 6598ms



ğŸ¤– AI Response Summary: {



  bubblesCount: 3,



  phase: 'consult_path',



  handler: 'ai',



  reason: 'ai_fallback',



  fieldUpdatesKeys: [



    'tattoo_summary',



    'tattoo_placement',



    'how_soon_is_client_deciding',



    'first_tattoo'



  ]



}



ğŸ“¡ Channel context: { isDm: true, hasPhone: false, conversationId: null, phone: null }



âœ‰ï¸ sendConversationMessage context: { contactId: 'e4li32CBaL6hsTy4uXDj', isDm: true, hasPhone: false }



ğŸ” No conversationId provided for DM, searching for existing conversation...



âœ… Found existing conversation 7y7T7be9lJESYKNgUvZY with type FB



âœ… Using conversation type FB from GHL conversation - skipping ID validation



ğŸ“¨ Sending DM reply via GHL: {



  conversationId: '7y7T7be9lJESYKNgUvZY',



  contactId: 'e4li32CBaL6hsTy4uXDj',



  message: 'That forest scene on your back shoulder is gonna look fire.',



  type: 'FB'



}



ğŸ“¨ GHL DM reply response: {



  status: 201,



  contactId: 'e4li32CBaL6hsTy4uXDj',



  conversationId: '7y7T7be9lJESYKNgUvZY'



}



âœ‰ï¸ sendConversationMessage context: { contactId: 'e4li32CBaL6hsTy4uXDj', isDm: true, hasPhone: false }



ğŸ” No conversationId provided for DM, searching for existing conversation...



âœ… Found existing conversation 7y7T7be9lJESYKNgUvZY with type FB



âœ… Using conversation type FB from GHL conversation - skipping ID validation



ğŸ“¨ Sending DM reply via GHL: {



  conversationId: '7y7T7be9lJESYKNgUvZY',



  contactId: 'e4li32CBaL6hsTy4uXDj',



  message: 'January works. Any specific week youâ€™re aiming for?',



  type: 'FB'



}



ğŸ“¨ GHL DM reply response: {



  status: 201,



  contactId: 'e4li32CBaL6hsTy4uXDj',



  conversationId: '7y7T7be9lJESYKNgUvZY'



}



âœ‰ï¸ sendConversationMessage context: { contactId: 'e4li32CBaL6hsTy4uXDj', isDm: true, hasPhone: false }



ğŸ” No conversationId provided for DM, searching for existing conversation...



âœ… Found existing conversation 7y7T7be9lJESYKNgUvZY with type FB



âœ… Using conversation type FB from GHL conversation - skipping ID validation



ğŸ“¨ Sending DM reply via GHL: {



  conversationId: '7y7T7be9lJESYKNgUvZY',



  contactId: 'e4li32CBaL6hsTy4uXDj',



  message: 'The next step is a quick 15â€“20 minute consultation with the artist to fully understand your design.',



  type: 'FB'



}



ğŸ“¨ GHL DM reply response: {



  status: 201,



  contactId: 'e4li32CBaL6hsTy4uXDj',



  conversationId: '7y7T7be9lJESYKNgUvZY'



}



ğŸ“¤ Sent 3/3 bubbles to GHL conversation



âœ… Updated tattoo fields for contact e4li32CBaL6hsTy4uXDj with {



  tattoo_summary: 'forest scene with pine trees',



  tattoo_placement: 'back shoulder',



  how_soon_is_client_deciding: 'January',



  first_tattoo: 'No'



}



âœ… Persisted field_updates: [



  'tattoo_summary',



  'tattoo_placement',



  'how_soon_is_client_deciding',



  'first_tattoo'



]



ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•









ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•



ğŸ’¬ GHL MESSAGE WEBHOOK HIT



ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•



ğŸ“¦ Webhook Payload (non-empty fields): {



  "First Tattoo": "No",



  "Tattoo Placement": "back shoulder",



  "How Soon Is Client Deciding?": "January",



  "Tattoo Summary": "forest scene with pine trees",



  "contact_id": "e4li32CBaL6hsTy4uXDj",



  "first_name": "Maria",



  "last_name": "Claflin",



  "full_name": "Maria Claflin",



  "tags": "dm consultation request",



  "country": "US",



  "date_created": "2025-12-16T05:00:04.640Z",



  "contact_type": "lead",



  "location": {



    "name": "Studio AZ Tattoo",



    "address": "333 Washington Ave N STE 100",



    "city": "Minneapolis",



    "state": "Minnesota",



    "country": "US",



    "postalCode": "55401",



    "fullAddress": "333 Washington Ave N STE 100, Minneapolis Minnesota 55401",



    "id": "mUemx2jG4wly4kJWBkI4"



  },



  "message": {



    "type": 11,



    "body": "Great, the week of January 11th is what I was thinking. What days are you free that week?"



  },



  "workflow": {



    "id": "8cf237bb-6cb1-4240-8ca5-b797bba8b769",



    "name": "Testing Ai Bot"



  },



  "contact": {



    "attributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    },



    "lastAttributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    }



  },



  "customData": {



    "contactId": "e4li32CBaL6hsTy4uXDj",



    "messageBody": "Great, the week of January 11th is what I was thinking. What days are you free that week?"



  }



}



ğŸ“© Incoming message text: Great, the week of January 11th is what I was thinking. What days are you free that week?



ğŸ‘¤ Contact ID: e4li32CBaL6hsTy4uXDj



ğŸ“‹ Webhook custom fields extracted: {



  "first_tattoo": "No",



  "tattoo_placement": "back shoulder",



  "how_soon_is_client_deciding": "January",



  "tattoo_summary": "forest scene with pine trees"



}



ğŸ‘¤ Contact: Maria Claflin



ğŸ“‹ Contact custom fields (merged): {



  "jd8yhvksbi4agqjqoeov": "back shoulder",



  "xagtmfmbxtfchdo2oyf7": "forest scene with pine trees",



  "fnydobmyqnxdxlljy5oe": "No",



  "ra4nk80wma8eqklcfxst": "January",



  "first_tattoo": "No",



  "tattoo_placement": "back shoulder",



  "how_soon_is_client_deciding": "January",



  "tattoo_summary": "forest scene with pine trees"



}



ğŸ§  [AI CONTEXT] Processing message: {



  messageText: 'Great, the week of January 11th is what I was thinking. What days are you free that week?',



  contactId: 'e4li32CBaL6hsTy4uXDj',



  contactName: 'Maria Claflin',



  consultExplained: undefined



}



ğŸ“Š [CANONICAL] State before routing: {



  tattooSummary: 'forest scene with pine trees',



  tattooPlacement: 'back shoulder',



  tattooSize: null,



  timeline: 'January',



  consultationType: null,



  depositPaid: false,



  derivedPhase: 'consult_path'



}



ğŸ¯ [INTENTS] Detected intents: [ 'scheduling_intent' ] from message: Great, the week of January 11th is what I was thinking. What days are you free that week?



ğŸ“… [SLOT OFFER] Time preferences extracted: {



  preferredWeek: null,



  preferredDay: null,



  preferredTimeWindow: null,



  preferredMonth: 0,



  preferredYear: null



}



ğŸ“… [SLOTS] Inputs {



  preferredWeek: null,



  preferredDay: null,



  preferredTimeWindow: null,



  preferredMonth: 0,



  preferredYear: null,



  nowIso: '2025-12-16T05:04:01.251Z',



  tzOffsetMinutes: 0



}



ğŸ“… [SLOTS] Month preference "Jan" 2026 - fetching full month



ğŸ“… [SLOTS] Fetching real GHL slots from 2026-01-01T00:00:00.000Z to 2026-01-31T23:59:59.999Z



âœ… [GHL CALENDAR] Found 12 free slots for calendar 2EJcAtrllnYOtuSx4Dua between 2026-01-01T00:00:00.000Z and 2026-01-31T23:59:59.999Z



ğŸ“… [SLOTS] Returning 4 real GHL slots



ğŸ§¾ [SLOT PERSIST] Writing last_sent_slots {



  contactId: 'e4li32CBaL6hsTy4uXDj',



  slotsCount: 4,



  bytes: 616,



  sha1: 'ff82445b2246',



  preview: [



    {



      startTime: '2026-01-06T20:00:00.000Z',



      endTime: '2026-01-06T20:30:00.000Z',



      calendarId: '2EJcAtrllnYOtuSx4Dua',



      displayText: 'Tuesday, Jan 6 at 8pm'



    },



    {



      startTime: '2026-01-06T20:40:00.000Z',



      endTime: '2026-01-06T21:10:00.000Z',



      calendarId: '2EJcAtrllnYOtuSx4Dua',



      displayText: 'Tuesday, Jan 6 at 8:40pm'



    },



    {



      startTime: '2026-01-06T21:20:00.000Z',



      endTime: '2026-01-06T21:50:00.000Z',



      calendarId: '2EJcAtrllnYOtuSx4Dua',



      displayText: 'Tuesday, Jan 6 at 9:20pm'



    },



    {



      startTime: '2026-01-06T22:00:00.000Z',



      endTime: '2026-01-06T22:30:00.000Z',



      calendarId: '2EJcAtrllnYOtuSx4Dua',



      displayText: 'Tuesday, Jan 6 at 10pm'



    }



  ]



}



ğŸ§¾ [SLOT PERSIST] updateSystemFields result { contactId: 'e4li32CBaL6hsTy4uXDj', ok: true }



âœ… [SLOT PERSIST] Saved 4 slots to GHL for contact e4li32CBaL6hsTy4uXDj



ğŸ§­ [PHASE] derived_phase snapshot {



  derived_phase: 'consult_path',



  canonical: {



    tattooSummary: 'forest scene with pine trees',



    tattooPlacement: 'back shoulder',



    tattooSize: null,



    timeline: 'January',



    consultationType: null,



    consultationTypeLocked: false,



    depositLinkSent: false,



    depositPaid: false,



    holdAppointmentId: null



  },



  intents: {



    reschedule_intent: false,



    cancel_intent: false,



    scheduling_intent: true,



    slot_selection_intent: false,



    deposit_intent: false,



    consult_path_choice_intent: false,



    artist_guided_size_intent: false,



    process_or_price_question_intent: false,



    translator_affirm_intent: false



  },



  selected_handler: 'deterministic',



  routing_reason: 'scheduling_intent',



  intent_flags: [ 'scheduling_intent' ]



}



â±ï¸ [TIMING] Total handleInboundMessage took 724ms



ğŸ¤– AI Response Summary: {



  bubblesCount: 1,



  phase: 'consult_path',



  handler: 'deterministic',



  reason: 'scheduling_intent',



  fieldUpdatesKeys: [ 'consult_explained' ]



}



ğŸ“¡ Channel context: { isDm: true, hasPhone: false, conversationId: null, phone: null }



âœ‰ï¸ sendConversationMessage context: { contactId: 'e4li32CBaL6hsTy4uXDj', isDm: true, hasPhone: false }



ğŸ” No conversationId provided for DM, searching for existing conversation...



âœ… Found existing conversation 7y7T7be9lJESYKNgUvZY with type FB



âœ… Using conversation type FB from GHL conversation - skipping ID validation



ğŸ“¨ Sending DM reply via GHL: {



  conversationId: '7y7T7be9lJESYKNgUvZY',



  contactId: 'e4li32CBaL6hsTy4uXDj',



  message: 'I pulled a few openings for a consult with an artist:\n' +



    '1) Tuesday, Jan 6 at 8pm\n' +



    '2) Tuesday, Jan 6 at 8:40pm\n' +



    '3) Tuesday, Jan 6 at 9:20pm\n' +



    '4) Tuesday, Jan 6 at 10pm\n' +



    '\n' +



    'Which works best?',



  type: 'FB'



}



ğŸ“¨ GHL DM reply response: {



  status: 201,



  contactId: 'e4li32CBaL6hsTy4uXDj',



  conversationId: '7y7T7be9lJESYKNgUvZY'



}



ğŸ“¤ Sent 1/1 bubbles to GHL conversation



updateTattooFields: no mapped fields to update for contact e4li32CBaL6hsTy4uXDj



âœ… Persisted field_updates: [ 'consult_explained' ]



ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•









ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•



ğŸ’¬ GHL MESSAGE WEBHOOK HIT



ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•



ğŸ“¦ Webhook Payload (non-empty fields): {



  "last_sent_slots": "[{\"startTime\":\"2026-01-06T20:00:00.000Z\",\"endTime\":\"2026-01-06T20:30:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 6 at 8pm\"},{\"startTime\":\"2026-01-06T20:40:00.000Z\",\"endTime\":\"2026-01-06T21:10:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 6 at 8:40pm\"},{\"startTime\":\"2026-01-06T21:20:00.000Z\",\"endTime\":\"2026-01-06T21:50:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 6 at 9:20pm\"},{\"startTime\":\"2026-01-06T22:00:00.000Z\",\"endTime\":\"2026-01-06T22:30:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 6 at 10pm\"}]",



  "times_sent": "Yes",



  "First Tattoo": "No",



  "Tattoo Placement": "back shoulder",



  "How Soon Is Client Deciding?": "January",



  "Tattoo Summary": "forest scene with pine trees",



  "contact_id": "e4li32CBaL6hsTy4uXDj",



  "first_name": "Maria",



  "last_name": "Claflin",



  "full_name": "Maria Claflin",



  "tags": "dm consultation request",



  "country": "US",



  "date_created": "2025-12-16T05:00:04.640Z",



  "contact_type": "lead",



  "location": {



    "name": "Studio AZ Tattoo",



    "address": "333 Washington Ave N STE 100",



    "city": "Minneapolis",



    "state": "Minnesota",



    "country": "US",



    "postalCode": "55401",



    "fullAddress": "333 Washington Ave N STE 100, Minneapolis Minnesota 55401",



    "id": "mUemx2jG4wly4kJWBkI4"



  },



  "message": {



    "type": 11,



    "body": "Tuesday January 6 at 8pm works"



  },



  "workflow": {



    "id": "8cf237bb-6cb1-4240-8ca5-b797bba8b769",



    "name": "Testing Ai Bot"



  },



  "contact": {



    "attributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    },



    "lastAttributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    }



  },



  "customData": {



    "contactId": "e4li32CBaL6hsTy4uXDj",



    "messageBody": "Tuesday January 6 at 8pm works"



  }



}



ğŸ“© Incoming message text: Tuesday January 6 at 8pm works



ğŸ‘¤ Contact ID: e4li32CBaL6hsTy4uXDj



ğŸ“‹ Webhook custom fields extracted: {



  "last_sent_slots": "[{\"startTime\":\"2026-01-06T20:00:00.000Z\",\"endTime\":\"2026-01-06T20:30:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 6 at 8pm\"},{\"startTime\":\"2026-01-06T20:40:00.000Z\",\"endTime\":\"2026-01-06T21:10:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 6 at 8:40pm\"},{\"startTime\":\"2026-01-06T21:20:00.000Z\",\"endTime\":\"2026-01-06T21:50:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 6 at 9:20pm\"},{\"startTime\":\"2026-01-06T22:00:00.000Z\",\"endTime\":\"2026-01-06T22:30:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 6 at 10pm\"}]",



  "times_sent": "Yes",



  "first_tattoo": "No",



  "tattoo_placement": "back shoulder",



  "how_soon_is_client_deciding": "January",



  "tattoo_summary": "forest scene with pine trees"



}



ğŸ‘¤ Contact: Maria Claflin



ğŸ“‹ Contact custom fields (merged): {



  "jd8yhvksbi4agqjqoeov": "back shoulder",



  "xagtmfmbxtfchdo2oyf7": "forest scene with pine trees",



  "fnydobmyqnxdxlljy5oe": "No",



  "ra4nk80wma8eqklcfxst": "January",



  "a832mlwirz5cv6xaktna": "[{\"startTime\":\"2026-01-06T20:00:00.000Z\",\"endTime\":\"2026-01-06T20:30:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 6 at 8pm\"},{\"startTime\":\"2026-01-06T20:40:00.000Z\",\"endTime\":\"2026-01-06T21:10:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 6 at 8:40pm\"},{\"startTime\":\"2026-01-06T21:20:00.000Z\",\"endTime\":\"2026-01-06T21:50:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 6 at 9:20pm\"},{\"startTime\":\"2026-01-06T22:00:00.000Z\",\"endTime\":\"2026-01-06T22:30:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 6 at 10pm\"}]",



  "eah8fdi5pwfxsqqfd45a": "Yes",



  "last_sent_slots": "[{\"startTime\":\"2026-01-06T20:00:00.000Z\",\"endTime\":\"2026-01-06T20:30:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 6 at 8pm\"},{\"startTime\":\"2026-01-06T20:40:00.000Z\",\"endTime\":\"2026-01-06T21:10:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 6 at 8:40pm\"},{\"startTime\":\"2026-01-06T21:20:00.000Z\",\"endTime\":\"2026-01-06T21:50:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 6 at 9:20pm\"},{\"startTime\":\"2026-01-06T22:00:00.000Z\",\"endTime\":\"2026-01-06T22:30:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 6 at 10pm\"}]",



  "times_sent": "Yes",



  "first_tattoo": "No",



  "tattoo_placement": "back shoulder",



  "how_soon_is_client_deciding": "January",



  "tattoo_summary": "forest scene with pine trees"



}



ğŸ§  [AI CONTEXT] Processing message: {



  messageText: 'Tuesday January 6 at 8pm works',



  contactId: 'e4li32CBaL6hsTy4uXDj',



  contactName: 'Maria Claflin',



  consultExplained: undefined



}



ğŸ“Š [CANONICAL] State before routing: {



  tattooSummary: 'forest scene with pine trees',



  tattooPlacement: 'back shoulder',



  tattooSize: null,



  timeline: 'January',



  consultationType: null,



  depositPaid: false,



  derivedPhase: 'consult_path'



}



ğŸ¯ [INTENTS] Detected intents: [ 'slot_selection_intent' ] from message: Tuesday January 6 at 8pm works



âœ… Matched day name with time: tuesday â†’ slot 1



ğŸ§­ [SLOT CHOICE] parseTimeSelection -> 0 number chosenSlot 2026-01-06T20:00:00.000Z



âš ï¸ Failed to create Google Meet (continuing without link): Missing Google OAuth credentials (client id/secret/refresh token)



âœ… Created appointment: {



  appointmentId: 'YOlcf7srUpsk93YN4fAk',



  calendarId: '2EJcAtrllnYOtuSx4Dua',



  contactId: 'e4li32CBaL6hsTy4uXDj',



  startTime: '2026-01-06T20:00:00.000Z',



  appointmentStatus: 'new'



}



âœ… Created appointment (status: new): {



  appointmentId: 'YOlcf7srUpsk93YN4fAk',



  calendarId: '2EJcAtrllnYOtuSx4Dua',



  contactId: 'e4li32CBaL6hsTy4uXDj',



  startTime: '2026-01-06T20:00:00.000Z',



  appointmentStatus: 'new',



  depositPaid: false,



  translatorAppointmentId: null



}



[Square] Creating payment link (HTTP) with body: {



  contactId: 'e4li32CBaL6hsTy4uXDj',



  amountCents: 10000,



  currency: 'USD',



  env: 'sandbox'



}



ğŸ’³ Square payment link created (HTTP): {



  contactId: 'e4li32CBaL6hsTy4uXDj',



  paymentLinkId: '3T7IFHXIPQRQ36S3',



  url: 'https://sandbox.square.link/u/YijAPZ1z'



}



ğŸ§­ [PHASE] derived_phase snapshot {



  derived_phase: 'consult_path',



  canonical: {



    tattooSummary: 'forest scene with pine trees',



    tattooPlacement: 'back shoulder',



    tattooSize: null,



    timeline: 'January',



    consultationType: null,



    consultationTypeLocked: false,



    depositLinkSent: false,



    depositPaid: false,



    holdAppointmentId: null



  },



  intents: {



    reschedule_intent: false,



    cancel_intent: false,



    scheduling_intent: false,



    slot_selection_intent: true,



    deposit_intent: false,



    consult_path_choice_intent: false,



    artist_guided_size_intent: false,



    process_or_price_question_intent: false,



    translator_affirm_intent: false



  },



  selected_handler: 'deterministic',



  routing_reason: 'slot_selection',



  intent_flags: [ 'slot_selection_intent' ]



}



â±ï¸ [TIMING] Total handleInboundMessage took 2752ms



ğŸ¤– AI Response Summary: {



  bubblesCount: 1,



  phase: 'consult_path',



  handler: 'deterministic',



  reason: 'slot_selection',



  fieldUpdatesKeys: [ 'consult_explained' ]



}



ğŸ“¡ Channel context: { isDm: true, hasPhone: false, conversationId: null, phone: null }



âœ‰ï¸ sendConversationMessage context: { contactId: 'e4li32CBaL6hsTy4uXDj', isDm: true, hasPhone: false }



ğŸ” No conversationId provided for DM, searching for existing conversation...



âœ… Found existing conversation 7y7T7be9lJESYKNgUvZY with type FB



âœ… Using conversation type FB from GHL conversation - skipping ID validation



ğŸ“¨ Sending DM reply via GHL: {



  conversationId: '7y7T7be9lJESYKNgUvZY',



  contactId: 'e4li32CBaL6hsTy4uXDj',



  message: 'Got you for Tuesday, Jan 6 at 8pm.\n' +



    'Hereâ€™s the $100 refundable deposit to lock it: https://sandbox.square.link/u/YijAPZ1z\n' +



    'Iâ€™ll keep it on hold for ~20 minutes.',



  type: 'FB'



}



ğŸ“¨ GHL DM reply response: {



  status: 201,



  contactId: 'e4li32CBaL6hsTy4uXDj',



  conversationId: '7y7T7be9lJESYKNgUvZY'



}



ğŸ“¤ Sent 1/1 bubbles to GHL conversation



updateTattooFields: no mapped fields to update for contact e4li32CBaL6hsTy4uXDj



âœ… Persisted field_updates: [ 'consult_explained' ]



ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•









ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•



ğŸ’¬ GHL MESSAGE WEBHOOK HIT



ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•



ğŸ“¦ Webhook Payload (non-empty fields): {



  "last_sent_slots": "[{\"startTime\":\"2026-01-06T20:00:00.000Z\",\"endTime\":\"2026-01-06T20:30:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 6 at 8pm\"},{\"startTime\":\"2026-01-06T20:40:00.000Z\",\"endTime\":\"2026-01-06T21:10:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 6 at 8:40pm\"},{\"startTime\":\"2026-01-06T21:20:00.000Z\",\"endTime\":\"2026-01-06T21:50:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 6 at 9:20pm\"},{\"startTime\":\"2026-01-06T22:00:00.000Z\",\"endTime\":\"2026-01-06T22:30:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 6 at 10pm\"}]",



  "times_sent": "Yes",



  "First Tattoo": "No",



  "hold_last_activity_at": "2025-12-16T05:04:43.612Z",



  "hold_warning_sent": "No",



  "Deposit Link Sent": "Yes",



  "Tattoo Placement": "back shoulder",



  "hold_appointment_id": "YOlcf7srUpsk93YN4fAk",



  "How Soon Is Client Deciding?": "January",



  "Tattoo Summary": "forest scene with pine trees",



  "contact_id": "e4li32CBaL6hsTy4uXDj",



  "first_name": "Maria",



  "last_name": "Claflin",



  "full_name": "Maria Claflin",



  "tags": "dm consultation request",



  "country": "US",



  "date_created": "2025-12-16T05:00:04.640Z",



  "contact_type": "lead",



  "location": {



    "name": "Studio AZ Tattoo",



    "address": "333 Washington Ave N STE 100",



    "city": "Minneapolis",



    "state": "Minnesota",



    "country": "US",



    "postalCode": "55401",



    "fullAddress": "333 Washington Ave N STE 100, Minneapolis Minnesota 55401",



    "id": "mUemx2jG4wly4kJWBkI4"



  },



  "user": {



    "firstName": "Claudia",



    "lastName": "Chavarria",



    "email": "tigsatattoos@gmail.com"



  },



  "message": {



    "type": 11,



    "body": "Before I send the deposit, is the consultation in person?"



  },



  "workflow": {



    "id": "8cf237bb-6cb1-4240-8ca5-b797bba8b769",



    "name": "Testing Ai Bot"



  },



  "contact": {



    "attributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    },



    "lastAttributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    }



  },



  "customData": {



    "contactId": "e4li32CBaL6hsTy4uXDj",



    "messageBody": "Before I send the deposit, is the consultation in person?"



  }



}



ğŸ“© Incoming message text: Before I send the deposit, is the consultation in person?



ğŸ‘¤ Contact ID: e4li32CBaL6hsTy4uXDj



ğŸ“‹ Webhook custom fields extracted: {



  "last_sent_slots": "[{\"startTime\":\"2026-01-06T20:00:00.000Z\",\"endTime\":\"2026-01-06T20:30:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 6 at 8pm\"},{\"startTime\":\"2026-01-06T20:40:00.000Z\",\"endTime\":\"2026-01-06T21:10:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 6 at 8:40pm\"},{\"startTime\":\"2026-01-06T21:20:00.000Z\",\"endTime\":\"2026-01-06T21:50:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 6 at 9:20pm\"},{\"startTime\":\"2026-01-06T22:00:00.000Z\",\"endTime\":\"2026-01-06T22:30:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 6 at 10pm\"}]",



  "times_sent": "Yes",



  "first_tattoo": "No",



  "hold_last_activity_at": "2025-12-16T05:04:43.612Z",



  "hold_warning_sent": "No",



  "deposit_link_sent": "Yes",



  "tattoo_placement": "back shoulder",



  "hold_appointment_id": "YOlcf7srUpsk93YN4fAk",



  "how_soon_is_client_deciding": "January",



  "tattoo_summary": "forest scene with pine trees"



}



ğŸ‘¤ Contact: Maria Claflin



ğŸ“‹ Contact custom fields (merged): {



  "jd8yhvksbi4agqjqoeov": "back shoulder",



  "xagtmfmbxtfchdo2oyf7": "forest scene with pine trees",



  "fnydobmyqnxdxlljy5oe": "No",



  "ra4nk80wma8eqklcfxst": "January",



  "a832mlwirz5cv6xaktna": "[{\"startTime\":\"2026-01-06T20:00:00.000Z\",\"endTime\":\"2026-01-06T20:30:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 6 at 8pm\"},{\"startTime\":\"2026-01-06T20:40:00.000Z\",\"endTime\":\"2026-01-06T21:10:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 6 at 8:40pm\"},{\"startTime\":\"2026-01-06T21:20:00.000Z\",\"endTime\":\"2026-01-06T21:50:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 6 at 9:20pm\"},{\"startTime\":\"2026-01-06T22:00:00.000Z\",\"endTime\":\"2026-01-06T22:30:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 6 at 10pm\"}]",



  "eah8fdi5pwfxsqqfd45a": "Yes",



  "hnelct3ekpbjphnspnif": "2025-12-16T05:04:43.612Z",



  "emwcggyxu7uzasx6uwod": "No",



  "jszdgcpnyzab1s3alcjk": "Yes",



  "ma7faq854uotakf7qzy5": "YOlcf7srUpsk93YN4fAk",



  "last_sent_slots": "[{\"startTime\":\"2026-01-06T20:00:00.000Z\",\"endTime\":\"2026-01-06T20:30:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 6 at 8pm\"},{\"startTime\":\"2026-01-06T20:40:00.000Z\",\"endTime\":\"2026-01-06T21:10:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 6 at 8:40pm\"},{\"startTime\":\"2026-01-06T21:20:00.000Z\",\"endTime\":\"2026-01-06T21:50:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 6 at 9:20pm\"},{\"startTime\":\"2026-01-06T22:00:00.000Z\",\"endTime\":\"2026-01-06T22:30:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 6 at 10pm\"}]",



  "times_sent": "Yes",



  "first_tattoo": "No",



  "hold_last_activity_at": "2025-12-16T05:04:43.612Z",



  "hold_warning_sent": "No",



  "deposit_link_sent": "Yes",



  "tattoo_placement": "back shoulder",



  "hold_appointment_id": "YOlcf7srUpsk93YN4fAk",



  "how_soon_is_client_deciding": "January",



  "tattoo_summary": "forest scene with pine trees"



}



ğŸ§  [AI CONTEXT] Processing message: {



  messageText: 'Before I send the deposit, is the consultation in person?',



  contactId: 'e4li32CBaL6hsTy4uXDj',



  contactName: 'Maria Claflin',



  consultExplained: undefined



}



ğŸ“Š [CANONICAL] State before routing: {



  tattooSummary: 'forest scene with pine trees',



  tattooPlacement: 'back shoulder',



  tattooSize: null,



  timeline: 'January',



  consultationType: null,



  depositPaid: false,



  derivedPhase: 'deposit_pending'



}



ğŸ¯ [INTENTS] Detected intents: [ 'deposit_intent', 'consult_path_choice_intent' ] from message: Before I send the deposit, is the consultation in person?



[Square] Creating payment link (HTTP) with body: {



  contactId: 'e4li32CBaL6hsTy4uXDj',



  amountCents: 10000,



  currency: 'USD',



  env: 'sandbox'



}



ğŸ’³ Square payment link created (HTTP): {



  contactId: 'e4li32CBaL6hsTy4uXDj',



  paymentLinkId: 'VH6FXHFUCQCDZC7P',



  url: 'https://sandbox.square.link/u/kQI1zja1'



}



ğŸ§­ [PHASE] derived_phase snapshot {



  derived_phase: 'deposit_pending',



  canonical: {



    tattooSummary: 'forest scene with pine trees',



    tattooPlacement: 'back shoulder',



    tattooSize: null,



    timeline: 'January',



    consultationType: null,



    consultationTypeLocked: false,



    depositLinkSent: true,



    depositPaid: false,



    holdAppointmentId: 'YOlcf7srUpsk93YN4fAk'



  },



  intents: {



    reschedule_intent: false,



    cancel_intent: false,



    scheduling_intent: false,



    slot_selection_intent: false,



    deposit_intent: true,



    consult_path_choice_intent: true,



    artist_guided_size_intent: false,



    process_or_price_question_intent: false,



    translator_affirm_intent: false



  },



  selected_handler: 'deterministic',



  routing_reason: 'deposit_intent',



  intent_flags: [ 'deposit_intent', 'consult_path_choice_intent' ]



}



â±ï¸ [TIMING] Total handleInboundMessage took 1049ms



ğŸ¤– AI Response Summary: {



  bubblesCount: 1,



  phase: 'deposit_pending',



  handler: 'deterministic',



  reason: 'deposit_intent',



  fieldUpdatesKeys: [ 'consult_explained' ]



}



ğŸ“¡ Channel context: { isDm: true, hasPhone: false, conversationId: null, phone: null }



âœ‰ï¸ sendConversationMessage context: { contactId: 'e4li32CBaL6hsTy4uXDj', isDm: true, hasPhone: false }



ğŸ” No conversationId provided for DM, searching for existing conversation...



âœ… Found existing conversation 7y7T7be9lJESYKNgUvZY with type FB



âœ… Using conversation type FB from GHL conversation - skipping ID validation



ğŸ“¨ Sending DM reply via GHL: {



  conversationId: '7y7T7be9lJESYKNgUvZY',



  contactId: 'e4li32CBaL6hsTy4uXDj',



  message: 'Hereâ€™s your $100 refundable deposit to lock your consult: https://sandbox.square.link/u/kQI1zja1',



  type: 'FB'



}



ğŸ“¨ GHL DM reply response: {



  status: 201,



  contactId: 'e4li32CBaL6hsTy4uXDj',



  conversationId: '7y7T7be9lJESYKNgUvZY'



}



ğŸ“¤ Sent 1/1 bubbles to GHL conversation



updateTattooFields: no mapped fields to update for contact e4li32CBaL6hsTy4uXDj



âœ… Persisted field_updates: [ 'consult_explained' ]



ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•






  "eah8fdi5pwfxsqqfd45a": "Yes",



  "hnelct3ekpbjphnspnif": "2025-12-16T05:04:43.612Z",



  "emwcggyxu7uzasx6uwod": "No",



  "jszdgcpnyzab1s3alcjk": "Yes",



  "ma7faq854uotakf7qzy5": "YOlcf7srUpsk93YN4fAk",



  "last_sent_slots": "[{\"startTime\":\"2026-01-06T20:00:00.000Z\",\"endTime\":\"2026-01-06T20:30:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 6 at 8pm\"},{\"startTime\":\"2026-01-06T20:40:00.000Z\",\"endTime\":\"2026-01-06T21:10:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 6 at 8:40pm\"},{\"startTime\":\"2026-01-06T21:20:00.000Z\",\"endTime\":\"2026-01-06T21:50:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 6 at 9:20pm\"},{\"startTime\":\"2026-01-06T22:00:00.000Z\",\"endTime\":\"2026-01-06T22:30:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Jan 6 at 10pm\"}]",



  "times_sent": "Yes",



  "first_tattoo": "No",



  "hold_last_activity_at": "2025-12-16T05:04:43.612Z",



  "hold_warning_sent": "No",



  "deposit_link_sent": "Yes",



  "tattoo_placement": "back shoulder",



  "hold_appointment_id": "YOlcf7srUpsk93YN4fAk",



  "how_soon_is_client_deciding": "January",



  "tattoo_summary": "forest scene with pine trees"



}



ğŸ§  [AI CONTEXT] Processing message: {



  messageText: 'Before I send the deposit, is the consultation in person?',



  contactId: 'e4li32CBaL6hsTy4uXDj',



  contactName: 'Maria Claflin',



  consultExplained: undefined



}



ğŸ“Š [CANONICAL] State before routing: {



  tattooSummary: 'forest scene with pine trees',



  tattooPlacement: 'back shoulder',



  tattooSize: null,



  timeline: 'January',



  consultationType: null,



  depositPaid: false,



  derivedPhase: 'deposit_pending'



}



ğŸ¯ [INTENTS] Detected intents: [ 'deposit_intent', 'consult_path_choice_intent' ] from message: Before I send the deposit, is the consultation in person?



[Square] Creating payment link (HTTP) with body: {



  contactId: 'e4li32CBaL6hsTy4uXDj',



  amountCents: 10000,



  currency: 'USD',



  env: 'sandbox'



}



ğŸ’³ Square payment link created (HTTP): {



  contactId: 'e4li32CBaL6hsTy4uXDj',



  paymentLinkId: 'VH6FXHFUCQCDZC7P',



  url: 'https://sandbox.square.link/u/kQI1zja1'



}



ğŸ§­ [PHASE] derived_phase snapshot {



  derived_phase: 'deposit_pending',



  canonical: {



    tattooSummary: 'forest scene with pine trees',



    tattooPlacement: 'back shoulder',



    tattooSize: null,



    timeline: 'January',



    consultationType: null,



    consultationTypeLocked: false,



    depositLinkSent: true,



    depositPaid: false,



    holdAppointmentId: 'YOlcf7srUpsk93YN4fAk'



  },



  intents: {



    reschedule_intent: false,



    cancel_intent: false,



    scheduling_intent: false,



    slot_selection_intent: false,



    deposit_intent: true,



    consult_path_choice_intent: true,



    artist_guided_size_intent: false,



    process_or_price_question_intent: false,



    translator_affirm_intent: false



  },



  selected_handler: 'deterministic',



  routing_reason: 'deposit_intent',



  intent_flags: [ 'deposit_intent', 'consult_path_choice_intent' ]



}



â±ï¸ [TIMING] Total handleInboundMessage took 1049ms



ğŸ¤– AI Response Summary: {



  bubblesCount: 1,



  phase: 'deposit_pending',



  handler: 'deterministic',



  reason: 'deposit_intent',



  fieldUpdatesKeys: [ 'consult_explained' ]



}



ğŸ“¡ Channel context: { isDm: true, hasPhone: false, conversationId: null, phone: null }



âœ‰ï¸ sendConversationMessage context: { contactId: 'e4li32CBaL6hsTy4uXDj', isDm: true, hasPhone: false }



ğŸ” No conversationId provided for DM, searching for existing conversation...



âœ… Found existing conversation 7y7T7be9lJESYKNgUvZY with type FB



âœ… Using conversation type FB from GHL conversation - skipping ID validation



ğŸ“¨ Sending DM reply via GHL: {



  conversationId: '7y7T7be9lJESYKNgUvZY',



  contactId: 'e4li32CBaL6hsTy4uXDj',



  message: 'Hereâ€™s your $100 refundable deposit to lock your consult: https://sandbox.square.link/u/kQI1zja1',



  type: 'FB'



}



ğŸ“¨ GHL DM reply response: {



  status: 201,



  contactId: 'e4li32CBaL6hsTy4uXDj',



  conversationId: '7y7T7be9lJESYKNgUvZY'



}



ğŸ“¤ Sent 1/1 bubbles to GHL conversation



updateTattooFields: no mapped fields to update for contact e4li32CBaL6hsTy4uXDj



âœ… Persisted field_updates: [ 'consult_explained' ]



ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
