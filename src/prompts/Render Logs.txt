ğŸ’¬ GHL MESSAGE WEBHOOK HIT
ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“¦ Webhook Payload (non-empty fields): {
  "contact_id": "OdDJ3aIPJxRCt63ViawC",
  "first_name": "Leonel",
  "last_name": "Chavez",
  "full_name": "Leonel Chavez",
  "tags": "dm consultation request",
  "date_created": "2025-12-16T00:29:54.300Z",
  "contact_type": "lead",
  "location": {
    "name": "Studio AZ Tattoo",
    "address": "333 Washington Ave N STE 100",
    "city": "Minneapolis",
    "state": "Minnesota",
    "country": "US",
    "postalCode": "55401",
    "fullAddress": "333 Washington Ave N STE 100, Minneapolis Minnesota 55401",
    "id": "mUemx2jG4wly4kJWBkI4"
  },
  "message": {
    "type": 11,
    "body": "How can I make an appt for a tattoo?"
  },
  "workflow": {
    "id": "8cf237bb-6cb1-4240-8ca5-b797bba8b769",
    "name": "Testing Ai Bot"
  },
  "contact": {
    "attributionSource": {
      "photoUrl": null,
      "sessionSource": "Social media",
      "adId": null,
      "productId": null,
      "videoUrl": null,
      "mediumId": "9747144365336642",
      "utmContent": null,
      "pSid": "9747144365336642",
      "medium": "facebook",
      "postId": null,
      "flowId": null
    },
    "lastAttributionSource": {
      "photoUrl": null,
      "sessionSource": "Social media",
      "adId": null,
      "productId": null,
      "videoUrl": null,
      "mediumId": "9747144365336642",
      "utmContent": null,
      "pSid": "9747144365336642",
      "medium": "facebook",
      "postId": null,
      "flowId": null
    }
  },
  "customData": {
    "contactId": "OdDJ3aIPJxRCt63ViawC",
    "messageBody": "How can I make an appt for a tattoo?"
  }
}
ğŸ“© Incoming message text: How can I make an appt for a tattoo?
ğŸ‘¤ Contact ID: OdDJ3aIPJxRCt63ViawC
ğŸ“‹ Webhook custom fields extracted: {}
ğŸ‘¤ Contact: Leonel Chavez
ğŸ“‹ Contact custom fields (merged): {}
ğŸ§  [AI CONTEXT] Processing message: {
  messageText: 'How can I make an appt for a tattoo?',
  contactId: 'OdDJ3aIPJxRCt63ViawC',
  contactName: 'Leonel Chavez',
  consultExplained: undefined
}
ğŸ“Š [CANONICAL] State before routing: {
  tattooSummary: null,
  tattooPlacement: null,
  tattooSize: null,
  timeline: null,
  consultationType: null,
  depositPaid: false,
  derivedPhase: 'intake'
}
ğŸ¯ [INTENTS] No specific intents detected for: How can I make an appt for a tattoo?
ğŸ¤– Raw OpenAI opener response: {
  "language": "en",
  "bubbles": [
    "Leonel, what kind of piece are you thinking?",
    "Where on your body were you wanting to get it?"
  ],
  "internal_notes": "Opening intake message to gather tattoo idea and placement.",
  "meta": {
    "aiPhase": "intake",
    "leadTemperature": "warm",
    "wantsDepositLink": false,
    "depositPushedThisTurn": false,
    "mentionDecoyOffered": false,
    "consultMode": "online"
  },
  "field_updates": {}
}
â±ï¸ [TIMING] AI call took 3506ms
ğŸ§­ [PHASE] derived_phase snapshot {
  derived_phase: 'intake',
  canonical: {
    tattooSummary: null,
    tattooPlacement: null,
    tattooSize: null,
    timeline: null,
    consultationType: null,
    consultationTypeLocked: false,
    depositLinkSent: false,
    depositPaid: false,
    holdAppointmentId: null
  },
  intents: {
    reschedule_intent: false,
    cancel_intent: false,
    scheduling_intent: false,
    slot_selection_intent: false,
    deposit_intent: false,
    consult_path_choice_intent: false,
    artist_guided_size_intent: false,
    process_or_price_question_intent: false,
    translator_affirm_intent: false
  },
  selected_handler: 'ai',
  routing_reason: 'ai_fallback',
  intent_flags: []
}
â±ï¸ [TIMING] Total handleInboundMessage took 3511ms
ğŸ¤– AI Response Summary: {
  bubblesCount: 2,
  phase: 'intake',
  handler: 'ai',
  reason: 'ai_fallback',
  fieldUpdatesKeys: []
}
ğŸ“¡ Channel context: { isDm: true, hasPhone: false, conversationId: null, phone: null }
âœ‰ï¸ sendConversationMessage context: { contactId: 'OdDJ3aIPJxRCt63ViawC', isDm: true, hasPhone: false }
ğŸ” No conversationId provided for DM, searching for existing conversation...
âœ… Found existing conversation 5tO6jUJu8HtRkLo8zvN5 with type FB
âœ… Using conversation type FB from GHL conversation - skipping ID validation
ğŸ“¨ Sending DM reply via GHL: {
  conversationId: '5tO6jUJu8HtRkLo8zvN5',
  contactId: 'OdDJ3aIPJxRCt63ViawC',
  message: 'Leonel, what kind of piece are you thinking?',
  type: 'FB'
}
ğŸ“¨ GHL DM reply response: {
  status: 201,
  contactId: 'OdDJ3aIPJxRCt63ViawC',
  conversationId: '5tO6jUJu8HtRkLo8zvN5'
}
âœ‰ï¸ sendConversationMessage context: { contactId: 'OdDJ3aIPJxRCt63ViawC', isDm: true, hasPhone: false }
ğŸ” No conversationId provided for DM, searching for existing conversation...
âœ… Found existing conversation 5tO6jUJu8HtRkLo8zvN5 with type FB
âœ… Using conversation type FB from GHL conversation - skipping ID validation
ğŸ“¨ Sending DM reply via GHL: {
  conversationId: '5tO6jUJu8HtRkLo8zvN5',
  contactId: 'OdDJ3aIPJxRCt63ViawC',
  message: 'Where on your body were you wanting to get it?',
  type: 'FB'
}
ğŸ“¨ GHL DM reply response: {
  status: 201,
  contactId: 'OdDJ3aIPJxRCt63ViawC',
  conversationId: '5tO6jUJu8HtRkLo8zvN5'
}
ğŸ“¤ Sent 2/2 bubbles to GHL conversation
â„¹ï¸ No field_updates from AI to persist this turn
ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’¬ GHL MESSAGE WEBHOOK HIT
ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“¦ Webhook Payload (non-empty fields): {
  "contact_id": "OdDJ3aIPJxRCt63ViawC",
  "first_name": "Leonel",
  "last_name": "Chavez",
  "full_name": "Leonel Chavez",
  "tags": "dm consultation request",
  "date_created": "2025-12-16T00:29:54.300Z",
  "contact_type": "lead",
  "location": {
    "name": "Studio AZ Tattoo",
    "address": "333 Washington Ave N STE 100",
    "city": "Minneapolis",
    "state": "Minnesota",
    "country": "US",
    "postalCode": "55401",
    "fullAddress": "333 Washington Ave N STE 100, Minneapolis Minnesota 55401",
    "id": "mUemx2jG4wly4kJWBkI4"
  },
  "message": {
    "type": 11,
    "body": "Im hoping for a lion with roses around it on my shoulder"
  },
  "workflow": {
    "id": "8cf237bb-6cb1-4240-8ca5-b797bba8b769",
    "name": "Testing Ai Bot"
  },
  "contact": {
    "attributionSource": {
      "photoUrl": null,
      "sessionSource": "Social media",
      "adId": null,
      "productId": null,
      "videoUrl": null,
      "mediumId": "9747144365336642",
      "utmContent": null,
      "pSid": "9747144365336642",
      "medium": "facebook",
      "postId": null,
      "flowId": null
    },
    "lastAttributionSource": {
      "photoUrl": null,
      "sessionSource": "Social media",
      "adId": null,
      "productId": null,
      "videoUrl": null,
      "mediumId": "9747144365336642",
      "utmContent": null,
      "pSid": "9747144365336642",
      "medium": "facebook",
      "postId": null,
      "flowId": null
    }
  },
  "customData": {
    "contactId": "OdDJ3aIPJxRCt63ViawC",
    "messageBody": "Im hoping for a lion with roses around it on my shoulder"
  }
}
ğŸ“© Incoming message text: Im hoping for a lion with roses around it on my shoulder
ğŸ‘¤ Contact ID: OdDJ3aIPJxRCt63ViawC
ğŸ“‹ Webhook custom fields extracted: {}
ğŸ‘¤ Contact: Leonel Chavez
ğŸ“‹ Contact custom fields (merged): {}
ğŸ§  [AI CONTEXT] Processing message: {
  messageText: 'Im hoping for a lion with roses around it on my shoulder',
  contactId: 'OdDJ3aIPJxRCt63ViawC',
  contactName: 'Leonel Chavez',
  consultExplained: undefined
}
ğŸ“Š [CANONICAL] State before routing: {
  tattooSummary: null,
  tattooPlacement: null,
  tattooSize: null,
  timeline: null,
  consultationType: null,
  depositPaid: false,
  derivedPhase: 'intake'
}
ğŸ¯ [INTENTS] No specific intents detected for: Im hoping for a lion with roses around it on my shoulder
ğŸ¤– Raw OpenAI opener response: {
  "language": "en",
  "bubbles": [
    "Sick â€” that lion with roses on your shoulder is gonna look fire.",
    "When were you thinking to get it done?"
  ],
  "internal_notes": "Acknowledged tattoo idea and placement, asked about timing to continue intake phase.",
  "meta": {
    "aiPhase": "intake",
    "leadTemperature": "warm",
    "wantsDepositLink": false,
    "depositPushedThisTurn": false,
    "mentionDecoyOffered": false,
    "consultMode": "online"
  },
  "field_updates": {
    "tattoo_placement": "shoulder",
    "tattoo_summary": "lion with roses",
    "first_tattoo": false
  }
}
â±ï¸ [TIMING] AI call took 4298ms
ğŸ§­ [PHASE] derived_phase snapshot {
  derived_phase: 'discovery',
  canonical: {
    tattooSummary: 'lion with roses',
    tattooPlacement: 'shoulder',
    tattooSize: null,
    timeline: null,
    consultationType: null,
    consultationTypeLocked: false,
    depositLinkSent: false,
    depositPaid: false,
    holdAppointmentId: null
  },
  intents: {
    reschedule_intent: false,
    cancel_intent: false,
    scheduling_intent: false,
    slot_selection_intent: false,
    deposit_intent: false,
    consult_path_choice_intent: false,
    artist_guided_size_intent: false,
    process_or_price_question_intent: false,
    translator_affirm_intent: false
  },
  selected_handler: 'ai',
  routing_reason: 'ai_fallback',
  intent_flags: []
}
â±ï¸ [TIMING] Total handleInboundMessage took 4557ms
ğŸ¤– AI Response Summary: {
  bubblesCount: 2,
  phase: 'discovery',
  handler: 'ai',
  reason: 'ai_fallback',
  fieldUpdatesKeys: [ 'tattoo_placement', 'tattoo_summary', 'first_tattoo' ]
}
ğŸ“¡ Channel context: { isDm: true, hasPhone: false, conversationId: null, phone: null }
âœ‰ï¸ sendConversationMessage context: { contactId: 'OdDJ3aIPJxRCt63ViawC', isDm: true, hasPhone: false }
ğŸ” No conversationId provided for DM, searching for existing conversation...
âœ… Found existing conversation 5tO6jUJu8HtRkLo8zvN5 with type FB
âœ… Using conversation type FB from GHL conversation - skipping ID validation
ğŸ“¨ Sending DM reply via GHL: {
  conversationId: '5tO6jUJu8HtRkLo8zvN5',
  contactId: 'OdDJ3aIPJxRCt63ViawC',
  message: 'Sick â€” that lion with roses on your shoulder is gonna look fire.',
  type: 'FB'
}
ğŸ“¨ GHL DM reply response: {
  status: 201,
  contactId: 'OdDJ3aIPJxRCt63ViawC',
  conversationId: '5tO6jUJu8HtRkLo8zvN5'
}
âœ‰ï¸ sendConversationMessage context: { contactId: 'OdDJ3aIPJxRCt63ViawC', isDm: true, hasPhone: false }
ğŸ” No conversationId provided for DM, searching for existing conversation...
âœ… Found existing conversation 5tO6jUJu8HtRkLo8zvN5 with type FB
âœ… Using conversation type FB from GHL conversation - skipping ID validation
ğŸ“¨ Sending DM reply via GHL: {
  conversationId: '5tO6jUJu8HtRkLo8zvN5',
  contactId: 'OdDJ3aIPJxRCt63ViawC',
  message: 'When were you thinking to get it done?',
  type: 'FB'
}
ğŸ“¨ GHL DM reply response: {
  status: 201,
  contactId: 'OdDJ3aIPJxRCt63ViawC',
  conversationId: '5tO6jUJu8HtRkLo8zvN5'
}
ğŸ“¤ Sent 2/2 bubbles to GHL conversation
âœ… Updated tattoo fields for contact OdDJ3aIPJxRCt63ViawC with {
  tattoo_placement: 'shoulder',
  tattoo_summary: 'lion with roses',
  first_tattoo: 'No'
}
âœ… Persisted field_updates: [ 'tattoo_placement', 'tattoo_summary', 'first_tattoo' ]
ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ==> Detected service running on port 10000
     ==> Docs on specifying a port: https://render.com/docs/web-services#port-binding
ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’¬ GHL MESSAGE WEBHOOK HIT
ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“¦ Webhook Payload (non-empty fields): {
  "First Tattoo": "No",
  "Tattoo Placement": "shoulder",
  "Tattoo Summary": "lion with roses",
  "contact_id": "OdDJ3aIPJxRCt63ViawC",
  "first_name": "Leonel",
  "last_name": "Chavez",
  "full_name": "Leonel Chavez",
  "tags": "dm consultation request",
  "country": "US",
  "date_created": "2025-12-16T00:29:54.300Z",
  "contact_type": "lead",
  "location": {
    "name": "Studio AZ Tattoo",
    "address": "333 Washington Ave N STE 100",
    "city": "Minneapolis",
    "state": "Minnesota",
    "country": "US",
    "postalCode": "55401",
    "fullAddress": "333 Washington Ave N STE 100, Minneapolis Minnesota 55401",
    "id": "mUemx2jG4wly4kJWBkI4"
  },
  "message": {
    "type": 11,
    "body": "Whats available in January?"
  },
  "workflow": {
    "id": "8cf237bb-6cb1-4240-8ca5-b797bba8b769",
    "name": "Testing Ai Bot"
  },
  "contact": {
    "attributionSource": {
      "photoUrl": null,
      "sessionSource": "Social media",
      "adId": null,
      "productId": null,
      "videoUrl": null,
      "mediumId": "9747144365336642",
      "utmContent": null,
      "pSid": "9747144365336642",
      "medium": "facebook",
      "postId": null,
      "flowId": null
    },
    "lastAttributionSource": {
      "photoUrl": null,
      "sessionSource": "Social media",
      "adId": null,
      "productId": null,
      "videoUrl": null,
      "mediumId": "9747144365336642",
      "utmContent": null,
      "pSid": "9747144365336642",
      "medium": "facebook",
      "postId": null,
      "flowId": null
    }
  },
  "customData": {
    "contactId": "OdDJ3aIPJxRCt63ViawC",
    "messageBody": "Whats available in January?"
  }
}
ğŸ“© Incoming message text: Whats available in January?
ğŸ‘¤ Contact ID: OdDJ3aIPJxRCt63ViawC
ğŸ“‹ Webhook custom fields extracted: {
  "first_tattoo": "No",
  "tattoo_placement": "shoulder",
  "tattoo_summary": "lion with roses"
}
ğŸ‘¤ Contact: Leonel Chavez
ğŸ“‹ Contact custom fields (merged): {
  "fnydobmyqnxdxlljy5oe": "No",
  "jd8yhvksbi4agqjqoeov": "shoulder",
  "xagtmfmbxtfchdo2oyf7": "lion with roses",
  "first_tattoo": "No",
  "tattoo_placement": "shoulder",
  "tattoo_summary": "lion with roses"
}
ğŸ§  [AI CONTEXT] Processing message: {
  messageText: 'Whats available in January?',
  contactId: 'OdDJ3aIPJxRCt63ViawC',
  contactName: 'Leonel Chavez',
  consultExplained: undefined
}
ğŸ“Š [CANONICAL] State before routing: {
  tattooSummary: 'lion with roses',
  tattooPlacement: 'shoulder',
  tattooSize: null,
  timeline: null,
  consultationType: null,
  depositPaid: false,
  derivedPhase: 'discovery'
}
ğŸ¯ [INTENTS] Detected intents: [ 'scheduling_intent' ] from message: Whats available in January?
ğŸ“… [SLOT OFFER] Time preferences extracted: { preferredWeek: null, preferredDay: null, preferredTimeWindow: null }
ğŸ“… [SLOTS] Fetching real GHL slots from 2025-12-16T00:00:00.000Z to 2025-12-23T23:59:59.999Z
âœ… [GHL CALENDAR] Found 12 free slots for calendar 2EJcAtrllnYOtuSx4Dua between 2025-12-16T00:00:00.000Z and 2025-12-23T23:59:59.999Z
ğŸ“… [SLOTS] Returning 4 real GHL slots
âœ… [SLOT PERSIST] Saved 4 slots to GHL for contact OdDJ3aIPJxRCt63ViawC
ğŸ§­ [PHASE] derived_phase snapshot {
  derived_phase: 'discovery',
  canonical: {
    tattooSummary: 'lion with roses',
    tattooPlacement: 'shoulder',
    tattooSize: null,
    timeline: null,
    consultationType: null,
    consultationTypeLocked: false,
    depositLinkSent: false,
    depositPaid: false,
    holdAppointmentId: null
  },
  intents: {
    reschedule_intent: false,
    cancel_intent: false,
    scheduling_intent: true,
    slot_selection_intent: false,
    deposit_intent: false,
    consult_path_choice_intent: false,
    artist_guided_size_intent: false,
    process_or_price_question_intent: false,
    translator_affirm_intent: false
  },
  selected_handler: 'deterministic',
  routing_reason: 'scheduling_intent',
  intent_flags: [ 'scheduling_intent' ]
}
â±ï¸ [TIMING] Total handleInboundMessage took 686ms
ğŸ¤– AI Response Summary: {
  bubblesCount: 1,
  phase: 'discovery',
  handler: 'deterministic',
  reason: 'scheduling_intent',
  fieldUpdatesKeys: [ 'consult_explained' ]
}
ğŸ“¡ Channel context: { isDm: true, hasPhone: false, conversationId: null, phone: null }
âœ‰ï¸ sendConversationMessage context: { contactId: 'OdDJ3aIPJxRCt63ViawC', isDm: true, hasPhone: false }
ğŸ” No conversationId provided for DM, searching for existing conversation...
âœ… Found existing conversation 5tO6jUJu8HtRkLo8zvN5 with type FB
âœ… Using conversation type FB from GHL conversation - skipping ID validation
ğŸ“¨ Sending DM reply via GHL: {
  conversationId: '5tO6jUJu8HtRkLo8zvN5',
  contactId: 'OdDJ3aIPJxRCt63ViawC',
  message: 'I pulled a few openings for a consult with an artist:\n' +
    '1) Tuesday, Dec 16 at 8pm\n' +
    '2) Tuesday, Dec 16 at 8:40pm\n' +
    '3) Tuesday, Dec 16 at 9:20pm\n' +
    '4) Tuesday, Dec 16 at 10pm\n' +
    '\n' +
    'Which works best?',
  type: 'FB'
}
ğŸ“¨ GHL DM reply response: {
  status: 201,
  contactId: 'OdDJ3aIPJxRCt63ViawC',
  conversationId: '5tO6jUJu8HtRkLo8zvN5'
}
ğŸ“¤ Sent 1/1 bubbles to GHL conversation
updateTattooFields: no mapped fields to update for contact OdDJ3aIPJxRCt63ViawC
âœ… Persisted field_updates: [ 'consult_explained' ]
ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’¬ GHL MESSAGE WEBHOOK HIT
ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“¦ Webhook Payload (non-empty fields): {
  "times_sent": "Yes",
  "First Tattoo": "No",
  "Tattoo Placement": "shoulder",
  "Tattoo Summary": "lion with roses",
  "contact_id": "OdDJ3aIPJxRCt63ViawC",
  "first_name": "Leonel",
  "last_name": "Chavez",
  "full_name": "Leonel Chavez",
  "tags": "dm consultation request",
  "country": "US",
  "date_created": "2025-12-16T00:29:54.300Z",
  "contact_type": "lead",
  "location": {
    "name": "Studio AZ Tattoo",
    "address": "333 Washington Ave N STE 100",
    "city": "Minneapolis",
    "state": "Minnesota",
    "country": "US",
    "postalCode": "55401",
    "fullAddress": "333 Washington Ave N STE 100, Minneapolis Minnesota 55401",
    "id": "mUemx2jG4wly4kJWBkI4"
  },
  "message": {
    "type": 11,
    "body": "Letâ€™s do 8pm"
  },
  "workflow": {
    "id": "8cf237bb-6cb1-4240-8ca5-b797bba8b769",
    "name": "Testing Ai Bot"
  },
  "contact": {
    "attributionSource": {
      "photoUrl": null,
      "sessionSource": "Social media",
      "adId": null,
      "productId": null,
      "videoUrl": null,
      "mediumId": "9747144365336642",
      "utmContent": null,
      "pSid": "9747144365336642",
      "medium": "facebook",
      "postId": null,
      "flowId": null
    },
    "lastAttributionSource": {
      "photoUrl": null,
      "sessionSource": "Social media",
      "adId": null,
      "productId": null,
      "videoUrl": null,
      "mediumId": "9747144365336642",
      "utmContent": null,
      "pSid": "9747144365336642",
      "medium": "facebook",
      "postId": null,
      "flowId": null
    }
  },
  "customData": {
    "contactId": "OdDJ3aIPJxRCt63ViawC",
    "messageBody": "Letâ€™s do 8pm"
  }
}
ğŸ“© Incoming message text: Letâ€™s do 8pm
ğŸ‘¤ Contact ID: OdDJ3aIPJxRCt63ViawC
ğŸ“‹ Webhook custom fields extracted: {
  "times_sent": "Yes",
  "first_tattoo": "No",
  "tattoo_placement": "shoulder",
  "tattoo_summary": "lion with roses"
}
ğŸ‘¤ Contact: Leonel Chavez
ğŸ“‹ Contact custom fields (merged): {
  "fnydobmyqnxdxlljy5oe": "No",
  "jd8yhvksbi4agqjqoeov": "shoulder",
  "xagtmfmbxtfchdo2oyf7": "lion with roses",
  "eah8fdi5pwfxsqqfd45a": "Yes",
  "times_sent": "Yes",
  "first_tattoo": "No",
  "tattoo_placement": "shoulder",
  "tattoo_summary": "lion with roses"
}
ğŸ§  [AI CONTEXT] Processing message: {
  messageText: 'Letâ€™s do 8pm',
  contactId: 'OdDJ3aIPJxRCt63ViawC',
  contactName: 'Leonel Chavez',
  consultExplained: undefined
}
ğŸ“Š [CANONICAL] State before routing: {
  tattooSummary: 'lion with roses',
  tattooPlacement: 'shoulder',
  tattooSize: null,
  timeline: null,
  consultationType: null,
  depositPaid: false,
  derivedPhase: 'discovery'
}
ğŸ¯ [INTENTS] Detected intents: [ 'slot_selection_intent' ] from message: Letâ€™s do 8pm
ğŸ”„ [SLOT RECOVERY] lastSentSlots empty but timesSent=true, fetching from GHL...
ğŸ“‹ [SLOT RECOVERY] Contact has 4 custom fields. Looking for slot data...
âš ï¸ [SLOT RECOVERY] No slots found in GHL contact. Will regenerate fresh slots.
ğŸ“… [SLOTS] Fetching real GHL slots from 2025-12-16T00:00:00.000Z to 2025-12-23T23:59:59.999Z
âœ… [GHL CALENDAR] Found 12 free slots for calendar 2EJcAtrllnYOtuSx4Dua between 2025-12-16T00:00:00.000Z and 2025-12-23T23:59:59.999Z
ğŸ“… [SLOTS] Returning 4 real GHL slots
âœ… [SLOT RECOVERY] Generated 4 fresh slots to match against
âœ… Matched time 8pm â†’ slot 1
ğŸ§­ [PHASE] derived_phase snapshot {
  derived_phase: 'discovery',
  canonical: {
    tattooSummary: 'lion with roses',
    tattooPlacement: 'shoulder',
    tattooSize: null,
    timeline: null,
    consultationType: null,
    consultationTypeLocked: false,
    depositLinkSent: false,
    depositPaid: false,
    holdAppointmentId: null
  },
  intents: {
    reschedule_intent: false,
    cancel_intent: false,
    scheduling_intent: false,
    slot_selection_intent: true,
    deposit_intent: false,
    consult_path_choice_intent: false,
    artist_guided_size_intent: false,
    process_or_price_question_intent: false,
    translator_affirm_intent: false
  },
  selected_handler: 'deterministic',
  routing_reason: 'slot_selection',
  intent_flags: [ 'slot_selection_intent' ]
}
â±ï¸ [TIMING] Total handleInboundMessage took 644ms
ğŸ¤– AI Response Summary: {
  bubblesCount: 1,
  phase: 'discovery',
  handler: 'deterministic',
  reason: 'slot_selection',
  fieldUpdatesKeys: []
}
ğŸ“¡ Channel context: { isDm: true, hasPhone: false, conversationId: null, phone: null }
âœ‰ï¸ sendConversationMessage context: { contactId: 'OdDJ3aIPJxRCt63ViawC', isDm: true, hasPhone: false }
ğŸ” No conversationId provided for DM, searching for existing conversation...
âœ… Found existing conversation 5tO6jUJu8HtRkLo8zvN5 with type FB
âœ… Using conversation type FB from GHL conversation - skipping ID validation
ğŸ“¨ Sending DM reply via GHL: {
  conversationId: '5tO6jUJu8HtRkLo8zvN5',
  contactId: 'OdDJ3aIPJxRCt63ViawC',
  message: 'I can hold a spotâ€”what day(s) this week and what time window works best (morning / afternoon / evening)?',
  type: 'FB'
}
ğŸ“¨ GHL DM reply response: {
  status: 201,
  contactId: 'OdDJ3aIPJxRCt63ViawC',
  conversationId: '5tO6jUJu8HtRkLo8zvN5'
}
ğŸ“¤ Sent 1/1 bubbles to GHL conversation
â„¹ï¸ No field_updates from AI to persist this turn
ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’¬ GHL MESSAGE WEBHOOK HIT
ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“¦ Webhook Payload (non-empty fields): {
  "times_sent": "Yes",
  "First Tattoo": "No",
  "Tattoo Placement": "shoulder",
  "Tattoo Summary": "lion with roses",
  "contact_id": "OdDJ3aIPJxRCt63ViawC",
  "first_name": "Leonel",
  "last_name": "Chavez",
  "full_name": "Leonel Chavez",
  "tags": "dm consultation request",
  "country": "US",
  "date_created": "2025-12-16T00:29:54.300Z",
  "contact_type": "lead",
  "location": {
    "name": "Studio AZ Tattoo",
    "address": "333 Washington Ave N STE 100",
    "city": "Minneapolis",
    "state": "Minnesota",
    "country": "US",
    "postalCode": "55401",
    "fullAddress": "333 Washington Ave N STE 100, Minneapolis Minnesota 55401",
    "id": "mUemx2jG4wly4kJWBkI4"
  },
  "message": {
    "type": 11,
    "body": "Tuesday evening"
  },
  "workflow": {
    "id": "8cf237bb-6cb1-4240-8ca5-b797bba8b769",
    "name": "Testing Ai Bot"
  },
  "contact": {
    "attributionSource": {
      "photoUrl": null,
      "sessionSource": "Social media",
      "adId": null,
      "productId": null,
      "videoUrl": null,
      "mediumId": "9747144365336642",
      "utmContent": null,
      "pSid": "9747144365336642",
      "medium": "facebook",
      "postId": null,
      "flowId": null
    },
    "lastAttributionSource": {
      "photoUrl": null,
      "sessionSource": "Social media",
      "adId": null,
      "productId": null,
      "videoUrl": null,
      "mediumId": "9747144365336642",
      "utmContent": null,
      "pSid": "9747144365336642",
      "medium": "facebook",
      "postId": null,
      "flowId": null
    }
  },
  "customData": {
    "contactId": "OdDJ3aIPJxRCt63ViawC",
    "messageBody": "Tuesday evening"
  }
}
ğŸ“© Incoming message text: Tuesday evening
ğŸ‘¤ Contact ID: OdDJ3aIPJxRCt63ViawC
ğŸ“‹ Webhook custom fields extracted: {
  "times_sent": "Yes",
  "first_tattoo": "No",
  "tattoo_placement": "shoulder",
  "tattoo_summary": "lion with roses"
}
ğŸ‘¤ Contact: Leonel Chavez
ğŸ“‹ Contact custom fields (merged): {
  "fnydobmyqnxdxlljy5oe": "No",
  "jd8yhvksbi4agqjqoeov": "shoulder",
  "xagtmfmbxtfchdo2oyf7": "lion with roses",
  "eah8fdi5pwfxsqqfd45a": "Yes",
  "times_sent": "Yes",
  "first_tattoo": "No",
  "tattoo_placement": "shoulder",
  "tattoo_summary": "lion with roses"
}
ğŸ§  [AI CONTEXT] Processing message: {
  messageText: 'Tuesday evening',
  contactId: 'OdDJ3aIPJxRCt63ViawC',
  contactName: 'Leonel Chavez',
  consultExplained: undefined
}
ğŸ“Š [CANONICAL] State before routing: {
  tattooSummary: 'lion with roses',
  tattooPlacement: 'shoulder',
  tattooSize: null,
  timeline: null,
  consultationType: null,
  depositPaid: false,
  derivedPhase: 'discovery'
}
ğŸ¯ [INTENTS] Detected intents: [ 'slot_selection_intent' ] from message: Tuesday evening
ğŸ”„ [SLOT RECOVERY] lastSentSlots empty but timesSent=true, fetching from GHL...
ğŸ“‹ [SLOT RECOVERY] Contact has 4 custom fields. Looking for slot data...
âš ï¸ [SLOT RECOVERY] No slots found in GHL contact. Will regenerate fresh slots.
ğŸ“… [SLOTS] Fetching real GHL slots from 2025-12-16T00:00:00.000Z to 2025-12-23T23:59:59.999Z
âœ… [GHL CALENDAR] Found 12 free slots for calendar 2EJcAtrllnYOtuSx4Dua between 2025-12-16T00:00:00.000Z and 2025-12-23T23:59:59.999Z
ğŸ“… [SLOTS] Filtered to tuesday: 12 slots
ğŸ“… [SLOTS] Filtered to evening: 6 slots
ğŸ“… [SLOTS] Returning 4 real GHL slots
âœ… [SLOT RECOVERY] Generated 4 fresh slots to match against
âœ… Matched day name with time: tuesday â†’ slot 1
ğŸ§­ [PHASE] derived_phase snapshot {
  derived_phase: 'discovery',
  canonical: {
    tattooSummary: 'lion with roses',
    tattooPlacement: 'shoulder',
    tattooSize: null,
    timeline: null,
    consultationType: null,
    consultationTypeLocked: false,
    depositLinkSent: false,
    depositPaid: false,
    holdAppointmentId: null
  },
  intents: {
    reschedule_intent: false,
    cancel_intent: false,
    scheduling_intent: false,
    slot_selection_intent: true,
    deposit_intent: false,
    consult_path_choice_intent: false,
    artist_guided_size_intent: false,
    process_or_price_question_intent: false,
    translator_affirm_intent: false
  },
  selected_handler: 'deterministic',
  routing_reason: 'slot_selection',
  intent_flags: [ 'slot_selection_intent' ]
}
â±ï¸ [TIMING] Total handleInboundMessage took 596ms
ğŸ¤– AI Response Summary: {
  bubblesCount: 1,
  phase: 'discovery',
  handler: 'deterministic',
  reason: 'slot_selection',
  fieldUpdatesKeys: []
}
ğŸ“¡ Channel context: { isDm: true, hasPhone: false, conversationId: null, phone: null }
âœ‰ï¸ sendConversationMessage context: { contactId: 'OdDJ3aIPJxRCt63ViawC', isDm: true, hasPhone: false }
ğŸ” No conversationId provided for DM, searching for existing conversation...
âœ… Found existing conversation 5tO6jUJu8HtRkLo8zvN5 with type FB
âœ… Using conversation type FB from GHL conversation - skipping ID validation
ğŸ“¨ Sending DM reply via GHL: {
  conversationId: '5tO6jUJu8HtRkLo8zvN5',
  contactId: 'OdDJ3aIPJxRCt63ViawC',
  message: 'I can hold a spotâ€”what day(s) this week and what time window works best (morning / afternoon / evening)?',
  type: 'FB'
}
ğŸ“¨ GHL DM reply response: {
  status: 201,
  contactId: 'OdDJ3aIPJxRCt63ViawC',
  conversationId: '5tO6jUJu8HtRkLo8zvN5'
}
ğŸ“¤ Sent 1/1 bubbles to GHL conversation
â„¹ï¸ No field_updates from AI to persist this turn
ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•