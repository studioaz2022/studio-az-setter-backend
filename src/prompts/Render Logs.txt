ğŸ’¬ GHL MESSAGE WEBHOOK HIT
ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“¦ Webhook Payload (non-empty fields): {
  "contact_id": "2hmCxUngp0dlFq2IovW8",
  "first_name": "Leonel",
  "last_name": "Chavez",
  "full_name": "Leonel Chavez",
  "tags": "dm consultation request",
  "date_created": "2025-12-16T01:04:47.559Z",
  "contact_type": "lead",
  "location": {
    "name": "Studio AZ Tattoo",
    "address": "333 Washington Ave N STE 100",
    "city": "Minneapolis",
    "state": "Minnesota",
    "country": "US",
    "postalCode": "55401",
    "fullAddress": "333 Washington Ave N STE 100, Minneapolis Minnesota 55401",
    "id": "mUemx2jG4wly4kJWBkI4"
  },
  "message": {
    "type": 11,
    "body": "How can I make an appt for a tattoo?"
  },
  "workflow": {
    "id": "8cf237bb-6cb1-4240-8ca5-b797bba8b769",
    "name": "Testing Ai Bot"
  },
  "contact": {
    "attributionSource": {
      "photoUrl": null,
      "sessionSource": "Social media",
      "adId": null,
      "productId": null,
      "videoUrl": null,
      "mediumId": "9747144365336642",
      "utmContent": null,
      "pSid": "9747144365336642",
      "medium": "facebook",
      "postId": null,
      "flowId": null
    },
    "lastAttributionSource": {
      "photoUrl": null,
      "sessionSource": "Social media",
      "adId": null,
      "productId": null,
      "videoUrl": null,
      "mediumId": "9747144365336642",
      "utmContent": null,
      "pSid": "9747144365336642",
      "medium": "facebook",
      "postId": null,
      "flowId": null
    }
  },
  "customData": {
    "contactId": "2hmCxUngp0dlFq2IovW8",
    "messageBody": "How can I make an appt for a tattoo?"
  }
}
ğŸ“© Incoming message text: How can I make an appt for a tattoo?
ğŸ‘¤ Contact ID: 2hmCxUngp0dlFq2IovW8
ğŸ“‹ Webhook custom fields extracted: {}
ğŸ‘¤ Contact: Leonel Chavez
ğŸ“‹ Contact custom fields (merged): {}
ğŸ§  [AI CONTEXT] Processing message: {
  messageText: 'How can I make an appt for a tattoo?',
  contactId: '2hmCxUngp0dlFq2IovW8',
  contactName: 'Leonel Chavez',
  consultExplained: undefined
}
ğŸ“Š [CANONICAL] State before routing: {
  tattooSummary: null,
  tattooPlacement: null,
  tattooSize: null,
  timeline: null,
  consultationType: null,
  depositPaid: false,
  derivedPhase: 'intake'
}
ğŸ¯ [INTENTS] No specific intents detected for: How can I make an appt for a tattoo?
ğŸ¤– Raw OpenAI opener response: {
  "language": "en",
  "bubbles": [
    "Leonel, what kind of piece are you thinking?",
    "Where on your body were you wanting it?"
  ],
  "internal_notes": "Starting intake phase by gathering basic tattoo idea and placement.",
  "meta": {
    "aiPhase": "intake",
    "leadTemperature": "warm",
    "wantsDepositLink": false,
    "depositPushedThisTurn": false,
    "mentionDecoyOffered": false,
    "consultMode": "online"
  },
  "field_updates": {}
}
â±ï¸ [TIMING] AI call took 4670ms
ğŸ§­ [PHASE] derived_phase snapshot {
  derived_phase: 'intake',
  canonical: {
    tattooSummary: null,
    tattooPlacement: null,
    tattooSize: null,
    timeline: null,
    consultationType: null,
    consultationTypeLocked: false,
    depositLinkSent: false,
    depositPaid: false,
    holdAppointmentId: null
  },
  intents: {
    reschedule_intent: false,
    cancel_intent: false,
    scheduling_intent: false,
    slot_selection_intent: false,
    deposit_intent: false,
    consult_path_choice_intent: false,
    artist_guided_size_intent: false,
    process_or_price_question_intent: false,
    translator_affirm_intent: false
  },
  selected_handler: 'ai',
  routing_reason: 'ai_fallback',
  intent_flags: []
}
â±ï¸ [TIMING] Total handleInboundMessage took 4673ms
ğŸ¤– AI Response Summary: {
  bubblesCount: 2,
  phase: 'intake',
  handler: 'ai',
  reason: 'ai_fallback',
  fieldUpdatesKeys: []
}
ğŸ“¡ Channel context: { isDm: true, hasPhone: false, conversationId: null, phone: null }
âœ‰ï¸ sendConversationMessage context: { contactId: '2hmCxUngp0dlFq2IovW8', isDm: true, hasPhone: false }
ğŸ” No conversationId provided for DM, searching for existing conversation...
âœ… Found existing conversation rwknop8J4YpazXthsSUc with type FB
âœ… Using conversation type FB from GHL conversation - skipping ID validation
ğŸ“¨ Sending DM reply via GHL: {
  conversationId: 'rwknop8J4YpazXthsSUc',
  contactId: '2hmCxUngp0dlFq2IovW8',
  message: 'Leonel, what kind of piece are you thinking?',
  type: 'FB'
}
ğŸ“¨ GHL DM reply response: {
  status: 201,
  contactId: '2hmCxUngp0dlFq2IovW8',
  conversationId: 'rwknop8J4YpazXthsSUc'
}
âœ‰ï¸ sendConversationMessage context: { contactId: '2hmCxUngp0dlFq2IovW8', isDm: true, hasPhone: false }
ğŸ” No conversationId provided for DM, searching for existing conversation...
âœ… Found existing conversation rwknop8J4YpazXthsSUc with type FB
âœ… Using conversation type FB from GHL conversation - skipping ID validation
ğŸ“¨ Sending DM reply via GHL: {
  conversationId: 'rwknop8J4YpazXthsSUc',
  contactId: '2hmCxUngp0dlFq2IovW8',
  message: 'Where on your body were you wanting it?',
  type: 'FB'
}
ğŸ“¨ GHL DM reply response: {
  status: 201,
  contactId: '2hmCxUngp0dlFq2IovW8',
  conversationId: 'rwknop8J4YpazXthsSUc'
}
ğŸ“¤ Sent 2/2 bubbles to GHL conversation
â„¹ï¸ No field_updates from AI to persist this turn
ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’¬ GHL MESSAGE WEBHOOK HIT
ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“¦ Webhook Payload (non-empty fields): {
  "contact_id": "2hmCxUngp0dlFq2IovW8",
  "first_name": "Leonel",
  "last_name": "Chavez",
  "full_name": "Leonel Chavez",
  "tags": "dm consultation request",
  "date_created": "2025-12-16T01:04:47.559Z",
  "contact_type": "lead",
  "location": {
    "name": "Studio AZ Tattoo",
    "address": "333 Washington Ave N STE 100",
    "city": "Minneapolis",
    "state": "Minnesota",
    "country": "US",
    "postalCode": "55401",
    "fullAddress": "333 Washington Ave N STE 100, Minneapolis Minnesota 55401",
    "id": "mUemx2jG4wly4kJWBkI4"
  },
  "message": {
    "type": 11,
    "body": "Im hoping for a lion with roses around it on my shoulder"
  },
  "workflow": {
    "id": "8cf237bb-6cb1-4240-8ca5-b797bba8b769",
    "name": "Testing Ai Bot"
  },
  "contact": {
    "attributionSource": {
      "photoUrl": null,
      "sessionSource": "Social media",
      "adId": null,
      "productId": null,
      "videoUrl": null,
      "mediumId": "9747144365336642",
      "utmContent": null,
      "pSid": "9747144365336642",
      "medium": "facebook",
      "postId": null,
      "flowId": null
    },
    "lastAttributionSource": {
      "photoUrl": null,
      "sessionSource": "Social media",
      "adId": null,
      "productId": null,
      "videoUrl": null,
      "mediumId": "9747144365336642",
      "utmContent": null,
      "pSid": "9747144365336642",
      "medium": "facebook",
      "postId": null,
      "flowId": null
    }
  },
  "customData": {
    "contactId": "2hmCxUngp0dlFq2IovW8",
    "messageBody": "Im hoping for a lion with roses around it on my shoulder"
  }
}
ğŸ“© Incoming message text: Im hoping for a lion with roses around it on my shoulder
ğŸ‘¤ Contact ID: 2hmCxUngp0dlFq2IovW8
ğŸ“‹ Webhook custom fields extracted: {}
ğŸ‘¤ Contact: Leonel Chavez
ğŸ“‹ Contact custom fields (merged): {}
ğŸ§  [AI CONTEXT] Processing message: {
  messageText: 'Im hoping for a lion with roses around it on my shoulder',
  contactId: '2hmCxUngp0dlFq2IovW8',
  contactName: 'Leonel Chavez',
  consultExplained: undefined
}
ğŸ“Š [CANONICAL] State before routing: {
  tattooSummary: null,
  tattooPlacement: null,
  tattooSize: null,
  timeline: null,
  consultationType: null,
  depositPaid: false,
  derivedPhase: 'intake'
}
ğŸ¯ [INTENTS] No specific intents detected for: Im hoping for a lion with roses around it on my shoulder
ğŸ¤– Raw OpenAI opener response: {
  "language": "en",
  "bubbles": [
    "That lion with roses on your shoulder is gonna look fire.",
    "When were you thinking to get it done?"
  ],
  "internal_notes": "Acknowledged tattoo idea and placement, asked for timing to continue intake.",
  "meta": {
    "aiPhase": "intake",
    "leadTemperature": "warm",
    "wantsDepositLink": false,
    "depositPushedThisTurn": false,
    "mentionDecoyOffered": false,
    "consultMode": "online"
  },
  "field_updates": {
    "tattoo_placement": "shoulder",
    "tattoo_summary": "lion with roses",
    "first_tattoo": false
  }
}
â±ï¸ [TIMING] AI call took 3197ms
ğŸ§­ [PHASE] derived_phase snapshot {
  derived_phase: 'discovery',
  canonical: {
    tattooSummary: 'lion with roses',
    tattooPlacement: 'shoulder',
    tattooSize: null,
    timeline: null,
    consultationType: null,
    consultationTypeLocked: false,
    depositLinkSent: false,
    depositPaid: false,
    holdAppointmentId: null
  },
  intents: {
    reschedule_intent: false,
    cancel_intent: false,
    scheduling_intent: false,
    slot_selection_intent: false,
    deposit_intent: false,
    consult_path_choice_intent: false,
    artist_guided_size_intent: false,
    process_or_price_question_intent: false,
    translator_affirm_intent: false
  },
  selected_handler: 'ai',
  routing_reason: 'ai_fallback',
  intent_flags: []
}
â±ï¸ [TIMING] Total handleInboundMessage took 3395ms
ğŸ¤– AI Response Summary: {
  bubblesCount: 2,
  phase: 'discovery',
  handler: 'ai',
  reason: 'ai_fallback',
  fieldUpdatesKeys: [ 'tattoo_placement', 'tattoo_summary', 'first_tattoo' ]
}
ğŸ“¡ Channel context: { isDm: true, hasPhone: false, conversationId: null, phone: null }
âœ‰ï¸ sendConversationMessage context: { contactId: '2hmCxUngp0dlFq2IovW8', isDm: true, hasPhone: false }
ğŸ” No conversationId provided for DM, searching for existing conversation...
âœ… Found existing conversation rwknop8J4YpazXthsSUc with type FB
âœ… Using conversation type FB from GHL conversation - skipping ID validation
ğŸ“¨ Sending DM reply via GHL: {
  conversationId: 'rwknop8J4YpazXthsSUc',
  contactId: '2hmCxUngp0dlFq2IovW8',
  message: 'That lion with roses on your shoulder is gonna look fire.',
  type: 'FB'
}
ğŸ“¨ GHL DM reply response: {
  status: 201,
  contactId: '2hmCxUngp0dlFq2IovW8',
  conversationId: 'rwknop8J4YpazXthsSUc'
}
âœ‰ï¸ sendConversationMessage context: { contactId: '2hmCxUngp0dlFq2IovW8', isDm: true, hasPhone: false }
ğŸ” No conversationId provided for DM, searching for existing conversation...
âœ… Found existing conversation rwknop8J4YpazXthsSUc with type FB
âœ… Using conversation type FB from GHL conversation - skipping ID validation
ğŸ“¨ Sending DM reply via GHL: {
  conversationId: 'rwknop8J4YpazXthsSUc',
  contactId: '2hmCxUngp0dlFq2IovW8',
  message: 'When were you thinking to get it done?',
  type: 'FB'
}
ğŸ“¨ GHL DM reply response: {
  status: 201,
  contactId: '2hmCxUngp0dlFq2IovW8',
  conversationId: 'rwknop8J4YpazXthsSUc'
}
ğŸ“¤ Sent 2/2 bubbles to GHL conversation
âœ… Updated tattoo fields for contact 2hmCxUngp0dlFq2IovW8 with {
  tattoo_placement: 'shoulder',
  tattoo_summary: 'lion with roses',
  first_tattoo: 'No'
}
âœ… Persisted field_updates: [ 'tattoo_placement', 'tattoo_summary', 'first_tattoo' ]
ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’¬ GHL MESSAGE WEBHOOK HIT
ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“¦ Webhook Payload (non-empty fields): {
  "First Tattoo": "No",
  "Tattoo Placement": "shoulder",
  "Tattoo Summary": "lion with roses",
  "contact_id": "2hmCxUngp0dlFq2IovW8",
  "first_name": "Leonel",
  "last_name": "Chavez",
  "full_name": "Leonel Chavez",
  "tags": "dm consultation request",
  "country": "US",
  "date_created": "2025-12-16T01:04:47.559Z",
  "contact_type": "lead",
  "location": {
    "name": "Studio AZ Tattoo",
    "address": "333 Washington Ave N STE 100",
    "city": "Minneapolis",
    "state": "Minnesota",
    "country": "US",
    "postalCode": "55401",
    "fullAddress": "333 Washington Ave N STE 100, Minneapolis Minnesota 55401",
    "id": "mUemx2jG4wly4kJWBkI4"
  },
  "message": {
    "type": 11,
    "body": "Sometime in January"
  },
  "workflow": {
    "id": "8cf237bb-6cb1-4240-8ca5-b797bba8b769",
    "name": "Testing Ai Bot"
  },
  "contact": {
    "attributionSource": {
      "photoUrl": null,
      "sessionSource": "Social media",
      "adId": null,
      "productId": null,
      "videoUrl": null,
      "mediumId": "9747144365336642",
      "utmContent": null,
      "pSid": "9747144365336642",
      "medium": "facebook",
      "postId": null,
      "flowId": null
    },
    "lastAttributionSource": {
      "photoUrl": null,
      "sessionSource": "Social media",
      "adId": null,
      "productId": null,
      "videoUrl": null,
      "mediumId": "9747144365336642",
      "utmContent": null,
      "pSid": "9747144365336642",
      "medium": "facebook",
      "postId": null,
      "flowId": null
    }
  },
  "customData": {
    "contactId": "2hmCxUngp0dlFq2IovW8",
    "messageBody": "Sometime in January"
  }
}
ğŸ“© Incoming message text: Sometime in January
ğŸ‘¤ Contact ID: 2hmCxUngp0dlFq2IovW8
ğŸ“‹ Webhook custom fields extracted: {
  "first_tattoo": "No",
  "tattoo_placement": "shoulder",
  "tattoo_summary": "lion with roses"
}
ğŸ‘¤ Contact: Leonel Chavez
ğŸ“‹ Contact custom fields (merged): {
  "fnydobmyqnxdxlljy5oe": "No",
  "jd8yhvksbi4agqjqoeov": "shoulder",
  "xagtmfmbxtfchdo2oyf7": "lion with roses",
  "first_tattoo": "No",
  "tattoo_placement": "shoulder",
  "tattoo_summary": "lion with roses"
}
ğŸ§  [AI CONTEXT] Processing message: {
  messageText: 'Sometime in January',
  contactId: '2hmCxUngp0dlFq2IovW8',
  contactName: 'Leonel Chavez',
  consultExplained: undefined
}
ğŸ“Š [CANONICAL] State before routing: {
  tattooSummary: 'lion with roses',
  tattooPlacement: 'shoulder',
  tattooSize: null,
  timeline: null,
  consultationType: null,
  depositPaid: false,
  derivedPhase: 'discovery'
}
ğŸ¯ [INTENTS] No specific intents detected for: Sometime in January
ğŸ¤– Raw OpenAI opener response: {
  "language": "en",
  "bubbles": [
    "Got it â€” that lion with roses on your shoulder in January is a solid plan.",
    "Perfect, we can make that work. The next step is a quick 15â€“20 minute consultation with the artist to fully understand your design.",
    "Would you prefer a video call or to go back and forth in messages for the consult?"
  ],
  "internal_notes": "Acknowledged tattoo idea and timeline, introduced consult and asked for preferred consult mode.",
  "meta": {
    "aiPhase": "qualification",
    "leadTemperature": "warm",
    "wantsDepositLink": false,
    "depositPushedThisTurn": false,
    "mentionDecoyOffered": false,
    "consultMode": "online"
  },
  "field_updates": {
    "how_soon_is_client_deciding": "January",
    "tattoo_summary": "lion with roses",
    "tattoo_placement": "shoulder",
    "first_tattoo": false
  }
}
â±ï¸ [TIMING] AI call took 4024ms
ğŸ§­ [PHASE] derived_phase snapshot {
  derived_phase: 'consult_path',
  canonical: {
    tattooSummary: 'lion with roses',
    tattooPlacement: 'shoulder',
    tattooSize: null,
    timeline: 'January',
    consultationType: null,
    consultationTypeLocked: false,
    depositLinkSent: false,
    depositPaid: false,
    holdAppointmentId: null
  },
  intents: {
    reschedule_intent: false,
    cancel_intent: false,
    scheduling_intent: false,
    slot_selection_intent: false,
    deposit_intent: false,
    consult_path_choice_intent: false,
    artist_guided_size_intent: false,
    process_or_price_question_intent: false,
    translator_affirm_intent: false
  },
  selected_handler: 'ai',
  routing_reason: 'ai_fallback',
  intent_flags: []
}
â±ï¸ [TIMING] Total handleInboundMessage took 4210ms
ğŸ¤– AI Response Summary: {
  bubblesCount: 3,
  phase: 'consult_path',
  handler: 'ai',
  reason: 'ai_fallback',
  fieldUpdatesKeys: [
    'how_soon_is_client_deciding',
    'tattoo_summary',
    'tattoo_placement',
    'first_tattoo'
  ]
}
ğŸ“¡ Channel context: { isDm: true, hasPhone: false, conversationId: null, phone: null }
âœ‰ï¸ sendConversationMessage context: { contactId: '2hmCxUngp0dlFq2IovW8', isDm: true, hasPhone: false }
ğŸ” No conversationId provided for DM, searching for existing conversation...
âœ… Found existing conversation rwknop8J4YpazXthsSUc with type FB
âœ… Using conversation type FB from GHL conversation - skipping ID validation
ğŸ“¨ Sending DM reply via GHL: {
  conversationId: 'rwknop8J4YpazXthsSUc',
  contactId: '2hmCxUngp0dlFq2IovW8',
  message: 'Got it â€” that lion with roses on your shoulder in January is a solid plan.',
  type: 'FB'
}
ğŸ“¨ GHL DM reply response: {
  status: 201,
  contactId: '2hmCxUngp0dlFq2IovW8',
  conversationId: 'rwknop8J4YpazXthsSUc'
}
âœ‰ï¸ sendConversationMessage context: { contactId: '2hmCxUngp0dlFq2IovW8', isDm: true, hasPhone: false }
ğŸ” No conversationId provided for DM, searching for existing conversation...
âœ… Found existing conversation rwknop8J4YpazXthsSUc with type FB
âœ… Using conversation type FB from GHL conversation - skipping ID validation
ğŸ“¨ Sending DM reply via GHL: {
  conversationId: 'rwknop8J4YpazXthsSUc',
  contactId: '2hmCxUngp0dlFq2IovW8',
  message: 'Perfect, we can make that work. The next step is a quick 15â€“20 minute consultation with the artist to fully understand your design.',
  type: 'FB'
}
ğŸ“¨ GHL DM reply response: {
  status: 201,
  contactId: '2hmCxUngp0dlFq2IovW8',
  conversationId: 'rwknop8J4YpazXthsSUc'
}
âœ‰ï¸ sendConversationMessage context: { contactId: '2hmCxUngp0dlFq2IovW8', isDm: true, hasPhone: false }
ğŸ” No conversationId provided for DM, searching for existing conversation...
âœ… Found existing conversation rwknop8J4YpazXthsSUc with type FB
âœ… Using conversation type FB from GHL conversation - skipping ID validation
ğŸ“¨ Sending DM reply via GHL: {
  conversationId: 'rwknop8J4YpazXthsSUc',
  contactId: '2hmCxUngp0dlFq2IovW8',
  message: 'Would you prefer a video call or to go back and forth in messages for the consult?',
  type: 'FB'
}
ğŸ“¨ GHL DM reply response: {
  status: 201,
  contactId: '2hmCxUngp0dlFq2IovW8',
  conversationId: 'rwknop8J4YpazXthsSUc'
}
ğŸ“¤ Sent 3/3 bubbles to GHL conversation
âœ… Updated tattoo fields for contact 2hmCxUngp0dlFq2IovW8 with {
  how_soon_is_client_deciding: 'January',
  tattoo_summary: 'lion with roses',
  tattoo_placement: 'shoulder',
  first_tattoo: 'No'
}
âœ… Persisted field_updates: [
  'how_soon_is_client_deciding',
  'tattoo_summary',
  'tattoo_placement',
  'first_tattoo'
]
ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’¬ GHL MESSAGE WEBHOOK HIT
ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“¦ Webhook Payload (non-empty fields): {
  "First Tattoo": "No",
  "Tattoo Placement": "shoulder",
  "How Soon Is Client Deciding?": "January",
  "Tattoo Summary": "lion with roses",
  "contact_id": "2hmCxUngp0dlFq2IovW8",
  "first_name": "Leonel",
  "last_name": "Chavez",
  "full_name": "Leonel Chavez",
  "tags": "dm consultation request",
  "country": "US",
  "date_created": "2025-12-16T01:04:47.559Z",
  "contact_type": "lead",
  "location": {
    "name": "Studio AZ Tattoo",
    "address": "333 Washington Ave N STE 100",
    "city": "Minneapolis",
    "state": "Minnesota",
    "country": "US",
    "postalCode": "55401",
    "fullAddress": "333 Washington Ave N STE 100, Minneapolis Minnesota 55401",
    "id": "mUemx2jG4wly4kJWBkI4"
  },
  "message": {
    "type": 11,
    "body": "Ok. Iâ€™ll do a video call"
  },
  "workflow": {
    "id": "8cf237bb-6cb1-4240-8ca5-b797bba8b769",
    "name": "Testing Ai Bot"
  },
  "contact": {
    "attributionSource": {
      "photoUrl": null,
      "sessionSource": "Social media",
      "adId": null,
      "productId": null,
      "videoUrl": null,
      "mediumId": "9747144365336642",
      "utmContent": null,
      "pSid": "9747144365336642",
      "medium": "facebook",
      "postId": null,
      "flowId": null
    },
    "lastAttributionSource": {
      "photoUrl": null,
      "sessionSource": "Social media",
      "adId": null,
      "productId": null,
      "videoUrl": null,
      "mediumId": "9747144365336642",
      "utmContent": null,
      "pSid": "9747144365336642",
      "medium": "facebook",
      "postId": null,
      "flowId": null
    }
  },
  "customData": {
    "contactId": "2hmCxUngp0dlFq2IovW8",
    "messageBody": "Ok. Iâ€™ll do a video call"
  }
}
ğŸ“© Incoming message text: Ok. Iâ€™ll do a video call
ğŸ‘¤ Contact ID: 2hmCxUngp0dlFq2IovW8
ğŸ“‹ Webhook custom fields extracted: {
  "first_tattoo": "No",
  "tattoo_placement": "shoulder",
  "how_soon_is_client_deciding": "January",
  "tattoo_summary": "lion with roses"
}
ğŸ‘¤ Contact: Leonel Chavez
ğŸ“‹ Contact custom fields (merged): {
  "fnydobmyqnxdxlljy5oe": "No",
  "jd8yhvksbi4agqjqoeov": "shoulder",
  "xagtmfmbxtfchdo2oyf7": "lion with roses",
  "ra4nk80wma8eqklcfxst": "January",
  "first_tattoo": "No",
  "tattoo_placement": "shoulder",
  "how_soon_is_client_deciding": "January",
  "tattoo_summary": "lion with roses"
}
ğŸ§  [AI CONTEXT] Processing message: {
  messageText: 'Ok. Iâ€™ll do a video call',
  contactId: '2hmCxUngp0dlFq2IovW8',
  contactName: 'Leonel Chavez',
  consultExplained: undefined
}
ğŸ“Š [CANONICAL] State before routing: {
  tattooSummary: 'lion with roses',
  tattooPlacement: 'shoulder',
  tattooSize: null,
  timeline: 'January',
  consultationType: null,
  depositPaid: false,
  derivedPhase: 'consult_path'
}
ğŸ¯ [INTENTS] Detected intents: [ 'consult_path_choice_intent' ] from message: Ok. Iâ€™ll do a video call
ğŸ“ [CONSULTATION_TYPE] Setting consultation_type="appointment" (translator needed) for contact 2hmCxUngp0dlFq2IovW8 (detected from: "Ok. Iâ€™ll do a video call")
âœ‰ï¸ sendConversationMessage context: { contactId: '2hmCxUngp0dlFq2IovW8', isDm: false, hasPhone: false }
ğŸ“¨ GHL conversations API response (fallback): { status: 201, contactId: '2hmCxUngp0dlFq2IovW8', type: 'FB' }
ğŸ“ [CONSULTATION_TYPE] Sent translator explanation message directly
ğŸ”„ [PIPELINE] Syncing opportunity stage for contact 2hmCxUngp0dlFq2IovW8: {
  currentStage: '(none)',
  targetStage: 'CONSULT_APPOINTMENT',
  context: {
    aiPhase: 'consult_support',
    depositLinkSent: false,
    depositPaid: false,
    consultType: 'appointment',
    hasUpcomingTattoo: false,
    tattooCompleted: false,
    lost: false
  }
}
âŒ Error syncing opportunity stage after consult mode = appointment: Request failed with status code 422
âŒ Pipeline sync response (appointment consult): 422 {
  message: [ 'Query must not exceed 75 characters', 'query must be a string' ],
  error: 'Unprocessable Entity',
  statusCode: 422,
  traceId: 'f3167d30-a6e8-45b2-9411-33f4970c6cf7'
}
ğŸ§­ [PHASE] derived_phase snapshot {
  derived_phase: 'consult_path',
  canonical: {
    tattooSummary: 'lion with roses',
    tattooPlacement: 'shoulder',
    tattooSize: null,
    timeline: 'January',
    consultationType: null,
    consultationTypeLocked: false,
    depositLinkSent: false,
    depositPaid: false,
    holdAppointmentId: null
  },
  intents: {
    reschedule_intent: false,
    cancel_intent: false,
    scheduling_intent: false,
    slot_selection_intent: false,
    deposit_intent: false,
    consult_path_choice_intent: true,
    artist_guided_size_intent: false,
    process_or_price_question_intent: false,
    translator_affirm_intent: false
  },
  selected_handler: 'consult_path',
  routing_reason: 'consult_path_choice_intent',
  intent_flags: [ 'consult_path_choice_intent' ]
}
â±ï¸ [TIMING] Total handleInboundMessage took 1640ms
ğŸ¤– AI Response Summary: {
  bubblesCount: 0,
  phase: 'consult_path',
  handler: 'consult_path',
  reason: 'consult_path_choice_intent',
  fieldUpdatesKeys: []
}
ğŸ“¡ Channel context: { isDm: true, hasPhone: false, conversationId: null, phone: null }
ğŸ“¤ Sent 0/0 bubbles to GHL conversation
â„¹ï¸ No field_updates from AI to persist this turn
ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’¬ GHL MESSAGE WEBHOOK HIT
ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“¦ Webhook Payload (non-empty fields): {
  "First Tattoo": "No",
  "translator_explained": "Yes",
  "consultation_type": "appointment",
  "language_barrier_explained": "Yes",
  "Tattoo Placement": "shoulder",
  "translator_needed": "Yes",
  "How Soon Is Client Deciding?": "January",
  "Tattoo Summary": "lion with roses",
  "contact_id": "2hmCxUngp0dlFq2IovW8",
  "first_name": "Leonel",
  "last_name": "Chavez",
  "full_name": "Leonel Chavez",
  "tags": "dm consultation request",
  "country": "US",
  "date_created": "2025-12-16T01:04:47.559Z",
  "contact_type": "lead",
  "location": {
    "name": "Studio AZ Tattoo",
    "address": "333 Washington Ave N STE 100",
    "city": "Minneapolis",
    "state": "Minnesota",
    "country": "US",
    "postalCode": "55401",
    "fullAddress": "333 Washington Ave N STE 100, Minneapolis Minnesota 55401",
    "id": "mUemx2jG4wly4kJWBkI4"
  },
  "message": {
    "type": 11,
    "body": "Sure"
  },
  "workflow": {
    "id": "8cf237bb-6cb1-4240-8ca5-b797bba8b769",
    "name": "Testing Ai Bot"
  },
  "contact": {
    "attributionSource": {
      "photoUrl": null,
      "sessionSource": "Social media",
      "adId": null,
      "productId": null,
      "videoUrl": null,
      "mediumId": "9747144365336642",
      "utmContent": null,
      "pSid": "9747144365336642",
      "medium": "facebook",
      "postId": null,
      "flowId": null
    },
    "lastAttributionSource": {
      "photoUrl": null,
      "sessionSource": "Social media",
      "adId": null,
      "productId": null,
      "videoUrl": null,
      "mediumId": "9747144365336642",
      "utmContent": null,
      "pSid": "9747144365336642",
      "medium": "facebook",
      "postId": null,
      "flowId": null
    }
  },
  "customData": {
    "contactId": "2hmCxUngp0dlFq2IovW8",
    "messageBody": "Sure"
  }
}
ğŸ“© Incoming message text: Sure
ğŸ‘¤ Contact ID: 2hmCxUngp0dlFq2IovW8
ğŸ“‹ Webhook custom fields extracted: {
  "first_tattoo": "No",
  "translator_explained": "Yes",
  "consultation_type": "appointment",
  "tattoo_placement": "shoulder",
  "translator_needed": "Yes",
  "how_soon_is_client_deciding": "January",
  "tattoo_summary": "lion with roses"
}
ğŸ‘¤ Contact: Leonel Chavez
ğŸ“‹ Contact custom fields (merged): {
  "fnydobmyqnxdxlljy5oe": "No",
  "jd8yhvksbi4agqjqoeov": "shoulder",
  "xagtmfmbxtfchdo2oyf7": "lion with roses",
  "ra4nk80wma8eqklcfxst": "January",
  "myuihlqvwgjnrnmy1hzu": "Yes",
  "gm2pvo90ynbdhekv5g64": "appointment",
  "ikiju6c8apzchvhsyfwr": "Yes",
  "qvuq2wdv3drhbkhts6td": "Yes",
  "first_tattoo": "No",
  "translator_explained": "Yes",
  "consultation_type": "appointment",
  "tattoo_placement": "shoulder",
  "translator_needed": "Yes",
  "how_soon_is_client_deciding": "January",
  "tattoo_summary": "lion with roses"
}
ğŸ§  [AI CONTEXT] Processing message: {
  messageText: 'Sure',
  contactId: '2hmCxUngp0dlFq2IovW8',
  contactName: 'Leonel Chavez',
  consultExplained: undefined
}
ğŸ“Š [CANONICAL] State before routing: {
  tattooSummary: 'lion with roses',
  tattooPlacement: 'shoulder',
  tattooSize: null,
  timeline: 'January',
  consultationType: 'appointment',
  depositPaid: false,
  derivedPhase: 'discovery'
}
ğŸ¯ [INTENTS] Detected intents: [ 'scheduling_intent', 'translator_affirm_intent' ] from message: Sure
ğŸ“… [SLOT OFFER] Time preferences extracted: {
  preferredWeek: null,
  preferredDay: null,
  preferredTimeWindow: null,
  preferredMonth: null,
  preferredYear: null
}
ğŸ“… [SLOTS] Inputs {
  preferredWeek: null,
  preferredDay: null,
  preferredTimeWindow: null,
  preferredMonth: null,
  preferredYear: null,
  nowIso: '2025-12-16T01:06:38.892Z',
  tzOffsetMinutes: 0
}
ğŸ“… [SLOTS] Fetching real GHL slots from 2025-12-16T00:00:00.000Z to 2025-12-23T23:59:59.999Z
âœ… [GHL CALENDAR] Found 12 free slots for calendar 2EJcAtrllnYOtuSx4Dua between 2025-12-16T00:00:00.000Z and 2025-12-23T23:59:59.999Z
ğŸ“… [SLOTS] Returning 4 real GHL slots
ğŸ§¾ [SLOT PERSIST] Writing last_sent_slots {
  contactId: '2hmCxUngp0dlFq2IovW8',
  slotsCount: 4,
  bytes: 620,
  sha1: '03c217e22c68',
  preview: [
    {
      startTime: '2025-12-16T20:00:00.000Z',
      endTime: '2025-12-16T20:30:00.000Z',
      calendarId: '2EJcAtrllnYOtuSx4Dua',
      displayText: 'Tuesday, Dec 16 at 8pm'
    },
    {
      startTime: '2025-12-16T20:40:00.000Z',
      endTime: '2025-12-16T21:10:00.000Z',
      calendarId: '2EJcAtrllnYOtuSx4Dua',
      displayText: 'Tuesday, Dec 16 at 8:40pm'
    },
    {
      startTime: '2025-12-16T21:20:00.000Z',
      endTime: '2025-12-16T21:50:00.000Z',
      calendarId: '2EJcAtrllnYOtuSx4Dua',
      displayText: 'Tuesday, Dec 16 at 9:20pm'
    },
    {
      startTime: '2025-12-16T22:00:00.000Z',
      endTime: '2025-12-16T22:30:00.000Z',
      calendarId: '2EJcAtrllnYOtuSx4Dua',
      displayText: 'Tuesday, Dec 16 at 10pm'
    }
  ]
}
ğŸ§¾ [SLOT PERSIST] updateSystemFields result { contactId: '2hmCxUngp0dlFq2IovW8', ok: true }
âœ… [SLOT PERSIST] Saved 4 slots to GHL for contact 2hmCxUngp0dlFq2IovW8
ğŸ§­ [PHASE] derived_phase snapshot {
  derived_phase: 'discovery',
  canonical: {
    tattooSummary: 'lion with roses',
    tattooPlacement: 'shoulder',
    tattooSize: null,
    timeline: 'January',
    consultationType: 'appointment',
    consultationTypeLocked: false,
    depositLinkSent: false,
    depositPaid: false,
    holdAppointmentId: null
  },
  intents: {
    reschedule_intent: false,
    cancel_intent: false,
    scheduling_intent: true,
    slot_selection_intent: false,
    deposit_intent: false,
    consult_path_choice_intent: false,
    artist_guided_size_intent: false,
    process_or_price_question_intent: false,
    translator_affirm_intent: true
  },
  selected_handler: 'deterministic',
  routing_reason: 'scheduling_intent',
  intent_flags: [ 'scheduling_intent', 'translator_affirm_intent' ]
}
â±ï¸ [TIMING] Total handleInboundMessage took 992ms
ğŸ¤– AI Response Summary: {
  bubblesCount: 1,
  phase: 'discovery',
  handler: 'deterministic',
  reason: 'scheduling_intent',
  fieldUpdatesKeys: [ 'consult_explained' ]
}
ğŸ“¡ Channel context: { isDm: true, hasPhone: false, conversationId: null, phone: null }
âœ‰ï¸ sendConversationMessage context: { contactId: '2hmCxUngp0dlFq2IovW8', isDm: true, hasPhone: false }
ğŸ” No conversationId provided for DM, searching for existing conversation...
âœ… Found existing conversation rwknop8J4YpazXthsSUc with type FB
âœ… Using conversation type FB from GHL conversation - skipping ID validation
ğŸ“¨ Sending DM reply via GHL: {
  conversationId: 'rwknop8J4YpazXthsSUc',
  contactId: '2hmCxUngp0dlFq2IovW8',
  message: 'I pulled a few openings for a consult with an artist:\n' +
    '1) Tuesday, Dec 16 at 8pm\n' +
    '2) Tuesday, Dec 16 at 8:40pm\n' +
    '3) Tuesday, Dec 16 at 9:20pm\n' +
    '4) Tuesday, Dec 16 at 10pm\n' +
    '\n' +
    'Which works best?',
  type: 'FB'
}
ğŸ“¨ GHL DM reply response: {
  status: 201,
  contactId: '2hmCxUngp0dlFq2IovW8',
  conversationId: 'rwknop8J4YpazXthsSUc'
}
ğŸ“¤ Sent 1/1 bubbles to GHL conversation
updateTattooFields: no mapped fields to update for contact 2hmCxUngp0dlFq2IovW8
âœ… Persisted field_updates: [ 'consult_explained' ]
ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’¬ GHL MESSAGE WEBHOOK HIT
ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“¦ Webhook Payload (non-empty fields): {
  "last_sent_slots": "[{\"startTime\":\"2025-12-16T20:00:00.000Z\",\"endTime\":\"2025-12-16T20:30:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Dec 16 at 8pm\"},{\"startTime\":\"2025-12-16T20:40:00.000Z\",\"endTime\":\"2025-12-16T21:10:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Dec 16 at 8:40pm\"},{\"startTime\":\"2025-12-16T21:20:00.000Z\",\"endTime\":\"2025-12-16T21:50:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Dec 16 at 9:20pm\"},{\"startTime\":\"2025-12-16T22:00:00.000Z\",\"endTime\":\"2025-12-16T22:30:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Dec 16 at 10pm\"}]",
  "times_sent": "Yes",
  "First Tattoo": "No",
  "translator_explained": "Yes",
  "translator_confirmed": "Yes",
  "consultation_type": "appointment",
  "language_barrier_explained": "Yes",
  "Tattoo Placement": "shoulder",
  "translator_needed": "Yes",
  "How Soon Is Client Deciding?": "January",
  "Tattoo Summary": "lion with roses",
  "contact_id": "2hmCxUngp0dlFq2IovW8",
  "first_name": "Leonel",
  "last_name": "Chavez",
  "full_name": "Leonel Chavez",
  "tags": "dm consultation request",
  "country": "US",
  "date_created": "2025-12-16T01:04:47.559Z",
  "contact_type": "lead",
  "location": {
    "name": "Studio AZ Tattoo",
    "address": "333 Washington Ave N STE 100",
    "city": "Minneapolis",
    "state": "Minnesota",
    "country": "US",
    "postalCode": "55401",
    "fullAddress": "333 Washington Ave N STE 100, Minneapolis Minnesota 55401",
    "id": "mUemx2jG4wly4kJWBkI4"
  },
  "message": {
    "type": 11,
    "body": "8pm does"
  },
  "workflow": {
    "id": "8cf237bb-6cb1-4240-8ca5-b797bba8b769",
    "name": "Testing Ai Bot"
  },
  "contact": {
    "attributionSource": {
      "photoUrl": null,
      "sessionSource": "Social media",
      "adId": null,
      "productId": null,
      "videoUrl": null,
      "mediumId": "9747144365336642",
      "utmContent": null,
      "pSid": "9747144365336642",
      "medium": "facebook",
      "postId": null,
      "flowId": null
    },
    "lastAttributionSource": {
      "photoUrl": null,
      "sessionSource": "Social media",
      "adId": null,
      "productId": null,
      "videoUrl": null,
      "mediumId": "9747144365336642",
      "utmContent": null,
      "pSid": "9747144365336642",
      "medium": "facebook",
      "postId": null,
      "flowId": null
    }
  },
  "customData": {
    "contactId": "2hmCxUngp0dlFq2IovW8",
    "messageBody": "8pm does"
  }
}
ğŸ“© Incoming message text: 8pm does
ğŸ‘¤ Contact ID: 2hmCxUngp0dlFq2IovW8
ğŸ“‹ Webhook custom fields extracted: {
  "last_sent_slots": "[{\"startTime\":\"2025-12-16T20:00:00.000Z\",\"endTime\":\"2025-12-16T20:30:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Dec 16 at 8pm\"},{\"startTime\":\"2025-12-16T20:40:00.000Z\",\"endTime\":\"2025-12-16T21:10:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Dec 16 at 8:40pm\"},{\"startTime\":\"2025-12-16T21:20:00.000Z\",\"endTime\":\"2025-12-16T21:50:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Dec 16 at 9:20pm\"},{\"startTime\":\"2025-12-16T22:00:00.000Z\",\"endTime\":\"2025-12-16T22:30:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Dec 16 at 10pm\"}]",
  "times_sent": "Yes",
  "first_tattoo": "No",
  "translator_explained": "Yes",
  "translator_confirmed": "Yes",
  "consultation_type": "appointment",
  "tattoo_placement": "shoulder",
  "translator_needed": "Yes",
  "how_soon_is_client_deciding": "January",
  "tattoo_summary": "lion with roses"
}
ğŸ‘¤ Contact: Leonel Chavez
ğŸ“‹ Contact custom fields (merged): {
  "fnydobmyqnxdxlljy5oe": "No",
  "jd8yhvksbi4agqjqoeov": "shoulder",
  "xagtmfmbxtfchdo2oyf7": "lion with roses",
  "ra4nk80wma8eqklcfxst": "January",
  "myuihlqvwgjnrnmy1hzu": "Yes",
  "gm2pvo90ynbdhekv5g64": "appointment",
  "ikiju6c8apzchvhsyfwr": "Yes",
  "qvuq2wdv3drhbkhts6td": "Yes",
  "whwh3aco0mzavhb0vizw": "Yes",
  "a832mlwirz5cv6xaktna": "[{\"startTime\":\"2025-12-16T20:00:00.000Z\",\"endTime\":\"2025-12-16T20:30:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Dec 16 at 8pm\"},{\"startTime\":\"2025-12-16T20:40:00.000Z\",\"endTime\":\"2025-12-16T21:10:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Dec 16 at 8:40pm\"},{\"startTime\":\"2025-12-16T21:20:00.000Z\",\"endTime\":\"2025-12-16T21:50:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Dec 16 at 9:20pm\"},{\"startTime\":\"2025-12-16T22:00:00.000Z\",\"endTime\":\"2025-12-16T22:30:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Dec 16 at 10pm\"}]",
  "eah8fdi5pwfxsqqfd45a": "Yes",
  "last_sent_slots": "[{\"startTime\":\"2025-12-16T20:00:00.000Z\",\"endTime\":\"2025-12-16T20:30:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Dec 16 at 8pm\"},{\"startTime\":\"2025-12-16T20:40:00.000Z\",\"endTime\":\"2025-12-16T21:10:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Dec 16 at 8:40pm\"},{\"startTime\":\"2025-12-16T21:20:00.000Z\",\"endTime\":\"2025-12-16T21:50:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Dec 16 at 9:20pm\"},{\"startTime\":\"2025-12-16T22:00:00.000Z\",\"endTime\":\"2025-12-16T22:30:00.000Z\",\"calendarId\":\"2EJcAtrllnYOtuSx4Dua\",\"displayText\":\"Tuesday, Dec 16 at 10pm\"}]",
  "times_sent": "Yes",
  "first_tattoo": "No",
  "translator_explained": "Yes",
  "translator_confirmed": "Yes",
  "consultation_type": "appointment",
  "tattoo_placement": "shoulder",
  "translator_needed": "Yes",
  "how_soon_is_client_deciding": "January",
  "tattoo_summary": "lion with roses"
}
ğŸ§  [AI CONTEXT] Processing message: {
  messageText: '8pm does',
  contactId: '2hmCxUngp0dlFq2IovW8',
  contactName: 'Leonel Chavez',
  consultExplained: undefined
}
ğŸ“Š [CANONICAL] State before routing: {
  tattooSummary: 'lion with roses',
  tattooPlacement: 'shoulder',
  tattooSize: null,
  timeline: 'January',
  consultationType: 'appointment',
  depositPaid: false,
  derivedPhase: 'scheduling'
}
ğŸ¯ [INTENTS] Detected intents: [ 'slot_selection_intent' ] from message: 8pm does
âœ… Matched time 8pm â†’ slot 1
ğŸ§­ [SLOT CHOICE] parseTimeSelection -> 0 number chosenSlot 2025-12-16T20:00:00.000Z
âš ï¸ Failed to create Google Meet (continuing without link): Missing Google OAuth credentials (client id/secret/refresh token)
âŒ Error creating appointment: {
  message: 'The user id not part of calendar team.',
  error: 'Unprocessable Entity',
  statusCode: 422,
  traceId: '759a21b5-ab83-4bae-8047-ee45ae395d11'
}
âŒ Error creating consult appointment: Request failed with status code 422
âŒ Deterministic slot selection failed: Request failed with status code 422
ğŸ§­ [PHASE] derived_phase snapshot {
  derived_phase: 'scheduling',
  canonical: {
    tattooSummary: 'lion with roses',
    tattooPlacement: 'shoulder',
    tattooSize: null,
    timeline: 'January',
    consultationType: 'appointment',
    consultationTypeLocked: false,
    depositLinkSent: false,
    depositPaid: false,
    holdAppointmentId: null
  },
  intents: {
    reschedule_intent: false,
    cancel_intent: false,
    scheduling_intent: false,
    slot_selection_intent: true,
    deposit_intent: false,
    consult_path_choice_intent: false,
    artist_guided_size_intent: false,
    process_or_price_question_intent: false,
    translator_affirm_intent: false
  },
  selected_handler: 'deterministic',
  routing_reason: 'slot_selection',
  intent_flags: [ 'slot_selection_intent' ]
}
â±ï¸ [TIMING] Total handleInboundMessage took 568ms
ğŸ¤– AI Response Summary: {
  bubblesCount: 1,
  phase: 'scheduling',
  handler: 'deterministic',
  reason: 'slot_selection',
  fieldUpdatesKeys: [ 'consult_explained' ]
}
ğŸ“¡ Channel context: { isDm: true, hasPhone: false, conversationId: null, phone: null }
âœ‰ï¸ sendConversationMessage context: { contactId: '2hmCxUngp0dlFq2IovW8', isDm: true, hasPhone: false }
ğŸ” No conversationId provided for DM, searching for existing conversation...
âœ… Found existing conversation rwknop8J4YpazXthsSUc with type FB
âœ… Using conversation type FB from GHL conversation - skipping ID validation
ğŸ“¨ Sending DM reply via GHL: {
  conversationId: 'rwknop8J4YpazXthsSUc',
  contactId: '2hmCxUngp0dlFq2IovW8',
  message: 'I can hold a spotâ€”what day(s) this week and what time window works best (morning / afternoon / evening)?',
  type: 'FB'
}
ğŸ“¨ GHL DM reply response: {
  status: 201,
  contactId: '2hmCxUngp0dlFq2IovW8',
  conversationId: 'rwknop8J4YpazXthsSUc'
}
ğŸ“¤ Sent 1/1 bubbles to GHL conversation
updateTattooFields: no mapped fields to update for contact 2hmCxUngp0dlFq2IovW8
âœ… Persisted field_updates: [ 'consult_explained' ]
ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•