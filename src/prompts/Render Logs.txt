ğŸ’¬ GHL MESSAGE WEBHOOK HIT



ğŸ’¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•



ğŸ“¦ Webhook Payload (non-empty fields): {



  "contact_id": "Nc8DVLpAYkUMKpa8jSNs",



  "first_name": "Maria",



  "last_name": "Claflin",



  "full_name": "Maria Claflin",



  "tags": "dm consultation request",



  "date_created": "2025-12-19T01:26:09.545Z",



  "contact_type": "lead",



  "location": {



    "name": "Studio AZ Tattoo",



    "address": "333 Washington Ave N STE 100",



    "city": "Minneapolis",



    "state": "Minnesota",



    "country": "US",



    "postalCode": "55401",



    "fullAddress": "333 Washington Ave N STE 100, Minneapolis Minnesota 55401",



    "id": "mUemx2jG4wly4kJWBkI4"



  },



  "message": {



    "type": 11,



    "body": "Hi! How do I book a tattoo appointment?"



  },



  "workflow": {



    "id": "8cf237bb-6cb1-4240-8ca5-b797bba8b769",



    "name": "Testing Ai Bot"



  },



  "contact": {



    "attributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    },



    "lastAttributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    }



  },



  "customData": {



    "contactId": "Nc8DVLpAYkUMKpa8jSNs",



    "messageBody": "Hi! How do I book a tattoo appointment?"



  }



}



ğŸ“© Incoming message text: Hi! How do I book a tattoo appointment?



ğŸ‘¤ Contact ID: Nc8DVLpAYkUMKpa8jSNs



ğŸ“‹ Webhook custom fields extracted: {}



ğŸ‘¤ Contact: Maria Claflin



ğŸ“‹ Contact custom fields (merged): {}



ğŸ“¡ Channel context: {



  isDm: true,



  hasPhone: false,



  isWhatsApp: false,



  isSms: false,



  channelType: 'facebook',



  conversationId: null,



  phone: null



}



ğŸ“Š [PIPELINE] New lead from facebook - syncing entry stage...



ğŸ“Š [PIPELINE] Direct channel (facebook) â†’ starting at DISCOVERY



âœ… [PIPELINE] Entry stage set: DISCOVERY (contact: Nc8DVLpAYkUMKpa8jSNs)



ğŸ“œ Fetching conversation history...



ğŸ“œ Fetched 1 messages for contact Nc8DVLpAYkUMKpa8jSNs



ğŸ“œ Thread context: {



  totalMessages: 1,



  recentCount: 1,



  hasSummary: false,



  hasImageContext: false,



  wasHumanHandling: false,



  isReturningClient: false



}



ğŸ§  [AI CONTEXT] Processing message: {



  messageText: 'Hi! How do I book a tattoo appointment?',



  contactId: 'Nc8DVLpAYkUMKpa8jSNs',



  contactName: 'Maria Claflin',



  consultExplained: undefined,



  threadStats: {



    totalMessages: 1,



    recentMessages: 1,



    hasSummary: false,



    hasImageContext: false,



    wasHumanHandling: false



  }



}



ğŸ“Š [CANONICAL] State before routing: {



  tattooSummary: null,



  tattooPlacement: null,



  tattooSize: null,



  timeline: null,



  consultationType: null,



  depositPaid: false,



  derivedPhase: 'intake'



}



ğŸ¯ [INTENTS] No specific intents detected for: Hi! How do I book a tattoo appointment?



ğŸ“œ [AI] Thread context included: {



  totalMessages: 1,



  recentCount: 1,



  hasSummary: false,



  hasImageContext: false,



  wasHumanHandling: false



}



ğŸ¤– Raw OpenAI opener response: {



  "language": "en",



  "bubbles": [



    "What kind of piece are you thinking?",



    "Where on your body were you thinking of getting it?"



  ],



  "internal_notes": "Starting intake phase, gathering basic tattoo idea and placement from new lead.",



  "meta": {



    "aiPhase": "intake",



    "leadTemperature": "warm",



    "wantsDepositLink": false,



    "depositPushedThisTurn": false,



    "mentionDecoyOffered": false,



    "wantsAppointmentOffer": false,



    "consultMode": "online"



  },



  "field_updates": {}



}



â±ï¸ [TIMING] AI call took 2421ms



ğŸ§­ [PHASE] derived_phase snapshot {



  derived_phase: 'intake',



  canonical: {



    tattooSummary: null,



    tattooPlacement: null,



    tattooSize: null,



    timeline: null,



    consultationType: null,



    consultationTypeLocked: false,



    depositLinkSent: false,



    depositPaid: false,



    holdAppointmentId: null



  },



  intents: {



    reschedule_intent: false,



    cancel_intent: false,



    scheduling_intent: false,



    slot_selection_intent: false,



    deposit_intent: false,



    consult_path_choice_intent: false,



    artist_guided_size_intent: false,



    process_or_price_question_intent: false,



    translator_affirm_intent: false



  },



  selected_handler: 'ai',



  routing_reason: 'ai_fallback',



  intent_flags: []



}



â±ï¸ [TIMING] Total handleInboundMessage took 2424ms



ğŸ¤– AI Response Summary: {



  bubblesCount: 2,



  phase: 'intake',



  handler: 'ai',



  reason: 'ai_fallback',



  fieldUpdatesKeys: []



}



âœ‰ï¸ sendConversationMessage context: { contactId: 'Nc8DVLpAYkUMKpa8jSNs', isDm: true, hasPhone: false }



ğŸ” No conversationId provided for DM, searching for DM conversation...



ğŸ” No DM conversation found for contact



ğŸ” No existing DM conversation found, will try to infer type from contact...



ğŸ” No DM conversation found for contact



inferConversationMessageType: no DM conversation found, checking contact tags...



ğŸ“¨ Sending DM via GHL (creating new conversation): {



  contactId: 'Nc8DVLpAYkUMKpa8jSNs',



  locationId: 'mUemx2jG4wly4kJWBkI4',



  message: 'What kind of piece are you thinking?',



  type: 'FB'



}



ğŸ“¨ GHL DM message response (new conversation): { status: 201, contactId: 'Nc8DVLpAYkUMKpa8jSNs', type: 'FB' }



âœ‰ï¸ sendConversationMessage context: { contactId: 'Nc8DVLpAYkUMKpa8jSNs', isDm: true, hasPhone: false }



ğŸ” No conversationId provided for DM, searching for DM conversation...



ğŸ” No DM conversation found for contact



ğŸ” No existing DM conversation found, will try to infer type from contact...



ğŸ” No DM conversation found for contact



inferConversationMessageType: no DM conversation found, checking contact tags...



ğŸ“¨ Sending DM via GHL (creating new conversation): {



  contactId: 'Nc8DVLpAYkUMKpa8jSNs',



  locationId: 'mUemx2jG4wly4kJWBkI4',



  message: 'Where on your body were you thinking of getting it?',



  type: 'FB'



}
