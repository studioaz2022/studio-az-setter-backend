üí¨ GHL MESSAGE WEBHOOK HIT



Raw Body: {



  "contact_id": "Qyiz7MFsHji0OVBP7WJh",



  "first_name": "Maria",



  "last_name": "Claflin",



  "full_name": "Maria Claflin",



  "tags": "dm consultation request",



  "date_created": "2025-12-09T02:33:29.307Z",



  "full_address": "",



  "contact_type": "lead",



  "location": {



    "name": "Studio AZ Tattoo",



    "address": "333 Washington Ave N STE 100",



    "city": "Minneapolis",



    "state": "Minnesota",



    "country": "US",



    "postalCode": "55401",



    "fullAddress": "333 Washington Ave N STE 100, Minneapolis Minnesota 55401",



    "id": "mUemx2jG4wly4kJWBkI4"



  },



  "message": {



    "type": 11,



    "body": "Hi I want to get a tattoo soon! How much do you charge?"



  },



  "workflow": {



    "id": "8cf237bb-6cb1-4240-8ca5-b797bba8b769",



    "name": "Testing Ai Bot"



  },



  "triggerData": {},



  "contact": {



    "attributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    },



    "lastAttributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    }



  },



  "attributionSource": {},



  "customData": {



    "contactId": "Qyiz7MFsHji0OVBP7WJh",



    "messageBody": "Hi I want to get a tattoo soon! How much do you charge?"



  }



}



üì° Channel context: { isDm: true, hasPhone: false, conversationId: null, phone: null }



Parsed contactId from message webhook: Qyiz7MFsHji0OVBP7WJh



‚úÖ Loaded Contact from GHL (message webhook): {



  id: 'Qyiz7MFsHji0OVBP7WJh',



  firstName: 'Maria',



  lastName: 'Claflin',



  tags: [ 'dm consultation request' ]



}



üì© Incoming message text (for language detection): Hi I want to get a tattoo soon! How much do you charge?



üåê Updating language_preference based on DM/SMS detection: { previous: null, next: 'English' }



‚úÖ language_preference updated to English for contact: Qyiz7MFsHji0OVBP7WJh



üß† Derived system state (message): { currentPhase: '', newPhase: 'intake', leadTemperature: 'warm' }



‚úÖ System fields updated for message webhook



üîÑ [PIPELINE] Syncing opportunity stage for contact Qyiz7MFsHji0OVBP7WJh: {



  currentStage: '(none)',



  targetStage: 'INTAKE',



  context: {



    aiPhase: 'intake',



    depositLinkSent: false,



    depositPaid: false,



    consultType: null,



    hasUpcomingTattoo: false,



    tattooCompleted: false,



    lost: false



  }



}



‚ùå Error syncing opportunity stage from message webhook: Request failed with status code 422



üîÑ Refetched contact after system field update for AI call.



ü§ñ Processing message with payload summary: {



  contactId: 'Qyiz7MFsHji0OVBP7WJh',



  leadTemperature: 'warm',



  aiPhase: 'intake',



  language: 'English',



  hasTattooPlacement: false,



  hasTattooSize: false,



  depositPaid: false,



  depositLinkSent: false



}



üîÑ New generation 1 for contact Qyiz7MFsHji0OVBP7WJh



üì± Channel emoji support: yes



ü§ñ Raw OpenAI opener response: {



  "language": "en",



  "bubbles": [



    "Hey Maria! Tattoo pricing really depends on the size and detail of the piece.",



    "What kind of tattoo are you thinking, and where were you wanting it?"



  ],



  "internal_notes": "Opening message to engage lead and start gathering tattoo idea and placement for pricing context.",



  "meta": {



    "aiPhase": "intake",



    "leadTemperature": "warm",



    "wantsDepositLink": false,



    "depositPushedThisTurn": false,



    "mentionDecoyOffered": false,



    "consultMode": "online"



  },



  "field_updates": {}



}



üß† AI DECISION SUMMARY {



  aiPhaseFromAI: 'intake',



  leadTemperatureFromAI: 'warm',



  wantsDepositLink: false,



  wantsAppointmentOffer: undefined,



  consultMode: 'online',



  depositPushedThisTurn: false,



  mentionDecoyOffered: false,



  bubblesPreview: [



    'Hey Maria! Tattoo pricing really depends on the size and detail of the piece.',



    'What kind of tattoo are you thinking, and where were you wanting it?'



  ]



}



ü§ñ AI DM suggestion: {



  "language": "en",



  "bubbles": [



    "Hey Maria! Tattoo pricing really depends on the size and detail of the piece.",



    "What kind of tattoo are you thinking, and where were you wanting it?"



  ],



  "internal_notes": "Opening message to engage lead and start gathering tattoo idea and placement for pricing context.",



  "meta": {



    "aiPhase": "intake",



    "leadTemperature": "warm",



    "wantsDepositLink": false,



    "depositPushedThisTurn": false,



    "mentionDecoyOffered": false,



    "consultMode": "online"



  }



}



‚úâÔ∏è sendConversationMessage context: { contactId: 'Qyiz7MFsHji0OVBP7WJh', isDm: true, hasPhone: false }



üîç No conversationId provided for DM, searching for existing conversation...



‚úÖ Found existing conversation JYEWlRqhtZQmz2TQtjnT with type SMS



‚ö†Ô∏è No valid phone number and no DM conversationId; cannot send message. {



  contactId: 'Qyiz7MFsHji0OVBP7WJh',



  isDm: true,



  hasPhone: false,



  conversationId: null



}



‚è± Waiting 8000ms before sending bubble 2...



‚úâÔ∏è sendConversationMessage context: { contactId: 'Qyiz7MFsHji0OVBP7WJh', isDm: true, hasPhone: false }



üîç No conversationId provided for DM, searching for existing conversation...



‚úÖ Found existing conversation JYEWlRqhtZQmz2TQtjnT with type FB



‚úÖ Using conversation type FB from GHL conversation - skipping ID validation



üì® Sending DM reply via GHL: {



  conversationId: 'JYEWlRqhtZQmz2TQtjnT',



  contactId: 'Qyiz7MFsHji0OVBP7WJh',



  message: 'What kind of tattoo are you thinking, and where were you wanting it?',



  type: 'FB'



}



üì® GHL DM reply response: {



  status: 201,



  contactId: 'Qyiz7MFsHji0OVBP7WJh',



  conversationId: 'JYEWlRqhtZQmz2TQtjnT'



}



üì§ Sent AI bubbles to GHL conversation.



üß† Updating contact system fields from AI meta: {



  ai_phase: 'intake',



  lead_temperature: 'warm',



  consult_explained: undefined



}



‚ÑπÔ∏è No field_updates from AI to apply this turn.



‚ÑπÔ∏è No deposit link created (either not requested, already sent, or already paid). { wantsDepositLink: false, alreadyPaid: false, alreadySent: false }



POST /ghl/message-webhook



üí¨ GHL MESSAGE WEBHOOK HIT



Raw Body: {



  "consult_explained": "",



  "AI Creative Response": "",



  "Tattoo Style": "",



  "Promotional Link": "",



  "Appt 2: Start Time": "",



  "deposit_confirmation_sent": "",



  "Deposit Made On": "",



  "pending_slot_artist": "",



  "utm medium": "",



  "pending_slot_calendar": "",



  " Appt 2: Cancellation Link": "",



  "total_tattoos_completed": "",



  "Appt 1: Reschedule Link": "",



  "Tattoo Concerns": "",



  "Appt 1: Service": "",



  "reschedule_pending": "",



  "Appt 3: Reschedule Link": "",



  "utm campaign": "",



  "TikTok": "",



  "Tattoo Title": "",



  "reschedule_target_translator_appointment_id": "",



  "Follow Up Reason": "",



  "Technician's Address": "",



  "Square Payment ID": "",



  "Technician's Photo ID": "",



  "pending_slot_end": "",



  "I have been fully informed of the risks of body art including but not limited to infection, scarring, and allergic reactions to items associated with body art procedures. Technician will not perform the body art procedure if you fail to complete or sign this form. Further, technician may decline to perform a body art procedure if the client has any identified health conditions. Having been informed of the potential risks associated with this body art procedure, I still wish to proceed with the body art application and I assume any/all risks that may arise from body art.": "",



  "Appt 2: Start Date": "",



  "Appt 1: End Time": "",



  "Customer Lifetime Value": "",



  "times_sent": "",



  "Language Preference": "English",



  "First Tattoo": "",



  "pending_slot_mode": "",



  "Appt 2: Google Calendar": "",



  "Artist Inquired (Deseado)": "",



  "hold_last_activity_at": "",



  "last_released_slot_start": "",



  "AI Email Subject": "",



  "Instagram": "",



  "Appt 1: IOS/Outlook Calendar": "",



  "First Assigned Barber": "",



  "Appt 1: Start Date": "",



  "Deposit Paid": "",



  "Artist": "",



  "last_released_slot_display": "",



  "Appt 3: Cancellation Link": "",



  "Preferred Artist": "",



  "pending_slot_start": "",



  "Lead Temperature": "warm",



  "Square Payment Status": "",



  "Deposit": "",



  "Appt 3: Google Calendar": "",



  "Appt 3: IOS/Outlook Calendar": "",



  "Emergency Contact": "",



  "Appt 3: Start Date": "",



  "Whatsapp User?": "",



  "Other Social Media": "",



  "Technician's Phone Number": "",



  "Tattoo Color Preference": "",



  "Appt 1: Cancellation Link": "",



  "Last SMS": "",



  "Valid Body Art License": "",



  "Flash Tattoo": "",



  "Appt 1: Assigned User": "",



  "square_payment_link_id": "",



  "last_released_slot_calendar": "",



  "Rent vs Commission": "",



  "Appt 1: Start Time": "",



  "pending_slot_display": "",



  "Location of Tattoo": "",



  "I {{contact.full_name}}, the client, confirm that I have read the above statements, and by checking \"Yes\" below, you give your consent to receive BODY ART.": "",



  "Appt 3: Assigned User": "",



  "Referral: Current Referral Points": "",



  "How would you like us to contact you?": "",



  "returning_client": "",



  "hold_warning_sent": "",



  "Appt 3: End Time": "",



  "consultation_type": "",



  "Final Price": "",



  "Upload a Picture of a Valid ID (Driver's License, Gov ID, etc)": "",



  "Best time to contact you": "",



  "Notes to the Artist? (Optional)": "",



  "language_barrier_explained": "",



  "Application Notes": "",



  "Deposit Link Sent": "",



  "Tattoo Placement": "",



  "Appt 2: Reschedule Link": "",



  "client_lifetime_value": "",



  "Dwelling Type": "",



  "Appt 3: Start Time": "",



  "utm source": "",



  "Appt 1: Google Calendar": "",



  "Date of Procedure:": "",



  "Technician's DOB": "",



  "Referral Link Shortened": "",



  "reschedule_target_appointment_id": "",



  "hold_appointment_id": "",



  "Appt 2: IOS/Outlook Calendar": "",



  "Medical History": "",



  "Medical History (Description)": "",



  "Square Order ID": "",



  "Date Picker 3k8r": "",



  "Last Phase Update At": "2025-12-09T02:33:47.186Z",



  "Photo Reference (Referencia)": "",



  "Assigned Technician License #": "",



  "translator_needed": "",



  "Google Meet Link": "",



  "How Soon Is Client Deciding?": "",



  "Work Experience": "",



  "Appt 3: Service": "",



  "Appt 2: Service": "",



  "Project Complexity": "",



  "Appt 2: End Time": "",



  "Appt 2: Assigned User": "",



  "Square Reference ID": "",



  "translator_appointment_id": "",



  "Tattoo Photo Description": "",



  "Body Art License Number": "",



  "last_released_slot_end": "",



  "Tattoo Size": "",



  "Appt 3: End Date": "",



  "Tattoo Summary": "",



  "AI Phase": "intake",



  "Next Follow Up At": "",



  "Assigned Technician": "",



  "contact_id": "Qyiz7MFsHji0OVBP7WJh",



  "first_name": "Maria",



  "last_name": "Claflin",



  "full_name": "Maria Claflin",



  "tags": "dm consultation request",



  "country": "US",



  "date_created": "2025-12-09T02:33:29.307Z",



  "full_address": "",



  "contact_type": "lead",



  "location": {



    "name": "Studio AZ Tattoo",



    "address": "333 Washington Ave N STE 100",



    "city": "Minneapolis",



    "state": "Minnesota",



    "country": "US",



    "postalCode": "55401",



    "fullAddress": "333 Washington Ave N STE 100, Minneapolis Minnesota 55401",



    "id": "mUemx2jG4wly4kJWBkI4"



  },



  "message": {



    "type": 11,



    "body": "I was thinking of getting my kids name going up my calf in like cursive text style"



  },



  "workflow": {



    "id": "8cf237bb-6cb1-4240-8ca5-b797bba8b769",



    "name": "Testing Ai Bot"



  },



  "triggerData": {},



  "contact": {



    "attributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    },



    "lastAttributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    }



  },



  "attributionSource": {},



  "customData": {



    "contactId": "Qyiz7MFsHji0OVBP7WJh",



    "messageBody": "I was thinking of getting my kids name going up my calf in like cursive text style"



  }



}



üì° Channel context: { isDm: true, hasPhone: false, conversationId: null, phone: null }



Parsed contactId from message webhook: Qyiz7MFsHji0OVBP7WJh



‚úÖ Loaded Contact from GHL (message webhook): {



  id: 'Qyiz7MFsHji0OVBP7WJh',



  firstName: 'Maria',



  lastName: 'Claflin',



  tags: [ 'dm consultation request' ]



}



üì© Incoming message text (for language detection): I was thinking of getting my kids name going up my calf in like cursive text style



üåê Updating language_preference based on DM/SMS detection: { previous: null, next: 'English' }



‚úÖ language_preference updated to English for contact: Qyiz7MFsHji0OVBP7WJh



üß† Derived system state (message): { currentPhase: 'intake', newPhase: 'intake', leadTemperature: 'warm' }



‚úÖ System fields updated for message webhook



üîÑ [PIPELINE] Syncing opportunity stage for contact Qyiz7MFsHji0OVBP7WJh: {



  currentStage: '(none)',



  targetStage: 'INTAKE',



  context: {



    aiPhase: 'intake',



    depositLinkSent: false,



    depositPaid: false,



    consultType: null,



    hasUpcomingTattoo: false,



    tattooCompleted: false,



    lost: false



  }



}



‚ùå Error syncing opportunity stage from message webhook: Request failed with status code 422



üîÑ Refetched contact after system field update for AI call.



ü§ñ Processing message with payload summary: {



  contactId: 'Qyiz7MFsHji0OVBP7WJh',



  leadTemperature: 'warm',



  aiPhase: 'intake',



  language: 'English',



  hasTattooPlacement: false,



  hasTattooSize: false,



  depositPaid: false,



  depositLinkSent: false



}



üîÑ New generation 2 for contact Qyiz7MFsHji0OVBP7WJh



üì± Channel emoji support: yes



üìù [CONSULTATION_TYPE] Setting consultation_type="message" for contact Qyiz7MFsHji0OVBP7WJh (detected from: "I was thinking of getting my kids name going up my calf in like cursive text style")



‚ùå Failed to create message consult task: Request failed with status code 422



‚úâÔ∏è sendConversationMessage context: { contactId: 'Qyiz7MFsHji0OVBP7WJh', isDm: true, hasPhone: false }



üîç No conversationId provided for DM, searching for existing conversation...



‚úÖ Found existing conversation JYEWlRqhtZQmz2TQtjnT with type FB



‚úÖ Using conversation type FB from GHL conversation - skipping ID validation



üì® Sending DM reply via GHL: {



  conversationId: 'JYEWlRqhtZQmz2TQtjnT',



  contactId: 'Qyiz7MFsHji0OVBP7WJh',



  message: "Sounds good ‚Äî we'll keep your consult right here in messages so you can share photos and notes at your own pace. I'll make sure the artist sees this thread.",



  type: 'FB'



}



üì® GHL DM reply response: {



  status: 201,



  contactId: 'Qyiz7MFsHji0OVBP7WJh',



  conversationId: 'JYEWlRqhtZQmz2TQtjnT'



}



üîÑ [PIPELINE] Syncing opportunity stage for contact Qyiz7MFsHji0OVBP7WJh: {



  currentStage: '(none)',



  targetStage: 'INTAKE',



  context: {



    aiPhase: 'consult_support',



    depositLinkSent: false,



    depositPaid: false,



    consultType: null,



    hasUpcomingTattoo: false,



    tattooCompleted: false,



    lost: false



  }



}



‚ùå Error syncing opportunity stage after consult mode = message: Request failed with status code 422



POST /ghl/message-webhook



üí¨ GHL MESSAGE WEBHOOK HIT



Raw Body: {



  "consult_explained": "",



  "AI Creative Response": "",



  "Tattoo Style": "",



  "Promotional Link": "",



  "Appt 2: Start Time": "",



  "deposit_confirmation_sent": "",



  "Deposit Made On": "",



  "pending_slot_artist": "",



  "utm medium": "",



  "pending_slot_calendar": "",



  " Appt 2: Cancellation Link": "",



  "total_tattoos_completed": "",



  "Appt 1: Reschedule Link": "",



  "Tattoo Concerns": "",



  "Appt 1: Service": "",



  "reschedule_pending": "",



  "Appt 3: Reschedule Link": "",



  "utm campaign": "",



  "TikTok": "",



  "Tattoo Title": "",



  "reschedule_target_translator_appointment_id": "",



  "Follow Up Reason": "",



  "Technician's Address": "",



  "Square Payment ID": "",



  "Technician's Photo ID": "",



  "pending_slot_end": "",



  "I have been fully informed of the risks of body art including but not limited to infection, scarring, and allergic reactions to items associated with body art procedures. Technician will not perform the body art procedure if you fail to complete or sign this form. Further, technician may decline to perform a body art procedure if the client has any identified health conditions. Having been informed of the potential risks associated with this body art procedure, I still wish to proceed with the body art application and I assume any/all risks that may arise from body art.": "",



  "Appt 2: Start Date": "",



  "Appt 1: End Time": "",



  "Customer Lifetime Value": "",



  "times_sent": "",



  "Language Preference": "English",



  "First Tattoo": "",



  "pending_slot_mode": "",



  "Appt 2: Google Calendar": "",



  "Artist Inquired (Deseado)": "",



  "hold_last_activity_at": "",



  "last_released_slot_start": "",



  "AI Email Subject": "",



  "Instagram": "",



  "Appt 1: IOS/Outlook Calendar": "",



  "First Assigned Barber": "",



  "Appt 1: Start Date": "",



  "Deposit Paid": "",



  "Artist": "",



  "last_released_slot_display": "",



  "Appt 3: Cancellation Link": "",



  "Preferred Artist": "",



  "pending_slot_start": "",



  "Lead Temperature": "warm",



  "Square Payment Status": "",



  "Deposit": "",



  "Appt 3: Google Calendar": "",



  "Appt 3: IOS/Outlook Calendar": "",



  "Emergency Contact": "",



  "Appt 3: Start Date": "",



  "Whatsapp User?": "",



  "Other Social Media": "",



  "Technician's Phone Number": "",



  "Tattoo Color Preference": "",



  "Appt 1: Cancellation Link": "",



  "Last SMS": "",



  "Valid Body Art License": "",



  "Flash Tattoo": "",



  "Appt 1: Assigned User": "",



  "square_payment_link_id": "",



  "last_released_slot_calendar": "",



  "Rent vs Commission": "",



  "Appt 1: Start Time": "",



  "pending_slot_display": "",



  "Location of Tattoo": "",



  "I {{contact.full_name}}, the client, confirm that I have read the above statements, and by checking \"Yes\" below, you give your consent to receive BODY ART.": "",



  "Appt 3: Assigned User": "",



  "Referral: Current Referral Points": "",



  "How would you like us to contact you?": "",



  "returning_client": "",



  "hold_warning_sent": "",



  "Appt 3: End Time": "",



  "consultation_type": "message",



  "Final Price": "",



  "Upload a Picture of a Valid ID (Driver's License, Gov ID, etc)": "",



  "Best time to contact you": "",



  "Notes to the Artist? (Optional)": "",



  "language_barrier_explained": "",



  "Application Notes": "",



  "Deposit Link Sent": "",



  "Tattoo Placement": "",



  "Appt 2: Reschedule Link": "",



  "client_lifetime_value": "",



  "Dwelling Type": "",



  "Appt 3: Start Time": "",



  "utm source": "",



  "Appt 1: Google Calendar": "",



  "Date of Procedure:": "",



  "Technician's DOB": "",



  "Referral Link Shortened": "",



  "reschedule_target_appointment_id": "",



  "hold_appointment_id": "",



  "Appt 2: IOS/Outlook Calendar": "",



  "Medical History": "",



  "Medical History (Description)": "",



  "Square Order ID": "",



  "Date Picker 3k8r": "",



  "Last Phase Update At": "2025-12-09T02:36:40.626Z",



  "Photo Reference (Referencia)": "",



  "Assigned Technician License #": "",



  "translator_needed": "No",



  "Google Meet Link": "",



  "How Soon Is Client Deciding?": "",



  "Work Experience": "",



  "Appt 3: Service": "",



  "Appt 2: Service": "",



  "Project Complexity": "",



  "Appt 2: End Time": "",



  "Appt 2: Assigned User": "",



  "Square Reference ID": "",



  "translator_appointment_id": "",



  "Tattoo Photo Description": "",



  "Body Art License Number": "",



  "last_released_slot_end": "",



  "Tattoo Size": "",



  "Appt 3: End Date": "",



  "Tattoo Summary": "",



  "AI Phase": "intake",



  "Next Follow Up At": "",



  "Assigned Technician": "",



  "contact_id": "Qyiz7MFsHji0OVBP7WJh",



  "first_name": "Maria",



  "last_name": "Claflin",



  "full_name": "Maria Claflin",



  "tags": "dm consultation request",



  "country": "US",



  "date_created": "2025-12-09T02:33:29.307Z",



  "full_address": "",



  "contact_type": "lead",



  "location": {



    "name": "Studio AZ Tattoo",



    "address": "333 Washington Ave N STE 100",



    "city": "Minneapolis",



    "state": "Minnesota",



    "country": "US",



    "postalCode": "55401",



    "fullAddress": "333 Washington Ave N STE 100, Minneapolis Minnesota 55401",



    "id": "mUemx2jG4wly4kJWBkI4"



  },



  "message": {



    "type": 11,



    "body": "I would like to meet with the artist instead of messaging them"



  },



  "workflow": {



    "id": "8cf237bb-6cb1-4240-8ca5-b797bba8b769",



    "name": "Testing Ai Bot"



  },



  "triggerData": {},



  "contact": {



    "attributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    },



    "lastAttributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    }



  },



  "attributionSource": {},



  "customData": {



    "contactId": "Qyiz7MFsHji0OVBP7WJh",



    "messageBody": "I would like to meet with the artist instead of messaging them"



  }



}



üì° Channel context: { isDm: true, hasPhone: false, conversationId: null, phone: null }



Parsed contactId from message webhook: Qyiz7MFsHji0OVBP7WJh



‚úÖ Loaded Contact from GHL (message webhook): {



  id: 'Qyiz7MFsHji0OVBP7WJh',



  firstName: 'Maria',



  lastName: 'Claflin',



  tags: [ 'dm consultation request' ]



}



üì© Incoming message text (for language detection): I would like to meet with the artist instead of messaging them



üåê Updating language_preference based on DM/SMS detection: { previous: null, next: 'English' }



‚úÖ language_preference updated to English for contact: Qyiz7MFsHji0OVBP7WJh



üß† Derived system state (message): { currentPhase: 'intake', newPhase: 'intake', leadTemperature: 'warm' }



‚úÖ System fields updated for message webhook



üîÑ [PIPELINE] Syncing opportunity stage for contact Qyiz7MFsHji0OVBP7WJh: {



  currentStage: '(none)',



  targetStage: 'INTAKE',



  context: {



    aiPhase: 'intake',



    depositLinkSent: false,



    depositPaid: false,



    consultType: null,



    hasUpcomingTattoo: false,



    tattooCompleted: false,



    lost: false



  }



}



‚ùå Error syncing opportunity stage from message webhook: Request failed with status code 422



üîÑ Refetched contact after system field update for AI call.



ü§ñ Processing message with payload summary: {



  contactId: 'Qyiz7MFsHji0OVBP7WJh',



  leadTemperature: 'warm',



  aiPhase: 'intake',



  language: 'English',



  hasTattooPlacement: false,



  hasTattooSize: false,



  depositPaid: false,



  depositLinkSent: false



}



üîÑ New generation 3 for contact Qyiz7MFsHji0OVBP7WJh



üì± Channel emoji support: yes



ü§ñ Raw OpenAI opener response: {



  "language": "en",



  "bubbles": [



    "Got it, you want to meet the artist in person instead of messaging back and forth.",



    "The next step is a quick 15‚Äì20 minute consultation with the artist to nail down your design. Would you prefer to do that in person or over a video call?"



  ],



  "internal_notes": "Acknowledging client's preference for in-person consult and offering consult mode options to move forward.",



  "meta": {



    "aiPhase": "intake",



    "leadTemperature": "warm",



    "wantsDepositLink": false,



    "depositPushedThisTurn": false,



    "mentionDecoyOffered": false,



    "consultMode": "online"



  },



  "field_updates": {}



}



üß† AI DECISION SUMMARY {



  aiPhaseFromAI: 'intake',



  leadTemperatureFromAI: 'warm',



  wantsDepositLink: false,



  wantsAppointmentOffer: undefined,



  consultMode: 'online',



  depositPushedThisTurn: false,



  mentionDecoyOffered: false,



  bubblesPreview: [



    'Got it, you want to meet the artist in person instead of messaging back and fort',



    'The next step is a quick 15‚Äì20 minute consultation with the artist to nail down '



  ]



}



ü§ñ AI DM suggestion: {



  "language": "en",



  "bubbles": [



    "Got it, you want to meet the artist in person instead of messaging back and forth.",



    "The next step is a quick 15‚Äì20 minute consultation with the artist to nail down your design. Would you prefer to do that in person or over a video call?"



  ],



  "internal_notes": "Acknowledging client's preference for in-person consult and offering consult mode options to move forward.",



  "meta": {



    "aiPhase": "intake",



    "leadTemperature": "warm",



    "wantsDepositLink": false,



    "depositPushedThisTurn": false,



    "mentionDecoyOffered": false,



    "consultMode": "online"



  }



}



‚úâÔ∏è sendConversationMessage context: { contactId: 'Qyiz7MFsHji0OVBP7WJh', isDm: true, hasPhone: false }



üîç No conversationId provided for DM, searching for existing conversation...



‚úÖ Found existing conversation JYEWlRqhtZQmz2TQtjnT with type FB



‚úÖ Using conversation type FB from GHL conversation - skipping ID validation



üì® Sending DM reply via GHL: {



  conversationId: 'JYEWlRqhtZQmz2TQtjnT',



  contactId: 'Qyiz7MFsHji0OVBP7WJh',



  message: 'Got it, you want to meet the artist in person instead of messaging back and forth.',



  type: 'FB'



}



üì® GHL DM reply response: {



  status: 201,



  contactId: 'Qyiz7MFsHji0OVBP7WJh',



  conversationId: 'JYEWlRqhtZQmz2TQtjnT'



}



‚è± Waiting 12000ms before sending bubble 2...



‚úâÔ∏è sendConversationMessage context: { contactId: 'Qyiz7MFsHji0OVBP7WJh', isDm: true, hasPhone: false }



üîç No conversationId provided for DM, searching for existing conversation...



‚úÖ Found existing conversation JYEWlRqhtZQmz2TQtjnT with type FB



‚úÖ Using conversation type FB from GHL conversation - skipping ID validation



üì® Sending DM reply via GHL: {



  conversationId: 'JYEWlRqhtZQmz2TQtjnT',



  contactId: 'Qyiz7MFsHji0OVBP7WJh',



  message: 'The next step is a quick 15‚Äì20 minute consultation with the artist to nail down your design. Would you prefer to do that in person or over a video call?',



  type: 'FB'



}



üì® GHL DM reply response: {



  status: 201,



  contactId: 'Qyiz7MFsHji0OVBP7WJh',



  conversationId: 'JYEWlRqhtZQmz2TQtjnT'



}



üì§ Sent AI bubbles to GHL conversation.



üß† Updating contact system fields from AI meta: {



  ai_phase: 'intake',



  lead_temperature: 'warm',



  consult_explained: undefined



}



‚ÑπÔ∏è No field_updates from AI to apply this turn.



‚ÑπÔ∏è No deposit link created (either not requested, already sent, or already paid). { wantsDepositLink: false, alreadyPaid: false, alreadySent: false }



POST /ghl/message-webhook



üí¨ GHL MESSAGE WEBHOOK HIT



Raw Body: {



  "consult_explained": "",



  "AI Creative Response": "",



  "Tattoo Style": "",



  "Promotional Link": "",



  "Appt 2: Start Time": "",



  "deposit_confirmation_sent": "",



  "Deposit Made On": "",



  "pending_slot_artist": "",



  "utm medium": "",



  "pending_slot_calendar": "",



  " Appt 2: Cancellation Link": "",



  "total_tattoos_completed": "",



  "Appt 1: Reschedule Link": "",



  "Tattoo Concerns": "",



  "Appt 1: Service": "",



  "reschedule_pending": "",



  "Appt 3: Reschedule Link": "",



  "utm campaign": "",



  "TikTok": "",



  "Tattoo Title": "",



  "reschedule_target_translator_appointment_id": "",



  "Follow Up Reason": "",



  "Technician's Address": "",



  "Square Payment ID": "",



  "Technician's Photo ID": "",



  "pending_slot_end": "",



  "I have been fully informed of the risks of body art including but not limited to infection, scarring, and allergic reactions to items associated with body art procedures. Technician will not perform the body art procedure if you fail to complete or sign this form. Further, technician may decline to perform a body art procedure if the client has any identified health conditions. Having been informed of the potential risks associated with this body art procedure, I still wish to proceed with the body art application and I assume any/all risks that may arise from body art.": "",



  "Appt 2: Start Date": "",



  "Appt 1: End Time": "",



  "Customer Lifetime Value": "",



  "times_sent": "",



  "Language Preference": "English",



  "First Tattoo": "",



  "pending_slot_mode": "",



  "Appt 2: Google Calendar": "",



  "Artist Inquired (Deseado)": "",



  "hold_last_activity_at": "",



  "last_released_slot_start": "",



  "AI Email Subject": "",



  "Instagram": "",



  "Appt 1: IOS/Outlook Calendar": "",



  "First Assigned Barber": "",



  "Appt 1: Start Date": "",



  "Deposit Paid": "",



  "Artist": "",



  "last_released_slot_display": "",



  "Appt 3: Cancellation Link": "",



  "Preferred Artist": "",



  "pending_slot_start": "",



  "Lead Temperature": "warm",



  "Square Payment Status": "",



  "Deposit": "",



  "Appt 3: Google Calendar": "",



  "Appt 3: IOS/Outlook Calendar": "",



  "Emergency Contact": "",



  "Appt 3: Start Date": "",



  "Whatsapp User?": "",



  "Other Social Media": "",



  "Technician's Phone Number": "",



  "Tattoo Color Preference": "",



  "Appt 1: Cancellation Link": "",



  "Last SMS": "",



  "Valid Body Art License": "",



  "Flash Tattoo": "",



  "Appt 1: Assigned User": "",



  "square_payment_link_id": "",



  "last_released_slot_calendar": "",



  "Rent vs Commission": "",



  "Appt 1: Start Time": "",



  "pending_slot_display": "",



  "Location of Tattoo": "",



  "I {{contact.full_name}}, the client, confirm that I have read the above statements, and by checking \"Yes\" below, you give your consent to receive BODY ART.": "",



  "Appt 3: Assigned User": "",



  "Referral: Current Referral Points": "",



  "How would you like us to contact you?": "",



  "returning_client": "",



  "hold_warning_sent": "",



  "Appt 3: End Time": "",



  "consultation_type": "message",



  "Final Price": "",



  "Upload a Picture of a Valid ID (Driver's License, Gov ID, etc)": "",



  "Best time to contact you": "",



  "Notes to the Artist? (Optional)": "",



  "language_barrier_explained": "",



  "Application Notes": "",



  "Deposit Link Sent": "",



  "Tattoo Placement": "",



  "Appt 2: Reschedule Link": "",



  "client_lifetime_value": "",



  "Dwelling Type": "",



  "Appt 3: Start Time": "",



  "utm source": "",



  "Appt 1: Google Calendar": "",



  "Date of Procedure:": "",



  "Technician's DOB": "",



  "Referral Link Shortened": "",



  "reschedule_target_appointment_id": "",



  "hold_appointment_id": "",



  "Appt 2: IOS/Outlook Calendar": "",



  "Medical History": "",



  "Medical History (Description)": "",



  "Square Order ID": "",



  "Date Picker 3k8r": "",



  "Last Phase Update At": "2025-12-09T02:38:11.969Z",



  "Photo Reference (Referencia)": "",



  "Assigned Technician License #": "",



  "translator_needed": "No",



  "Google Meet Link": "",



  "How Soon Is Client Deciding?": "",



  "Work Experience": "",



  "Appt 3: Service": "",



  "Appt 2: Service": "",



  "Project Complexity": "",



  "Appt 2: End Time": "",



  "Appt 2: Assigned User": "",



  "Square Reference ID": "",



  "translator_appointment_id": "",



  "Tattoo Photo Description": "",



  "Body Art License Number": "",



  "last_released_slot_end": "",



  "Tattoo Size": "",



  "Appt 3: End Date": "",



  "Tattoo Summary": "",



  "AI Phase": "intake",



  "Next Follow Up At": "",



  "Assigned Technician": "",



  "contact_id": "Qyiz7MFsHji0OVBP7WJh",



  "first_name": "Maria",



  "last_name": "Claflin",



  "full_name": "Maria Claflin",



  "tags": "dm consultation request",



  "country": "US",



  "date_created": "2025-12-09T02:33:29.307Z",



  "full_address": "",



  "contact_type": "lead",



  "location": {



    "name": "Studio AZ Tattoo",



    "address": "333 Washington Ave N STE 100",



    "city": "Minneapolis",



    "state": "Minnesota",



    "country": "US",



    "postalCode": "55401",



    "fullAddress": "333 Washington Ave N STE 100, Minneapolis Minnesota 55401",



    "id": "mUemx2jG4wly4kJWBkI4"



  },



  "message": {



    "type": 11,



    "body": "Video call would be great!"



  },



  "workflow": {



    "id": "8cf237bb-6cb1-4240-8ca5-b797bba8b769",



    "name": "Testing Ai Bot"



  },



  "triggerData": {},



  "contact": {



    "attributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    },



    "lastAttributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    }



  },



  "attributionSource": {},



  "customData": {



    "contactId": "Qyiz7MFsHji0OVBP7WJh",



    "messageBody": "Video call would be great!"



  }



}



üì° Channel context: { isDm: true, hasPhone: false, conversationId: null, phone: null }



Parsed contactId from message webhook: Qyiz7MFsHji0OVBP7WJh



‚úÖ Loaded Contact from GHL (message webhook): {



  id: 'Qyiz7MFsHji0OVBP7WJh',



  firstName: 'Maria',



  lastName: 'Claflin',



  tags: [ 'dm consultation request' ]



}



üì© Incoming message text (for language detection): Video call would be great!



üåê Updating language_preference based on DM/SMS detection: { previous: null, next: 'English' }



‚úÖ language_preference updated to English for contact: Qyiz7MFsHji0OVBP7WJh



üß† Derived system state (message): { currentPhase: 'intake', newPhase: 'intake', leadTemperature: 'warm' }



‚úÖ System fields updated for message webhook



üîÑ [PIPELINE] Syncing opportunity stage for contact Qyiz7MFsHji0OVBP7WJh: {



  currentStage: '(none)',



  targetStage: 'INTAKE',



  context: {



    aiPhase: 'intake',



    depositLinkSent: false,



    depositPaid: false,



    consultType: null,



    hasUpcomingTattoo: false,



    tattooCompleted: false,



    lost: false



  }



}



‚ùå Error syncing opportunity stage from message webhook: Request failed with status code 422



üîÑ Refetched contact after system field update for AI call.



ü§ñ Processing message with payload summary: {



  contactId: 'Qyiz7MFsHji0OVBP7WJh',



  leadTemperature: 'warm',



  aiPhase: 'intake',



  language: 'English',



  hasTattooPlacement: false,



  hasTattooSize: false,



  depositPaid: false,



  depositLinkSent: false



}



üîÑ New generation 4 for contact Qyiz7MFsHji0OVBP7WJh



üì± Channel emoji support: yes



üìù [CONSULTATION_TYPE] Setting consultation_type="appointment" (translator needed) for contact Qyiz7MFsHji0OVBP7WJh (detected from: "Video call would be great!")



‚úâÔ∏è sendConversationMessage context: { contactId: 'Qyiz7MFsHji0OVBP7WJh', isDm: true, hasPhone: false }



üîç No conversationId provided for DM, searching for existing conversation...



‚úÖ Found existing conversation JYEWlRqhtZQmz2TQtjnT with type FB



‚úÖ Using conversation type FB from GHL conversation - skipping ID validation



üì® Sending DM reply via GHL: {



  conversationId: 'JYEWlRqhtZQmz2TQtjnT',



  contactId: 'Qyiz7MFsHji0OVBP7WJh',



  message: "Got it ‚Äî I'll set up a video consult with a translator.",



  type: 'FB'



}



üì® GHL DM reply response: {



  status: 201,



  contactId: 'Qyiz7MFsHji0OVBP7WJh',



  conversationId: 'JYEWlRqhtZQmz2TQtjnT'



}



üîÑ [PIPELINE] Syncing opportunity stage for contact Qyiz7MFsHji0OVBP7WJh: {



  currentStage: '(none)',



  targetStage: 'INTAKE',



  context: {



    aiPhase: 'consult_support',



    depositLinkSent: false,



    depositPaid: false,



    consultType: null,



    hasUpcomingTattoo: false,



    tattooCompleted: false,



    lost: false



  }



}



üìÖ Triggering appointment offer after translator choice



‚ùå Error syncing opportunity stage after consult mode = appointment: Request failed with status code 422



üïê TIME-FIRST MODE: No explicit artist preference, showing all artists' availability



üìÖ [SLOT_GENERATION] Generating synthetic slots (preferredDay: none, preferredTimeWindow: none)



üìÖ [SLOT_GENERATION] Generated 3 synthetic slots



‚ùå Error fetching artist workloads: {



  message: [



üìä Artist workloads: {"Joan":0,"Andrew":0,"Artist2":0,"Artist3":0,"Artist4":0}, sorted order: Joan, Andrew



    'property pagination should not exist',



    'Query must not exceed 75 characters',



    'query must be a string'



  ],



  error: 'Unprocessable Entity',



  statusCode: 422,



  traceId: '2915762d-63c5-4f12-8e7b-e2220cca8f26'



}



üìÖ TIME-FIRST: Presenting 3 slots (online): [



  'Tuesday, Dec 9 at 5pm [Joan]',



  'Wednesday, Dec 10 at 5pm [Joan]',



  'Thursday, Dec 11 at 5pm [Joan]'



]



‚úâÔ∏è sendConversationMessage context: { contactId: 'Qyiz7MFsHji0OVBP7WJh', isDm: true, hasPhone: false }



üîç No conversationId provided for DM, searching for existing conversation...



‚úÖ Found existing conversation JYEWlRqhtZQmz2TQtjnT with type FB



‚úÖ Using conversation type FB from GHL conversation - skipping ID validation



üì® Sending DM reply via GHL: {



  conversationId: 'JYEWlRqhtZQmz2TQtjnT',



  contactId: 'Qyiz7MFsHji0OVBP7WJh',



  message: 'Here are some times that work:\n' +



    '\n' +



    '1. Tuesday, Dec 9 at 5pm\n' +



    '2. Wednesday, Dec 10 at 5pm\n' +



    '3. Thursday, Dec 11 at 5pm\n' +



    '\n' +



    'Which one works for you?',



  type: 'FB'



}



üì® GHL DM reply response: {



  status: 201,



  contactId: 'Qyiz7MFsHji0OVBP7WJh',



  conversationId: 'JYEWlRqhtZQmz2TQtjnT'



}



POST /ghl/message-webhook



üí¨ GHL MESSAGE WEBHOOK HIT



Raw Body: {



  "consult_explained": "",



  "AI Creative Response": "",



  "Tattoo Style": "",



  "Promotional Link": "",



  "Appt 2: Start Time": "",



  "deposit_confirmation_sent": "",



  "Deposit Made On": "",



  "pending_slot_artist": "",



  "utm medium": "",



  "pending_slot_calendar": "",



  " Appt 2: Cancellation Link": "",



  "total_tattoos_completed": "",



  "Appt 1: Reschedule Link": "",



  "Tattoo Concerns": "",



  "Appt 1: Service": "",



  "reschedule_pending": "",



  "Appt 3: Reschedule Link": "",



  "utm campaign": "",



  "TikTok": "",



  "Tattoo Title": "",



  "reschedule_target_translator_appointment_id": "",



  "Follow Up Reason": "",



  "Technician's Address": "",



  "Square Payment ID": "",



  "Technician's Photo ID": "",



  "pending_slot_end": "",



  "I have been fully informed of the risks of body art including but not limited to infection, scarring, and allergic reactions to items associated with body art procedures. Technician will not perform the body art procedure if you fail to complete or sign this form. Further, technician may decline to perform a body art procedure if the client has any identified health conditions. Having been informed of the potential risks associated with this body art procedure, I still wish to proceed with the body art application and I assume any/all risks that may arise from body art.": "",



  "Appt 2: Start Date": "",



  "Appt 1: End Time": "",



  "Customer Lifetime Value": "",



  "times_sent": "",



  "Language Preference": "English",



  "First Tattoo": "",



  "pending_slot_mode": "",



  "Appt 2: Google Calendar": "",



  "Artist Inquired (Deseado)": "",



  "hold_last_activity_at": "",



  "last_released_slot_start": "",



  "AI Email Subject": "",



  "Instagram": "",



  "Appt 1: IOS/Outlook Calendar": "",



  "First Assigned Barber": "",



  "Appt 1: Start Date": "",



  "Deposit Paid": "",



  "Artist": "",



  "last_released_slot_display": "",



  "Appt 3: Cancellation Link": "",



  "Preferred Artist": "",



  "pending_slot_start": "",



  "Lead Temperature": "warm",



  "Square Payment Status": "",



  "Deposit": "",



  "Appt 3: Google Calendar": "",



  "Appt 3: IOS/Outlook Calendar": "",



  "Emergency Contact": "",



  "Appt 3: Start Date": "",



  "Whatsapp User?": "",



  "Other Social Media": "",



  "Technician's Phone Number": "",



  "Tattoo Color Preference": "",



  "Appt 1: Cancellation Link": "",



  "Last SMS": "",



  "Valid Body Art License": "",



  "Flash Tattoo": "",



  "Appt 1: Assigned User": "",



  "square_payment_link_id": "",



  "last_released_slot_calendar": "",



  "Rent vs Commission": "",



  "Appt 1: Start Time": "",



  "pending_slot_display": "",



  "Location of Tattoo": "",



  "I {{contact.full_name}}, the client, confirm that I have read the above statements, and by checking \"Yes\" below, you give your consent to receive BODY ART.": "",



  "Appt 3: Assigned User": "",



  "Referral: Current Referral Points": "",



  "How would you like us to contact you?": "",



  "returning_client": "",



  "hold_warning_sent": "",



  "Appt 3: End Time": "",



  "consultation_type": "appointment",



  "Final Price": "",



  "Upload a Picture of a Valid ID (Driver's License, Gov ID, etc)": "",



  "Best time to contact you": "",



  "Notes to the Artist? (Optional)": "",



  "language_barrier_explained": "",



  "Application Notes": "",



  "Deposit Link Sent": "",



  "Tattoo Placement": "",



  "Appt 2: Reschedule Link": "",



  "client_lifetime_value": "",



  "Dwelling Type": "",



  "Appt 3: Start Time": "",



  "utm source": "",



  "Appt 1: Google Calendar": "",



  "Date of Procedure:": "",



  "Technician's DOB": "",



  "Referral Link Shortened": "",



  "reschedule_target_appointment_id": "",



  "hold_appointment_id": "",



  "Appt 2: IOS/Outlook Calendar": "",



  "Medical History": "",



  "Medical History (Description)": "",



  "Square Order ID": "",



  "Date Picker 3k8r": "",



  "Last Phase Update At": "2025-12-09T02:38:37.881Z",



  "Photo Reference (Referencia)": "",



  "Assigned Technician License #": "",



  "translator_needed": "Yes",



  "Google Meet Link": "",



  "How Soon Is Client Deciding?": "",



  "Work Experience": "",



  "Appt 3: Service": "",



  "Appt 2: Service": "",



  "Project Complexity": "",



  "Appt 2: End Time": "",



  "Appt 2: Assigned User": "",



  "Square Reference ID": "",



  "translator_appointment_id": "",



  "Tattoo Photo Description": "",



  "Body Art License Number": "",



  "last_released_slot_end": "",



  "Tattoo Size": "",



  "Appt 3: End Date": "",



  "Tattoo Summary": "",



  "AI Phase": "intake",



  "Next Follow Up At": "",



  "Assigned Technician": "",



  "contact_id": "Qyiz7MFsHji0OVBP7WJh",



  "first_name": "Maria",



  "last_name": "Claflin",



  "full_name": "Maria Claflin",



  "tags": "dm consultation request",



  "country": "US",



  "date_created": "2025-12-09T02:33:29.307Z",



  "full_address": "",



  "contact_type": "lead",



  "location": {



    "name": "Studio AZ Tattoo",



    "address": "333 Washington Ave N STE 100",



    "city": "Minneapolis",



    "state": "Minnesota",



    "country": "US",



    "postalCode": "55401",



    "fullAddress": "333 Washington Ave N STE 100, Minneapolis Minnesota 55401",



    "id": "mUemx2jG4wly4kJWBkI4"



  },



  "message": {



    "type": 11,



    "body": "Ok, Wednesday works! Why do we need a translator?"



  },



  "workflow": {



    "id": "8cf237bb-6cb1-4240-8ca5-b797bba8b769",



    "name": "Testing Ai Bot"



  },



  "triggerData": {},



  "contact": {



    "attributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    },



    "lastAttributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    }



  },



  "attributionSource": {},



  "customData": {



    "contactId": "Qyiz7MFsHji0OVBP7WJh",



    "messageBody": "Ok, Wednesday works! Why do we need a translator?"



  }



}



üì° Channel context: { isDm: true, hasPhone: false, conversationId: null, phone: null }



Parsed contactId from message webhook: Qyiz7MFsHji0OVBP7WJh



‚úÖ Loaded Contact from GHL (message webhook): {



  id: 'Qyiz7MFsHji0OVBP7WJh',



  firstName: 'Maria',



  lastName: 'Claflin',



  tags: [ 'dm consultation request' ]



}



üì© Incoming message text (for language detection): Ok, Wednesday works! Why do we need a translator?



üåê Updating language_preference based on DM/SMS detection: { previous: null, next: 'English' }



‚úÖ language_preference updated to English for contact: Qyiz7MFsHji0OVBP7WJh



üß† Derived system state (message): { currentPhase: 'intake', newPhase: 'intake', leadTemperature: 'warm' }



‚úÖ System fields updated for message webhook



üîÑ [PIPELINE] Syncing opportunity stage for contact Qyiz7MFsHji0OVBP7WJh: {



  currentStage: '(none)',



  targetStage: 'INTAKE',



  context: {



    aiPhase: 'intake',



    depositLinkSent: false,



    depositPaid: false,



    consultType: null,



    hasUpcomingTattoo: false,



    tattooCompleted: false,



    lost: false



  }



}



‚ùå Error syncing opportunity stage from message webhook: Request failed with status code 422



üîÑ Refetched contact after system field update for AI call.



ü§ñ Processing message with payload summary: {



  contactId: 'Qyiz7MFsHji0OVBP7WJh',



  leadTemperature: 'warm',



  aiPhase: 'intake',



  language: 'English',



  hasTattooPlacement: false,



  hasTattooSize: false,



  depositPaid: false,



  depositLinkSent: false



}



üîÑ New generation 5 for contact Qyiz7MFsHji0OVBP7WJh



üì± Channel emoji support: yes



üìù [CONSULTATION_TYPE] Setting consultation_type="appointment" (translator needed) for contact Qyiz7MFsHji0OVBP7WJh (detected from: "Ok, Wednesday works! Why do we need a translator?")



‚úâÔ∏è sendConversationMessage context: { contactId: 'Qyiz7MFsHji0OVBP7WJh', isDm: true, hasPhone: false }



üîç No conversationId provided for DM, searching for existing conversation...



‚úÖ Found existing conversation JYEWlRqhtZQmz2TQtjnT with type FB



‚úÖ Using conversation type FB from GHL conversation - skipping ID validation



üì® Sending DM reply via GHL: {



  conversationId: 'JYEWlRqhtZQmz2TQtjnT',



  contactId: 'Qyiz7MFsHji0OVBP7WJh',



  message: "Got it ‚Äî I'll set up a video consult with a translator.",



  type: 'FB'



}



üì® GHL DM reply response: {



  status: 201,



  contactId: 'Qyiz7MFsHji0OVBP7WJh',



  conversationId: 'JYEWlRqhtZQmz2TQtjnT'



}



üîÑ [PIPELINE] Syncing opportunity stage for contact Qyiz7MFsHji0OVBP7WJh: {



  currentStage: '(none)',



  targetStage: 'INTAKE',



  context: {



    aiPhase: 'consult_support',



    depositLinkSent: false,



    depositPaid: false,



    consultType: null,



    hasUpcomingTattoo: false,



    tattooCompleted: false,



    lost: false



  }



}



‚ùå Error syncing opportunity stage after consult mode = appointment: Request failed with status code 422



üìÖ Triggering appointment offer after translator choice



üïê TIME-FIRST MODE: No explicit artist preference, showing all artists' availability



üìÖ [SLOT_GENERATION] Generating synthetic slots (preferredDay: none, preferredTimeWindow: none)



üìÖ [SLOT_GENERATION] Generated 3 synthetic slots



‚ùå Error fetching artist workloads: {



  message: [



    'property pagination should not exist',



    'Query must not exceed 75 characters',



    'query must be a string'



üìä Artist workloads: {"Joan":0,"Andrew":0,"Artist2":0,"Artist3":0,"Artist4":0}, sorted order: Joan, Andrew



  ],



  error: 'Unprocessable Entity',



  statusCode: 422,



  traceId: '1febec18-3aa5-437a-b9a7-ffd211c1bf17'



}



üìÖ TIME-FIRST: Presenting 3 slots (online): [



  'Tuesday, Dec 9 at 5pm [Joan]',



  'Wednesday, Dec 10 at 5pm [Joan]',



  'Thursday, Dec 11 at 5pm [Joan]'



]



‚úâÔ∏è sendConversationMessage context: { contactId: 'Qyiz7MFsHji0OVBP7WJh', isDm: true, hasPhone: false }



üîç No conversationId provided for DM, searching for existing conversation...



‚úÖ Found existing conversation JYEWlRqhtZQmz2TQtjnT with type FB



‚úÖ Using conversation type FB from GHL conversation - skipping ID validation



üì® Sending DM reply via GHL: {



  conversationId: 'JYEWlRqhtZQmz2TQtjnT',



  contactId: 'Qyiz7MFsHji0OVBP7WJh',



  message: 'Here are some times that work:\n' +



    '\n' +



    '1. Tuesday, Dec 9 at 5pm\n' +



    '2. Wednesday, Dec 10 at 5pm\n' +



    '3. Thursday, Dec 11 at 5pm\n' +



    '\n' +



    'Which one works for you?',



  type: 'FB'



}



üì® GHL DM reply response: {



  status: 201,



  contactId: 'Qyiz7MFsHji0OVBP7WJh',



  conversationId: 'JYEWlRqhtZQmz2TQtjnT'



}



POST /ghl/message-webhook



üí¨ GHL MESSAGE WEBHOOK HIT



Raw Body: {



  "consult_explained": "",



  "AI Creative Response": "",



  "Tattoo Style": "",



  "Promotional Link": "",



  "Appt 2: Start Time": "",



  "deposit_confirmation_sent": "",



  "Deposit Made On": "",



  "pending_slot_artist": "",



  "utm medium": "",



  "pending_slot_calendar": "",



  " Appt 2: Cancellation Link": "",



  "total_tattoos_completed": "",



  "Appt 1: Reschedule Link": "",



  "Tattoo Concerns": "",



  "Appt 1: Service": "",



  "reschedule_pending": "",



  "Appt 3: Reschedule Link": "",



  "utm campaign": "",



  "TikTok": "",



  "Tattoo Title": "",



  "reschedule_target_translator_appointment_id": "",



  "Follow Up Reason": "",



  "Technician's Address": "",



  "Square Payment ID": "",



  "Technician's Photo ID": "",



  "pending_slot_end": "",



  "I have been fully informed of the risks of body art including but not limited to infection, scarring, and allergic reactions to items associated with body art procedures. Technician will not perform the body art procedure if you fail to complete or sign this form. Further, technician may decline to perform a body art procedure if the client has any identified health conditions. Having been informed of the potential risks associated with this body art procedure, I still wish to proceed with the body art application and I assume any/all risks that may arise from body art.": "",



  "Appt 2: Start Date": "",



  "Appt 1: End Time": "",



  "Customer Lifetime Value": "",



  "times_sent": "",



  "Language Preference": "English",



  "First Tattoo": "",



  "pending_slot_mode": "",



  "Appt 2: Google Calendar": "",



  "Artist Inquired (Deseado)": "",



  "hold_last_activity_at": "",



  "last_released_slot_start": "",



  "AI Email Subject": "",



  "Instagram": "",



  "Appt 1: IOS/Outlook Calendar": "",



  "First Assigned Barber": "",



  "Appt 1: Start Date": "",



  "Deposit Paid": "",



  "Artist": "",



  "last_released_slot_display": "",



  "Appt 3: Cancellation Link": "",



  "Preferred Artist": "",



  "pending_slot_start": "",



  "Lead Temperature": "warm",



  "Square Payment Status": "",



  "Deposit": "",



  "Appt 3: Google Calendar": "",



  "Appt 3: IOS/Outlook Calendar": "",



  "Emergency Contact": "",



  "Appt 3: Start Date": "",



  "Whatsapp User?": "",



  "Other Social Media": "",



  "Technician's Phone Number": "",



  "Tattoo Color Preference": "",



  "Appt 1: Cancellation Link": "",



  "Last SMS": "",



  "Valid Body Art License": "",



  "Flash Tattoo": "",



  "Appt 1: Assigned User": "",



  "square_payment_link_id": "",



  "last_released_slot_calendar": "",



  "Rent vs Commission": "",



  "Appt 1: Start Time": "",



  "pending_slot_display": "",



  "Location of Tattoo": "",



  "I {{contact.full_name}}, the client, confirm that I have read the above statements, and by checking \"Yes\" below, you give your consent to receive BODY ART.": "",



  "Appt 3: Assigned User": "",



  "Referral: Current Referral Points": "",



  "How would you like us to contact you?": "",



  "returning_client": "",



  "hold_warning_sent": "",



  "Appt 3: End Time": "",



  "consultation_type": "appointment",



  "Final Price": "",



  "Upload a Picture of a Valid ID (Driver's License, Gov ID, etc)": "",



  "Best time to contact you": "",



  "Notes to the Artist? (Optional)": "",



  "language_barrier_explained": "",



  "Application Notes": "",



  "Deposit Link Sent": "",



  "Tattoo Placement": "",



  "Appt 2: Reschedule Link": "",



  "client_lifetime_value": "",



  "Dwelling Type": "",



  "Appt 3: Start Time": "",



  "utm source": "",



  "Appt 1: Google Calendar": "",



  "Date of Procedure:": "",



  "Technician's DOB": "",



  "Referral Link Shortened": "",



  "reschedule_target_appointment_id": "",



  "hold_appointment_id": "",



  "Appt 2: IOS/Outlook Calendar": "",



  "Medical History": "",



  "Medical History (Description)": "",



  "Square Order ID": "",



  "Date Picker 3k8r": "",



  "Last Phase Update At": "2025-12-09T02:39:28.636Z",



  "Photo Reference (Referencia)": "",



  "Assigned Technician License #": "",



  "translator_needed": "Yes",



  "Google Meet Link": "",



  "How Soon Is Client Deciding?": "",



  "Work Experience": "",



  "Appt 3: Service": "",



  "Appt 2: Service": "",



  "Project Complexity": "",



  "Appt 2: End Time": "",



  "Appt 2: Assigned User": "",



  "Square Reference ID": "",



  "translator_appointment_id": "",



  "Tattoo Photo Description": "",



  "Body Art License Number": "",



  "last_released_slot_end": "",



  "Tattoo Size": "",



  "Appt 3: End Date": "",



  "Tattoo Summary": "",



  "AI Phase": "intake",



  "Next Follow Up At": "",



  "Assigned Technician": "",



  "contact_id": "Qyiz7MFsHji0OVBP7WJh",



  "first_name": "Maria",



  "last_name": "Claflin",



  "full_name": "Maria Claflin",



  "tags": "dm consultation request",



  "country": "US",



  "date_created": "2025-12-09T02:33:29.307Z",



  "full_address": "",



  "contact_type": "lead",



  "location": {



    "name": "Studio AZ Tattoo",



    "address": "333 Washington Ave N STE 100",



    "city": "Minneapolis",



    "state": "Minnesota",



    "country": "US",



    "postalCode": "55401",



    "fullAddress": "333 Washington Ave N STE 100, Minneapolis Minnesota 55401",



    "id": "mUemx2jG4wly4kJWBkI4"



  },



  "message": {



    "type": 11,



    "body": "Ok Wednesday works!"



  },



  "workflow": {



    "id": "8cf237bb-6cb1-4240-8ca5-b797bba8b769",



    "name": "Testing Ai Bot"



  },



  "triggerData": {},



  "contact": {



    "attributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    },



    "lastAttributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    }



  },



  "attributionSource": {},



  "customData": {



    "contactId": "Qyiz7MFsHji0OVBP7WJh",



    "messageBody": "Ok Wednesday works!"



  }



}



üì° Channel context: { isDm: true, hasPhone: false, conversationId: null, phone: null }



Parsed contactId from message webhook: Qyiz7MFsHji0OVBP7WJh



‚úÖ Loaded Contact from GHL (message webhook): {



  id: 'Qyiz7MFsHji0OVBP7WJh',



  firstName: 'Maria',



  lastName: 'Claflin',



  tags: [ 'dm consultation request' ]



}



üì© Incoming message text (for language detection): Ok Wednesday works!



üåê Updating language_preference based on DM/SMS detection: { previous: null, next: 'English' }



‚úÖ language_preference updated to English for contact: Qyiz7MFsHji0OVBP7WJh



üß† Derived system state (message): { currentPhase: 'intake', newPhase: 'intake', leadTemperature: 'warm' }



‚úÖ System fields updated for message webhook



üîÑ [PIPELINE] Syncing opportunity stage for contact Qyiz7MFsHji0OVBP7WJh: {



  currentStage: '(none)',



  targetStage: 'INTAKE',



  context: {



    aiPhase: 'intake',



    depositLinkSent: false,



    depositPaid: false,



    consultType: null,



    hasUpcomingTattoo: false,



    tattooCompleted: false,



    lost: false



  }



}



‚ùå Error syncing opportunity stage from message webhook: Request failed with status code 422



üîÑ Refetched contact after system field update for AI call.



ü§ñ Processing message with payload summary: {



  contactId: 'Qyiz7MFsHji0OVBP7WJh',



  leadTemperature: 'warm',



  aiPhase: 'intake',



  language: 'English',



  hasTattooPlacement: false,



  hasTattooSize: false,



  depositPaid: false,



  depositLinkSent: false



}



üîÑ New generation 6 for contact Qyiz7MFsHji0OVBP7WJh



üì± Channel emoji support: yes



üéØ SLOT SELECTION DETECTED - user is picking a specific time



üïê TIME-FIRST MODE: No explicit artist preference, showing all artists' availability



üìÖ User requested wednesday, starting from Wed Dec 10 2025



üìÖ [SLOT_GENERATION] Generating synthetic slots (preferredDay: wednesday, preferredTimeWindow: none)



üìÖ [SLOT_GENERATION] Generated 3 synthetic slots



‚ùå Error fetching artist workloads: {



  message: [



    'property pagination should not exist',



    'Query must not exceed 75 characters',



    'query must be a string'



  ],



  error: 'Unprocessable Entity',



  statusCode: 422,



  traceId: '8db74fec-4bb1-4354-a1a5-66649d8d0af9'



}



üìä Artist workloads: {"Joan":0,"Andrew":0,"Artist2":0,"Artist3":0,"Artist4":0}, sorted order: Joan, Andrew



üìÖ TIME-FIRST: Presenting 3 slots (online): [



  'Wednesday, Dec 10 at 5pm [Joan]',



  'Wednesday, Dec 17 at 5pm [Joan]',



  'Wednesday, Dec 24 at 5pm [Joan]'



]



üìÖ Day name mentioned without time (wednesday) - not selecting



‚ö†Ô∏è Could not match slot selection to available slots - asking to pick from list



‚úâÔ∏è sendConversationMessage context: { contactId: 'Qyiz7MFsHji0OVBP7WJh', isDm: true, hasPhone: false }



üîç No conversationId provided for DM, searching for existing conversation...



‚úÖ Found existing conversation JYEWlRqhtZQmz2TQtjnT with type FB



‚úÖ Using conversation type FB from GHL conversation - skipping ID validation



üì® Sending DM reply via GHL: {



  conversationId: 'JYEWlRqhtZQmz2TQtjnT',



  contactId: 'Qyiz7MFsHji0OVBP7WJh',



  message: "I couldn't quite catch that ‚Äî which of these times works for you?\n" +



    '\n' +



    '1. Wednesday, Dec 10 at 5pm\n' +



    '2. Wednesday, Dec 17 at 5pm\n' +



    '3. Wednesday, Dec 24 at 5pm',



  type: 'FB'



}



üì® GHL DM reply response: {



  status: 201,



  contactId: 'Qyiz7MFsHji0OVBP7WJh',



  conversationId: 'JYEWlRqhtZQmz2TQtjnT'



}



POST /ghl/message-webhook



üí¨ GHL MESSAGE WEBHOOK HIT



Raw Body: {



  "consult_explained": "",



  "AI Creative Response": "",



  "Tattoo Style": "",



  "Promotional Link": "",



  "Appt 2: Start Time": "",



  "deposit_confirmation_sent": "",



  "Deposit Made On": "",



  "pending_slot_artist": "",



  "utm medium": "",



  "pending_slot_calendar": "",



  " Appt 2: Cancellation Link": "",



  "total_tattoos_completed": "",



  "Appt 1: Reschedule Link": "",



  "Tattoo Concerns": "",



  "Appt 1: Service": "",



  "reschedule_pending": "",



  "Appt 3: Reschedule Link": "",



  "utm campaign": "",



  "TikTok": "",



  "Tattoo Title": "",



  "reschedule_target_translator_appointment_id": "",



  "Follow Up Reason": "",



  "Technician's Address": "",



  "Square Payment ID": "",



  "Technician's Photo ID": "",



  "pending_slot_end": "",



  "I have been fully informed of the risks of body art including but not limited to infection, scarring, and allergic reactions to items associated with body art procedures. Technician will not perform the body art procedure if you fail to complete or sign this form. Further, technician may decline to perform a body art procedure if the client has any identified health conditions. Having been informed of the potential risks associated with this body art procedure, I still wish to proceed with the body art application and I assume any/all risks that may arise from body art.": "",



  "Appt 2: Start Date": "",



  "Appt 1: End Time": "",



  "Customer Lifetime Value": "",



  "times_sent": "",



  "Language Preference": "English",



  "First Tattoo": "",



  "pending_slot_mode": "",



  "Appt 2: Google Calendar": "",



  "Artist Inquired (Deseado)": "",



  "hold_last_activity_at": "",



  "last_released_slot_start": "",



  "AI Email Subject": "",



  "Instagram": "",



  "Appt 1: IOS/Outlook Calendar": "",



  "First Assigned Barber": "",



  "Appt 1: Start Date": "",



  "Deposit Paid": "",



  "Artist": "",



  "last_released_slot_display": "",



  "Appt 3: Cancellation Link": "",



  "Preferred Artist": "",



  "pending_slot_start": "",



  "Lead Temperature": "warm",



  "Square Payment Status": "",



  "Deposit": "",



  "Appt 3: Google Calendar": "",



  "Appt 3: IOS/Outlook Calendar": "",



  "Emergency Contact": "",



  "Appt 3: Start Date": "",



  "Whatsapp User?": "",



  "Other Social Media": "",



  "Technician's Phone Number": "",



  "Tattoo Color Preference": "",



  "Appt 1: Cancellation Link": "",



  "Last SMS": "",



  "Valid Body Art License": "",



  "Flash Tattoo": "",



  "Appt 1: Assigned User": "",



  "square_payment_link_id": "",



  "last_released_slot_calendar": "",



  "Rent vs Commission": "",



  "Appt 1: Start Time": "",



  "pending_slot_display": "",



  "Location of Tattoo": "",



  "I {{contact.full_name}}, the client, confirm that I have read the above statements, and by checking \"Yes\" below, you give your consent to receive BODY ART.": "",



  "Appt 3: Assigned User": "",



  "Referral: Current Referral Points": "",



  "How would you like us to contact you?": "",



  "returning_client": "",



  "hold_warning_sent": "",



  "Appt 3: End Time": "",



  "consultation_type": "appointment",



  "Final Price": "",



  "Upload a Picture of a Valid ID (Driver's License, Gov ID, etc)": "",



  "Best time to contact you": "",



  "Notes to the Artist? (Optional)": "",



  "language_barrier_explained": "",



  "Application Notes": "",



  "Deposit Link Sent": "",



  "Tattoo Placement": "",



  "Appt 2: Reschedule Link": "",



  "client_lifetime_value": "",



  "Dwelling Type": "",



  "Appt 3: Start Time": "",



  "utm source": "",



  "Appt 1: Google Calendar": "",



  "Date of Procedure:": "",



  "Technician's DOB": "",



  "Referral Link Shortened": "",



  "reschedule_target_appointment_id": "",



  "hold_appointment_id": "",



  "Appt 2: IOS/Outlook Calendar": "",



  "Medical History": "",



  "Medical History (Description)": "",



  "Square Order ID": "",



  "Date Picker 3k8r": "",



  "Last Phase Update At": "2025-12-09T02:39:28.636Z",



  "Photo Reference (Referencia)": "",



  "Assigned Technician License #": "",



  "translator_needed": "Yes",



  "Google Meet Link": "",



  "How Soon Is Client Deciding?": "",



  "Work Experience": "",



  "Appt 3: Service": "",



  "Appt 2: Service": "",



  "Project Complexity": "",



  "Appt 2: End Time": "",



  "Appt 2: Assigned User": "",



  "Square Reference ID": "",



  "translator_appointment_id": "",



  "Tattoo Photo Description": "",



  "Body Art License Number": "",



  "last_released_slot_end": "",



  "Tattoo Size": "",



  "Appt 3: End Date": "",



  "Tattoo Summary": "",



  "AI Phase": "intake",



  "Next Follow Up At": "",



  "Assigned Technician": "",



  "contact_id": "Qyiz7MFsHji0OVBP7WJh",



  "first_name": "Maria",



  "last_name": "Claflin",



  "full_name": "Maria Claflin",



  "tags": "dm consultation request",



  "country": "US",



  "date_created": "2025-12-09T02:33:29.307Z",



  "full_address": "",



  "contact_type": "lead",



  "location": {



    "name": "Studio AZ Tattoo",



    "address": "333 Washington Ave N STE 100",



    "city": "Minneapolis",



    "state": "Minnesota",



    "country": "US",



    "postalCode": "55401",



    "fullAddress": "333 Washington Ave N STE 100, Minneapolis Minnesota 55401",



    "id": "mUemx2jG4wly4kJWBkI4"



  },



  "message": {



    "type": 11,



    "body": "Ok Wednesday works!"



  },



  "workflow": {



    "id": "8cf237bb-6cb1-4240-8ca5-b797bba8b769",



    "name": "Testing Ai Bot"



  },



  "triggerData": {},



  "contact": {



    "attributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    },



    "lastAttributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    }



  },



  "attributionSource": {},



  "customData": {



    "contactId": "Qyiz7MFsHji0OVBP7WJh",



    "messageBody": "Ok Wednesday works!"



  }



}



üì° Channel context: { isDm: true, hasPhone: false, conversationId: null, phone: null }



Parsed contactId from message webhook: Qyiz7MFsHji0OVBP7WJh



‚úÖ Loaded Contact from GHL (message webhook): {



  id: 'Qyiz7MFsHji0OVBP7WJh',



  firstName: 'Maria',



  lastName: 'Claflin',



  tags: [ 'dm consultation request' ]



}



üì© Incoming message text (for language detection): Ok Wednesday works!



üåê Updating language_preference based on DM/SMS detection: { previous: null, next: 'English' }



‚úÖ language_preference updated to English for contact: Qyiz7MFsHji0OVBP7WJh



üß† Derived system state (message): { currentPhase: 'intake', newPhase: 'intake', leadTemperature: 'warm' }



‚úÖ System fields updated for message webhook



üîÑ [PIPELINE] Syncing opportunity stage for contact Qyiz7MFsHji0OVBP7WJh: {



  currentStage: '(none)',



  targetStage: 'INTAKE',



  context: {



    aiPhase: 'intake',



    depositLinkSent: false,



    depositPaid: false,



    consultType: null,



    hasUpcomingTattoo: false,



    tattooCompleted: false,



    lost: false



  }



}



‚ùå Error syncing opportunity stage from message webhook: Request failed with status code 422



üîÑ Refetched contact after system field update for AI call.



ü§ñ Processing message with payload summary: {



  contactId: 'Qyiz7MFsHji0OVBP7WJh',



  leadTemperature: 'warm',



  aiPhase: 'intake',



  language: 'English',



  hasTattooPlacement: false,



  hasTattooSize: false,



  depositPaid: false,



  depositLinkSent: false



}



üîÑ New generation 6 for contact Qyiz7MFsHji0OVBP7WJh



üì± Channel emoji support: yes



üéØ SLOT SELECTION DETECTED - user is picking a specific time



üïê TIME-FIRST MODE: No explicit artist preference, showing all artists' availability



üìÖ User requested wednesday, starting from Wed Dec 10 2025



üìÖ [SLOT_GENERATION] Generating synthetic slots (preferredDay: wednesday, preferredTimeWindow: none)



üìÖ [SLOT_GENERATION] Generated 3 synthetic slots



‚ùå Error fetching artist workloads: {



  message: [



    'property pagination should not exist',



    'Query must not exceed 75 characters',



    'query must be a string'



  ],



  error: 'Unprocessable Entity',



  statusCode: 422,



  traceId: '8db74fec-4bb1-4354-a1a5-66649d8d0af9'



}



üìä Artist workloads: {"Joan":0,"Andrew":0,"Artist2":0,"Artist3":0,"Artist4":0}, sorted order: Joan, Andrew



üìÖ TIME-FIRST: Presenting 3 slots (online): [



  'Wednesday, Dec 10 at 5pm [Joan]',



  'Wednesday, Dec 17 at 5pm [Joan]',



  'Wednesday, Dec 24 at 5pm [Joan]'



]



üìÖ Day name mentioned without time (wednesday) - not selecting



‚ö†Ô∏è Could not match slot selection to available slots - asking to pick from list



‚úâÔ∏è sendConversationMessage context: { contactId: 'Qyiz7MFsHji0OVBP7WJh', isDm: true, hasPhone: false }



üîç No conversationId provided for DM, searching for existing conversation...



‚úÖ Found existing conversation JYEWlRqhtZQmz2TQtjnT with type FB



‚úÖ Using conversation type FB from GHL conversation - skipping ID validation



üì® Sending DM reply via GHL: {



  conversationId: 'JYEWlRqhtZQmz2TQtjnT',



  contactId: 'Qyiz7MFsHji0OVBP7WJh',



  message: "I couldn't quite catch that ‚Äî which of these times works for you?\n" +



    '\n' +



    '1. Wednesday, Dec 10 at 5pm\n' +



    '2. Wednesday, Dec 17 at 5pm\n' +



    '3. Wednesday, Dec 24 at 5pm',



  type: 'FB'



}



üì® GHL DM reply response: {



  status: 201,



  contactId: 'Qyiz7MFsHji0OVBP7WJh',



  conversationId: 'JYEWlRqhtZQmz2TQtjnT'



}



POST /ghl/message-webhook



üí¨ GHL MESSAGE WEBHOOK HIT



Raw Body: {



  "consult_explained": "",



  "AI Creative Response": "",



  "Tattoo Style": "",



  "Promotional Link": "",



  "Appt 2: Start Time": "",



  "deposit_confirmation_sent": "",



  "Deposit Made On": "",



  "pending_slot_artist": "",



  "utm medium": "",



  "pending_slot_calendar": "",



  " Appt 2: Cancellation Link": "",



  "total_tattoos_completed": "",



  "Appt 1: Reschedule Link": "",



  "Tattoo Concerns": "",



  "Appt 1: Service": "",



  "reschedule_pending": "",



  "Appt 3: Reschedule Link": "",



  "utm campaign": "",



  "TikTok": "",



  "Tattoo Title": "",



  "reschedule_target_translator_appointment_id": "",



  "Follow Up Reason": "",



  "Technician's Address": "",



  "Square Payment ID": "",



  "Technician's Photo ID": "",



  "pending_slot_end": "",



  "I have been fully informed of the risks of body art including but not limited to infection, scarring, and allergic reactions to items associated with body art procedures. Technician will not perform the body art procedure if you fail to complete or sign this form. Further, technician may decline to perform a body art procedure if the client has any identified health conditions. Having been informed of the potential risks associated with this body art procedure, I still wish to proceed with the body art application and I assume any/all risks that may arise from body art.": "",



  "Appt 2: Start Date": "",



  "Appt 1: End Time": "",



  "Customer Lifetime Value": "",



  "times_sent": "",



  "Language Preference": "English",



  "First Tattoo": "",



  "pending_slot_mode": "",



  "Appt 2: Google Calendar": "",



  "Artist Inquired (Deseado)": "",



  "hold_last_activity_at": "",



  "last_released_slot_start": "",



  "AI Email Subject": "",



  "Instagram": "",



  "Appt 1: IOS/Outlook Calendar": "",



  "First Assigned Barber": "",



  "Appt 1: Start Date": "",



  "Deposit Paid": "",



  "Artist": "",



  "last_released_slot_display": "",



  "Appt 3: Cancellation Link": "",



  "Preferred Artist": "",



  "pending_slot_start": "",



  "Lead Temperature": "warm",



  "Square Payment Status": "",



  "Deposit": "",



  "Appt 3: Google Calendar": "",



  "Appt 3: IOS/Outlook Calendar": "",



  "Emergency Contact": "",



  "Appt 3: Start Date": "",



  "Whatsapp User?": "",



  "Other Social Media": "",



  "Technician's Phone Number": "",



  "Tattoo Color Preference": "",



  "Appt 1: Cancellation Link": "",



  "Last SMS": "",



  "Valid Body Art License": "",



  "Flash Tattoo": "",



  "Appt 1: Assigned User": "",



  "square_payment_link_id": "",



  "last_released_slot_calendar": "",



  "Rent vs Commission": "",



  "Appt 1: Start Time": "",



  "pending_slot_display": "",



  "Location of Tattoo": "",



  "I {{contact.full_name}}, the client, confirm that I have read the above statements, and by checking \"Yes\" below, you give your consent to receive BODY ART.": "",



  "Appt 3: Assigned User": "",



  "Referral: Current Referral Points": "",



  "How would you like us to contact you?": "",



  "returning_client": "",



  "hold_warning_sent": "",



  "Appt 3: End Time": "",



  "consultation_type": "appointment",



  "Final Price": "",



  "Upload a Picture of a Valid ID (Driver's License, Gov ID, etc)": "",



  "Best time to contact you": "",



  "Notes to the Artist? (Optional)": "",



  "language_barrier_explained": "",



  "Application Notes": "",



  "Deposit Link Sent": "",



  "Tattoo Placement": "",



  "Appt 2: Reschedule Link": "",



  "client_lifetime_value": "",



  "Dwelling Type": "",



  "Appt 3: Start Time": "",



  "utm source": "",



  "Appt 1: Google Calendar": "",



  "Date of Procedure:": "",



  "Technician's DOB": "",



  "Referral Link Shortened": "",



  "reschedule_target_appointment_id": "",



  "hold_appointment_id": "",



  "Appt 2: IOS/Outlook Calendar": "",



  "Medical History": "",



  "Medical History (Description)": "",



  "Square Order ID": "",



  "Date Picker 3k8r": "",



  "Last Phase Update At": "2025-12-09T02:39:53.387Z",



  "Photo Reference (Referencia)": "",



  "Assigned Technician License #": "",



  "translator_needed": "Yes",



  "Google Meet Link": "",



  "How Soon Is Client Deciding?": "",



  "Work Experience": "",



  "Appt 3: Service": "",



  "Appt 2: Service": "",



  "Project Complexity": "",



  "Appt 2: End Time": "",



  "Appt 2: Assigned User": "",



  "Square Reference ID": "",



  "translator_appointment_id": "",



  "Tattoo Photo Description": "",



  "Body Art License Number": "",



  "last_released_slot_end": "",



  "Tattoo Size": "",



  "Appt 3: End Date": "",



  "Tattoo Summary": "",



  "AI Phase": "intake",



  "Next Follow Up At": "",



  "Assigned Technician": "",



  "contact_id": "Qyiz7MFsHji0OVBP7WJh",



  "first_name": "Maria",



  "last_name": "Claflin",



  "full_name": "Maria Claflin",



  "tags": "dm consultation request",



  "country": "US",



  "date_created": "2025-12-09T02:33:29.307Z",



  "full_address": "",



  "contact_type": "lead",



  "location": {



    "name": "Studio AZ Tattoo",



    "address": "333 Washington Ave N STE 100",



    "city": "Minneapolis",



    "state": "Minnesota",



    "country": "US",



    "postalCode": "55401",



    "fullAddress": "333 Washington Ave N STE 100, Minneapolis Minnesota 55401",



    "id": "mUemx2jG4wly4kJWBkI4"



  },



  "message": {



    "type": 11,



    "body": "Wednesday Dec 10 at 5pm"



  },



  "workflow": {



    "id": "8cf237bb-6cb1-4240-8ca5-b797bba8b769",



    "name": "Testing Ai Bot"



  },



  "triggerData": {},



  "contact": {



    "attributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    },



    "lastAttributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    }



  },



  "attributionSource": {},



  "customData": {



    "contactId": "Qyiz7MFsHji0OVBP7WJh",



    "messageBody": "Wednesday Dec 10 at 5pm"



  }



}



üì° Channel context: { isDm: true, hasPhone: false, conversationId: null, phone: null }



Parsed contactId from message webhook: Qyiz7MFsHji0OVBP7WJh



‚úÖ Loaded Contact from GHL (message webhook): {



  id: 'Qyiz7MFsHji0OVBP7WJh',



  firstName: 'Maria',



  lastName: 'Claflin',



  tags: [ 'dm consultation request' ]



}



üì© Incoming message text (for language detection): Wednesday Dec 10 at 5pm



üåê Updating language_preference based on DM/SMS detection: { previous: null, next: 'English' }



‚úÖ language_preference updated to English for contact: Qyiz7MFsHji0OVBP7WJh



üß† Derived system state (message): { currentPhase: 'intake', newPhase: 'intake', leadTemperature: 'warm' }



‚úÖ System fields updated for message webhook



üîÑ [PIPELINE] Syncing opportunity stage for contact Qyiz7MFsHji0OVBP7WJh: {



  currentStage: '(none)',



  targetStage: 'INTAKE',



  context: {



    aiPhase: 'intake',



    depositLinkSent: false,



    depositPaid: false,



    consultType: null,



    hasUpcomingTattoo: false,



    tattooCompleted: false,



    lost: false



  }



}



‚ùå Error syncing opportunity stage from message webhook: Request failed with status code 422



üîÑ Refetched contact after system field update for AI call.



ü§ñ Processing message with payload summary: {



  contactId: 'Qyiz7MFsHji0OVBP7WJh',



  leadTemperature: 'warm',



  aiPhase: 'intake',



  language: 'English',



  hasTattooPlacement: false,



  hasTattooSize: false,



  depositPaid: false,



  depositLinkSent: false



}



üîÑ New generation 7 for contact Qyiz7MFsHji0OVBP7WJh



üì± Channel emoji support: yes



üéØ SLOT SELECTION DETECTED - user is picking a specific time



üïê TIME-FIRST MODE: No explicit artist preference, showing all artists' availability



üìÖ [SLOT_GENERATION] Generating slots for 1 specific date(s) using SYNTHETIC times (GHL availability not yet integrated)



üìÖ [SLOT_GENERATION] Generated 2 synthetic slots for dates: 2025-12-10



‚ùå Error fetching artist workloads: {



  message: [



    'property pagination should not exist',



    'Query must not exceed 75 characters',



üìä Artist workloads: {"Joan":0,"Andrew":0,"Artist2":0,"Artist3":0,"Artist4":0}, sorted order: Joan, Andrew



    'query must be a string'



  ],



  error: 'Unprocessable Entity',



  statusCode: 422,



  traceId: '06fd698b-cd04-4b5c-881d-0b8e4c8cf552'



}



üìÖ TIME-FIRST: Presenting 2 slots (online): [



  'Wednesday, Dec 10 at 5pm [Joan]',



  'Wednesday, Dec 10 at 6pm [Joan]'



]



‚úÖ Matched day name with time: wednesday ‚Üí slot 1



‚úÖ Matched slot 1: Wednesday, Dec 10 at 5pm



üìÖ Booking with artist: Joan, calendar: 2EJcAtrllnYOtuSx4Dua (mode: time-first)



‚ùå Error creating appointment: {



  message: 'The user id not part of calendar team.',



  error: 'Unprocessable Entity',



  statusCode: 422,



  traceId: '1292b564-0d63-4caf-97c4-8e0bb42c7ad1'



}



‚ùå Error creating consult appointment: Request failed with status code 422



‚ùå Error creating hold appointment: Request failed with status code 422



‚úâÔ∏è sendConversationMessage context: { contactId: 'Qyiz7MFsHji0OVBP7WJh', isDm: true, hasPhone: false }



üîç No conversationId provided for DM, searching for existing conversation...



‚úÖ Found existing conversation JYEWlRqhtZQmz2TQtjnT with type FB



‚úÖ Using conversation type FB from GHL conversation - skipping ID validation



üì® Sending DM reply via GHL: {



  conversationId: 'JYEWlRqhtZQmz2TQtjnT',



  contactId: 'Qyiz7MFsHji0OVBP7WJh',



  message: 'Sorry, I had trouble booking that time. Can you try picking another option?',



  type: 'FB'



}



üì® GHL DM reply response: {



  status: 201,



  contactId: 'Qyiz7MFsHji0OVBP7WJh',



  conversationId: 'JYEWlRqhtZQmz2TQtjnT'



}



POST /ghl/message-webhook



üí¨ GHL MESSAGE WEBHOOK HIT



Raw Body: {



  "consult_explained": "",



  "AI Creative Response": "",



  "Tattoo Style": "",



  "Promotional Link": "",



  "Appt 2: Start Time": "",



  "deposit_confirmation_sent": "",



  "Deposit Made On": "",



  "pending_slot_artist": "",



  "utm medium": "",



  "pending_slot_calendar": "",



  " Appt 2: Cancellation Link": "",



  "total_tattoos_completed": "",



  "Appt 1: Reschedule Link": "",



  "Tattoo Concerns": "",



  "Appt 1: Service": "",



  "reschedule_pending": "",



  "Appt 3: Reschedule Link": "",



  "utm campaign": "",



  "TikTok": "",



  "Tattoo Title": "",



  "reschedule_target_translator_appointment_id": "",



  "Follow Up Reason": "",



  "Technician's Address": "",



  "Square Payment ID": "",



  "Technician's Photo ID": "",



  "pending_slot_end": "",



  "I have been fully informed of the risks of body art including but not limited to infection, scarring, and allergic reactions to items associated with body art procedures. Technician will not perform the body art procedure if you fail to complete or sign this form. Further, technician may decline to perform a body art procedure if the client has any identified health conditions. Having been informed of the potential risks associated with this body art procedure, I still wish to proceed with the body art application and I assume any/all risks that may arise from body art.": "",



  "Appt 2: Start Date": "",



  "Appt 1: End Time": "",



  "Customer Lifetime Value": "",



  "times_sent": "",



  "Language Preference": "English",



  "First Tattoo": "",



  "pending_slot_mode": "",



  "Appt 2: Google Calendar": "",



  "Artist Inquired (Deseado)": "",



  "hold_last_activity_at": "",



  "last_released_slot_start": "",



  "AI Email Subject": "",



  "Instagram": "",



  "Appt 1: IOS/Outlook Calendar": "",



  "First Assigned Barber": "",



  "Appt 1: Start Date": "",



  "Deposit Paid": "",



  "Artist": "",



  "last_released_slot_display": "",



  "Appt 3: Cancellation Link": "",



  "Preferred Artist": "",



  "pending_slot_start": "",



  "Lead Temperature": "warm",



  "Square Payment Status": "",



  "Deposit": "",



  "Appt 3: Google Calendar": "",



  "Appt 3: IOS/Outlook Calendar": "",



  "Emergency Contact": "",



  "Appt 3: Start Date": "",



  "Whatsapp User?": "",



  "Other Social Media": "",



  "Technician's Phone Number": "",



  "Tattoo Color Preference": "",



  "Appt 1: Cancellation Link": "",



  "Last SMS": "",



  "Valid Body Art License": "",



  "Flash Tattoo": "",



  "Appt 1: Assigned User": "",



  "square_payment_link_id": "",



  "last_released_slot_calendar": "",



  "Rent vs Commission": "",



  "Appt 1: Start Time": "",



  "pending_slot_display": "",



  "Location of Tattoo": "",



  "I {{contact.full_name}}, the client, confirm that I have read the above statements, and by checking \"Yes\" below, you give your consent to receive BODY ART.": "",



  "Appt 3: Assigned User": "",



  "Referral: Current Referral Points": "",



  "How would you like us to contact you?": "",



  "returning_client": "",



  "hold_warning_sent": "",



  "Appt 3: End Time": "",



  "consultation_type": "appointment",



  "Final Price": "",



  "Upload a Picture of a Valid ID (Driver's License, Gov ID, etc)": "",



  "Best time to contact you": "",



  "Notes to the Artist? (Optional)": "",



  "language_barrier_explained": "",



  "Application Notes": "",



  "Deposit Link Sent": "",



  "Tattoo Placement": "",



  "Appt 2: Reschedule Link": "",



  "client_lifetime_value": "",



  "Dwelling Type": "",



  "Appt 3: Start Time": "",



  "utm source": "",



  "Appt 1: Google Calendar": "",



  "Date of Procedure:": "",



  "Technician's DOB": "",



  "Referral Link Shortened": "",



  "reschedule_target_appointment_id": "",



  "hold_appointment_id": "",



  "Appt 2: IOS/Outlook Calendar": "",



  "Medical History": "",



  "Medical History (Description)": "",



  "Square Order ID": "",



  "Date Picker 3k8r": "",



  "Last Phase Update At": "2025-12-09T02:40:16.507Z",



  "Photo Reference (Referencia)": "",



  "Assigned Technician License #": "",



  "translator_needed": "Yes",



  "Google Meet Link": "",



  "How Soon Is Client Deciding?": "",



  "Work Experience": "",



  "Appt 3: Service": "",



  "Appt 2: Service": "",



  "Project Complexity": "",



  "Appt 2: End Time": "",



  "Appt 2: Assigned User": "",



  "Square Reference ID": "",



  "translator_appointment_id": "",



  "Tattoo Photo Description": "",



  "Body Art License Number": "",



  "last_released_slot_end": "",



  "Tattoo Size": "",



  "Appt 3: End Date": "",



  "Tattoo Summary": "",



  "AI Phase": "intake",



  "Next Follow Up At": "",



  "Assigned Technician": "",



  "contact_id": "Qyiz7MFsHji0OVBP7WJh",



  "first_name": "Maria",



  "last_name": "Claflin",



  "full_name": "Maria Claflin",



  "tags": "dm consultation request",



  "country": "US",



  "date_created": "2025-12-09T02:33:29.307Z",



  "full_address": "",



  "contact_type": "lead",



  "location": {



    "name": "Studio AZ Tattoo",



    "address": "333 Washington Ave N STE 100",



    "city": "Minneapolis",



    "state": "Minnesota",



    "country": "US",



    "postalCode": "55401",



    "fullAddress": "333 Washington Ave N STE 100, Minneapolis Minnesota 55401",



    "id": "mUemx2jG4wly4kJWBkI4"



  },



  "message": {



    "type": 11,



    "body": "Wednesday, Dec 17 at 5pm"



  },



  "workflow": {



    "id": "8cf237bb-6cb1-4240-8ca5-b797bba8b769",



    "name": "Testing Ai Bot"



  },



  "triggerData": {},



  "contact": {



    "attributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    },



    "lastAttributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    }



  },



  "attributionSource": {},



  "customData": {



    "contactId": "Qyiz7MFsHji0OVBP7WJh",



    "messageBody": "Wednesday, Dec 17 at 5pm"



  }



}



üì° Channel context: { isDm: true, hasPhone: false, conversationId: null, phone: null }



Parsed contactId from message webhook: Qyiz7MFsHji0OVBP7WJh



‚úÖ Loaded Contact from GHL (message webhook): {



  id: 'Qyiz7MFsHji0OVBP7WJh',



  firstName: 'Maria',



  lastName: 'Claflin',



  tags: [ 'dm consultation request' ]



}



üì© Incoming message text (for language detection): Wednesday, Dec 17 at 5pm



üåê Updating language_preference based on DM/SMS detection: { previous: null, next: 'English' }



‚úÖ language_preference updated to English for contact: Qyiz7MFsHji0OVBP7WJh



üß† Derived system state (message): { currentPhase: 'intake', newPhase: 'intake', leadTemperature: 'warm' }



‚úÖ System fields updated for message webhook



üîÑ [PIPELINE] Syncing opportunity stage for contact Qyiz7MFsHji0OVBP7WJh: {



  currentStage: '(none)',



  targetStage: 'INTAKE',



  context: {



    aiPhase: 'intake',



    depositLinkSent: false,



    depositPaid: false,



    consultType: null,



    hasUpcomingTattoo: false,



    tattooCompleted: false,



    lost: false



  }



}



‚ùå Error syncing opportunity stage from message webhook: Request failed with status code 422



üîÑ Refetched contact after system field update for AI call.



ü§ñ Processing message with payload summary: {



  contactId: 'Qyiz7MFsHji0OVBP7WJh',



  leadTemperature: 'warm',



  aiPhase: 'intake',



  language: 'English',



  hasTattooPlacement: false,



  hasTattooSize: false,



  depositPaid: false,



  depositLinkSent: false



}



üîÑ New generation 8 for contact Qyiz7MFsHji0OVBP7WJh



üì± Channel emoji support: yes



üéØ SLOT SELECTION DETECTED - user is picking a specific time



üïê TIME-FIRST MODE: No explicit artist preference, showing all artists' availability



üìÖ [SLOT_GENERATION] Generating slots for 1 specific date(s) using SYNTHETIC times (GHL availability not yet integrated)



üìÖ [SLOT_GENERATION] Generated 2 synthetic slots for dates: 2025-12-17



‚ùå Error fetching artist workloads: {



üìä Artist workloads: {"Joan":0,"Andrew":0,"Artist2":0,"Artist3":0,"Artist4":0}, sorted order: Joan, Andrew



  message: [



    'property pagination should not exist',



    'Query must not exceed 75 characters',



    'query must be a string'



  ],



  error: 'Unprocessable Entity',



  statusCode: 422,



  traceId: 'a0377805-cd98-4775-9d71-7c8d6f5dc7ab'



}



üìÖ TIME-FIRST: Presenting 2 slots (online): [



  'Wednesday, Dec 17 at 5pm [Joan]',



  'Wednesday, Dec 17 at 6pm [Joan]'



]



‚úÖ Matched day name with time: wednesday ‚Üí slot 1



‚úÖ Matched slot 1: Wednesday, Dec 17 at 5pm



üìÖ Booking with artist: Joan, calendar: 2EJcAtrllnYOtuSx4Dua (mode: time-first)



‚ùå Error creating appointment: {



  message: 'The user id not part of calendar team.',



  error: 'Unprocessable Entity',



  statusCode: 422,



  traceId: 'ecc231dc-4219-44b2-bf59-72b294f20e0b'



}



‚ùå Error creating consult appointment: Request failed with status code 422



‚ùå Error creating hold appointment: Request failed with status code 422



‚úâÔ∏è sendConversationMessage context: { contactId: 'Qyiz7MFsHji0OVBP7WJh', isDm: true, hasPhone: false }



üîç No conversationId provided for DM, searching for existing conversation...



‚úÖ Found existing conversation JYEWlRqhtZQmz2TQtjnT with type FB



‚úÖ Using conversation type FB from GHL conversation - skipping ID validation



üì® Sending DM reply via GHL: {



  conversationId: 'JYEWlRqhtZQmz2TQtjnT',



  contactId: 'Qyiz7MFsHji0OVBP7WJh',



  message: 'Sorry, I had trouble booking that time. Can you try picking another option?',



  type: 'FB'



}



üì® GHL DM reply response: {



  status: 201,



  contactId: 'Qyiz7MFsHji0OVBP7WJh',



  conversationId: 'JYEWlRqhtZQmz2TQtjnT'



}



POST /ghl/message-webhook



üí¨ GHL MESSAGE WEBHOOK HIT



Raw Body: {



  "consult_explained": "",



  "AI Creative Response": "",



  "Tattoo Style": "",



  "Promotional Link": "",



  "Appt 2: Start Time": "",



  "deposit_confirmation_sent": "",



  "Deposit Made On": "",



  "pending_slot_artist": "",



  "utm medium": "",



  "pending_slot_calendar": "",



  " Appt 2: Cancellation Link": "",



  "total_tattoos_completed": "",



  "Appt 1: Reschedule Link": "",



  "Tattoo Concerns": "",



  "Appt 1: Service": "",



  "reschedule_pending": "",



  "Appt 3: Reschedule Link": "",



  "utm campaign": "",



  "TikTok": "",



  "Tattoo Title": "",



  "reschedule_target_translator_appointment_id": "",



  "Follow Up Reason": "",



  "Technician's Address": "",



  "Square Payment ID": "",



  "Technician's Photo ID": "",



  "pending_slot_end": "",



  "I have been fully informed of the risks of body art including but not limited to infection, scarring, and allergic reactions to items associated with body art procedures. Technician will not perform the body art procedure if you fail to complete or sign this form. Further, technician may decline to perform a body art procedure if the client has any identified health conditions. Having been informed of the potential risks associated with this body art procedure, I still wish to proceed with the body art application and I assume any/all risks that may arise from body art.": "",



  "Appt 2: Start Date": "",



  "Appt 1: End Time": "",



  "Customer Lifetime Value": "",



  "times_sent": "",



  "Language Preference": "English",



  "First Tattoo": "",



  "pending_slot_mode": "",



  "Appt 2: Google Calendar": "",



  "Artist Inquired (Deseado)": "",



  "hold_last_activity_at": "",



  "last_released_slot_start": "",



  "AI Email Subject": "",



  "Instagram": "",



  "Appt 1: IOS/Outlook Calendar": "",



  "First Assigned Barber": "",



  "Appt 1: Start Date": "",



  "Deposit Paid": "",



  "Artist": "",



  "last_released_slot_display": "",



  "Appt 3: Cancellation Link": "",



  "Preferred Artist": "",



  "pending_slot_start": "",



  "Lead Temperature": "warm",



  "Square Payment Status": "",



  "Deposit": "",



  "Appt 3: Google Calendar": "",



  "Appt 3: IOS/Outlook Calendar": "",



  "Emergency Contact": "",



  "Appt 3: Start Date": "",



  "Whatsapp User?": "",



  "Other Social Media": "",



  "Technician's Phone Number": "",



  "Tattoo Color Preference": "",



  "Appt 1: Cancellation Link": "",



  "Last SMS": "",



  "Valid Body Art License": "",



  "Flash Tattoo": "",



  "Appt 1: Assigned User": "",



  "square_payment_link_id": "",



  "last_released_slot_calendar": "",



  "Rent vs Commission": "",



  "Appt 1: Start Time": "",



  "pending_slot_display": "",



  "Location of Tattoo": "",



  "I {{contact.full_name}}, the client, confirm that I have read the above statements, and by checking \"Yes\" below, you give your consent to receive BODY ART.": "",



  "Appt 3: Assigned User": "",



  "Referral: Current Referral Points": "",



  "How would you like us to contact you?": "",



  "returning_client": "",



  "hold_warning_sent": "",



  "Appt 3: End Time": "",



  "consultation_type": "appointment",



  "Final Price": "",



  "Upload a Picture of a Valid ID (Driver's License, Gov ID, etc)": "",



  "Best time to contact you": "",



  "Notes to the Artist? (Optional)": "",



  "language_barrier_explained": "",



  "Application Notes": "",



  "Deposit Link Sent": "",



  "Tattoo Placement": "",



  "Appt 2: Reschedule Link": "",



  "client_lifetime_value": "",



  "Dwelling Type": "",



  "Appt 3: Start Time": "",



  "utm source": "",



  "Appt 1: Google Calendar": "",



  "Date of Procedure:": "",



  "Technician's DOB": "",



  "Referral Link Shortened": "",



  "reschedule_target_appointment_id": "",



  "hold_appointment_id": "",



  "Appt 2: IOS/Outlook Calendar": "",



  "Medical History": "",



  "Medical History (Description)": "",



  "Square Order ID": "",



  "Date Picker 3k8r": "",



  "Last Phase Update At": "2025-12-09T02:40:48.517Z",



  "Photo Reference (Referencia)": "",



  "Assigned Technician License #": "",



  "translator_needed": "Yes",



  "Google Meet Link": "",



  "How Soon Is Client Deciding?": "",



  "Work Experience": "",



  "Appt 3: Service": "",



  "Appt 2: Service": "",



  "Project Complexity": "",



  "Appt 2: End Time": "",



  "Appt 2: Assigned User": "",



  "Square Reference ID": "",



  "translator_appointment_id": "",



  "Tattoo Photo Description": "",



  "Body Art License Number": "",



  "last_released_slot_end": "",



  "Tattoo Size": "",



  "Appt 3: End Date": "",



  "Tattoo Summary": "",



  "AI Phase": "intake",



  "Next Follow Up At": "",



  "Assigned Technician": "",



  "contact_id": "Qyiz7MFsHji0OVBP7WJh",



  "first_name": "Maria",



  "last_name": "Claflin",



  "full_name": "Maria Claflin",



  "tags": "dm consultation request",



  "country": "US",



  "date_created": "2025-12-09T02:33:29.307Z",



  "full_address": "",



  "contact_type": "lead",



  "location": {



    "name": "Studio AZ Tattoo",



    "address": "333 Washington Ave N STE 100",



    "city": "Minneapolis",



    "state": "Minnesota",



    "country": "US",



    "postalCode": "55401",



    "fullAddress": "333 Washington Ave N STE 100, Minneapolis Minnesota 55401",



    "id": "mUemx2jG4wly4kJWBkI4"



  },



  "message": {



    "type": 11,



    "body": "Can I do it tomorrow? December 9th?"



  },



  "workflow": {



    "id": "8cf237bb-6cb1-4240-8ca5-b797bba8b769",



    "name": "Testing Ai Bot"



  },



  "triggerData": {},



  "contact": {



    "attributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    },



    "lastAttributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    }



  },



  "attributionSource": {},



  "customData": {



    "contactId": "Qyiz7MFsHji0OVBP7WJh",



    "messageBody": "Can I do it tomorrow? December 9th?"



  }



}



üì° Channel context: { isDm: true, hasPhone: false, conversationId: null, phone: null }



Parsed contactId from message webhook: Qyiz7MFsHji0OVBP7WJh



‚úÖ Loaded Contact from GHL (message webhook): {



  id: 'Qyiz7MFsHji0OVBP7WJh',



  firstName: 'Maria',



  lastName: 'Claflin',



  tags: [ 'dm consultation request' ]



}



üì© Incoming message text (for language detection): Can I do it tomorrow? December 9th?



üåê Updating language_preference based on DM/SMS detection: { previous: null, next: 'English' }



‚úÖ language_preference updated to English for contact: Qyiz7MFsHji0OVBP7WJh



üß† Derived system state (message): { currentPhase: 'intake', newPhase: 'intake', leadTemperature: 'warm' }



‚úÖ System fields updated for message webhook



üîÑ [PIPELINE] Syncing opportunity stage for contact Qyiz7MFsHji0OVBP7WJh: {



  currentStage: '(none)',



  targetStage: 'INTAKE',



  context: {



    aiPhase: 'intake',



    depositLinkSent: false,



    depositPaid: false,



    consultType: null,



    hasUpcomingTattoo: false,



    tattooCompleted: false,



    lost: false



  }



}



‚ùå Error syncing opportunity stage from message webhook: Request failed with status code 422



üîÑ Refetched contact after system field update for AI call.



ü§ñ Processing message with payload summary: {



  contactId: 'Qyiz7MFsHji0OVBP7WJh',



  leadTemperature: 'warm',



  aiPhase: 'intake',



  language: 'English',



  hasTattooPlacement: false,



  hasTattooSize: false,



  depositPaid: false,



  depositLinkSent: false



}



üîÑ New generation 9 for contact Qyiz7MFsHji0OVBP7WJh



üì± Channel emoji support: yes



üéØ SLOT SELECTION DETECTED - user is picking a specific time



üïê TIME-FIRST MODE: No explicit artist preference, showing all artists' availability



üìÖ [SLOT_GENERATION] Generating slots for 2 specific date(s) using SYNTHETIC times (GHL availability not yet integrated)



üìÖ [SLOT_GENERATION] Generated 4 synthetic slots for dates: 2026-01-09, 2026-12-09



‚ùå Error fetching artist workloads: {



  message: [



    'property pagination should not exist',



    'Query must not exceed 75 characters',



    'query must be a string'



  ],



  error: 'Unprocessable Entity',



üìä Artist workloads: {"Joan":0,"Andrew":0,"Artist2":0,"Artist3":0,"Artist4":0}, sorted order: Joan, Andrew



  statusCode: 422,



  traceId: '48b425c1-f2fb-4f91-baaa-b02db9079df0'



}



üìÖ TIME-FIRST: Presenting 4 slots (online): [



  'Friday, Jan 9 at 5pm [Joan]',



  'Friday, Jan 9 at 6pm [Joan]',



  'Wednesday, Dec 9 at 5pm [Joan]',



  'Wednesday, Dec 9 at 6pm [Joan]'



]



üìÖ Month+day mentioned without time (dec 9) - not selecting



‚ö†Ô∏è Could not match slot selection to available slots - asking to pick from list



‚úâÔ∏è sendConversationMessage context: { contactId: 'Qyiz7MFsHji0OVBP7WJh', isDm: true, hasPhone: false }



üîç No conversationId provided for DM, searching for existing conversation...



‚úÖ Found existing conversation JYEWlRqhtZQmz2TQtjnT with type FB



‚úÖ Using conversation type FB from GHL conversation - skipping ID validation



üì® Sending DM reply via GHL: {



  conversationId: 'JYEWlRqhtZQmz2TQtjnT',



  contactId: 'Qyiz7MFsHji0OVBP7WJh',



  message: "I couldn't quite catch that ‚Äî which of these times works for you?\n" +



    '\n' +



    '1. Friday, Jan 9 at 5pm\n' +



    '2. Friday, Jan 9 at 6pm\n' +



    '3. Wednesday, Dec 9 at 5pm\n' +



    '4. Wednesday, Dec 9 at 6pm',



  type: 'FB'



}



üì® GHL DM reply response: {



  status: 201,



  contactId: 'Qyiz7MFsHji0OVBP7WJh',



  conversationId: 'JYEWlRqhtZQmz2TQtjnT'



}



POST /ghl/message-webhook



üí¨ GHL MESSAGE WEBHOOK HIT



Raw Body: {



  "consult_explained": "",



  "AI Creative Response": "",



  "Tattoo Style": "",



  "Promotional Link": "",



  "Appt 2: Start Time": "",



  "deposit_confirmation_sent": "",



  "Deposit Made On": "",



  "pending_slot_artist": "",



  "utm medium": "",



  "pending_slot_calendar": "",



  " Appt 2: Cancellation Link": "",



  "total_tattoos_completed": "",



  "Appt 1: Reschedule Link": "",



  "Tattoo Concerns": "",



  "Appt 1: Service": "",



  "reschedule_pending": "",



  "Appt 3: Reschedule Link": "",



  "utm campaign": "",



  "TikTok": "",



  "Tattoo Title": "",



  "reschedule_target_translator_appointment_id": "",



  "Follow Up Reason": "",



  "Technician's Address": "",



  "Square Payment ID": "",



  "Technician's Photo ID": "",



  "pending_slot_end": "",



  "I have been fully informed of the risks of body art including but not limited to infection, scarring, and allergic reactions to items associated with body art procedures. Technician will not perform the body art procedure if you fail to complete or sign this form. Further, technician may decline to perform a body art procedure if the client has any identified health conditions. Having been informed of the potential risks associated with this body art procedure, I still wish to proceed with the body art application and I assume any/all risks that may arise from body art.": "",



  "Appt 2: Start Date": "",



  "Appt 1: End Time": "",



  "Customer Lifetime Value": "",



  "times_sent": "",



  "Language Preference": "English",



  "First Tattoo": "",



  "pending_slot_mode": "",



  "Appt 2: Google Calendar": "",



  "Artist Inquired (Deseado)": "",



  "hold_last_activity_at": "",



  "last_released_slot_start": "",



  "AI Email Subject": "",



  "Instagram": "",



  "Appt 1: IOS/Outlook Calendar": "",



  "First Assigned Barber": "",



  "Appt 1: Start Date": "",



  "Deposit Paid": "",



  "Artist": "",



  "last_released_slot_display": "",



  "Appt 3: Cancellation Link": "",



  "Preferred Artist": "",



  "pending_slot_start": "",



  "Lead Temperature": "warm",



  "Square Payment Status": "",



  "Deposit": "",



  "Appt 3: Google Calendar": "",



  "Appt 3: IOS/Outlook Calendar": "",



  "Emergency Contact": "",



  "Appt 3: Start Date": "",



  "Whatsapp User?": "",



  "Other Social Media": "",



  "Technician's Phone Number": "",



  "Tattoo Color Preference": "",



  "Appt 1: Cancellation Link": "",



  "Last SMS": "",



  "Valid Body Art License": "",



  "Flash Tattoo": "",



  "Appt 1: Assigned User": "",



  "square_payment_link_id": "",



  "last_released_slot_calendar": "",



  "Rent vs Commission": "",



  "Appt 1: Start Time": "",



  "pending_slot_display": "",



  "Location of Tattoo": "",



  "I {{contact.full_name}}, the client, confirm that I have read the above statements, and by checking \"Yes\" below, you give your consent to receive BODY ART.": "",



  "Appt 3: Assigned User": "",



  "Referral: Current Referral Points": "",



  "How would you like us to contact you?": "",



  "returning_client": "",



  "hold_warning_sent": "",



  "Appt 3: End Time": "",



  "consultation_type": "appointment",



  "Final Price": "",



  "Upload a Picture of a Valid ID (Driver's License, Gov ID, etc)": "",



  "Best time to contact you": "",



  "Notes to the Artist? (Optional)": "",



  "language_barrier_explained": "",



  "Application Notes": "",



  "Deposit Link Sent": "",



  "Tattoo Placement": "",



  "Appt 2: Reschedule Link": "",



  "client_lifetime_value": "",



  "Dwelling Type": "",



  "Appt 3: Start Time": "",



  "utm source": "",



  "Appt 1: Google Calendar": "",



  "Date of Procedure:": "",



  "Technician's DOB": "",



  "Referral Link Shortened": "",



  "reschedule_target_appointment_id": "",



  "hold_appointment_id": "",



  "Appt 2: IOS/Outlook Calendar": "",



  "Medical History": "",



  "Medical History (Description)": "",



  "Square Order ID": "",



  "Date Picker 3k8r": "",



  "Last Phase Update At": "2025-12-09T02:41:35.204Z",



  "Photo Reference (Referencia)": "",



  "Assigned Technician License #": "",



  "translator_needed": "Yes",



  "Google Meet Link": "",



  "How Soon Is Client Deciding?": "",



  "Work Experience": "",



  "Appt 3: Service": "",



  "Appt 2: Service": "",



  "Project Complexity": "",



  "Appt 2: End Time": "",



  "Appt 2: Assigned User": "",



  "Square Reference ID": "",



  "translator_appointment_id": "",



  "Tattoo Photo Description": "",



  "Body Art License Number": "",



  "last_released_slot_end": "",



  "Tattoo Size": "",



  "Appt 3: End Date": "",



  "Tattoo Summary": "",



  "AI Phase": "intake",



  "Next Follow Up At": "",



  "Assigned Technician": "",



  "contact_id": "Qyiz7MFsHji0OVBP7WJh",



  "first_name": "Maria",



  "last_name": "Claflin",



  "full_name": "Maria Claflin",



  "tags": "dm consultation request",



  "country": "US",



  "date_created": "2025-12-09T02:33:29.307Z",



  "full_address": "",



  "contact_type": "lead",



  "location": {



    "name": "Studio AZ Tattoo",



    "address": "333 Washington Ave N STE 100",



    "city": "Minneapolis",



    "state": "Minnesota",



    "country": "US",



    "postalCode": "55401",



    "fullAddress": "333 Washington Ave N STE 100, Minneapolis Minnesota 55401",



    "id": "mUemx2jG4wly4kJWBkI4"



  },



  "message": {



    "type": 11,



    "body": "Id like to send a deposit for my tattoo consultation"



  },



  "workflow": {



    "id": "8cf237bb-6cb1-4240-8ca5-b797bba8b769",



    "name": "Testing Ai Bot"



  },



  "triggerData": {},



  "contact": {



    "attributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    },



    "lastAttributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    }



  },



  "attributionSource": {},



  "customData": {



    "contactId": "Qyiz7MFsHji0OVBP7WJh",



    "messageBody": "Id like to send a deposit for my tattoo consultation"



  }



}



üì° Channel context: { isDm: true, hasPhone: false, conversationId: null, phone: null }



Parsed contactId from message webhook: Qyiz7MFsHji0OVBP7WJh



‚úÖ Loaded Contact from GHL (message webhook): {



  id: 'Qyiz7MFsHji0OVBP7WJh',



  firstName: 'Maria',



  lastName: 'Claflin',



  tags: [ 'dm consultation request' ]



}



üì© Incoming message text (for language detection): Id like to send a deposit for my tattoo consultation



üåê Updating language_preference based on DM/SMS detection: { previous: null, next: 'English' }



‚úÖ language_preference updated to English for contact: Qyiz7MFsHji0OVBP7WJh



üß† Derived system state (message): { currentPhase: 'intake', newPhase: 'intake', leadTemperature: 'warm' }



‚úÖ System fields updated for message webhook



üîÑ [PIPELINE] Syncing opportunity stage for contact Qyiz7MFsHji0OVBP7WJh: {



  currentStage: '(none)',



  targetStage: 'INTAKE',



  context: {



    aiPhase: 'intake',



    depositLinkSent: false,



    depositPaid: false,



    consultType: null,



    hasUpcomingTattoo: false,



    tattooCompleted: false,



    lost: false



  }



}



‚ùå Error syncing opportunity stage from message webhook: Request failed with status code 422



üîÑ Refetched contact after system field update for AI call.



ü§ñ Processing message with payload summary: {



  contactId: 'Qyiz7MFsHji0OVBP7WJh',



  leadTemperature: 'warm',



  aiPhase: 'intake',



  language: 'English',



  hasTattooPlacement: false,



  hasTattooSize: false,



  depositPaid: false,



  depositLinkSent: false



}



üîÑ New generation 10 for contact Qyiz7MFsHji0OVBP7WJh



üì± Channel emoji support: yes



ü§ñ Raw OpenAI opener response: {



  "language": "en",



  "bubbles": [



    "Awesome, we do require a $100 deposit to hold your consultation. It's fully refundable if you don't like the design, and goes toward your tattoo total.",



    "Before I send the link, what kind of piece are you thinking? Where were you planning to get it?"



  ],



  "internal_notes": "Acknowledging deposit request, explaining deposit policy, and gathering basic tattoo info to qualify lead.",



  "meta": {



    "aiPhase": "intake",



    "leadTemperature": "warm",



    "wantsDepositLink": false,



    "depositPushedThisTurn": true,



    "mentionDecoyOffered": false,



    "consultMode": "online"



  },



  "field_updates": {}



}



üß† AI DECISION SUMMARY {



  aiPhaseFromAI: 'intake',



  leadTemperatureFromAI: 'warm',



  wantsDepositLink: false,



  wantsAppointmentOffer: undefined,



  consultMode: 'online',



  depositPushedThisTurn: true,



  mentionDecoyOffered: false,



  bubblesPreview: [



    "Awesome, we do require a $100 deposit to hold your consultation. It's fully refu",



    'Before I send the link, what kind of piece are you thinking? Where were you plan'



  ]



}



ü§ñ AI DM suggestion: {



  "language": "en",



  "bubbles": [



    "Awesome, we do require a $100 deposit to hold your consultation. It's fully refundable if you don't like the design, and goes toward your tattoo total.",



    "Before I send the link, what kind of piece are you thinking? Where were you planning to get it?"



  ],



  "internal_notes": "Acknowledging deposit request, explaining deposit policy, and gathering basic tattoo info to qualify lead.",



  "meta": {



    "aiPhase": "intake",



    "leadTemperature": "warm",



    "wantsDepositLink": false,



    "depositPushedThisTurn": true,



    "mentionDecoyOffered": false,



    "consultMode": "online"



  }



}



‚úâÔ∏è sendConversationMessage context: { contactId: 'Qyiz7MFsHji0OVBP7WJh', isDm: true, hasPhone: false }



üîç No conversationId provided for DM, searching for existing conversation...



‚úÖ Found existing conversation JYEWlRqhtZQmz2TQtjnT with type FB



‚úÖ Using conversation type FB from GHL conversation - skipping ID validation



üì® Sending DM reply via GHL: {



  conversationId: 'JYEWlRqhtZQmz2TQtjnT',



  contactId: 'Qyiz7MFsHji0OVBP7WJh',



  message: "Awesome, we do require a $100 deposit to hold your consultation. It's fully refundable if you don't like the design, and goes toward your tattoo total.",



  type: 'FB'



}



üì® GHL DM reply response: {



  status: 201,



  contactId: 'Qyiz7MFsHji0OVBP7WJh',



  conversationId: 'JYEWlRqhtZQmz2TQtjnT'



}



‚è± Waiting 12000ms before sending bubble 2...



‚úâÔ∏è sendConversationMessage context: { contactId: 'Qyiz7MFsHji0OVBP7WJh', isDm: true, hasPhone: false }



üîç No conversationId provided for DM, searching for existing conversation...



‚úÖ Found existing conversation JYEWlRqhtZQmz2TQtjnT with type FB



‚úÖ Using conversation type FB from GHL conversation - skipping ID validation



üì® Sending DM reply via GHL: {



  conversationId: 'JYEWlRqhtZQmz2TQtjnT',



  contactId: 'Qyiz7MFsHji0OVBP7WJh',



  message: 'Before I send the link, what kind of piece are you thinking? Where were you planning to get it?',



  type: 'FB'



}



üì® GHL DM reply response: {



  status: 201,



  contactId: 'Qyiz7MFsHji0OVBP7WJh',



  conversationId: 'JYEWlRqhtZQmz2TQtjnT'



}



üì§ Sent AI bubbles to GHL conversation.



üìã AI explained consult this turn - marking consult_explained = true



üß† Updating contact system fields from AI meta: {



  ai_phase: 'intake',



  lead_temperature: 'warm',



  consult_explained: true



}



‚ÑπÔ∏è No field_updates from AI to apply this turn.



‚ÑπÔ∏è No deposit link created (either not requested, already sent, or already paid). { wantsDepositLink: false, alreadyPaid: false, alreadySent: false }



POST /ghl/message-webhook



üí¨ GHL MESSAGE WEBHOOK HIT



Raw Body: {



  "consult_explained": "Yes",



  "AI Creative Response": "",



  "Tattoo Style": "",



  "Promotional Link": "",



  "Appt 2: Start Time": "",



  "deposit_confirmation_sent": "",



  "Deposit Made On": "",



  "pending_slot_artist": "",



  "utm medium": "",



  "pending_slot_calendar": "",



  " Appt 2: Cancellation Link": "",



  "total_tattoos_completed": "",



  "Appt 1: Reschedule Link": "",



  "Tattoo Concerns": "",



  "Appt 1: Service": "",



  "reschedule_pending": "",



  "Appt 3: Reschedule Link": "",



  "utm campaign": "",



  "TikTok": "",



  "Tattoo Title": "",



  "reschedule_target_translator_appointment_id": "",



  "Follow Up Reason": "",



  "Technician's Address": "",



  "Square Payment ID": "",



  "Technician's Photo ID": "",



  "pending_slot_end": "",



  "I have been fully informed of the risks of body art including but not limited to infection, scarring, and allergic reactions to items associated with body art procedures. Technician will not perform the body art procedure if you fail to complete or sign this form. Further, technician may decline to perform a body art procedure if the client has any identified health conditions. Having been informed of the potential risks associated with this body art procedure, I still wish to proceed with the body art application and I assume any/all risks that may arise from body art.": "",



  "Appt 2: Start Date": "",



  "Appt 1: End Time": "",



  "Customer Lifetime Value": "",



  "times_sent": "",



  "Language Preference": "English",



  "First Tattoo": "",



  "pending_slot_mode": "",



  "Appt 2: Google Calendar": "",



  "Artist Inquired (Deseado)": "",



  "hold_last_activity_at": "",



  "last_released_slot_start": "",



  "AI Email Subject": "",



  "Instagram": "",



  "Appt 1: IOS/Outlook Calendar": "",



  "First Assigned Barber": "",



  "Appt 1: Start Date": "",



  "Deposit Paid": "",



  "Artist": "",



  "last_released_slot_display": "",



  "Appt 3: Cancellation Link": "",



  "Preferred Artist": "",



  "pending_slot_start": "",



  "Lead Temperature": "warm",



  "Square Payment Status": "",



  "Deposit": "",



  "Appt 3: Google Calendar": "",



  "Appt 3: IOS/Outlook Calendar": "",



  "Emergency Contact": "",



  "Appt 3: Start Date": "",



  "Whatsapp User?": "",



  "Other Social Media": "",



  "Technician's Phone Number": "",



  "Tattoo Color Preference": "",



  "Appt 1: Cancellation Link": "",



  "Last SMS": "",



  "Valid Body Art License": "",



  "Flash Tattoo": "",



  "Appt 1: Assigned User": "",



  "square_payment_link_id": "",



  "last_released_slot_calendar": "",



  "Rent vs Commission": "",



  "Appt 1: Start Time": "",



  "pending_slot_display": "",



  "Location of Tattoo": "",



  "I {{contact.full_name}}, the client, confirm that I have read the above statements, and by checking \"Yes\" below, you give your consent to receive BODY ART.": "",



  "Appt 3: Assigned User": "",



  "Referral: Current Referral Points": "",



  "How would you like us to contact you?": "",



  "returning_client": "",



  "hold_warning_sent": "",



  "Appt 3: End Time": "",



  "consultation_type": "appointment",



  "Final Price": "",



  "Upload a Picture of a Valid ID (Driver's License, Gov ID, etc)": "",



  "Best time to contact you": "",



  "Notes to the Artist? (Optional)": "",



  "language_barrier_explained": "",



  "Application Notes": "",



  "Deposit Link Sent": "",



  "Tattoo Placement": "",



  "Appt 2: Reschedule Link": "",



  "client_lifetime_value": "",



  "Dwelling Type": "",



  "Appt 3: Start Time": "",



  "utm source": "",



  "Appt 1: Google Calendar": "",



  "Date of Procedure:": "",



  "Technician's DOB": "",



  "Referral Link Shortened": "",



  "reschedule_target_appointment_id": "",



  "hold_appointment_id": "",



  "Appt 2: IOS/Outlook Calendar": "",



  "Medical History": "",



  "Medical History (Description)": "",



  "Square Order ID": "",



  "Date Picker 3k8r": "",



  "Last Phase Update At": "2025-12-09T02:43:35.988Z",



  "Photo Reference (Referencia)": "",



  "Assigned Technician License #": "",



  "translator_needed": "Yes",



  "Google Meet Link": "",



  "How Soon Is Client Deciding?": "",



  "Work Experience": "",



  "Appt 3: Service": "",



  "Appt 2: Service": "",



  "Project Complexity": "",



  "Appt 2: End Time": "",



  "Appt 2: Assigned User": "",



  "Square Reference ID": "",



  "translator_appointment_id": "",



  "Tattoo Photo Description": "",



  "Body Art License Number": "",



  "last_released_slot_end": "",



  "Tattoo Size": "",



  "Appt 3: End Date": "",



  "Tattoo Summary": "",



  "AI Phase": "intake",



  "Next Follow Up At": "",



  "Assigned Technician": "",



  "contact_id": "Qyiz7MFsHji0OVBP7WJh",



  "first_name": "Maria",



  "last_name": "Claflin",



  "full_name": "Maria Claflin",



  "tags": "dm consultation request",



  "country": "US",



  "date_created": "2025-12-09T02:33:29.307Z",



  "full_address": "",



  "contact_type": "lead",



  "location": {



    "name": "Studio AZ Tattoo",



    "address": "333 Washington Ave N STE 100",



    "city": "Minneapolis",



    "state": "Minnesota",



    "country": "US",



    "postalCode": "55401",



    "fullAddress": "333 Washington Ave N STE 100, Minneapolis Minnesota 55401",



    "id": "mUemx2jG4wly4kJWBkI4"



  },



  "message": {



    "type": 11,



    "body": "That sounds good. I want to get my kids name up my calf in thick cursive font !"



  },



  "workflow": {



    "id": "8cf237bb-6cb1-4240-8ca5-b797bba8b769",



    "name": "Testing Ai Bot"



  },



  "triggerData": {},



  "contact": {



    "attributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    },



    "lastAttributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    }



  },



  "attributionSource": {},



  "customData": {



    "contactId": "Qyiz7MFsHji0OVBP7WJh",



    "messageBody": "That sounds good. I want to get my kids name up my calf in thick cursive font !"



  }



}



üì° Channel context: { isDm: true, hasPhone: false, conversationId: null, phone: null }



Parsed contactId from message webhook: Qyiz7MFsHji0OVBP7WJh



‚úÖ Loaded Contact from GHL (message webhook): {



  id: 'Qyiz7MFsHji0OVBP7WJh',



  firstName: 'Maria',



  lastName: 'Claflin',



  tags: [ 'dm consultation request' ]



}



üì© Incoming message text (for language detection): That sounds good. I want to get my kids name up my calf in thick cursive font !



üåê Updating language_preference based on DM/SMS detection: { previous: null, next: 'English' }



‚úÖ language_preference updated to English for contact: Qyiz7MFsHji0OVBP7WJh



üß† Derived system state (message): { currentPhase: 'intake', newPhase: 'intake', leadTemperature: 'warm' }



‚úÖ System fields updated for message webhook



üîÑ [PIPELINE] Syncing opportunity stage for contact Qyiz7MFsHji0OVBP7WJh: {



  currentStage: '(none)',



  targetStage: 'INTAKE',



  context: {



    aiPhase: 'intake',



    depositLinkSent: false,



    depositPaid: false,



    consultType: null,



    hasUpcomingTattoo: false,



    tattooCompleted: false,



    lost: false



  }



}



‚ùå Error syncing opportunity stage from message webhook: Request failed with status code 422



üîÑ Refetched contact after system field update for AI call.



ü§ñ Processing message with payload summary: {



  contactId: 'Qyiz7MFsHji0OVBP7WJh',



  leadTemperature: 'warm',



  aiPhase: 'intake',



  language: 'English',



  hasTattooPlacement: false,



  hasTattooSize: false,



  depositPaid: false,



  depositLinkSent: false



}



üîÑ New generation 11 for contact Qyiz7MFsHji0OVBP7WJh



üì± Channel emoji support: yes



ü§ñ Raw OpenAI opener response: {



  "language": "en",



  "bubbles": [



    "Got it ‚Äî that calf piece with your kid's name in thick cursive will look clean.",



    "Roughly how big were you thinking for the size?"



  ],



  "internal_notes": "Acknowledged tattoo idea and placement, asked about size to continue intake.",



  "meta": {



    "aiPhase": "intake",



    "leadTemperature": "warm",



    "wantsDepositLink": false,



    "depositPushedThisTurn": false,



    "mentionDecoyOffered": false,



    "consultMode": "online"



  },



  "field_updates": {



    "tattoo_placement": "calf",



    "tattoo_style": "cursive",



    "tattoo_summary": "kid's name in thick cursive font on calf"



  }



}



üß† AI DECISION SUMMARY {



  aiPhaseFromAI: 'intake',



  leadTemperatureFromAI: 'warm',



  wantsDepositLink: false,



  wantsAppointmentOffer: undefined,



  consultMode: 'online',



  depositPushedThisTurn: false,



  mentionDecoyOffered: false,



  field_updates: {



    tattoo_placement: 'calf',



    tattoo_style: 'cursive',



    tattoo_summary: "kid's name in thick cursive font on calf"



  },



  bubblesPreview: [



    "Got it ‚Äî that calf piece with your kid's name in thick cursive will look clean.",



    'Roughly how big were you thinking for the size?'



  ]



}



ü§ñ AI DM suggestion: {



  "language": "en",



  "bubbles": [



    "Got it ‚Äî that calf piece with your kid's name in thick cursive will look clean.",



    "Roughly how big were you thinking for the size?"



  ],



  "internal_notes": "Acknowledged tattoo idea and placement, asked about size to continue intake.",



  "meta": {



    "aiPhase": "intake",



    "leadTemperature": "warm",



    "wantsDepositLink": false,



    "depositPushedThisTurn": false,



    "mentionDecoyOffered": false,



    "consultMode": "online"



  },



  "field_updates": {



    "tattoo_placement": "calf",



    "tattoo_style": "cursive",



    "tattoo_summary": "kid's name in thick cursive font on calf"



  }



}



‚úâÔ∏è sendConversationMessage context: { contactId: 'Qyiz7MFsHji0OVBP7WJh', isDm: true, hasPhone: false }



üîç No conversationId provided for DM, searching for existing conversation...



‚úÖ Found existing conversation JYEWlRqhtZQmz2TQtjnT with type FB



‚úÖ Using conversation type FB from GHL conversation - skipping ID validation



üì® Sending DM reply via GHL: {



  conversationId: 'JYEWlRqhtZQmz2TQtjnT',



  contactId: 'Qyiz7MFsHji0OVBP7WJh',



  message: "Got it ‚Äî that calf piece with your kid's name in thick cursive will look clean.",



  type: 'FB'



}



üì® GHL DM reply response: {



  status: 201,



  contactId: 'Qyiz7MFsHji0OVBP7WJh',



  conversationId: 'JYEWlRqhtZQmz2TQtjnT'



}



‚è± Waiting 8000ms before sending bubble 2...



‚úâÔ∏è sendConversationMessage context: { contactId: 'Qyiz7MFsHji0OVBP7WJh', isDm: true, hasPhone: false }



üîç No conversationId provided for DM, searching for existing conversation...



‚úÖ Found existing conversation JYEWlRqhtZQmz2TQtjnT with type FB



‚úÖ Using conversation type FB from GHL conversation - skipping ID validation



üì® Sending DM reply via GHL: {



  conversationId: 'JYEWlRqhtZQmz2TQtjnT',



  contactId: 'Qyiz7MFsHji0OVBP7WJh',



  message: 'Roughly how big were you thinking for the size?',



  type: 'FB'



}



üì® GHL DM reply response: {



  status: 201,



  contactId: 'Qyiz7MFsHji0OVBP7WJh',



  conversationId: 'JYEWlRqhtZQmz2TQtjnT'



}



üì§ Sent AI bubbles to GHL conversation.



üß† Updating contact system fields from AI meta: {



  ai_phase: 'intake',



  lead_temperature: 'warm',



  consult_explained: undefined



}



üßæ Applying AI field_updates to GHL: {



  tattoo_placement: 'calf',



  tattoo_style: 'cursive',



  tattoo_summary: "kid's name in thick cursive font on calf"



}



‚úÖ Updated tattoo fields for contact Qyiz7MFsHji0OVBP7WJh with {



  tattoo_placement: 'calf',



  tattoo_style: 'cursive',



  tattoo_summary: "kid's name in thick cursive font on calf"



}



‚ÑπÔ∏è No deposit link created (either not requested, already sent, or already paid). { wantsDepositLink: false, alreadyPaid: false, alreadySent: false }



POST /ghl/message-webhook



üí¨ GHL MESSAGE WEBHOOK HIT



Raw Body: {



  "consult_explained": "Yes",



  "AI Creative Response": "",



  "Tattoo Style": "cursive",



  "Promotional Link": "",



  "Appt 2: Start Time": "",



  "deposit_confirmation_sent": "",



  "Deposit Made On": "",



  "pending_slot_artist": "",



  "utm medium": "",



  "pending_slot_calendar": "",



  " Appt 2: Cancellation Link": "",



  "total_tattoos_completed": "",



  "Appt 1: Reschedule Link": "",



  "Tattoo Concerns": "",



  "Appt 1: Service": "",



  "reschedule_pending": "",



  "Appt 3: Reschedule Link": "",



  "utm campaign": "",



  "TikTok": "",



  "Tattoo Title": "",



  "reschedule_target_translator_appointment_id": "",



  "Follow Up Reason": "",



  "Technician's Address": "",



  "Square Payment ID": "",



  "Technician's Photo ID": "",



  "pending_slot_end": "",



  "I have been fully informed of the risks of body art including but not limited to infection, scarring, and allergic reactions to items associated with body art procedures. Technician will not perform the body art procedure if you fail to complete or sign this form. Further, technician may decline to perform a body art procedure if the client has any identified health conditions. Having been informed of the potential risks associated with this body art procedure, I still wish to proceed with the body art application and I assume any/all risks that may arise from body art.": "",



  "Appt 2: Start Date": "",



  "Appt 1: End Time": "",



  "Customer Lifetime Value": "",



  "times_sent": "",



  "Language Preference": "English",



  "First Tattoo": "",



  "pending_slot_mode": "",



  "Appt 2: Google Calendar": "",



  "Artist Inquired (Deseado)": "",



  "hold_last_activity_at": "",



  "last_released_slot_start": "",



  "AI Email Subject": "",



  "Instagram": "",



  "Appt 1: IOS/Outlook Calendar": "",



  "First Assigned Barber": "",



  "Appt 1: Start Date": "",



  "Deposit Paid": "",



  "Artist": "",



  "last_released_slot_display": "",



  "Appt 3: Cancellation Link": "",



  "Preferred Artist": "",



  "pending_slot_start": "",



  "Lead Temperature": "warm",



  "Square Payment Status": "",



  "Deposit": "",



  "Appt 3: Google Calendar": "",



  "Appt 3: IOS/Outlook Calendar": "",



  "Emergency Contact": "",



  "Appt 3: Start Date": "",



  "Whatsapp User?": "",



  "Other Social Media": "",



  "Technician's Phone Number": "",



  "Tattoo Color Preference": "",



  "Appt 1: Cancellation Link": "",



  "Last SMS": "",



  "Valid Body Art License": "",



  "Flash Tattoo": "",



  "Appt 1: Assigned User": "",



  "square_payment_link_id": "",



  "last_released_slot_calendar": "",



  "Rent vs Commission": "",



  "Appt 1: Start Time": "",



  "pending_slot_display": "",



  "Location of Tattoo": "",



  "I {{contact.full_name}}, the client, confirm that I have read the above statements, and by checking \"Yes\" below, you give your consent to receive BODY ART.": "",



  "Appt 3: Assigned User": "",



  "Referral: Current Referral Points": "",



  "How would you like us to contact you?": "",



  "returning_client": "",



  "hold_warning_sent": "",



  "Appt 3: End Time": "",



  "consultation_type": "appointment",



  "Final Price": "",



  "Upload a Picture of a Valid ID (Driver's License, Gov ID, etc)": "",



  "Best time to contact you": "",



  "Notes to the Artist? (Optional)": "",



  "language_barrier_explained": "",



  "Application Notes": "",



  "Deposit Link Sent": "",



  "Tattoo Placement": "calf",



  "Appt 2: Reschedule Link": "",



  "client_lifetime_value": "",



  "Dwelling Type": "",



  "Appt 3: Start Time": "",



  "utm source": "",



  "Appt 1: Google Calendar": "",



  "Date of Procedure:": "",



  "Technician's DOB": "",



  "Referral Link Shortened": "",



  "reschedule_target_appointment_id": "",



  "hold_appointment_id": "",



  "Appt 2: IOS/Outlook Calendar": "",



  "Medical History": "",



  "Medical History (Description)": "",



  "Square Order ID": "",



  "Date Picker 3k8r": "",



  "Last Phase Update At": "2025-12-09T02:44:49.828Z",



  "Photo Reference (Referencia)": "",



  "Assigned Technician License #": "",



  "translator_needed": "Yes",



  "Google Meet Link": "",



  "How Soon Is Client Deciding?": "",



  "Work Experience": "",



  "Appt 3: Service": "",



  "Appt 2: Service": "",



  "Project Complexity": "",



  "Appt 2: End Time": "",



  "Appt 2: Assigned User": "",



  "Square Reference ID": "",



  "translator_appointment_id": "",



  "Tattoo Photo Description": "",



  "Body Art License Number": "",



  "last_released_slot_end": "",



  "Tattoo Size": "",



  "Appt 3: End Date": "",



  "Tattoo Summary": "kid's name in thick cursive font on calf",



  "AI Phase": "intake",



  "Next Follow Up At": "",



  "Assigned Technician": "",



  "contact_id": "Qyiz7MFsHji0OVBP7WJh",



  "first_name": "Maria",



  "last_name": "Claflin",



  "full_name": "Maria Claflin",



  "tags": "dm consultation request",



  "country": "US",



  "date_created": "2025-12-09T02:33:29.307Z",



  "full_address": "",



  "contact_type": "lead",



  "location": {



    "name": "Studio AZ Tattoo",



    "address": "333 Washington Ave N STE 100",



    "city": "Minneapolis",



    "state": "Minnesota",



    "country": "US",



    "postalCode": "55401",



    "fullAddress": "333 Washington Ave N STE 100, Minneapolis Minnesota 55401",



    "id": "mUemx2jG4wly4kJWBkI4"



  },



  "message": {



    "type": 11,



    "body": "Covering my calf so about the size of 2 hands"



  },



  "workflow": {



    "id": "8cf237bb-6cb1-4240-8ca5-b797bba8b769",



    "name": "Testing Ai Bot"



  },



  "triggerData": {},



  "contact": {



    "attributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    },



    "lastAttributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    }



  },



  "attributionSource": {},



  "customData": {



    "contactId": "Qyiz7MFsHji0OVBP7WJh",



    "messageBody": "Covering my calf so about the size of 2 hands"



  }



}



üì° Channel context: { isDm: true, hasPhone: false, conversationId: null, phone: null }



Parsed contactId from message webhook: Qyiz7MFsHji0OVBP7WJh



‚úÖ Loaded Contact from GHL (message webhook): {



  id: 'Qyiz7MFsHji0OVBP7WJh',



  firstName: 'Maria',



  lastName: 'Claflin',



  tags: [ 'dm consultation request' ]



}



üì© Incoming message text (for language detection): Covering my calf so about the size of 2 hands



üåê Updating language_preference based on DM/SMS detection: { previous: null, next: 'English' }



‚úÖ language_preference updated to English for contact: Qyiz7MFsHji0OVBP7WJh



üß† Derived system state (message): { currentPhase: 'intake', newPhase: 'intake', leadTemperature: 'warm' }



‚úÖ System fields updated for message webhook



üîÑ [PIPELINE] Syncing opportunity stage for contact Qyiz7MFsHji0OVBP7WJh: {



  currentStage: '(none)',



  targetStage: 'INTAKE',



  context: {



    aiPhase: 'intake',



    depositLinkSent: false,



    depositPaid: false,



    consultType: null,



    hasUpcomingTattoo: false,



    tattooCompleted: false,



    lost: false



  }



}



‚ùå Error syncing opportunity stage from message webhook: Request failed with status code 422



üîÑ Refetched contact after system field update for AI call.



ü§ñ Processing message with payload summary: {



  contactId: 'Qyiz7MFsHji0OVBP7WJh',



  leadTemperature: 'warm',



  aiPhase: 'intake',



  language: 'English',



  hasTattooPlacement: true,



  hasTattooSize: false,



  depositPaid: false,



  depositLinkSent: false



}



üîÑ New generation 12 for contact Qyiz7MFsHji0OVBP7WJh



üì± Channel emoji support: yes



ü§ñ Raw OpenAI opener response: {



  "language": "en",



  "bubbles": [



    "Nice, that calf piece about the size of two hands with the kid's name in thick cursive will look really clean.",



    "When were you hoping to get it done?"



  ],



  "internal_notes": "Acknowledged tattoo placement, size, style, and summary; moved to timing question to qualify lead.",



  "meta": {



    "aiPhase": "qualification",



    "leadTemperature": "warm",



    "wantsDepositLink": false,



    "depositPushedThisTurn": false,



    "mentionDecoyOffered": false,



    "consultMode": "online"



  },



  "field_updates": {



    "tattoo_placement": "calf",



    "size_of_tattoo": "about the size of 2 hands",



    "tattoo_style": "cursive",



    "tattoo_summary": "kid's name in thick cursive font on calf"



  }



}



üß† AI DECISION SUMMARY {



  aiPhaseFromAI: 'qualification',



  leadTemperatureFromAI: 'warm',



  wantsDepositLink: false,



  wantsAppointmentOffer: undefined,



  consultMode: 'online',



  depositPushedThisTurn: false,



  mentionDecoyOffered: false,



  field_updates: {



    tattoo_placement: 'calf',



    size_of_tattoo: 'about the size of 2 hands',



    tattoo_style: 'cursive',



    tattoo_summary: "kid's name in thick cursive font on calf"



  },



  bubblesPreview: [



    "Nice, that calf piece about the size of two hands with the kid's name in thick c",



    'When were you hoping to get it done?'



  ]



}



ü§ñ AI DM suggestion: {



  "language": "en",



  "bubbles": [



    "Nice, that calf piece about the size of two hands with the kid's name in thick cursive will look really clean.",



    "When were you hoping to get it done?"



  ],



  "internal_notes": "Acknowledged tattoo placement, size, style, and summary; moved to timing question to qualify lead.",



  "meta": {



    "aiPhase": "qualification",



    "leadTemperature": "warm",



    "wantsDepositLink": false,



    "depositPushedThisTurn": false,



    "mentionDecoyOffered": false,



    "consultMode": "online"



  },



  "field_updates": {



    "tattoo_placement": "calf",



    "size_of_tattoo": "about the size of 2 hands",



    "tattoo_style": "cursive",



    "tattoo_summary": "kid's name in thick cursive font on calf"



  }



}



‚úâÔ∏è sendConversationMessage context: { contactId: 'Qyiz7MFsHji0OVBP7WJh', isDm: true, hasPhone: false }



üîç No conversationId provided for DM, searching for existing conversation...



‚úÖ Found existing conversation JYEWlRqhtZQmz2TQtjnT with type FB



‚úÖ Using conversation type FB from GHL conversation - skipping ID validation



üì® Sending DM reply via GHL: {



  conversationId: 'JYEWlRqhtZQmz2TQtjnT',



  contactId: 'Qyiz7MFsHji0OVBP7WJh',



  message: "Nice, that calf piece about the size of two hands with the kid's name in thick cursive will look really clean.",



  type: 'FB'



}



üì® GHL DM reply response: {



  status: 201,



  contactId: 'Qyiz7MFsHji0OVBP7WJh',



  conversationId: 'JYEWlRqhtZQmz2TQtjnT'



}



‚è± Waiting 8000ms before sending bubble 2...



‚úâÔ∏è sendConversationMessage context: { contactId: 'Qyiz7MFsHji0OVBP7WJh', isDm: true, hasPhone: false }



üîç No conversationId provided for DM, searching for existing conversation...



‚úÖ Found existing conversation JYEWlRqhtZQmz2TQtjnT with type FB



‚úÖ Using conversation type FB from GHL conversation - skipping ID validation



üì® Sending DM reply via GHL: {



  conversationId: 'JYEWlRqhtZQmz2TQtjnT',



  contactId: 'Qyiz7MFsHji0OVBP7WJh',



  message: 'When were you hoping to get it done?',



  type: 'FB'



}



üì® GHL DM reply response: {



  status: 201,



  contactId: 'Qyiz7MFsHji0OVBP7WJh',



  conversationId: 'JYEWlRqhtZQmz2TQtjnT'



}



üì§ Sent AI bubbles to GHL conversation.



üß† Updating contact system fields from AI meta: {



  ai_phase: 'qualification',



  lead_temperature: 'warm',



  consult_explained: undefined



}



üßæ Applying AI field_updates to GHL: {



  tattoo_placement: 'calf',



  size_of_tattoo: 'about the size of 2 hands',



  tattoo_style: 'cursive',



  tattoo_summary: "kid's name in thick cursive font on calf"



}



‚úÖ Updated tattoo fields for contact Qyiz7MFsHji0OVBP7WJh with {



  tattoo_placement: 'calf',



  size_of_tattoo: 'about the size of 2 hands',



  tattoo_style: 'cursive',



  tattoo_summary: "kid's name in thick cursive font on calf"



}



‚ÑπÔ∏è No deposit link created (either not requested, already sent, or already paid). { wantsDepositLink: false, alreadyPaid: false, alreadySent: false }



POST /ghl/message-webhook



üí¨ GHL MESSAGE WEBHOOK HIT



Raw Body: {



  "consult_explained": "Yes",



  "AI Creative Response": "",



  "Tattoo Style": "cursive",



  "Promotional Link": "",



  "Appt 2: Start Time": "",



  "deposit_confirmation_sent": "",



  "Deposit Made On": "",



  "pending_slot_artist": "",



  "utm medium": "",



  "pending_slot_calendar": "",



  " Appt 2: Cancellation Link": "",



  "total_tattoos_completed": "",



  "Appt 1: Reschedule Link": "",



  "Tattoo Concerns": "",



  "Appt 1: Service": "",



  "reschedule_pending": "",



  "Appt 3: Reschedule Link": "",



  "utm campaign": "",



  "TikTok": "",



  "Tattoo Title": "",



  "reschedule_target_translator_appointment_id": "",



  "Follow Up Reason": "",



  "Technician's Address": "",



  "Square Payment ID": "",



  "Technician's Photo ID": "",



  "pending_slot_end": "",



  "I have been fully informed of the risks of body art including but not limited to infection, scarring, and allergic reactions to items associated with body art procedures. Technician will not perform the body art procedure if you fail to complete or sign this form. Further, technician may decline to perform a body art procedure if the client has any identified health conditions. Having been informed of the potential risks associated with this body art procedure, I still wish to proceed with the body art application and I assume any/all risks that may arise from body art.": "",



  "Appt 2: Start Date": "",



  "Appt 1: End Time": "",



  "Customer Lifetime Value": "",



  "times_sent": "",



  "Language Preference": "English",



  "First Tattoo": "",



  "pending_slot_mode": "",



  "Appt 2: Google Calendar": "",



  "Artist Inquired (Deseado)": "",



  "hold_last_activity_at": "",



  "last_released_slot_start": "",



  "AI Email Subject": "",



  "Instagram": "",



  "Appt 1: IOS/Outlook Calendar": "",



  "First Assigned Barber": "",



  "Appt 1: Start Date": "",



  "Deposit Paid": "",



  "Artist": "",



  "last_released_slot_display": "",



  "Appt 3: Cancellation Link": "",



  "Preferred Artist": "",



  "pending_slot_start": "",



  "Lead Temperature": "warm",



  "Square Payment Status": "",



  "Deposit": "",



  "Appt 3: Google Calendar": "",



  "Appt 3: IOS/Outlook Calendar": "",



  "Emergency Contact": "",



  "Appt 3: Start Date": "",



  "Whatsapp User?": "",



  "Other Social Media": "",



  "Technician's Phone Number": "",



  "Tattoo Color Preference": "",



  "Appt 1: Cancellation Link": "",



  "Last SMS": "",



  "Valid Body Art License": "",



  "Flash Tattoo": "",



  "Appt 1: Assigned User": "",



  "square_payment_link_id": "",



  "last_released_slot_calendar": "",



  "Rent vs Commission": "",



  "Appt 1: Start Time": "",



  "pending_slot_display": "",



  "Location of Tattoo": "",



  "I {{contact.full_name}}, the client, confirm that I have read the above statements, and by checking \"Yes\" below, you give your consent to receive BODY ART.": "",



  "Appt 3: Assigned User": "",



  "Referral: Current Referral Points": "",



  "How would you like us to contact you?": "",



  "returning_client": "",



  "hold_warning_sent": "",



  "Appt 3: End Time": "",



  "consultation_type": "appointment",



  "Final Price": "",



  "Upload a Picture of a Valid ID (Driver's License, Gov ID, etc)": "",



  "Best time to contact you": "",



  "Notes to the Artist? (Optional)": "",



  "language_barrier_explained": "",



  "Application Notes": "",



  "Deposit Link Sent": "",



  "Tattoo Placement": "calf",



  "Appt 2: Reschedule Link": "",



  "client_lifetime_value": "",



  "Dwelling Type": "",



  "Appt 3: Start Time": "",



  "utm source": "",



  "Appt 1: Google Calendar": "",



  "Date of Procedure:": "",



  "Technician's DOB": "",



  "Referral Link Shortened": "",



  "reschedule_target_appointment_id": "",



  "hold_appointment_id": "",



  "Appt 2: IOS/Outlook Calendar": "",



  "Medical History": "",



  "Medical History (Description)": "",



  "Square Order ID": "",



  "Date Picker 3k8r": "",



  "Last Phase Update At": "2025-12-09T02:45:48.836Z",



  "Photo Reference (Referencia)": "",



  "Assigned Technician License #": "",



  "translator_needed": "Yes",



  "Google Meet Link": "",



  "How Soon Is Client Deciding?": "",



  "Work Experience": "",



  "Appt 3: Service": "",



  "Appt 2: Service": "",



  "Project Complexity": "",



  "Appt 2: End Time": "",



  "Appt 2: Assigned User": "",



  "Square Reference ID": "",



  "translator_appointment_id": "",



  "Tattoo Photo Description": "",



  "Body Art License Number": "",



  "last_released_slot_end": "",



  "Tattoo Size": "about the size of 2 hands",



  "Appt 3: End Date": "",



  "Tattoo Summary": "kid's name in thick cursive font on calf",



  "AI Phase": "qualification",



  "Next Follow Up At": "",



  "Assigned Technician": "",



  "contact_id": "Qyiz7MFsHji0OVBP7WJh",



  "first_name": "Maria",



  "last_name": "Claflin",



  "full_name": "Maria Claflin",



  "tags": "dm consultation request",



  "country": "US",



  "date_created": "2025-12-09T02:33:29.307Z",



  "full_address": "",



  "contact_type": "lead",



  "location": {



    "name": "Studio AZ Tattoo",



    "address": "333 Washington Ave N STE 100",



    "city": "Minneapolis",



    "state": "Minnesota",



    "country": "US",



    "postalCode": "55401",



    "fullAddress": "333 Washington Ave N STE 100, Minneapolis Minnesota 55401",



    "id": "mUemx2jG4wly4kJWBkI4"



  },



  "message": {



    "type": 11,



    "body": "In December"



  },



  "workflow": {



    "id": "8cf237bb-6cb1-4240-8ca5-b797bba8b769",



    "name": "Testing Ai Bot"



  },



  "triggerData": {},



  "contact": {



    "attributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    },



    "lastAttributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    }



  },



  "attributionSource": {},



  "customData": {



    "contactId": "Qyiz7MFsHji0OVBP7WJh",



    "messageBody": "In December"



  }



}



üì° Channel context: { isDm: true, hasPhone: false, conversationId: null, phone: null }



Parsed contactId from message webhook: Qyiz7MFsHji0OVBP7WJh



‚úÖ Loaded Contact from GHL (message webhook): {



  id: 'Qyiz7MFsHji0OVBP7WJh',



  firstName: 'Maria',



  lastName: 'Claflin',



  tags: [ 'dm consultation request' ]



}



üì© Incoming message text (for language detection): In December



üåê Updating language_preference based on DM/SMS detection: { previous: null, next: 'English' }



‚úÖ language_preference updated to English for contact: Qyiz7MFsHji0OVBP7WJh



üß† Derived system state (message): {



  currentPhase: 'qualification',



  newPhase: 'qualification',



  leadTemperature: 'warm'



}



‚úÖ System fields updated for message webhook



üîÑ [PIPELINE] Syncing opportunity stage for contact Qyiz7MFsHji0OVBP7WJh: {



  currentStage: '(none)',



  targetStage: 'INTAKE',



  context: {



    aiPhase: 'qualification',



    depositLinkSent: false,



    depositPaid: false,



    consultType: null,



    hasUpcomingTattoo: false,



    tattooCompleted: false,



    lost: false



  }



}



‚ùå Error syncing opportunity stage from message webhook: Request failed with status code 422



üîÑ Refetched contact after system field update for AI call.



ü§ñ Processing message with payload summary: {



  contactId: 'Qyiz7MFsHji0OVBP7WJh',



  leadTemperature: 'warm',



  aiPhase: 'qualification',



  language: 'English',



  hasTattooPlacement: true,



  hasTattooSize: true,



  depositPaid: false,



  depositLinkSent: false



}



üîÑ New generation 13 for contact Qyiz7MFsHji0OVBP7WJh



üì± Channel emoji support: yes



ü§ñ Raw OpenAI opener response: {



  "language": "en",



  "bubbles": [



    "Perfect, December works for your calf piece in thick cursive.",



    "The next step is a quick 15‚Äì20 minute consultation with the artist to fully understand your design.",



    "Would you prefer a video call or to go back and forth in messages?"



  ],



  "internal_notes": "Acknowledged timing and tattoo details, introduced consult and asked for preferred consult mode.",



  "meta": {



    "aiPhase": "qualification",



    "leadTemperature": "warm",



    "wantsDepositLink": false,



    "depositPushedThisTurn": false,



    "mentionDecoyOffered": false,



    "consultMode": "online"



  },



  "field_updates": {



    "how_soon_is_client_deciding": "December"



  }



}



üß† AI DECISION SUMMARY {



  aiPhaseFromAI: 'qualification',



  leadTemperatureFromAI: 'warm',



  wantsDepositLink: false,



  wantsAppointmentOffer: undefined,



  consultMode: 'online',



  depositPushedThisTurn: false,



  mentionDecoyOffered: false,



  field_updates: { how_soon_is_client_deciding: 'December' },



  bubblesPreview: [



    'Perfect, December works for your calf piece in thick cursive.',



    'The next step is a quick 15‚Äì20 minute consultation with the artist to fully unde',



    'Would you prefer a video call or to go back and forth in messages?'



  ]



}



ü§ñ AI DM suggestion: {



  "language": "en",



  "bubbles": [



    "Perfect, December works for your calf piece in thick cursive.",



    "The next step is a quick 15‚Äì20 minute consultation with the artist to fully understand your design.",



    "Would you prefer a video call or to go back and forth in messages?"



  ],



  "internal_notes": "Acknowledged timing and tattoo details, introduced consult and asked for preferred consult mode.",



  "meta": {



    "aiPhase": "qualification",



    "leadTemperature": "warm",



    "wantsDepositLink": false,



    "depositPushedThisTurn": false,



    "mentionDecoyOffered": false,



    "consultMode": "online"



  },



  "field_updates": {



    "how_soon_is_client_deciding": "December"



  }



}



üìù Limiting bubbles from 3 to 2



‚úâÔ∏è sendConversationMessage context: { contactId: 'Qyiz7MFsHji0OVBP7WJh', isDm: true, hasPhone: false }



üîç No conversationId provided for DM, searching for existing conversation...



‚úÖ Found existing conversation JYEWlRqhtZQmz2TQtjnT with type FB



‚úÖ Using conversation type FB from GHL conversation - skipping ID validation



üì® Sending DM reply via GHL: {



  conversationId: 'JYEWlRqhtZQmz2TQtjnT',



  contactId: 'Qyiz7MFsHji0OVBP7WJh',



  message: 'Perfect, December works for your calf piece in thick cursive.',



  type: 'FB'



}



üì® GHL DM reply response: {



  status: 201,



  contactId: 'Qyiz7MFsHji0OVBP7WJh',



  conversationId: 'JYEWlRqhtZQmz2TQtjnT'



}



‚è± Waiting 12000ms before sending bubble 2...



‚úâÔ∏è sendConversationMessage context: { contactId: 'Qyiz7MFsHji0OVBP7WJh', isDm: true, hasPhone: false }



üîç No conversationId provided for DM, searching for existing conversation...



‚úÖ Found existing conversation JYEWlRqhtZQmz2TQtjnT with type FB



‚úÖ Using conversation type FB from GHL conversation - skipping ID validation



üì® Sending DM reply via GHL: {



  conversationId: 'JYEWlRqhtZQmz2TQtjnT',



  contactId: 'Qyiz7MFsHji0OVBP7WJh',



  message: 'The next step is a quick 15‚Äì20 minute consultation with the artist to fully understand your design.',



  type: 'FB'



}



üì® GHL DM reply response: {



  status: 201,



  contactId: 'Qyiz7MFsHji0OVBP7WJh',



  conversationId: 'JYEWlRqhtZQmz2TQtjnT'



}



üì§ Sent AI bubbles to GHL conversation.



üß† Updating contact system fields from AI meta: {



  ai_phase: 'qualification',



  lead_temperature: 'warm',



  consult_explained: undefined



}



üßæ Applying AI field_updates to GHL: { how_soon_is_client_deciding: 'December' }



‚úÖ Updated tattoo fields for contact Qyiz7MFsHji0OVBP7WJh with { how_soon_is_client_deciding: 'December' }



‚ÑπÔ∏è No deposit link created (either not requested, already sent, or already paid). { wantsDepositLink: false, alreadyPaid: false, alreadySent: false }



POST /ghl/message-webhook



üí¨ GHL MESSAGE WEBHOOK HIT



Raw Body: {



  "consult_explained": "Yes",



  "AI Creative Response": "",



  "Tattoo Style": "cursive",



  "Promotional Link": "",



  "Appt 2: Start Time": "",



  "deposit_confirmation_sent": "",



  "Deposit Made On": "",



  "pending_slot_artist": "",



  "utm medium": "",



  "pending_slot_calendar": "",



  " Appt 2: Cancellation Link": "",



  "total_tattoos_completed": "",



  "Appt 1: Reschedule Link": "",



  "Tattoo Concerns": "",



  "Appt 1: Service": "",



  "reschedule_pending": "",



  "Appt 3: Reschedule Link": "",



  "utm campaign": "",



  "TikTok": "",



  "Tattoo Title": "",



  "reschedule_target_translator_appointment_id": "",



  "Follow Up Reason": "",



  "Technician's Address": "",



  "Square Payment ID": "",



  "Technician's Photo ID": "",



  "pending_slot_end": "",



  "I have been fully informed of the risks of body art including but not limited to infection, scarring, and allergic reactions to items associated with body art procedures. Technician will not perform the body art procedure if you fail to complete or sign this form. Further, technician may decline to perform a body art procedure if the client has any identified health conditions. Having been informed of the potential risks associated with this body art procedure, I still wish to proceed with the body art application and I assume any/all risks that may arise from body art.": "",



  "Appt 2: Start Date": "",



  "Appt 1: End Time": "",



  "Customer Lifetime Value": "",



  "times_sent": "",



  "Language Preference": "English",



  "First Tattoo": "",



  "pending_slot_mode": "",



  "Appt 2: Google Calendar": "",



  "Artist Inquired (Deseado)": "",



  "hold_last_activity_at": "",



  "last_released_slot_start": "",



  "AI Email Subject": "",



  "Instagram": "",



  "Appt 1: IOS/Outlook Calendar": "",



  "First Assigned Barber": "",



  "Appt 1: Start Date": "",



  "Deposit Paid": "",



  "Artist": "",



  "last_released_slot_display": "",



  "Appt 3: Cancellation Link": "",



  "Preferred Artist": "",



  "pending_slot_start": "",



  "Lead Temperature": "warm",



  "Square Payment Status": "",



  "Deposit": "",



  "Appt 3: Google Calendar": "",



  "Appt 3: IOS/Outlook Calendar": "",



  "Emergency Contact": "",



  "Appt 3: Start Date": "",



  "Whatsapp User?": "",



  "Other Social Media": "",



  "Technician's Phone Number": "",



  "Tattoo Color Preference": "",



  "Appt 1: Cancellation Link": "",



  "Last SMS": "",



  "Valid Body Art License": "",



  "Flash Tattoo": "",



  "Appt 1: Assigned User": "",



  "square_payment_link_id": "",



  "last_released_slot_calendar": "",



  "Rent vs Commission": "",



  "Appt 1: Start Time": "",



  "pending_slot_display": "",



  "Location of Tattoo": "",



  "I {{contact.full_name}}, the client, confirm that I have read the above statements, and by checking \"Yes\" below, you give your consent to receive BODY ART.": "",



  "Appt 3: Assigned User": "",



  "Referral: Current Referral Points": "",



  "How would you like us to contact you?": "",



  "returning_client": "",



  "hold_warning_sent": "",



  "Appt 3: End Time": "",



  "consultation_type": "appointment",



  "Final Price": "",



  "Upload a Picture of a Valid ID (Driver's License, Gov ID, etc)": "",



  "Best time to contact you": "",



  "Notes to the Artist? (Optional)": "",



  "language_barrier_explained": "",



  "Application Notes": "",



  "Deposit Link Sent": "",



  "Tattoo Placement": "calf",



  "Appt 2: Reschedule Link": "",



  "client_lifetime_value": "",



  "Dwelling Type": "",



  "Appt 3: Start Time": "",



  "utm source": "",



  "Appt 1: Google Calendar": "",



  "Date of Procedure:": "",



  "Technician's DOB": "",



  "Referral Link Shortened": "",



  "reschedule_target_appointment_id": "",



  "hold_appointment_id": "",



  "Appt 2: IOS/Outlook Calendar": "",



  "Medical History": "",



  "Medical History (Description)": "",



  "Square Order ID": "",



  "Date Picker 3k8r": "",



  "Last Phase Update At": "2025-12-09T02:46:23.536Z",



  "Photo Reference (Referencia)": "",



  "Assigned Technician License #": "",



  "translator_needed": "Yes",



  "Google Meet Link": "",



  "How Soon Is Client Deciding?": "December",



  "Work Experience": "",



  "Appt 3: Service": "",



  "Appt 2: Service": "",



  "Project Complexity": "",



  "Appt 2: End Time": "",



  "Appt 2: Assigned User": "",



  "Square Reference ID": "",



  "translator_appointment_id": "",



  "Tattoo Photo Description": "",



  "Body Art License Number": "",



  "last_released_slot_end": "",



  "Tattoo Size": "about the size of 2 hands",



  "Appt 3: End Date": "",



  "Tattoo Summary": "kid's name in thick cursive font on calf",



  "AI Phase": "qualification",



  "Next Follow Up At": "",



  "Assigned Technician": "",



  "contact_id": "Qyiz7MFsHji0OVBP7WJh",



  "first_name": "Maria",



  "last_name": "Claflin",



  "full_name": "Maria Claflin",



  "tags": "dm consultation request",



  "country": "US",



  "date_created": "2025-12-09T02:33:29.307Z",



  "full_address": "",



  "contact_type": "lead",



  "location": {



    "name": "Studio AZ Tattoo",



    "address": "333 Washington Ave N STE 100",



    "city": "Minneapolis",



    "state": "Minnesota",



    "country": "US",



    "postalCode": "55401",



    "fullAddress": "333 Washington Ave N STE 100, Minneapolis Minnesota 55401",



    "id": "mUemx2jG4wly4kJWBkI4"



  },



  "message": {



    "type": 11,



    "body": "Ok I‚Äôm free this week. What times do you have this week?"



  },



  "workflow": {



    "id": "8cf237bb-6cb1-4240-8ca5-b797bba8b769",



    "name": "Testing Ai Bot"



  },



  "triggerData": {},



  "contact": {



    "attributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    },



    "lastAttributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    }



  },



  "attributionSource": {},



  "customData": {



    "contactId": "Qyiz7MFsHji0OVBP7WJh",



    "messageBody": "Ok I‚Äôm free this week. What times do you have this week?"



  }



}



üì° Channel context: { isDm: true, hasPhone: false, conversationId: null, phone: null }



Parsed contactId from message webhook: Qyiz7MFsHji0OVBP7WJh



‚úÖ Loaded Contact from GHL (message webhook): {



  id: 'Qyiz7MFsHji0OVBP7WJh',



  firstName: 'Maria',



  lastName: 'Claflin',



  tags: [ 'dm consultation request' ]



}



üì© Incoming message text (for language detection): Ok I‚Äôm free this week. What times do you have this week?



üåê Updating language_preference based on DM/SMS detection: { previous: null, next: 'English' }



‚úÖ language_preference updated to English for contact: Qyiz7MFsHji0OVBP7WJh



üß† Derived system state (message): {



  currentPhase: 'qualification',



  newPhase: 'qualification',



  leadTemperature: 'warm'



}



‚úÖ System fields updated for message webhook



üîÑ [PIPELINE] Syncing opportunity stage for contact Qyiz7MFsHji0OVBP7WJh: {



  currentStage: '(none)',



  targetStage: 'INTAKE',



  context: {



    aiPhase: 'qualification',



    depositLinkSent: false,



    depositPaid: false,



    consultType: null,



    hasUpcomingTattoo: false,



    tattooCompleted: false,



    lost: false



  }



}



‚ùå Error syncing opportunity stage from message webhook: Request failed with status code 422



üîÑ Refetched contact after system field update for AI call.



ü§ñ Processing message with payload summary: {



  contactId: 'Qyiz7MFsHji0OVBP7WJh',



  leadTemperature: 'warm',



  aiPhase: 'qualification',



  language: 'English',



  hasTattooPlacement: true,



  hasTattooSize: true,



  depositPaid: false,



  depositLinkSent: false



}



üîÑ New generation 14 for contact Qyiz7MFsHji0OVBP7WJh



üì± Channel emoji support: yes



üéØ SLOT SELECTION DETECTED - user is picking a specific time



üïê TIME-FIRST MODE: No explicit artist preference, showing all artists' availability



üìÖ [SLOT_GENERATION] Generating synthetic slots (preferredDay: none, preferredTimeWindow: none)



üìÖ [SLOT_GENERATION] Generated 3 synthetic slots



üìä Artist workloads: {"Joan":0,"Andrew":0,"Artist2":0,"Artist3":0,"Artist4":0}, sorted order: Joan, Andrew



‚ùå Error fetching artist workloads: {



  message: [



    'property pagination should not exist',



    'Query must not exceed 75 characters',



    'query must be a string'



  ],



  error: 'Unprocessable Entity',



  statusCode: 422,



  traceId: 'b55ddbd5-8b09-4838-b371-d1e069842c87'



}



üìÖ TIME-FIRST: Presenting 3 slots (online): [



  'Tuesday, Dec 9 at 5pm [Joan]',



  'Wednesday, Dec 10 at 5pm [Joan]',



  'Thursday, Dec 11 at 5pm [Joan]'



]



üìÖ Detected availability question - not a slot selection



‚ö†Ô∏è Could not match slot selection to available slots - asking to pick from list



‚úâÔ∏è sendConversationMessage context: { contactId: 'Qyiz7MFsHji0OVBP7WJh', isDm: true, hasPhone: false }



üîç No conversationId provided for DM, searching for existing conversation...



‚úÖ Found existing conversation JYEWlRqhtZQmz2TQtjnT with type FB



‚úÖ Using conversation type FB from GHL conversation - skipping ID validation



üì® Sending DM reply via GHL: {



  conversationId: 'JYEWlRqhtZQmz2TQtjnT',



  contactId: 'Qyiz7MFsHji0OVBP7WJh',



  message: "I couldn't quite catch that ‚Äî which of these times works for you?\n" +



    '\n' +



    '1. Tuesday, Dec 9 at 5pm\n' +



    '2. Wednesday, Dec 10 at 5pm\n' +



    '3. Thursday, Dec 11 at 5pm',



  type: 'FB'



}



üì® GHL DM reply response: {



  status: 201,



  contactId: 'Qyiz7MFsHji0OVBP7WJh',



  conversationId: 'JYEWlRqhtZQmz2TQtjnT'



}



POST /ghl/message-webhook



üí¨ GHL MESSAGE WEBHOOK HIT



Raw Body: {



  "consult_explained": "Yes",



  "AI Creative Response": "",



  "Tattoo Style": "cursive",



  "Promotional Link": "",



  "Appt 2: Start Time": "",



  "deposit_confirmation_sent": "",



  "Deposit Made On": "",



  "pending_slot_artist": "",



  "utm medium": "",



  "pending_slot_calendar": "",



  " Appt 2: Cancellation Link": "",



  "total_tattoos_completed": "",



  "Appt 1: Reschedule Link": "",



  "Tattoo Concerns": "",



  "Appt 1: Service": "",



  "reschedule_pending": "",



  "Appt 3: Reschedule Link": "",



  "utm campaign": "",



  "TikTok": "",



  "Tattoo Title": "",



  "reschedule_target_translator_appointment_id": "",



  "Follow Up Reason": "",



  "Technician's Address": "",



  "Square Payment ID": "",



  "Technician's Photo ID": "",



  "pending_slot_end": "",



  "I have been fully informed of the risks of body art including but not limited to infection, scarring, and allergic reactions to items associated with body art procedures. Technician will not perform the body art procedure if you fail to complete or sign this form. Further, technician may decline to perform a body art procedure if the client has any identified health conditions. Having been informed of the potential risks associated with this body art procedure, I still wish to proceed with the body art application and I assume any/all risks that may arise from body art.": "",



  "Appt 2: Start Date": "",



  "Appt 1: End Time": "",



  "Customer Lifetime Value": "",



  "times_sent": "",



  "Language Preference": "English",



  "First Tattoo": "",



  "pending_slot_mode": "",



  "Appt 2: Google Calendar": "",



  "Artist Inquired (Deseado)": "",



  "hold_last_activity_at": "",



  "last_released_slot_start": "",



  "AI Email Subject": "",



  "Instagram": "",



  "Appt 1: IOS/Outlook Calendar": "",



  "First Assigned Barber": "",



  "Appt 1: Start Date": "",



  "Deposit Paid": "",



  "Artist": "",



  "last_released_slot_display": "",



  "Appt 3: Cancellation Link": "",



  "Preferred Artist": "",



  "pending_slot_start": "",



  "Lead Temperature": "warm",



  "Square Payment Status": "",



  "Deposit": "",



  "Appt 3: Google Calendar": "",



  "Appt 3: IOS/Outlook Calendar": "",



  "Emergency Contact": "",



  "Appt 3: Start Date": "",



  "Whatsapp User?": "",



  "Other Social Media": "",



  "Technician's Phone Number": "",



  "Tattoo Color Preference": "",



  "Appt 1: Cancellation Link": "",



  "Last SMS": "",



  "Valid Body Art License": "",



  "Flash Tattoo": "",



  "Appt 1: Assigned User": "",



  "square_payment_link_id": "",



  "last_released_slot_calendar": "",



  "Rent vs Commission": "",



  "Appt 1: Start Time": "",



  "pending_slot_display": "",



  "Location of Tattoo": "",



  "I {{contact.full_name}}, the client, confirm that I have read the above statements, and by checking \"Yes\" below, you give your consent to receive BODY ART.": "",



  "Appt 3: Assigned User": "",



  "Referral: Current Referral Points": "",



  "How would you like us to contact you?": "",



  "returning_client": "",



  "hold_warning_sent": "",



  "Appt 3: End Time": "",



  "consultation_type": "appointment",



  "Final Price": "",



  "Upload a Picture of a Valid ID (Driver's License, Gov ID, etc)": "",



  "Best time to contact you": "",



  "Notes to the Artist? (Optional)": "",



  "language_barrier_explained": "",



  "Application Notes": "",



  "Deposit Link Sent": "",



  "Tattoo Placement": "calf",



  "Appt 2: Reschedule Link": "",



  "client_lifetime_value": "",



  "Dwelling Type": "",



  "Appt 3: Start Time": "",



  "utm source": "",



  "Appt 1: Google Calendar": "",



  "Date of Procedure:": "",



  "Technician's DOB": "",



  "Referral Link Shortened": "",



  "reschedule_target_appointment_id": "",



  "hold_appointment_id": "",



  "Appt 2: IOS/Outlook Calendar": "",



  "Medical History": "",



  "Medical History (Description)": "",



  "Square Order ID": "",



  "Date Picker 3k8r": "",



  "Last Phase Update At": "2025-12-09T02:47:02.865Z",



  "Photo Reference (Referencia)": "",



  "Assigned Technician License #": "",



  "translator_needed": "Yes",



  "Google Meet Link": "",



  "How Soon Is Client Deciding?": "December",



  "Work Experience": "",



  "Appt 3: Service": "",



  "Appt 2: Service": "",



  "Project Complexity": "",



  "Appt 2: End Time": "",



  "Appt 2: Assigned User": "",



  "Square Reference ID": "",



  "translator_appointment_id": "",



  "Tattoo Photo Description": "",



  "Body Art License Number": "",



  "last_released_slot_end": "",



  "Tattoo Size": "about the size of 2 hands",



  "Appt 3: End Date": "",



  "Tattoo Summary": "kid's name in thick cursive font on calf",



  "AI Phase": "qualification",



  "Next Follow Up At": "",



  "Assigned Technician": "",



  "contact_id": "Qyiz7MFsHji0OVBP7WJh",



  "first_name": "Maria",



  "last_name": "Claflin",



  "full_name": "Maria Claflin",



  "tags": "dm consultation request",



  "country": "US",



  "date_created": "2025-12-09T02:33:29.307Z",



  "full_address": "",



  "contact_type": "lead",



  "location": {



    "name": "Studio AZ Tattoo",



    "address": "333 Washington Ave N STE 100",



    "city": "Minneapolis",



    "state": "Minnesota",



    "country": "US",



    "postalCode": "55401",



    "fullAddress": "333 Washington Ave N STE 100, Minneapolis Minnesota 55401",



    "id": "mUemx2jG4wly4kJWBkI4"



  },



  "message": {



    "type": 11,



    "body": "Tuesday December 9 at 5pm"



  },



  "workflow": {



    "id": "8cf237bb-6cb1-4240-8ca5-b797bba8b769",



    "name": "Testing Ai Bot"



  },



  "triggerData": {},



  "contact": {



    "attributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    },



    "lastAttributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    }



  },



  "attributionSource": {},



  "customData": {



    "contactId": "Qyiz7MFsHji0OVBP7WJh",



    "messageBody": "Tuesday December 9 at 5pm"



  }



}



üì° Channel context: { isDm: true, hasPhone: false, conversationId: null, phone: null }



Parsed contactId from message webhook: Qyiz7MFsHji0OVBP7WJh



‚úÖ Loaded Contact from GHL (message webhook): {



  id: 'Qyiz7MFsHji0OVBP7WJh',



  firstName: 'Maria',



  lastName: 'Claflin',



  tags: [ 'dm consultation request' ]



}



üì© Incoming message text (for language detection): Tuesday December 9 at 5pm



üåê Updating language_preference based on DM/SMS detection: { previous: null, next: 'English' }



‚úÖ language_preference updated to English for contact: Qyiz7MFsHji0OVBP7WJh



üß† Derived system state (message): {



  currentPhase: 'qualification',



  newPhase: 'qualification',



  leadTemperature: 'warm'



}



‚úÖ System fields updated for message webhook



üîÑ [PIPELINE] Syncing opportunity stage for contact Qyiz7MFsHji0OVBP7WJh: {



  currentStage: '(none)',



  targetStage: 'INTAKE',



  context: {



    aiPhase: 'qualification',



    depositLinkSent: false,



    depositPaid: false,



    consultType: null,



    hasUpcomingTattoo: false,



    tattooCompleted: false,



    lost: false



  }



}



‚ùå Error syncing opportunity stage from message webhook: Request failed with status code 422



üîÑ Refetched contact after system field update for AI call.



ü§ñ Processing message with payload summary: {



  contactId: 'Qyiz7MFsHji0OVBP7WJh',



  leadTemperature: 'warm',



  aiPhase: 'qualification',



  language: 'English',



  hasTattooPlacement: true,



  hasTattooSize: true,



  depositPaid: false,



  depositLinkSent: false



}



üîÑ New generation 15 for contact Qyiz7MFsHji0OVBP7WJh



üì± Channel emoji support: yes



üéØ SLOT SELECTION DETECTED - user is picking a specific time



üïê TIME-FIRST MODE: No explicit artist preference, showing all artists' availability



üìÖ [SLOT_GENERATION] Generating slots for 1 specific date(s) using SYNTHETIC times (GHL availability not yet integrated)



üìÖ [SLOT_GENERATION] Generated 2 synthetic slots for dates: 2026-12-09



‚ùå Error fetching artist workloads: {



  message: [



    'property pagination should not exist',



    'Query must not exceed 75 characters',



üìä Artist workloads: {"Joan":0,"Andrew":0,"Artist2":0,"Artist3":0,"Artist4":0}, sorted order: Joan, Andrew



    'query must be a string'



  ],



  error: 'Unprocessable Entity',



  statusCode: 422,



  traceId: '2936c6e1-0f89-4984-b730-b24ddfccf697'



}



üìÖ TIME-FIRST: Presenting 2 slots (online): [ 'Wednesday, Dec 9 at 5pm [Joan]', 'Wednesday, Dec 9 at 6pm [Joan]' ]



‚úÖ Matched month+day with time: dec 9 ‚Üí slot 1



‚úÖ Matched slot 1: Wednesday, Dec 9 at 5pm



üìÖ Booking with artist: Joan, calendar: 2EJcAtrllnYOtuSx4Dua (mode: time-first)



‚ùå Error creating appointment: {



  message: 'The user id not part of calendar team.',



  error: 'Unprocessable Entity',



  statusCode: 422,



  traceId: '1ac46ae2-6983-9184-9b44-602340132b0e'



}



‚ùå Error creating consult appointment: Request failed with status code 422



‚ùå Error creating hold appointment: Request failed with status code 422



‚úâÔ∏è sendConversationMessage context: { contactId: 'Qyiz7MFsHji0OVBP7WJh', isDm: true, hasPhone: false }



üîç No conversationId provided for DM, searching for existing conversation...



‚úÖ Found existing conversation JYEWlRqhtZQmz2TQtjnT with type FB



‚úÖ Using conversation type FB from GHL conversation - skipping ID validation



üì® Sending DM reply via GHL: {



  conversationId: 'JYEWlRqhtZQmz2TQtjnT',



  contactId: 'Qyiz7MFsHji0OVBP7WJh',



  message: 'Sorry, I had trouble booking that time. Can you try picking another option?',



  type: 'FB'



}



üì® GHL DM reply response: {



  status: 201,



  contactId: 'Qyiz7MFsHji0OVBP7WJh',



  conversationId: 'JYEWlRqhtZQmz2TQtjnT'



}



POST /ghl/message-webhook



üí¨ GHL MESSAGE WEBHOOK HIT



Raw Body: {



  "consult_explained": "Yes",



  "AI Creative Response": "",



  "Tattoo Style": "cursive",



  "Promotional Link": "",



  "Appt 2: Start Time": "",



  "deposit_confirmation_sent": "",



  "Deposit Made On": "",



  "pending_slot_artist": "",



  "utm medium": "",



  "pending_slot_calendar": "",



  " Appt 2: Cancellation Link": "",



  "total_tattoos_completed": "",



  "Appt 1: Reschedule Link": "",



  "Tattoo Concerns": "",



  "Appt 1: Service": "",



  "reschedule_pending": "",



  "Appt 3: Reschedule Link": "",



  "utm campaign": "",



  "TikTok": "",



  "Tattoo Title": "",



  "reschedule_target_translator_appointment_id": "",



  "Follow Up Reason": "",



  "Technician's Address": "",



  "Square Payment ID": "",



  "Technician's Photo ID": "",



  "pending_slot_end": "",



  "I have been fully informed of the risks of body art including but not limited to infection, scarring, and allergic reactions to items associated with body art procedures. Technician will not perform the body art procedure if you fail to complete or sign this form. Further, technician may decline to perform a body art procedure if the client has any identified health conditions. Having been informed of the potential risks associated with this body art procedure, I still wish to proceed with the body art application and I assume any/all risks that may arise from body art.": "",



  "Appt 2: Start Date": "",



  "Appt 1: End Time": "",



  "Customer Lifetime Value": "",



  "times_sent": "",



  "Language Preference": "English",



  "First Tattoo": "",



  "pending_slot_mode": "",



  "Appt 2: Google Calendar": "",



  "Artist Inquired (Deseado)": "",



  "hold_last_activity_at": "",



  "last_released_slot_start": "",



  "AI Email Subject": "",



  "Instagram": "",



  "Appt 1: IOS/Outlook Calendar": "",



  "First Assigned Barber": "",



  "Appt 1: Start Date": "",



  "Deposit Paid": "",



  "Artist": "",



  "last_released_slot_display": "",



  "Appt 3: Cancellation Link": "",



  "Preferred Artist": "",



  "pending_slot_start": "",



  "Lead Temperature": "warm",



  "Square Payment Status": "",



  "Deposit": "",



  "Appt 3: Google Calendar": "",



  "Appt 3: IOS/Outlook Calendar": "",



  "Emergency Contact": "",



  "Appt 3: Start Date": "",



  "Whatsapp User?": "",



  "Other Social Media": "",



  "Technician's Phone Number": "",



  "Tattoo Color Preference": "",



  "Appt 1: Cancellation Link": "",



  "Last SMS": "",



  "Valid Body Art License": "",



  "Flash Tattoo": "",



  "Appt 1: Assigned User": "",



  "square_payment_link_id": "",



  "last_released_slot_calendar": "",



  "Rent vs Commission": "",



  "Appt 1: Start Time": "",



  "pending_slot_display": "",



  "Location of Tattoo": "",



  "I {{contact.full_name}}, the client, confirm that I have read the above statements, and by checking \"Yes\" below, you give your consent to receive BODY ART.": "",



  "Appt 3: Assigned User": "",



  "Referral: Current Referral Points": "",



  "How would you like us to contact you?": "",



  "returning_client": "",



  "hold_warning_sent": "",



  "Appt 3: End Time": "",



  "consultation_type": "appointment",



  "Final Price": "",



  "Upload a Picture of a Valid ID (Driver's License, Gov ID, etc)": "",



  "Best time to contact you": "",



  "Notes to the Artist? (Optional)": "",



  "language_barrier_explained": "",



  "Application Notes": "",



  "Deposit Link Sent": "",



  "Tattoo Placement": "calf",



  "Appt 2: Reschedule Link": "",



  "client_lifetime_value": "",



  "Dwelling Type": "",



  "Appt 3: Start Time": "",



  "utm source": "",



  "Appt 1: Google Calendar": "",



  "Date of Procedure:": "",



  "Technician's DOB": "",



  "Referral Link Shortened": "",



  "reschedule_target_appointment_id": "",



  "hold_appointment_id": "",



  "Appt 2: IOS/Outlook Calendar": "",



  "Medical History": "",



  "Medical History (Description)": "",



  "Square Order ID": "",



  "Date Picker 3k8r": "",



  "Last Phase Update At": "2025-12-09T02:47:30.900Z",



  "Photo Reference (Referencia)": "",



  "Assigned Technician License #": "",



  "translator_needed": "Yes",



  "Google Meet Link": "",



  "How Soon Is Client Deciding?": "December",



  "Work Experience": "",



  "Appt 3: Service": "",



  "Appt 2: Service": "",



  "Project Complexity": "",



  "Appt 2: End Time": "",



  "Appt 2: Assigned User": "",



  "Square Reference ID": "",



  "translator_appointment_id": "",



  "Tattoo Photo Description": "",



  "Body Art License Number": "",



  "last_released_slot_end": "",



  "Tattoo Size": "about the size of 2 hands",



  "Appt 3: End Date": "",



  "Tattoo Summary": "kid's name in thick cursive font on calf",



  "AI Phase": "qualification",



  "Next Follow Up At": "",



  "Assigned Technician": "",



  "contact_id": "Qyiz7MFsHji0OVBP7WJh",



  "first_name": "Maria",



  "last_name": "Claflin",



  "full_name": "Maria Claflin",



  "tags": "dm consultation request",



  "country": "US",



  "date_created": "2025-12-09T02:33:29.307Z",



  "full_address": "",



  "contact_type": "lead",



  "location": {



    "name": "Studio AZ Tattoo",



    "address": "333 Washington Ave N STE 100",



    "city": "Minneapolis",



    "state": "Minnesota",



    "country": "US",



    "postalCode": "55401",



    "fullAddress": "333 Washington Ave N STE 100, Minneapolis Minnesota 55401",



    "id": "mUemx2jG4wly4kJWBkI4"



  },



  "message": {



    "type": 11,



    "body": "Can you send the link so I can make my deposit now?"



  },



  "workflow": {



    "id": "8cf237bb-6cb1-4240-8ca5-b797bba8b769",



    "name": "Testing Ai Bot"



  },



  "triggerData": {},



  "contact": {



    "attributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    },



    "lastAttributionSource": {



      "photoUrl": null,



      "sessionSource": "Social media",



      "adId": null,



      "productId": null,



      "videoUrl": null,



      "mediumId": "24364584283244494",



      "utmContent": null,



      "pSid": "24364584283244494",



      "medium": "facebook",



      "postId": null,



      "flowId": null



    }



  },



  "attributionSource": {},



  "customData": {



    "contactId": "Qyiz7MFsHji0OVBP7WJh",



    "messageBody": "Can you send the link so I can make my deposit now?"



  }



}



üì° Channel context: { isDm: true, hasPhone: false, conversationId: null, phone: null }



Parsed contactId from message webhook: Qyiz7MFsHji0OVBP7WJh



‚úÖ Loaded Contact from GHL (message webhook): {



  id: 'Qyiz7MFsHji0OVBP7WJh',



  firstName: 'Maria',



  lastName: 'Claflin',



  tags: [ 'dm consultation request' ]



}



üì© Incoming message text (for language detection): Can you send the link so I can make my deposit now?



üåê Updating language_preference based on DM/SMS detection: { previous: null, next: 'English' }



‚úÖ language_preference updated to English for contact: Qyiz7MFsHji0OVBP7WJh



üß† Derived system state (message): {



  currentPhase: 'qualification',



  newPhase: 'qualification',



  leadTemperature: 'warm'



}



‚úÖ System fields updated for message webhook



üîÑ [PIPELINE] Syncing opportunity stage for contact Qyiz7MFsHji0OVBP7WJh: {



  currentStage: '(none)',



  targetStage: 'INTAKE',



  context: {



    aiPhase: 'qualification',



    depositLinkSent: false,



    depositPaid: false,



    consultType: null,



    hasUpcomingTattoo: false,



    tattooCompleted: false,



    lost: false



  }



}



‚ùå Error syncing opportunity stage from message webhook: Request failed with status code 422



üîÑ Refetched contact after system field update for AI call.



ü§ñ Processing message with payload summary: {



  contactId: 'Qyiz7MFsHji0OVBP7WJh',



  leadTemperature: 'warm',



  aiPhase: 'qualification',



  language: 'English',



  hasTattooPlacement: true,



  hasTattooSize: true,



  depositPaid: false,



  depositLinkSent: false



}



üîÑ New generation 16 for contact Qyiz7MFsHji0OVBP7WJh



üì± Channel emoji support: yes



‚úâÔ∏è sendConversationMessage context: { contactId: 'Qyiz7MFsHji0OVBP7WJh', isDm: true, hasPhone: false }



üîç No conversationId provided for DM, searching for existing conversation...



‚úÖ Found existing conversation JYEWlRqhtZQmz2TQtjnT with type FB



‚úÖ Using conversation type FB from GHL conversation - skipping ID validation



üì® Sending DM reply via GHL: {



  conversationId: 'JYEWlRqhtZQmz2TQtjnT',



  contactId: 'Qyiz7MFsHji0OVBP7WJh',



  message: "Our artist's native language is Spanish. Most clients either do a quick video call with a translator or message the artist directly about the design details ‚Äî both have worked great!\n" +



    '\n' +



    'Which would you prefer?',



  type: 'FB'



}



üì® GHL DM reply response: {



  status: 201,



  contactId: 'Qyiz7MFsHji0OVBP7WJh',



  conversationId: 'JYEWlRqhtZQmz2TQtjnT'
